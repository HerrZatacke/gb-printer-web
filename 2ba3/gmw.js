(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{529:function(t,e,r){"use strict";r.r(e),r.d(e,"init",(function(){return J})),r.d(e,"middleware",(function(){return L})),r.d(e,"updateClient",(function(){return Y}));r(19),r(20),r(83),r(89),r(90),r(102),r(105),r(95),r(146),r(96),r(84),r(97),r(93),r(88),r(92),r(117),r(99),r(118),r(119),r(120),r(86),r(87),r(85);var n=r(429),o=r.n(n),i=r(522),a=r(126),c=r.n(a),u=r(116);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=d(t);if(e){var o=d(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return b(this,r)}}function b(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}(a,t);var e,r,n,o=m(a);function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return p(this,a),(t=o.call(this)).octoKit=null,t.busy=!1,t.owner=null,t.repo=null,t.branch=null,t.token=null,t.progress=0,t.expectedTicks=0,t.setOctokit(e),t}return e=a,(r=[{key:"setOctokit",value:function(t){var e=t.use,r=t.owner,n=t.repo,o=t.branch,a=t.token;if(this.busy||!e||!r||!n||!o||!a)return this.octoKit=null,this.owner=null,this.repo=null,this.branch=null,void(this.token=null);this.owner=r,this.repo=n,this.branch=o,this.token=a,this.octoKit=new i.a({auth:a})}},{key:"progressStart",value:function(t){this.busy=!0,this.emit("starting",{progress:0,busy:this.busy}),this.expectedTicks=t+7,this.progressTick()}},{key:"progressTick",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.octoKit)throw new Error("not configured");this.progress=t?0:this.progress+1,this.emit("progress",{progress:this.progress/this.expectedTicks,busy:!t&&this.busy})}},{key:"getRepoContents",value:function(){var t=this;try{this.progressTick()}catch(t){return Promise.reject(t)}var e=[{path:"images",value:[]},{path:"palettes",value:[]},{path:"png",value:[]},{path:"frames",value:[]},{path:"settings.json",value:{}}];return this.octoKit.repos.getContent({owner:this.owner,repo:this.repo,ref:"heads/".concat(this.branch),path:""}).then((function(r){var n=r.data;return Promise.all(e.map((function(e){var r=e.path,o=e.value;return n.find((function(t){return t.path===r}))?t.octoKit.repos.getContent({owner:t.owner,repo:t.repo,ref:"heads/".concat(t.branch),path:r}).then((function(t){var e=t.data;return{path:r,value:"file"===e.type?JSON.parse(atob(e.content)):e}})).catch((function(){return{path:r,value:o}})):Promise.resolve({path:r,value:o})}))).then((function(t){return{images:t.find((function(t){return"images"===t.path})).value,palettes:t.find((function(t){return"palettes"===t.path})).value,png:t.find((function(t){return"png"===t.path})).value,frames:t.find((function(t){return"frames"===t.path})).value,settings:t.find((function(t){return"settings.json"===t.path})).value}}))}))}},{key:"getBlob",value:function(t){return this.octoKit.git.getBlob({owner:this.owner,repo:this.repo,file_sha:t}).then((function(t){var e=t.data.content;return atob(e)}))}},{key:"getCurrentCommit",value:function(){var t=this;try{this.progressTick()}catch(t){return Promise.reject(t)}return this.octoKit.git.getRef({owner:this.owner,repo:this.repo,ref:"heads/".concat(this.branch)}).then((function(e){var r=e.data.object.sha;return t.octoKit.git.getCommit({owner:t.owner,repo:t.repo,commit_sha:r}).then((function(t){var e=t.data;return{commitSha:r,treeSha:e.tree.sha}}))}))}},{key:"createBlobForFile",value:function(t){var e=this,r=t.destination,n=t.blob;try{this.progressTick()}catch(t){return Promise.reject(t)}return new Promise((function(t){var e=new FileReader;e.onloadend=function(e){var r=e.target;t(r.result)},e.readAsDataURL(n)})).then((function(t){var n=t.indexOf(";base64,")+8,o=t.substr(n);return e.octoKit.git.createBlob({owner:e.owner,repo:e.repo,content:o,encoding:"base64"}).then((function(t){var e=t.data;return{filename:r,blobData:e}}))}))}},{key:"createNewTree",value:function(t,e){var r=t.files,n=t.del;try{this.progressTick()}catch(t){return Promise.reject(t)}var o=r.map((function(t){return{path:t.filename,mode:"100644",type:"blob",sha:t.blobData.sha}})),i=n.map((function(t){return{path:t.path,mode:"100644",sha:null}}));return this.octoKit.git.createTree({owner:this.owner,repo:this.repo,tree:[].concat(f(o),f(i)),base_tree:e}).then((function(t){return t.data}))}},{key:"createNewCommit",value:function(t,e,r){try{this.progressTick()}catch(t){return Promise.reject(t)}return this.octoKit.git.createCommit({owner:this.owner,repo:this.repo,message:t,tree:e,parents:[r]}).then((function(t){return t.data}))}},{key:"setBranchToCommit",value:function(t){try{this.progressTick()}catch(t){return Promise.reject(t)}return this.octoKit.git.updateRef({owner:this.owner,repo:this.repo,ref:"heads/".concat(this.branch),sha:t}).then((function(t){return t.data}))}},{key:"uploadToRepo",value:function(t){var e=this,r=t.upload,n=t.del;try{this.progressTick()}catch(t){return Promise.reject(t)}var o="Sync. ".concat(c()().format(u.d));return this.getCurrentCommit().then((function(t){var i=t.treeSha,a=t.commitSha;return Promise.all(r.map((function(t){return e.createBlobForFile(t)}))).then((function(t){return e.createNewTree({files:t,del:n},i)})).then((function(t){var r=t.sha;return e.createNewCommit(o,r,a)})).then((function(t){var r=t.sha;return e.setBranchToCommit(r)}))}))}},{key:"updateRemoteStore",value:function(t){var e=this,r=t.upload,n=void 0===r?[]:r,o=t.del,i=void 0===o?[]:o;return this.busy?Promise.reject(Error("currently busy")):n.length||i.length?(this.progressStart(n.length),this.uploadToRepo({upload:n,del:i}).then((function(){return e.progressTick(!0),e.busy=!1,{uploaded:n.map((function(t){return t.destination})),deleted:i.map((function(t){return t.path})),repo:"https://github.com/".concat(e.owner,"/").concat(e.repo,"/tree/").concat(e.branch)}})).catch((function(t){throw e.busy=!1,e.emit("error",t),t}))):Promise.resolve({})}}])&&h(e.prototype,r),n&&h(e,n),a}(o.a),v=(r(94),r(100),r(109),r(108),r(110),r(107),r(101),r(189)),w=r(163),O=r(166),j=r(165);function S(t){return function(t){if(Array.isArray(t))return A(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return A(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return A(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function T(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function k(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?T(Object(r),!0).forEach((function(e){P(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function P(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var R=function(t){var e=Object(v.a)(k(k({},t),{},{exportScaleFactors:[1],exportFileTypes:["png","txt"],exportCropFrame:!1})),r=[];return Promise.all([].concat(S(t.images.map((function(n){return Object(w.a)(n,t,!0).then((function(o){return o.length?e(Object(O.a)(t,n),n)(o).then((function(t){return k(k({},n),{},{files:t})})):(r.push(n.hash),Promise.resolve(null))}))}))),S(t.frames.map((function(t){return Object(j.a)(t.id).then((function(e){return k(k({},t),{},{hash:t.id,files:[{folder:"frames",filename:"",blob:new Blob(new Array(JSON.stringify(e||"{}",null,2)),{type:"application/json"}),title:t.name}]})}))}))))).then((function(t){return{imageCollection:t.filter(Boolean),missingLocally:r}}))},C=(r(123),r(437)),E=r.n(C),I=r(233);function _(t){return function(t){if(Array.isArray(t))return x(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return x(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var B=function(t){var e=[];t.forEach((function(t){var r=t.hash,n=t.files,o=t.hashes;e.push.apply(e,_(n.map((function(t){var e=t.blob,n=t.title,i=t.folder,a=E.a.extension(e.type);return{destination:"".concat(i||a,"/").concat(r,".").concat(a),blob:e,extension:a,title:n,hash:o?null:r}}))))}));var r=e.filter((function(t){return"png"===t.extension})).map((function(t){var e=t.destination,r=t.hash,n=t.title;return r?"[![".concat(n,"](").concat(e,' "').concat(n,'")](images/').concat(r,".txt)"):"![".concat(n,"](").concat(e,' "').concat(n,'")')})).join("\n"),n=Object(I.a)("remote");return e.push({destination:"README.md",blob:new Blob(_(r),{type:"text/plain"})},{destination:"settings.json",blob:new Blob(_(n),{type:"application/json"})}),e.filter(Boolean)};function K(t){return function(t){if(Array.isArray(t))return D(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return D(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return D(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var N=function(t,e,r){var n=t.images,o=t.png,i=t.palettes,a=t.frames;return{upload:e.filter((function(t){var e=t.destination;return!(n.find((function(t){return t.path===e}))||i.find((function(t){return t.path===e}))||o.find((function(t){return t.path===e}))||a.find((function(t){return t.path===e})))})),del:[].concat(K([].concat(K(n),K(o)).filter((function(t){var n=t.path;return!e.find((function(t){var e=t.destination;return n===e}))&&!r.find((function(t){return n.indexOf(t)>=-1}))}))),K([].concat(K(i),K(a)).filter((function(t){var r=t.path;return!e.find((function(t){var e=t.destination;return r===e}))}))))}},F=(r(219),r(133),r(134),r(106),r(132),r(124),r(128));function G(t){return function(t){if(Array.isArray(t))return M(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return M(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var U,$=function(t){return function(e){var r=e.images,n=e.frames;return Promise.all([].concat(G(r.map((function(e){var r=e.name.substr(0,40);return Object(F.b)(r,null,!0).then((function(n){return n.length?r:t.getBlob(e.sha).then((function(t){var e=t.split("\n").filter((function(t){return t.match(/^[0-9a-f ]+$/gi)}));return Object(F.c)(e)}))}))}))),G(n.map((function(e){var r=e.name.match(/^[a-z]+[0-9]+/gi)[0];return Object(j.a)(r).then((function(n){return n?r:t.getBlob(e.sha).then((function(t){var e=JSON.parse(t,null,2),n=Array(32).fill("f").join(""),o=Array(16).fill(n),i=[].concat(G(e.upper),G(Array(14).fill().map((function(t,r){return[].concat(G(e.left[r]),G(o),G(e.right[r]))})).flat()),G(e.lower));return Object(j.b)(r,i)}))}))})))))}},J=function(t){var e=t.getState().gitStorage;(U=new g(e)).on("progress",(function(e){t.dispatch({type:"GITSTORAGE_PROGRESS",payload:e})}))},L=function(t){return function(e){if("GITSTORAGE_SYNC_START"===e.type){var r=t.getState();U.getRepoContents().then((function(n){switch(e.payload){case"up":return R(r).then((function(t){var e=t.missingLocally,r=t.imageCollection,o=B(r);return N(n,o,e)})).then((function(t){return U.updateRemoteStore(t)}));case"down":return $(U)(n).then((function(e){return t.dispatch({type:"SETTINGS_IMPORT",payload:n.settings}),e}));default:return Promise.reject(new Error("wrong sync case"))}})).catch((function(e){return console.error(e),t.dispatch({type:"ERROR",payload:e.message}),e.message})).then((function(e){t.dispatch({type:"GITSTORAGE_SYNC_DONE",payload:e})}))}}},Y=function(t){U.setOctokit(t)}}}]);