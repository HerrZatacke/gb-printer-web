(self.webpackChunkgb_printer_web=self.webpackChunkgb_printer_web||[]).push([[991],{41238:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return G}});n(41539),n(88674),n(32564),n(83710),n(92222),n(21249),n(66992),n(78783),n(33948),n(84944),n(33792),n(57327),n(69826),n(68309),n(26699),n(69070),n(47941),n(82526),n(38880),n(89554),n(54747),n(49337),n(33321);var r=n(27484),o=n.n(r),a=n(25009),i=n.n(a),c=n(42146),u=n(15203),s=(n(24812),n(69600),n(74916),n(15306),n(23157),n(19601),n(68304),n(30489),n(12419),n(78011),n(79753),n(41817),n(32165),n(91038),n(47042),n(18475)),l=n(17187),f=n(36965),p=n(35820),h=n(25108);function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},w(t,e)}function x(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O(t);if(e){var o=O(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return j(this,n)}}function j(t,e){if(e&&("object"===d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return P(t)}function P(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function O(t){return O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},O(t)}var k=encodeURIComponent("".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname)),S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}(a,t);var e,n,r,o=x(a);function a(t,e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=o.call(this)).queueCallback=e,n.throttle=30;var r=t.accessToken,i=t.expiresAt,c=t.refreshToken,u=t.path,l=t.autoDropboxSync;return n.setRootPath(u),n.dbx=new s.Dropbox({clientId:"err6neqzlljod7b",accessToken:r,accessTokenExpiresAt:new Date(i),refreshToken:c}),window.dbx=n.dbx,n.requestError=n.requestError.bind(P(n)),l&&n.startLongPollSettings(),n}return e=a,n=[{key:"addToQueue",value:function(){return this.dbx.auth.getAccessToken()?this.queueCallback.apply(this,arguments):Promise.reject()}},{key:"setRootPath",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.rootPath=(0,p.Z)(t).split("/")}},{key:"toPath",value:function(t){var e=[].concat(b(this.rootPath),b(t.split("/"))).filter(Boolean);return"/".concat(e.join("/"))}},{key:"inSettingsPath",value:function(t){var e=this.toPath("settings");return(0,p.Z)(t.replace(e,""))}},{key:"checkLoginStatus",value:function(){var t=this;return this.dbx.auth.checkAndRefreshAccessToken().catch(this.requestError).then((function(){var e=t.dbx.auth.getAccessToken(),n=t.dbx.auth.getAccessTokenExpiresAt().getTime(),r=n-(new Date).getTime();return t.emit("loginDataUpdate",{accessToken:e,expiresAt:n}),e&&r>1e3})).catch((function(){return!1}))}},{key:"startAuth",value:function(){var t=this;this.dbx.auth.getAuthenticationUrl(k,void 0,"code","offline",void 0,void 0,!0).then((function(e){window.sessionStorage.setItem("dropboxCodeVerifier",t.dbx.auth.getCodeVerifier()),window.location.replace(e)}))}},{key:"codeAuth",value:function(t){var e=this;this.dbx.auth.setCodeVerifier(window.sessionStorage.getItem("dropboxCodeVerifier")),window.sessionStorage.removeItem("dropboxCodeVerifier"),this.dbx.auth.getAccessTokenFromCode(k,t).then((function(t){var n=t.result,r=n.refresh_token,o=n.access_token,a=n.expires_in,i=(new Date).getTime()+1e3*a;e.dbx.auth.setAccessToken(t.result.access_token),e.dbx.auth.setAccessTokenExpiresAt(new Date(i)),e.emit("loginDataUpdate",{refreshToken:r,accessToken:o,expiresAt:i})}))}},{key:"requestError",value:function(t){var e;throw t.error.error_summary.startsWith("expired_access_token")&&(this.dbx.auth.setAccessTokenExpiresAt(new Date(0)),this.dbx.auth.setAccessToken(null)),new Error((null==t||null===(e=t.error)||void 0===e?void 0:e.error_summary)||(null==t?void 0:t.error)||t)}},{key:"getRemoteContents",value:function(t){var e=this,n=["images","frames"],r="diff"===t;return this.checkLoginStatus().then((function(t){if(!t)throw new Error("not logged in");return e.addToQueue("dbx.filesDownload /settings.json",e.throttle,(function(){return e.dbx.filesDownload({path:e.toPath("/settings/settings.json")}).catch(e.requestError)}),r).catch((function(){return{result:{fileBlob:new Blob(b("{}"),{type:"text/plain"})}}})).then((function(t){var o=t.result.fileBlob;return(0,f.Z)(o,"text").then((function(t){return JSON.parse(t)})).then((function(t){return Promise.all(n.map((function(t){return e.addToQueue("dbx.filesListFolder /".concat(t),e.throttle,(function(){return e.dbx.filesListFolder({path:e.toPath("/settings/".concat(t)),limit:250,recursive:!0}).catch(e.requestError)}),r).catch((function(){return{result:{entries:[],has_more:!1}}})).then((function(t){var n=t.result,o=n.entries,a=n.has_more,i=n.cursor;return(a?e.getMoreContents(i,o,r):Promise.resolve(o)).then((function(t){return t.filter((function(t){return"file"===t[".tag"]}))}))}))}))).then((function(n){var o=y(n,2),a=o[0],i=o[1];return{images:e.augmentFileList("images",a,r),frames:e.augmentFileList("frames",i,r),settings:t}}))}))}))}))}},{key:"getImageContents",value:function(){var t=this;return this.addToQueue("dbx.filesListFolder /images",this.throttle,(function(){return t.dbx.filesListFolder({path:t.toPath("/images"),limit:250,recursive:!0}).catch(t.requestError)})).catch((function(){return{result:{entries:[],has_more:!1}}})).then((function(e){var n=e.result,r=n.entries,o=n.has_more,a=n.cursor;return(o?t.getMoreContents(a,r):Promise.resolve(r)).then((function(t){return t.filter((function(t){return"file"===t[".tag"]}))}))}))}},{key:"getMoreContents",value:function(t,e,n){var r=this;return this.addToQueue("dbx.filesListFolderContinue ".concat(t),this.throttle,(function(){return r.dbx.filesListFolderContinue({cursor:t}).catch(r.requestError)}),n).then((function(t){var o=t.result,a=o.entries,i=o.has_more,c=o.cursor,u=e.concat(a);return i?r.getMoreContents(c,u,n):u}))}},{key:"augmentFileList",value:function(t,e,n){var r=this;return e.map((function(o,a){var i=o.path_lower,c=o.content_hash,u=o.name,s=r.inSettingsPath(i),l={path:s,name:u,contentHash:c,getFileContent:function(){return r.getFileContent(s,a,e.length,n)}};switch(t){case"images":case"frames":return Object.assign(l,{hash:u.substr(0,40)});default:return l}}))}},{key:"getFileContent",value:function(t,e,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a="dbx.filesDownload (".concat(e+1,"/").concat(n,") ").concat(t);return this.addToQueue(a,this.throttle,(function(){return r.dbx.filesDownload({path:r.toPath("/settings/".concat(t))}).catch(r.requestError)}),o).then((function(t){var e=t.result.fileBlob;return(0,f.Z)(e,"text")}))}},{key:"upload",value:function(t,e){var n=this,r=t.upload,o=void 0===r?[]:r,a=t.del,i=void 0===a?[]:a;return Promise.all([o.length?Promise.all(o.map((function(t,r){return n.addToQueue("dbx.filesUpload (".concat(r+1,"/").concat(o.length,") ").concat(t.destination),n.throttle,(function(){return n.dbx.filesUpload({path:n.toPath("/".concat(e,"/").concat(t.destination)),contents:t.blob,mode:"overwrite"}).catch(n.requestError)})).then((function(t){return t.result}))}))):[],i.length?this.addToQueue("dbx.filesDeleteBatch ".concat(i.length," files"),this.throttle,(function(){return n.dbx.filesDeleteBatch({entries:i.map((function(t){var e=t.path;return{path:n.toPath("/settings/".concat(e))}}))}).catch(n.requestError)})).then((function(t){var e=t.result.async_job_id;return function t(){return n.addToQueue("dbx.filesDeleteBatchCheck ".concat(e),2e3,(function(){return n.dbx.filesDeleteBatchCheck({async_job_id:e}).catch(n.requestError)})).then((function(e){var n=e.result,r=n[".tag"],o=n.entries;return"in_progress"===r?t():o.map((function(t){return t.metadata}))}))}()})):[]]).then((function(t){var e=y(t,2),n=e[0],r=e[1];h.log({uploaded:n,deleted:r})}))}},{key:"startLongPollSettings",value:function(){var t=this;h.info("Start dropbox longpolling"),this.dbx.filesListFolderGetLatestCursor({path:this.toPath("/settings"),recursive:!1,include_media_info:!1,include_deleted:!1,include_has_explicit_shared_members:!1}).then((function(e){var n=e.result.cursor,r=function(){return t.dbx.filesListFolderLongpoll({cursor:n,timeout:480})};return r().then((function(e){var n=e.result.changes;return h.info("Longpoll info. Changes: ",n),n?(t.emit("settingsChanged"),t.addToQueue("Restart longpolling",t.throttle,(function(){return t.startLongPollSettings(),Promise.resolve(null)}),!0)):r()}))})).catch((function(t){h.error(t)}))}}],n&&v(e.prototype,n),r&&v(e,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(l.EventEmitter),A=S,T=n(55835),C=n(48764).Buffer,E=4194304;function _(t,e,n){this.overallHasher=t,this.blockHasher=e,this.blockPos=n}_.prototype.update=function(t,e){if(null===this.overallHasher)throw new Error("can't use this object anymore; you already called digest()");var n=t;if(!C.isBuffer(n)){if(void 0!==e&&"utf8"!==e&&"ascii"!==e&&"latin1"!==e)throw new Error("Invalid 'inputEncoding': ".concat(JSON.stringify(e)));n=C.from(t,e)}for(var r=0;r<n.length;){this.blockPos===E&&(this.overallHasher.update(this.blockHasher.digest()),this.blockHasher=T.createHash("sha256"),this.blockPos=0);var o=E-this.blockPos,a=Math.min(n.length,r+o),i=a-r;this.blockHasher.update(n.slice(r,a)),this.blockPos+=i,r=a}},_.prototype.digest=function(t){if(null===this.overallHasher)throw new Error("can't use this object anymore; you already called digest()");this.blockPos>0&&(this.overallHasher.update(this.blockHasher.digest()),this.blockHasher=null);var e=this.overallHasher.digest(t);return this.overallHasher=null,e};n(41637),n(64765);var D,U=function(){var t=new URLSearchParams(window.location.search).get("code");return t?(window.history.replaceState({},document.title,"./"),window.location.replace("#/settings/dropbox"),{dropboxCode:t}):{}},I=n(98642),R=n(39506),F=n(28014),L=n(93572),B=n(81477),H=n(31712),Z=n(13629),q=n(25108);function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){$(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function $(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var J=function(){},G=function(t){var e=[],n=new(i())(1,1/0);J=function(e){return function(r,o,a,i){return n.add((function(){return new Promise((function(n,c){window.setTimeout((function(){i||t.dispatch({type:Z.ON,payload:{timestamp:(new Date).getTime()/1e3,message:"".concat(e," runs ").concat(r)}}),a().then(n).catch(c)}),o)}))}))}};var r=function(){t.dispatch({type:Z.eP,payload:{storageType:"dropbox",direction:"diff"}})};D=new A(t.getState().dropboxStorage,J("Dropbox")),t.getState().dropboxStorage.autoDropboxSync&&(r(),D.on("settingsChanged",(function(){r()}))),D.on("loginDataUpdate",(function(e){t.dispatch({type:Z.wb,payload:Q(Q({},t.getState().dropboxStorage),e)})}));var a=U().dropboxCode;return a&&D.codeAuth(a),function(n){var r=t.getState();if(n.type===Z.wb&&D.setRootPath(r.dropboxStorage.path||"/"),n.type===Z.eP&&("dropbox"===n.payload.storageType&&D.getRemoteContents(n.payload.direction).then((function(e){switch(n.payload.direction){case"diff":var a,i,s;return null===(null==e||null===(a=e.settings)||void 0===a||null===(i=a.state)||void 0===i?void 0:i.lastUpdateUTC)||(t.dispatch({type:Z.oI,payload:e.settings.state.lastUpdateUTC}),e.settings.state.lastUpdateUTC>(null==r||null===(s=r.syncLastUpdate)||void 0===s?void 0:s.local)&&t.dispatch({type:Z.jH,payload:{message:"There is newer content in your dropbox!",questions:function(){var t;return["Your dropbox contains changes from ".concat((0,H.Z)(o()(1e3*e.settings.state.lastUpdateUTC),r.preferredLocale)),"Your last local update was ".concat(null!=r&&null!==(t=r.syncLastUpdate)&&void 0!==t&&t.local?(0,H.Z)(o()(1e3*r.syncLastUpdate.local),r.preferredLocale):"never","."),"Do you want to load the changes?"].map((function(t,e){return{label:t,key:"info".concat(e),type:"info"}}))},confirm:function(){t.dispatch({type:Z.Gp}),t.dispatch({type:Z.eP,payload:{storageType:"dropbox",direction:"down"}})},deny:function(){t.dispatch({type:Z.Gp})}}})),Promise.resolve(null);case"up":var l,f=(null==r||null===(l=r.syncLastUpdate)||void 0===l?void 0:l.local)||Math.floor((new Date).getTime()/1e3);return(0,c.Z)(t,e,f,J("GBPrinter")).then((function(t){return D.upload(t,"settings")})).then((function(e){return t.dispatch({type:Z.oI,payload:f}),e}));case"down":return(0,u.ZP)(e).then((function(n){return t.dispatch({type:Z.yK,payload:e.settings}),n}));default:return Promise.reject(new Error("dropbox sync: wrong sync case"))}})).then((function(e){t.dispatch({type:"diff"===n.payload.direction?Z.bM:Z.Ki,payload:{syncResult:e,storageType:"dropbox"}})})).catch((function(e){q.error(e),t.dispatch({type:Z.pn,payload:e.message})})),"dropboximages"===n.payload.storageType)){var a=(0,B.Z)(r),i=(0,I.j)(r),s=(0,F.Z)(r);Promise.all(a.map((function(t,e){return J("Generate images and hashes")("".concat(e+1,"/").concat(a.length),10,(function(){var e=(0,R.Z)(r,t);return s(t).then(i(e,t)).then((function(t){return Promise.all(t.map((function(t){var e=new _(T.createHash("sha256"),T.createHash("sha256"),0);return t.blob.arrayBuffer().then((function(n){return e.update(n),Q(Q({},t),{},{dropboxContentHash:e.digest("hex")})}))})))}))}))}))).then((function(t){return t.flat()})).then(L.Z).then((function(t){return D.getImageContents().then((function(e){if("up"===n.payload.direction){var r=t.filter((function(t){var n=t.dropboxContentHash,r=t.uFilename;return!e.find((function(t){var e=t.content_hash,o=t.name;return e===n&&o===r}))})).map((function(t){return Q(Q({},t),{},{destination:t.uFilename})}));return D.upload({upload:r,del:[]},"images")}return Promise.reject(new Error("dropbox sync: wrong sync case"))}))})).then((function(e){t.dispatch({type:Z.Ki,payload:{syncResult:e,storageType:"dropbox"}})})).catch((function(e){q.error(e),t.dispatch({type:Z.pn,payload:e.message})}))}n.type===Z.eh&&D.startAuth(),n.type===Z.UF&&(e.includes(n.payload)||(e.push(n.payload),D.getFileContent("images/".concat(n.payload,".txt"),0,1,!0).then(u.T3).then((function(){t.dispatch({type:Z.hT,payload:[]})})).catch((function(t){q.log('Dropbox responded: "'.concat(t.message,'" when recovering "images/').concat(n.payload,'.txt"'))}))))}}},35820:function(t,e,n){"use strict";n(74916),n(15306);e.Z=function(t){return t.replace(/[^a-z0-9/\\._-]/gi,"").replace(/[\\/]+/gi,"/").replace(/^\//,"").replace(/\/$/,"")}},42146:function(t,e,n){"use strict";n.d(e,{Z:function(){return w}});n(21249),n(57327),n(41539),n(69826),n(68309),n(66992),n(88674),n(78783),n(33948),n(92222),n(69070),n(47941),n(82526),n(38880),n(89554),n(54747),n(49337),n(33321),n(79753),n(41817),n(32165),n(91038),n(47042),n(74916);var r=n(75226),o=n(28014),a=n(39506),i=n(75500);n(82772);function c(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var s=function(t,e,n,r){var o=t.images,a=t.frames;return{upload:e.filter((function(t){var e=t.destination;return!o.find((function(t){return t.path===e}))&&!a.find((function(t){return t.path===e}))})),del:[].concat(c(c(o).filter((function(t){var o=t.path;return!n.find((function(t){var e=t.destination;return o===e}))&&!e.find((function(t){var e=t.destination;return o===e}))&&!r.find((function(t){return o.indexOf(t)>=-1}))}))),c(c(a).filter((function(t){var r=t.path;return!n.find((function(t){var e=t.destination;return r===e}))&&!e.find((function(t){var e=t.destination;return r===e}))}))))}},l=(n(69600),n(39324)),f=n(25108);function p(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var d=function(t){var e=(0,l.Z)(t);return function(t,n){var r=[],o=[],a={};t.forEach((function(t){var e=t.hash,n=t.files,i=t.inRepo;o.push.apply(o,p(i.map((function(t){var e=t.path,n=e.split("/")[0];return a[n]=a[n]?a[n]+1:1,{destination:e}})))),r.push.apply(r,p(n.map((function(t){var n=t.blob,r=t.folder,o=function(t){switch(t){case"image/png":return"png";case"image/jpg":case"image/jpeg":return"jpg";case"image/webp":return"webp";case"text/plain":return"txt";case"text/markdown":return"md";case"application/json":case"text/json":return"json";default:return f.warn('unknown file extension for type "'.concat(t,'"')),"none"}}(n.type),i=r||o;return a[i]=a[i]?a[i]+1:1,{destination:"".concat(i,"/").concat(e,".").concat(o),blob:n}}))))}));var i=["## Files in this repo:"].concat(p(Object.keys(a).map((function(t){return" * ".concat(t,": [").concat(a[t],"](/").concat(t,")")})))).join("\n");return e("remote",{lastUpdateUTC:n}).then((function(t){return r.push({destination:"README.md",blob:new Blob(p(i),{type:"text/plain"})},{destination:"settings.json",blob:new Blob(p(t),{type:"application/json"})}),{toUpload:r.filter(Boolean),toKeep:o.filter(Boolean)}}))}};function y(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach((function(e){v(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var w=function(t,e,n,c){var u=t.getState(),l=(0,r.Z)(m(m({},u),{},{exportScaleFactors:[1],exportFileTypes:["txt"],handleExportFrame:"keep"})),f=d(t),p=[],h=u.images.filter((function(t){return!t.hashes})).map((function(t){return m(m({},t),{},{inRepo:[e.images.find((function(e){return e.name.substr(0,40)===t.hash}))].filter(Boolean)})})),b=h.length,g=u.frames.map((function(t){return m(m({},t),{},{inRepo:[e.frames.find((function(e){return e.name.substr(0,40)===t.hash}))].filter(Boolean)})})),v=g.length;return Promise.all([].concat(y(h.map((function(t,e){return t.inRepo.length?m(m({},t),{},{inRepo:t.inRepo,files:[]}):c("loadImageTiles (".concat(e+1,"/").concat(b,") ").concat(t.title),3,(function(){return(0,o.Z)(u)(t,!0).then((function(e){return e.length?l((0,a.Z)(u,t),t)(e).then((function(e){return m(m({},t),{},{files:e})})):(p.push(t.hash),Promise.resolve(null))}))}))}))),y(g.map((function(t,e){return t.inRepo.length?m(m({},t),{},{inRepo:t.inRepo,files:[]}):c("loadFrameData (".concat(e+1,"/").concat(v,") ").concat(t.id),3,(function(){return(0,i.vJ)(t.hash).then((function(e){return m(m({},t),{},{files:[{folder:"frames",filename:"",blob:new Blob(new Array(JSON.stringify(e||"{}",null,2)),{type:"application/json"}),title:t.name}]})}))}))}))))).then((function(t){return f(t.filter(Boolean),n)})).then((function(t){var n=t.toUpload,r=t.toKeep;return s(e,n,r,p)}))}},15203:function(t,e,n){"use strict";n.d(e,{T3:function(){return c}});n(57327),n(41539),n(74916),n(4723),n(69600),n(43290),n(92222),n(84944),n(33792),n(21249),n(66992),n(88674),n(78783),n(33948),n(79753),n(82526),n(41817),n(32165),n(91038),n(47042),n(68309);var r=n(30661),o=n(75500);function a(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var c=function(t){var e=t.split("\n").filter((function(t){return t.match(/^[0-9a-f ]+$/gi)}));return(0,r.a1)(e)},u=function(t){var e=JSON.parse(t,null,2),n=Array(32).fill("f").join(""),r=Array(16).fill(n),i=[].concat(a(e.upper),a(Array(14).fill().map((function(t,n){return[].concat(a(e.left[n]),a(r),a(e.right[n]))})).flat()),a(e.lower));return(0,o.ez)(i)};e.ZP=function(t){var e=t.images,n=t.frames,i=e.length,s=n.length;return Promise.all([].concat(a(e.map((function(t,e){return(0,r.zD)(t.hash,null,!0).then((function(n){return n.length?t.hash:t.getFileContent(t.sha,e,i).then(c)}))}))),a(n.map((function(t,e){return(0,o.vJ)(t.hash).then((function(n){return n?t.hash:t.getFileContent(t.contentHash,e,s).then(u)}))})))))}},80950:function(){},46601:function(){},89214:function(){},96419:function(){},56353:function(){},8623:function(){},7748:function(){},85568:function(){},69386:function(){},31616:function(){},56619:function(){},77108:function(){},69862:function(){},40964:function(){}}]);