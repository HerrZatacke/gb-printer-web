(()=>{var e={30484:(e,t,r)=>{"use strict";var n=r(61975),i=r(71450),s=r(81863),a=r(87773),c=r(44351),u=r(3037),o=r(22043),l=r(16459),h=r.n(l),f=function(e){return e.USB="USB",e.SERIAL="SERIAL",e}({}),d=function(e){return e.INACTIVE="inactive",e.PACKET_CAPTURE="packet_capture",e.SUPER_PRINTER_INTERFACE="super_printer_interface",e.GBXCART="gbxcart",e}({}),_=r(74879).A,p=function(){function e(t,r,n){(0,c._)(this,e),this.portDeviceType=d.INACTIVE,this.bannerBytes=r,this.portType=t.portType,this.description=[t.getDescription(),n].filter(Boolean).join(" "),this.id=_()}return e.prototype.getBanner=function(){return(0,n._)(function(){return(0,i.YH)(this,function(e){return[2,this.bannerBytes]})}).call(this)},e}(),v=r(79703),b={NULL:48,OFW_RESET_AVR:42,OFW_CART_MODE:67,OFW_FW_VER:86,OFW_PCB_VER:104,OFW_USART_1_7M_SPEED:62,OFW_CART_PWR_ON:47,OFW_CART_PWR_OFF:46,OFW_QUERY_CART_PWR:93,OFW_DONE_LED_ON:61,OFW_ERROR_LED_ON:63,OFW_GB_CART_MODE:71,OFW_GB_FLASH_BANK_1_COMMAND_WRITES:78,OFW_LNL_QUERY:37,QUERY_FW_INFO:161,SET_MODE_AGB:162,SET_MODE_DMG:163,SET_VOLTAGE_3_3V:164,SET_VOLTAGE_5V:165,CART_PWR_ON:242,CART_PWR_OFF:243,SET_VARIABLE:166,SET_FLASH_CMD:167,SET_ADDR_AS_INPUTS:168,CLK_HIGH:169,CLK_LOW:170,DMG_CART_READ:177,DMG_CART_WRITE:178,DMG_CART_WRITE_SRAM:179,DMG_MBC_RESET:180,DMG_MBC7_READ_EEPROM:181,DMG_MBC7_WRITE_EEPROM:182,DMG_MBC6_MMSA_WRITE_FLASH:183,DMG_SET_BANK_CHANGE_CMD:184,DMG_EEPROM_WRITE:185,AGB_CART_READ:193,AGB_CART_WRITE:194,AGB_CART_READ_SRAM:195,AGB_CART_WRITE_SRAM:196,AGB_CART_READ_EEPROM:197,AGB_CART_WRITE_EEPROM:198,AGB_CART_WRITE_FLASH_DATA:199,AGB_CART_READ_3D_MEMORY:200,AGB_BOOTUP_SEQUENCE:201,DMG_FLASH_WRITE_BYTE:209,AGB_FLASH_WRITE_SHORT:210,FLASH_PROGRAM:211,CART_WRITE_FLASH_CMD:212},R={ADDRESS:{size:4,value:0},TRANSFER_SIZE:{size:2,value:0},BUFFER_SIZE:{size:2,value:1},DMG_ROM_BANK:{size:2,value:2},CART_MODE:{size:1,value:0},DMG_ACCESS_MODE:{size:1,value:1},FLASH_COMMAND_SET:{size:1,value:2},FLASH_METHOD:{size:1,value:3},FLASH_WE_PIN:{size:1,value:4},FLASH_PULSE_RESET:{size:1,value:5},FLASH_COMMANDS_BANK_1:{size:1,value:6},FLASH_SHARP_VERIFY_SR:{size:1,value:7},DMG_READ_CS_PULSE:{size:1,value:8},DMG_WRITE_CS_PULSE:{size:1,value:9},FLASH_DOUBLE_DIE:{size:1,value:10},DMG_READ_METHOD:{size:1,value:11},AGB_READ_METHOD:{size:1,value:12}},A={4:"v1.3",5:"v1.4",6:"v1.4a",101:"Mini v1.0d"},w={1:"V2",129:"V2",2:"V2C",130:"V2C",3:"V2CC",131:"V2CC/V2++"},E={12:"v1.2",13:"v1.3"},g=function(e){var t=e.filter(Boolean),r=new Uint8Array(t.reduce(function(e,t){return e+t.length},0)),n=0,i=!0,s=!1,a=void 0;try{for(var c,u=t[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var o=c.value;r.set(o,n),n+=o.length}}catch(e){s=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(s)throw a}}return r},D=function(){function e(t){(0,c._)(this,e),this.textDecoder=new TextDecoder,this.receiving=function(){},this.data=function(){},this.longBuffer=null,this.portDeviceType=d.PACKET_CAPTURE,this.device=t,this.portType=t.portType,this.description=t.getDescription(),this.id=_(),this.readLoop()}var t=e.prototype;return t.readLoop=function(){return(0,n._)(function(){var e,t,r,n,s;return(0,i.YH)(this,function(i){switch(i.label){case 0:e=this,t=0,r=function(){var t;(null==(t=e.longBuffer)?void 0:t.byteLength)&&(e.data(e.textDecoder.decode(e.longBuffer)),e.longBuffer=null)},n=this.device,i.label=1;case 1:if(!n.canRead())return[3,3];return[4,n.read({timeout:100})];case 2:return(s=i.sent()).byteLength&&(self.clearTimeout(t),t=self.setTimeout(r,1e3),this.receiving(),this.longBuffer=g([this.longBuffer,s])),[3,1];case 3:return[2]}})}).call(this)},t.setup=function(e){return(0,n._)(function(e){var t,r;return(0,i.YH)(this,function(n){return t=e.receiving,r=e.data,this.receiving=t,this.data=r,[2]})}).apply(this,arguments)},e}(),y=function(e){return(0,n._)(function(){return(0,i.YH)(this,function(t){return[2,new Promise(function(t){self.setTimeout(t,e)})]})})()},T=function(){function e(t,r){(0,c._)(this,e),this.portDeviceType=d.GBXCART,this.startProgress=function(e){return(0,n._)(function(){return(0,i.YH)(this,function(t){return console.log(e),[2,"#"]})})()},this.setProgress=function(e,t){console.log("".concat(e," - ").concat(Math.round(100*t),"%"))},this.stopProgress=function(e){console.log("".concat(e," - done"))},this.device=t,this.portType=t.portType;var s=e.parseFwResponse(r);this.fwVer=(null==s?void 0:s.firmwareVersion)||0,this.powerControlSupport=(null==s?void 0:s.powerControlSupport)||!1,this.id=_(),this.description=[null==s?void 0:s.deviceName,null==s?void 0:s.pcbLabel,"fw:L".concat(null==s?void 0:s.firmwareVersion),t.getDescription()].filter(Boolean).join(" - ")}var t=e.prototype;return t.waitForAck=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return(0,n._)(function(){var t,r;return(0,i.YH)(this,function(n){switch(n.label){case 0:if(!(this.fwVer<12))return[3,3];if(!(this.fwVer>1))return[3,2];return[4,y(e)];case 1:n.sent(),n.label=2;case 2:return[2];case 3:return t=[1,3],[4,this.device.read({length:1,timeout:e})];case 4:if(r=o._.apply(void 0,[n.sent(),1])[0],!t.includes(r))throw Error("no ack received");return[2]}})}).call(this)},t.setFwVariable=function(e,t){return(0,n._)(function(){var r,n,s,a,c,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:return n=(r=R[e]).size,s=r.value,a=b.SET_VARIABLE,(u=new DataView(c=new ArrayBuffer(10))).setUint8(0,a),u.setUint8(1,n),u.setUint32(2,s,!1),u.setUint32(6,t,!1),[4,this.device.send(new Uint8Array(c),[])];case 1:return i.sent(),[4,this.waitForAck(50)];case 2:return i.sent(),[2]}})}).call(this)},t.cartWrite=function(e,t){return(0,n._)(function(){var r,n;return(0,i.YH)(this,function(i){switch(i.label){case 0:return(n=new DataView(r=new ArrayBuffer(6))).setUint8(0,b.DMG_CART_WRITE),n.setUint32(1,e,!1),n.setUint8(5,t),[4,this.device.send(new Uint8Array(r),[])];case 1:return i.sent(),[4,this.waitForAck()];case 2:return i.sent(),[2]}})}).call(this)},t.readRAM=function(e,t){return(0,n._)(function(){var r,n,s,a;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r=Math.min(4096,t),n=new Uint8Array([b.DMG_CART_READ]),[4,this.setFwVariable("TRANSFER_SIZE",r)];case 1:return i.sent(),[4,this.setFwVariable("ADDRESS",40960+e)];case 2:return i.sent(),[4,this.setFwVariable("DMG_ACCESS_MODE",3)];case 3:return i.sent(),[4,this.setFwVariable("DMG_READ_CS_PULSE",1)];case 4:i.sent(),s=new Uint8Array([]),i.label=5;case 5:if(!(s.byteLength<t))return[3,7];return[4,this.device.send(n,[{length:r}])];case 6:return a=o._.apply(void 0,[i.sent(),1])[0],s=g([s,a]),[3,5];case 7:return[2,s]}})}).call(this)},t.readROM=function(e,t){return(0,n._)(function(){var r,n,s,a;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r=Math.min(this.fwVer>1&&this.fwVer<12?2048:4096,t),n=new Uint8Array([b.DMG_CART_READ]),[4,this.setFwVariable("TRANSFER_SIZE",r)];case 1:return i.sent(),[4,this.setFwVariable("ADDRESS",e)];case 2:return i.sent(),[4,this.setFwVariable("DMG_ACCESS_MODE",1)];case 3:i.sent(),s=new Uint8Array([]),i.label=4;case 4:if(!(s.byteLength<t))return[3,6];return[4,this.device.send(n,[{length:r,timeout:1e3}])];case 5:return(a=o._.apply(void 0,[i.sent(),1])[0]).byteLength!==r?(console.log("Expected ".concat(r,"bytes from read, received ").concat(a.byteLength,"bytes after 1000ms")),s=g([s,new Uint8Array(r)])):s=g([s,a]),[3,4];case 6:return[2,s]}})}).call(this)},t.readROMName=function(){return(0,n._)(function(){var e,t;return(0,i.YH)(this,function(r){switch(r.label){case 0:return[4,this.setModeVoltage()];case 1:return r.sent(),e=new TextDecoder,[4,this.readROM(308,16)];case 2:return t=r.sent(),[4,this.powerOff()];case 3:return r.sent(),[2,e.decode(t.filter(function(e){return 0!==e&&128!==e}))]}})}).call(this)},t.readRAMImage=function(){return(0,n._)(function(){var e,t,r,n,s,a,c,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:return[4,this.setModeVoltage()];case 1:return i.sent(),e=[],t=8192,n=r=16,[4,this.startProgress("Loading Camera RAM")];case 2:s=i.sent(),a=performance.now(),c=0,i.label=3;case 3:if(!(c<r))return[3,7];return[4,this.cartWrite(16384,c)];case 4:return i.sent(),this.setProgress(s,e.length/n),u=e.push,[4,this.readRAM(0,t)];case 5:u.apply(e,[i.sent()]),i.label=6;case 6:return c+=1,[3,3];case 7:return[4,this.powerOff()];case 8:return i.sent(),console.log("Reading RAM completed in ".concat(((performance.now()-a)/1e3).toFixed(2),"s")),this.stopProgress(s),[2,e]}})}).call(this)},t.readPhotoAlbums=function(){return(0,n._)(function(){var e,t,r,n,s,a,c,u,o,l,h,f,d,_;return(0,i.YH)(this,function(i){switch(i.label){case 0:return[4,this.setModeVoltage()];case 1:return i.sent(),e=[],t=16384,r=8192,c=(s=16)+(n=64)-(a=8),[4,this.startProgress("Loading Album Rolls (ROM + Flash) from Photo!")];case 2:u=i.sent(),o=performance.now(),l=0,i.label=3;case 3:if(!(l<s))return[3,7];return[4,this.cartWrite(16384,l)];case 4:return i.sent(),this.setProgress(u,e.length/c),h=e.push,[4,this.readRAM(0,r)];case 5:h.apply(e,[i.sent()]),i.label=6;case 6:return l+=1,[3,3];case 7:f=a,i.label=8;case 8:if(!(f<n))return[3,14];return[4,this.cartWrite(8448,f)];case 9:if(i.sent(),this.setProgress(u,e.length/c),0!==f)return[3,11];return d=e.push,[4,this.readROM(0,t)];case 10:return d.apply(e,[i.sent()]),[3,13];case 11:return _=e.push,[4,this.readROM(16384,t)];case 12:_.apply(e,[i.sent()]),i.label=13;case 13:return f+=1,[3,8];case 14:return[4,this.powerOff()];case 15:return i.sent(),console.log("Reading Photo RAM+ROM completed in ".concat(((performance.now()-o)/1e3).toFixed(2),"s")),this.stopProgress(u),[2,e]}})}).call(this)},t.checkFirmware=function(){return(0,n._)(function(){var t,r;return(0,i.YH)(this,function(n){switch(n.label){case 0:return t=new Uint8Array([b.QUERY_FW_INFO]),[4,this.device.send(t,[{timeout:100}])];case 1:return r=o._.apply(void 0,[n.sent(),1])[0],console.log(e.parseFwResponse(r)),[2]}})}).call(this)},t.setModeVoltage=function(){return(0,n._)(function(){var e,t,r;return(0,i.YH)(this,function(n){switch(n.label){case 0:return e=new Uint8Array([b.SET_MODE_DMG]),[4,this.device.send(e,[])];case 1:case 3:return n.sent(),[4,this.waitForAck()];case 2:return n.sent(),t=new Uint8Array([b.SET_VOLTAGE_5V]),[4,this.device.send(t,[])];case 4:if(n.sent(),!this.powerControlSupport)return[3,7];return r=new Uint8Array([b[this.fwVer>=12?"CART_PWR_ON":"OFW_CART_PWR_ON"]]),[4,this.device.send(r,[])];case 5:return n.sent(),[4,this.waitForAck(250)];case 6:n.sent(),n.label=7;case 7:if(!(this.fwVer>=12))return[3,9];return[4,this.setFwVariable("DMG_READ_METHOD",1)];case 8:n.sent(),n.label=9;case 9:return[2]}})}).call(this)},t.powerOff=function(){return(0,n._)(function(){var e;return(0,i.YH)(this,function(t){switch(t.label){case 0:if(!this.powerControlSupport)return[3,3];return e=new Uint8Array([b[this.fwVer>=12?"CART_PWR_OFF":"OFW_CART_PWR_OFF"]]),[4,this.device.send(e,[])];case 1:return t.sent(),[4,this.waitForAck(250)];case 2:t.sent(),t.label=3;case 3:return[2]}})}).call(this)},t.setup=function(e){return(0,n._)(function(e){var t,r,n;return(0,i.YH)(this,function(i){return t=e.startProgress,r=e.setProgress,n=e.stopProgress,this.startProgress=t,this.setProgress=r,this.stopProgress=n,[2]})}).apply(this,arguments)},e.parseFwResponse=function(e){var t=new TextDecoder;if(76!==e[1])return null;var r=new DataView(e.buffer,2,2).getUint16(0,!1),n=e[4],i=new DataView(e.buffer,5,4).getUint32(0,!1),s=e[9],a=new Date(1e3*i),c="GBxCart RW",u=r>1,o=!1;if(r>=12){var l=new Uint8Array(e.buffer,10,s-1);c=t.decode(l),u=!!e[s+10],o=!!e[s+11]}var h=A;return"GBFlash"===c?h=E:"Joey Jr"===c&&(h=w),{deviceName:c,powerControlSupport:u,bootloaderResetSupport:o,firmwareVersion:r,pcbVersion:n,pcbLabel:h[n]||"",firmwareTimestamp:i,firmwareDate:a}},e}(),C=r(45377),m=r(51638),P=r.n(m),M=r(79452),O=r.n(M),S=function(e){return e[e.LIGHT=0]="LIGHT",e[e.NORMAL=64]="NORMAL",e[e.DARK=127]="DARK",e}(S||{}),F=function(){function e(t){(0,c._)(this,e),this.portDeviceType=d.SUPER_PRINTER_INTERFACE,this.textDecoder=new TextDecoder,this.textEncoder=new TextEncoder,this.startProgress=function(e){return(0,n._)(function(){return(0,i.YH)(this,function(t){return console.log(e),[2,"#"]})})()},this.setProgress=function(e,t){console.log("".concat(e," - ").concat(Math.round(100*t),"%"))},this.stopProgress=function(e){console.log("".concat(e," - done"))},this.setError=function(e){console.log(e)},this.device=t,this.portType=t.portType,this.description=t.getDescription(),this.id=_()}var t=e.prototype;return t.generatePrintCommand=function(e,t,r){return[80,(Math.max(0,Math.min(15,t))<<4)+Math.max(0,Math.min(15,r)),228,e,13]},t.sendCommands=function(e){return(0,n._)(function(){var t,r,s,a,c;return(0,i.YH)(this,function(u){switch(u.label){case 0:if(t=this,!e.length)return[2];return r=e.length,[4,this.startProgress("Printing to Super Printer Interface")];case 1:s=u.sent(),a=function(){return(0,n._)(function(){var t,n,c,u,l;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(!(null==(t=e.shift())?void 0:t.byteLength))return[3,3];return this.setProgress(s,(r-e.length)/r),n=[{length:t.byteLength},{texts:[this.textEncoder.encode("Printer ready"),this.textEncoder.encode("Packet error")],timeout:2e4}],[4,this.device.send(t,n)];case 1:if(u=(c=o._.apply(void 0,[i.sent(),2]))[0],l=c[1],O()(t)!==O()(u))throw Error("Command validation failed");if(-1===this.textDecoder.decode(l).indexOf("Printer ready"))throw Error("Packet error");return[4,a()];case 2:return[2,i.sent()];case 3:return[2,!0]}})}).call(t)},u.label=2;case 2:return u.trys.push([2,4,,5]),[4,a()];case 3:return u.sent(),[3,5];case 4:return c=u.sent(),this.setError(c.message),this.stopProgress(s),[3,5];case 5:return this.stopProgress(s),[2]}})}).call(this)},t.printImage=function(e){return(0,n._)(function(){var t,r,n,s;return(0,i.YH)(this,function(i){switch(i.label){case 0:return t=this,r=e.reduce(function(e,t){var r=P()(t,2).flat();return(0,C._)(e).concat((0,C._)(r.map(function(e){return parseInt(e,16)})))},[]),n=P()(r,640).map(function(e){return new Uint8Array([68].concat((0,C._)(e),[13]))}),s=P()(n,9).map(function(e,r,n){var i=3*(r===n.length-1);return(0,C._)(e).concat([new Uint8Array(t.generatePrintCommand(127,+(0===r),i))])}).flat(),[4,this.sendCommands(s)];case 1:return i.sent(),[2]}})}).call(this)},t.setup=function(e){return(0,n._)(function(e){var t,r,n,s;return(0,i.YH)(this,function(i){return t=e.startProgress,r=e.setProgress,n=e.stopProgress,s=e.setError,this.startProgress=t,this.setProgress=r,this.stopProgress=n,this.setError=s,[2]})}).apply(this,arguments)},e}(),L=function(e,t){for(var r=t.length,n=e.length-r+1,i=0;i<n;i++){for(var s=!0,a=0;a<r;a++)if(e[i+a]!==t[a]){s=!1;break}if(s)return i}return -1},W="GAMEBOY PRINTER Packet Capture",B="GAMEBOY PRINTER Emulator",H="Super Printer Interface by Rapha\xebl BOICHOT",U=function(e){function t(e){var r;return(0,c._)(this,t),(r=(0,a._)(this,t)).enabled=!0,r.portType=e,r.textDecoder=new TextDecoder,r.textEncoder=new TextEncoder,r.bufferedData=null,r.readQueue=Promise.resolve(),r}(0,u._)(t,e);var r=t.prototype;return r.disable=function(){this.enabled=!1},r.startBuffering=function(e){(0,n._)(function(){var t;return(0,i.YH)(this,function(r){switch(r.label){case 0:if(!this.canRead())return[3,8];r.label=1;case 1:return r.trys.push([1,6,,7]),[4,this.readChunk()];case 2:if(!(t=r.sent()).byteLength)return[3,3];return this.bufferedData=g([this.bufferedData,t]),[3,5];case 3:return[4,y(e)];case 4:r.sent(),r.label=5;case 5:return[3,7];case 6:return r.sent(),[3,8];case 7:return[3,0];case 8:return[2]}})}).call(this)},r.readFromBuffer=function(e){return(0,n._)(function(e){var t,r,n,s,a,c,u,o,l;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(t=this,r=e.timeout,n=e.length,s=e.texts,a="number"==typeof n?n:1/0,c=!0,"number"==typeof r&&setTimeout(function(){c=!1},r),"number"!=typeof n)return[3,6];0===n&&(c=!1),i.label=1;case 1:if(!c)return[3,5];if(!(this.bufferedData&&this.bufferedData.byteLength>=n))return[3,2];return c=!1,[3,4];case 2:return[4,y(0)];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return[3,17];case 6:if(!(0,v._)(s,Array))return[3,15];0===s.length&&(c=!1),i.label=7;case 7:if(!c)return[3,14];if(!(this.bufferedData&&this.bufferedData.byteLength))return[3,11];if(!(o=null!=(u=s.map(function(e){return{needle:e,index:L(t.bufferedData,e)}}).filter(function(e){return -1!==e.index}).sort(function(e,t){return e.index-t.index})[0])?u:null))return[3,8];return a=o.index+o.needle.byteLength,c=!1,[3,10];case 8:return[4,y(0)];case 9:i.sent(),i.label=10;case 10:return[3,13];case 11:return[4,y(0)];case 12:i.sent(),i.label=13;case 13:return[3,7];case 14:return[3,17];case 15:if(!c)return[3,17];return[4,y(0)];case 16:return i.sent(),[3,15];case 17:if(!this.bufferedData)return[2,new Uint8Array];return l=this.bufferedData.slice(0,a),this.bufferedData=this.bufferedData.slice(a),[2,l]}})}).apply(this,arguments)},r.read=function(e){var t=this;return new Promise(function(r,n){t.readQueue=t.readQueue.then(function(){return t.readFromBuffer(e)}).then(r).catch(n)})},r.readReady=function(){var e=this;return new Promise(function(t,r){e.readQueue=e.readQueue.then(t).catch(r)})},r.detectActiveTypes=function(e){return(0,n._)(function(){return(0,i.YH)(this,function(t){switch(t.label){case 0:if(-1===L(e,this.textEncoder.encode(W))&&-1===L(e,this.textEncoder.encode(B)))return[3,2];return[4,this.read({timeout:500})];case 1:return t.sent(),[2,new D(this)];case 2:if(-1!==L(e,this.textEncoder.encode(H)))return[2,new F(this)];t.label=3;case 3:return[2,null]}})}).call(this)},r.send=function(e,t){return(0,n._)(function(){var r,n;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r=this,this.bufferedData=null,[4,this.readReady()];case 1:return i.sent(),n=t.map(function(e){return r.read(e)}),[4,this.sendRaw(e)];case 2:return i.sent(),[2,Promise.all(n)]}})}).call(this)},r.detectGBxCart=function(){return(0,n._)(function(){var e,t,r;return(0,i.YH)(this,function(n){switch(n.label){case 0:return[4,this.send(new Uint8Array([b.QUERY_FW_INFO]),[{timeout:100}])];case 1:if(!(e=o._.apply(void 0,[n.sent(),1])[0]).length||(console.log("firmwareInfo",t=T.parseFwResponse(e),e),!t))return[3,3];if(t.firmwareVersion>0&&""!==t.pcbLabel)return[2,new T(this,e)];return[4,this.read({timeout:500})];case 2:return r=n.sent(),this.disable(),[2,new p(this,g([e,r]),"GBXCart RW not recognized (".concat(t.pcbLabel," ").concat(t.deviceName," fw:").concat(t.firmwareVersion,")"))];case 3:return[2,null]}})}).call(this)},r.detectType=function(){return(0,n._)(function(){var e,t,r,n,s,a,c,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:return[4,this.read({timeout:4e3,texts:[this.textEncoder.encode(W),this.textEncoder.encode(B),this.textEncoder.encode(H)]})];case 1:return e=i.sent(),[4,this.detectActiveTypes(e)];case 2:if(t=i.sent())return[2,t];if(!e.byteLength)return[3,4];return[4,this.read({timeout:500})];case 3:return r=i.sent(),this.disable(),[2,new p(this,g([e,r]),"Banner not recognized")];case 4:return[4,this.detectGBxCart()];case 5:if(n=i.sent())return[2,n];return[4,this.send(new Uint8Array([85,170]),[{timeout:100}])];case 6:if(!(s=o._.apply(void 0,[i.sent(),1])[0]).byteLength||-1===this.textDecoder.decode(s).indexOf("Joey Jr FW L"))return[3,9];return[4,this.send(new Uint8Array([76,75]),[{timeout:100}])];case 7:if(!(a=o._.apply(void 0,[i.sent(),1])[0]).length||255!==a[0])throw Error("could not correctly initialize Joey Jr");return[4,this.detectGBxCart()];case 8:if(c=i.sent())return[2,c];i.label=9;case 9:return[4,this.send(new Uint8Array([13,10]),[{timeout:250}])];case 10:return u=o._.apply(void 0,[i.sent(),1])[0],this.disable(),[2,new p(this,u,"CrLf response not recognized")]}})}).call(this)},t}(h()),x=function(e){function t(e,r){var n;return(0,c._)(this,t),(n=(0,a._)(this,t,[f.SERIAL])).device=e,n.settingsCallback=r,n.baudRate=0,n.reader=null,n.writer=null,n}(0,u._)(t,e);var r=t.prototype;return r.getBaudRate=function(){return this.baudRate},r.canRead=function(){return!!(this.reader&&this.enabled)},r.getDescription=function(){return this.baudRate?"".concat(this.baudRate," baud"):""},r.readChunk=function(){return(0,n._)(function(){var e,t;return(0,i.YH)(this,function(r){switch(r.label){case 0:return[4,null==(e=this.reader)?void 0:e.read()];case 1:return[2,null==(t=r.sent())?void 0:t.value]}})}).call(this)},r.connect=function(){return(0,n._)(function(){var e;return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,this.settingsCallback()];case 1:if(e=t.sent(),this.baudRate=(null==e?void 0:e.baudRate)||0,!this.baudRate)return[2,null];return[4,this.device.open({baudRate:this.baudRate})];case 2:return t.sent(),this.reader=this.device.readable.getReader(),this.writer=this.device.writable.getWriter(),this.startBuffering(50),[2,this.detectType()]}})}).call(this)},r.sendRaw=function(e){return(0,n._)(function(){var t;return(0,i.YH)(this,function(r){switch(r.label){case 0:if(!(null==(t=this.device)?void 0:t.writable)||!this.writer)throw Error("device is not writable");return[4,this.writer.write(e)];case 1:return r.sent(),[2]}})}).call(this)},t}(U),I=new(function(e){function t(){var e;return(0,c._)(this,t),(e=(0,a._)(this,t)).connectedPorts=new Map,e.portsWorkerClient=null,e.enabled="undefined"!=typeof navigator&&!!navigator.serial&&!!TextDecoderStream,e}(0,u._)(t,e);var r=t.prototype;return r.registerClient=function(e){this.portsWorkerClient=e},r.initDevice=function(e){return(0,n._)(function(){var t,r,n;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(e.readable||!this.portsWorkerClient)return[2];return r=new p(t=new x(e,this.portsWorkerClient.settingsCallback),new Uint8Array),this.connectedPorts.set(r.id,e),[4,this.portsWorkerClient.addDeviceApi((0,s.BX)(r))];case 1:return i.sent(),[4,t.connect()];case 2:if(!(n=i.sent()))return[3,5];return this.connectedPorts.delete(r.id),[4,this.portsWorkerClient.removeDeviceApi(r.id)];case 3:return i.sent(),this.connectedPorts.set(n.id,e),[4,this.portsWorkerClient.addDeviceApi((0,s.BX)(n))];case 4:i.sent(),i.label=5;case 5:return[2]}})}).call(this)},r.initPorts=function(){return(0,n._)(function(){var e,t,r,s,a,c,u,l,h;return(0,i.YH)(this,function(f){switch(f.label){case 0:if(e=this,!this.enabled||!this.portsWorkerClient)throw Error("could not init serial ports");return console.log("initializing serial ports"),[4,navigator.serial.getPorts()];case 1:t=f.sent(),r=!0,s=!1,a=void 0,f.label=2;case 2:f.trys.push([2,7,8,9]),c=t[Symbol.iterator](),f.label=3;case 3:if(r=(u=c.next()).done)return[3,6];return l=u.value,[4,this.initDevice(l)];case 4:f.sent(),f.label=5;case 5:return r=!0,[3,3];case 6:return[3,9];case 7:return h=f.sent(),s=!0,a=h,[3,9];case 8:try{r||null==c.return||c.return()}finally{if(s)throw a}return[7];case 9:return navigator.serial.addEventListener("connect",function(t){return(0,n._)(function(){return(0,i.YH)(this,function(e){if(!this.portsWorkerClient)throw Error("could not init new serial port");return this.initDevice(t.target),[2]})}).call(e)}),navigator.serial.addEventListener("disconnect",function(t){if(e.portsWorkerClient){var r=(0,o._)(e.connectedPorts.entries().find(function(e){return(0,o._)(e,2)[1]===t.target})||[""],1)[0];r&&(e.connectedPorts.delete(r),e.portsWorkerClient.removeDeviceApi(r))}}),[2]}})}).call(this)},t}(h())),G=function(e){function t(e){var r;return(0,c._)(this,t),(r=(0,a._)(this,t,[f.USB])).device=e,r.productName=e.productName||"",r.interfaceNumber=2,r.endpointIn=5,r.endpointOut=4,r}(0,u._)(t,e);var r=t.prototype;return r.canRead=function(){return!!(this.device&&this.device.opened&&this.enabled)},r.getDescription=function(){return this.productName},r.readChunk=function(){return(0,n._)(function(){var e,t;return(0,i.YH)(this,function(r){switch(r.label){case 0:return[4,this.device.transferIn(this.endpointIn,64)];case 1:return t=(null==(e=r.sent())?void 0:e.data)||new DataView(new Uint8Array([]).buffer),[2,new Uint8Array(t.buffer,t.byteOffset,t.byteLength)]}})}).call(this)},r.connect=function(){return(0,n._)(function(){var e,t,r;return(0,i.YH)(this,function(n){switch(n.label){case 0:return e=this,[4,this.device.open()];case 1:return n.sent(),[4,this.device.selectConfiguration(1)];case 2:if(n.sent(),!(r=null==(t=this.device.configuration)?void 0:t.interfaces))return[2,null];return r.forEach(function(t){t.alternates.forEach(function(r){255===r.interfaceClass&&(e.interfaceNumber=t.interfaceNumber,r.endpoints.forEach(function(t){"out"===t.direction&&(e.endpointOut=t.endpointNumber),"in"===t.direction&&(e.endpointIn=t.endpointNumber)}))})}),[4,this.device.claimInterface(this.interfaceNumber)];case 3:return n.sent(),[4,this.device.selectAlternateInterface(this.interfaceNumber,0)];case 4:return n.sent(),[4,this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:1,index:this.interfaceNumber})];case 5:return n.sent(),this.startBuffering(50),[2,this.detectType()]}})}).call(this)},r.sendRaw=function(e){return(0,n._)(function(){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,Promise.race([this.device.transferOut(this.endpointOut,e),new Promise(function(e,t){return setTimeout(function(){return t(Error("Device did not accept data after 10s"))},1e4)})])];case 1:return t.sent(),[2]}})}).call(this)},t}(U),N=new(function(e){function t(){var e;return(0,c._)(this,t),(e=(0,a._)(this,t)).connectedDevices=new Map,e.portsWorkerClient=null,e.enabled="undefined"!=typeof navigator&&!!navigator.usb&&!!navigator.usb.getDevices,e}(0,u._)(t,e);var r=t.prototype;return r.registerClient=function(e){this.portsWorkerClient=e},r.initDevice=function(e){return(0,n._)(function(){var t,r,n;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(e.opened||!this.portsWorkerClient)return[2];return r=new p(t=new G(e),new Uint8Array),this.connectedDevices.set(r.id,e),[4,this.portsWorkerClient.addDeviceApi((0,s.BX)(r))];case 1:return i.sent(),[4,t.connect()];case 2:if(!(n=i.sent()))return[3,5];return this.connectedDevices.delete(r.id),[4,this.portsWorkerClient.removeDeviceApi(r.id)];case 3:return i.sent(),this.connectedDevices.set(n.id,e),[4,this.portsWorkerClient.addDeviceApi((0,s.BX)(n))];case 4:i.sent(),i.label=5;case 5:return[2]}})}).call(this)},r.initPorts=function(){return(0,n._)(function(){var e;return(0,i.YH)(this,function(t){switch(t.label){case 0:if(e=this,!this.enabled||!this.portsWorkerClient)return[2];return[4,navigator.usb.getDevices()];case 1:return t.sent().forEach(function(t){return e.initDevice(t)}),navigator.usb.addEventListener("connect",function(t){e.initDevice(t.device)}),navigator.usb.addEventListener("disconnect",function(t){if(e.portsWorkerClient){var r=(0,o._)(e.connectedDevices.entries().find(function(e){return(0,o._)(e,2)[1]===t.device})||[""],1)[0];r&&(e.connectedDevices.delete(r),e.portsWorkerClient.removeDeviceApi(r))}}),[2]}})}).call(this)},t}(h()));(0,s.p)({openSerial:function(){return(0,n._)(function(){return(0,i.YH)(this,function(e){switch(e.label){case 0:return console.log("open serial"),[4,I.initPorts()];case 1:return e.sent(),[2]}})})()},openUSB:function(){return(0,n._)(function(){return(0,i.YH)(this,function(e){switch(e.label){case 0:return[4,N.initPorts()];case 1:return e.sent(),[2]}})})()},registerClient:function(e){return(0,n._)(function(){return(0,i.YH)(this,function(t){switch(t.label){case 0:if(!I.enabled)return[3,3];return[4,I.registerClient(e)];case 1:return t.sent(),[4,I.initPorts()];case 2:t.sent(),t.label=3;case 3:if(!N.enabled)return[3,6];return[4,N.registerClient(e)];case 4:return t.sent(),[4,N.initPorts()];case 5:t.sent(),t.label=6;case 6:return e.setStatus(N.enabled,I.enabled),[2]}})})()}})}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}},a=!0;try{e[n].call(s.exports,s,s.exports,r),a=!1}finally{a&&delete t[n]}return s.exports}r.m=e,r.x=()=>{var e=r.O(void 0,[9452,1860,8040],()=>r(30484));return r.O(e)},(()=>{var e=[];r.O=(t,n,i,s)=>{if(n){s=s||0;for(var a=e.length;a>0&&e[a-1][2]>s;a--)e[a]=e[a-1];e[a]=[n,i,s];return}for(var c=1/0,a=0;a<e.length;a++){for(var[n,i,s]=e[a],u=!0,o=0;o<n.length;o++)(!1&s||c>=s)&&Object.keys(r.O).every(e=>r.O[e](n[o]))?n.splice(o--,1):(u=!1,s<c&&(c=s));if(u){e.splice(a--,1);var l=i();void 0!==l&&(t=l)}}return t}})(),r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce((t,n)=>(r.f[n](e,t),t),[])),r.u=e=>9452===e?"static/chunks/9452-77f75e22a220d531.js":"static/chunks/"+e+"."+({1860:"ad7c45b3733cee1c",8040:"fc9b85842882d7e8"})[e]+".js",r.miniCssF=e=>{},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.tt=()=>(void 0===e&&(e={createScriptURL:e=>e},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(e=trustedTypes.createPolicy("nextjs#bundler",e))),e)})(),r.tu=e=>r.tt().createScriptURL(e),r.p="/gb-printer-web/_next/",(()=>{var e={484:1};r.f.i=(t,n)=>{e[t]||importScripts(r.tu(r.p+r.u(t)))};var t=self.webpackChunk_N_E=self.webpackChunk_N_E||[],n=t.push.bind(t);t.push=t=>{var[i,s,a]=t;for(var c in s)r.o(s,c)&&(r.m[c]=s[c]);for(a&&a(r);i.length;)e[i.pop()]=1;n(t)}})(),(()=>{var e=r.x;r.x=()=>Promise.all([9452,1860,8040].map(r.e,r)).then(e)})(),_N_E=r.x()})();