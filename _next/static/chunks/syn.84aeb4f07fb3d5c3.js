"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1575],{5672:(t,e,n)=>{n.d(e,{A:()=>s,Z:()=>a});var r=n(49641).Buffer,a=function(t){return t.UINT8_ARRAY="uint8array",t.TEXT="text",t.DATA_URL="dataURL",t.BINARY_STRING="binaryString",t}({});let s=function(t,e){return new Promise(function(n,a){var s=new FileReader;switch(s.onload=function(t){var s=t.target;if(null==s?void 0:s.result)return"uint8array"===e?void n(r.from(s.result)):void n(s.result);a(Error("Filereader has no result"))},s.onerror=function(t){a(t)},e){case"uint8array":s.readAsArrayBuffer(t);break;case"text":s.readAsText(t);break;case"binaryString":s.readAsBinaryString(t);break;case"dataURL":s.readAsDataURL(t);break;default:a(Error('readAs param missing or unknown type "'.concat(e,'"')))}})}},10630:(t,e,n)=>{n.r(e),n.d(e,{gitSyncTool:()=>C,init:()=>x});var r,a,s=n(97004),o=n(39249),i=n(58617),u=n.n(i),c=n(56277),l=n(46498),h=n(41476),f=n(52166),p=n(24463),d=n(74335),g=n(19320),m=n(17419),v=n(82666),b=n(65492),w=n(66214),_=n(87025),y=n(40662),A=n.n(y),T=n(67660),S=n(5672),H=function(t){function e(t,n,r){var a;return(0,b._)(this,e),(a=(0,v._)(this,e)).octoKit=null,a.busy=!1,a.owner="",a.repo="",a.branch="",a.throttle=10,a.token=null,a.progress=0,a.queueLength=0,a.addToQueue=r,a.getPreferredLocale=n,a.setOctokit(t||{}),a}(0,w._)(e,t);var n=e.prototype;return n.setOctokit=function(t){var e=t.use,n=t.owner,r=t.repo,a=t.branch,s=t.throttle,o=t.token;if(this.busy||!e||!n||!r||!a||!s||!o){this.octoKit=null,this.owner="",this.repo="",this.branch="",this.throttle=10,this.token=null;return}this.owner=n,this.repo=r,this.branch=a,this.throttle=Math.max(s,10)||10,this.token=o,this.octoKit=new T.E({auth:o})},n.progressStart=function(t){this.queueLength=t+7,this.emit("starting",{progress:0,queueLength:this.queueLength}),this.progressTick()},n.progressTick=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.progress=t?0:this.progress+1,this.emit("progress",{progress:this.progress,queueLength:this.queueLength}),t&&(this.queueLength=0)},n.getRepoContents=function(){var t=this;return(0,s._)(function(){var e,n,r,a,s,i,u;return(0,o.YH)(this,function(o){switch(o.label){case 0:return t.progressTick(),[4,t.addToQueue("repos.getBranch ".concat(t.branch),t.throttle,function(){var e;return null==(e=t.octoKit)?void 0:e.repos.getBranch({owner:t.owner,repo:t.repo,branch:t.branch})})];case 1:return e=o.sent().data.commit.sha,[4,t.addToQueue("git.getCommit ".concat(e),t.throttle,function(){var n;return null==(n=t.octoKit)?void 0:n.git.getCommit({owner:t.owner,repo:t.repo,commit_sha:e})})];case 2:return n=o.sent().data.tree.sha,[4,t.addToQueue("git.getTree ".concat(n),t.throttle,function(){var e;return null==(e=t.octoKit)?void 0:e.git.getTree({owner:t.owner,repo:t.repo,tree_sha:n,recursive:"1"})})];case 3:if(a=(r=o.sent().data.tree).find(function(t){return"settings.json"===t.path}),s=t.augmentFileList("images",r.filter(function(t){var e=t.path;return null==e?void 0:e.startsWith("images/")})),i=t.augmentFileList("frames",r.filter(function(t){var e=t.path;return null==e?void 0:e.startsWith("frames/")})),!(null==a?void 0:a.sha))return[3,5];return[4,t.getFileContent(a.sha,0,1)];case 4:return u=o.sent(),[3,6];case 5:u="{}",o.label=6;case 6:return[2,{images:s,frames:i,settings:JSON.parse(u)}]}})})()},n.augmentFileList=function(t,e){var n=this;return e.reduce(function(r,a,s){var o,i=a.path,u=a.sha;if(!i||!u)return r;var c=i.split("/").pop()||"";switch(t){case"images":case"frames":o=c.split(".")[0];break;default:o="-"}var l={path:i,name:c,hash:o,getFileContent:function(){return n.getFileContent(u,s,e.length)}};return(0,_._)(r).concat([l])},[])},n.getFileContent=function(t,e,n){var r=this;return(0,s._)(function(){return(0,o.YH)(this,function(a){switch(a.label){case 0:return r.progressTick(),[4,r.addToQueue("git.getBlob (".concat(e+1,"/").concat(n,") ").concat(t),r.throttle,function(){var e;return null==(e=r.octoKit)?void 0:e.git.getBlob({owner:r.owner,repo:r.repo,file_sha:t})})];case 1:var s;return[2,(s=a.sent().data.content,decodeURIComponent(Array.prototype.map.call(atob(s),function(t){return"%".concat("00".concat(t.charCodeAt(0).toString(16)).slice(-2))}).join("")))]}})})()},n.getCurrentCommit=function(){var t=this;return(0,s._)(function(){var e,n;return(0,o.YH)(this,function(r){switch(r.label){case 0:return t.progressTick(),[4,t.addToQueue("git.getRef heads/".concat(t.branch),t.throttle,function(){var e;return null==(e=t.octoKit)?void 0:e.git.getRef({owner:t.owner,repo:t.repo,ref:"heads/".concat(t.branch)})})];case 1:return e=r.sent().data.object.sha,[4,t.addToQueue("git.getCommit ".concat(e),t.throttle,function(){var n;return null==(n=t.octoKit)?void 0:n.git.getCommit({owner:t.owner,repo:t.repo,commit_sha:e})})];case 2:return n=r.sent().data,[2,{commitSha:e,treeSha:n.tree.sha}]}})})()},n.createBlobForFile=function(t,e,n){var r=t.destination,a=t.blob,i=this;return(0,s._)(function(){var t,s,u;return(0,o.YH)(this,function(o){switch(o.label){case 0:return i.progressTick(),[4,(0,S.A)(a,S.Z.DATA_URL)];case 1:return s=(t=o.sent()).indexOf(";base64,")+8,u=t.slice(s),[4,i.addToQueue("git.createBlob (".concat(e+1,"/").concat(n,") ").concat(r),i.throttle,function(){var t;return null==(t=i.octoKit)?void 0:t.git.createBlob({owner:i.owner,repo:i.repo,content:u,encoding:"base64"})})];case 2:return[2,{filename:r,blobData:o.sent().data}]}})})()},n.createNewTree=function(t,e,n){var r=this;return(0,s._)(function(){var a,s;return(0,o.YH)(this,function(o){switch(o.label){case 0:return r.progressTick(),a=t.map(function(t){return{path:t.filename,mode:"100644",type:"blob",sha:t.blobData.sha}}),s=e.map(function(t){return{path:t.path,mode:"100644",sha:null}}),[4,r.addToQueue("git.createTree ".concat(n),r.throttle,function(){var t;return null==(t=r.octoKit)?void 0:t.git.createTree({owner:r.owner,repo:r.repo,tree:(0,_._)(a).concat((0,_._)(s)),base_tree:n})})];case 1:return[2,o.sent().data.sha]}})})()},n.createNewCommit=function(t,e,n){var r=this;return(0,s._)(function(){return(0,o.YH)(this,function(a){switch(a.label){case 0:return r.progressTick(),[4,r.addToQueue("git.createCommit ".concat(t),r.throttle,function(){var a;return null==(a=r.octoKit)?void 0:a.git.createCommit({owner:r.owner,repo:r.repo,message:t,tree:e,parents:[n]})})];case 1:return[2,a.sent().data.sha]}})})()},n.setBranchToCommit=function(t){var e=this;return(0,s._)(function(){return(0,o.YH)(this,function(n){switch(n.label){case 0:return e.progressTick(),[4,e.addToQueue("git.updateRef ".concat(t),e.throttle,function(){var n;return null==(n=e.octoKit)?void 0:n.git.updateRef({owner:e.owner,repo:e.repo,ref:"heads/".concat(e.branch),sha:t})})];case 1:return n.sent(),[2]}})})()},n.uploadToRepo=function(t){var e=t.upload,n=t.del,r=this;return(0,s._)(function(){var t,a,s,i,u,c,l,h;return(0,o.YH)(this,function(o){switch(o.label){case 0:if(!r.octoKit)throw Error("OctoClient not configured");return t="Sync. ".concat(new Date().toLocaleString(r.getPreferredLocale())),a=e.length,[4,r.getCurrentCommit()];case 1:return i=(s=o.sent()).treeSha,u=s.commitSha,[4,Promise.all(e.map(function(t,e){return r.createBlobForFile(t,e,a)}))];case 2:return c=o.sent(),[4,r.createNewTree(c,n,i)];case 3:return l=o.sent(),[4,r.createNewCommit(t,l,u)];case 4:return h=o.sent(),[4,r.setBranchToCommit(h)];case 5:return o.sent(),[2]}})})()},n.updateRemoteStore=function(t){var e=t.upload,n=t.del,r=this;return(0,s._)(function(){var t;return(0,o.YH)(this,function(a){switch(a.label){case 0:if(a.trys.push([0,2,,3]),r.busy)throw Error("currently busy");if(!e.length&&!n.length)return[2,{}];return r.progressStart(e.length),r.busy=!0,[4,r.uploadToRepo({upload:e,del:n})];case 1:return a.sent(),r.busy=!1,r.progressTick(!0),[2,{uploaded:e.map(function(t){return t.destination}),deleted:n.map(function(t){return t.path}),repo:"https://github.com/".concat(r.owner,"/").concat(r.repo,"/tree/").concat(r.branch)}];case 2:throw t=a.sent(),r.busy=!1,r.emit("error",t),t;case 3:return[2]}})})()},e}(A()),x=function(){var t=p.A.getState().gitStorage,e=h.A.getState().setProgressLog,n=new(u())(1,1/0);r=new H(t,function(){return f.A.getState().preferredLocale},(a=function(t){return function(r,a,i){return n.add((0,s._)(function(){return(0,o.YH)(this,function(n){switch(n.label){case 0:return[4,(0,d.c)(a)];case 1:return n.sent(),e("git",{timestamp:new Date().getTime()/1e3,message:"".concat(t," runs ").concat(r)}),[2,i()]}})}))}})("OctoClient"))},C=function(t){var e,n,i=l.A.getState(),u=i.setSyncBusy,f=i.setSyncSelect,d=h.A.getState().setProgressLog,v=p.A.getState().syncLastUpdate,b=(e=(0,s._)(function(t){return(0,o.YH)(this,function(e){switch(e.label){case 0:return[4,r.setOctokit(t)];case 1:return e.sent(),[2]}})}),function(t){return e.apply(this,arguments)}),w=(n=(0,s._)(function(e){var n,s,i,h;return(0,o.YH)(this,function(o){switch(o.label){case 0:u(!0),f(!1),o.label=1;case 1:return o.trys.push([1,10,,11]),[4,r.getRepoContents()];case 2:switch(n=o.sent(),e){case c.p.UP:return[3,3];case c.p.DOWN:return[3,6]}return[3,8];case 3:return s=(null==v?void 0:v.local)||Math.floor(new Date().getTime()/1e3),[4,(0,g.A)(n,s,a("GBPrinter"))];case 4:return i=o.sent(),[4,r.updateRemoteStore(i)];case 5:return o.sent(),[3,9];case 6:return[4,(0,m.Ay)(n)];case 7:return t(o.sent()),[3,9];case 8:throw Error("github sync: wrong sync case");case 9:return d("git",{timestamp:new Date().getTime()/1e3,message:"."}),u(!1),[3,11];case 10:return console.error(h=o.sent()),l.A.getState().setError(h),[3,11];case 11:return[2]}})}),function(t){return n.apply(this,arguments)});return p.A.subscribe(function(t){return t.gitStorage},b),{startSyncData:w,updateSettings:b}}},17419:(t,e,n)=>{n.d(e,{Ay:()=>g,L2:()=>p,_K:()=>f});var r=n(97004),a=n(693),s=n(60376),o=n(87025),i=n(39249),u=n(53982),c=n(55364),l=n(99451),h=n(72623),f=function(){var t=(0,r._)(function(t){var e;return(0,i.YH)(this,function(n){return e=t.split("\n").filter(function(t){return t.match(/^[0-9a-f ]+$/gi)}),[2,(0,h.UN)(e)]})});return function(e){return t.apply(this,arguments)}}(),p=function(t){var e=Array(32).fill("f").join(""),n=Array(16).fill(e);return(0,o._)(t.upper).concat((0,o._)(Array(14).fill("").map(function(e,r){return(0,o._)(t.left[r]).concat((0,o._)(n),(0,o._)(t.right[r]))}).flat()),(0,o._)(t.lower))},d=function(){var t=(0,r._)(function(t){var e,n,r;return(0,i.YH)(this,function(a){return n=(e=JSON.parse(t)).upper.length/20,r=p(e),[2,(0,u.R_)(r,n)]})});return function(e){return t.apply(this,arguments)}}();let g=function(){var t=(0,r._)(function(t){var e,n,o,p,g,m,v,b,w;return(0,i.YH)(this,function(_){var y,A;switch(_.label){case 0:return e=t.images,n=t.frames,p=(o=t.settings).state.images||[],g=o.state.frames||[],[4,Promise.all(e.map((y=(0,r._)(function(t){var e,n;return(0,i.YH)(this,function(r){switch(r.label){case 0:return[4,(0,h.Hh)(t.hash,void 0,!0)];case 1:if(null==(e=r.sent())?void 0:e.length)return[2,void 0];return[4,t.getFileContent()];case 2:return[4,f(r.sent())];case 3:if(n=r.sent(),t.hash!==n)return[2,{oldHash:t.hash,newHash:n}];return[2,void 0]}})}),function(t){return y.apply(this,arguments)})))];case 1:return m=_.sent().reduce(l.N,[]),[4,Promise.all(n.map((A=(0,r._)(function(t){var e;return(0,i.YH)(this,function(n){switch(n.label){case 0:return[4,(0,u.mZ)(t.hash)];case 1:if(n.sent())return[2,void 0];return[4,t.getFileContent()];case 2:return[4,d(n.sent())];case 3:if(e=n.sent(),t.hash!==e)return[2,{oldHash:t.hash,newHash:e}];return[2,void 0]}})}),function(t){return A.apply(this,arguments)})))];case 2:return v=_.sent().reduce(l.N,[]),b=p.map(function(t){if((0,c.pl)(t)){var e=(0,a._)({},t.hashes),n=m.find(function(e){return e.oldHash===t.hashes.r}),r=m.find(function(e){return e.oldHash===t.hashes.g}),o=m.find(function(e){return e.oldHash===t.hashes.b}),i=m.find(function(e){return e.oldHash===t.hashes.n});return(null==n?void 0:n.newHash)&&(e.r=null==n?void 0:n.newHash),(null==r?void 0:r.newHash)&&(e.g=null==r?void 0:r.newHash),(null==o?void 0:o.newHash)&&(e.b=null==o?void 0:o.newHash),(null==i?void 0:i.newHash)&&(e.n=null==i?void 0:i.newHash),(0,s._)((0,a._)({},t),{hashes:e})}var u=m.find(function(e){return e.oldHash===t.hash});return(0,s._)((0,a._)({},t),{hash:(null==u?void 0:u.newHash)||t.hash})}),w=g.map(function(t){var e=v.find(function(e){return e.oldHash===t.hash});return e?(0,s._)((0,a._)({},t),{hash:e.newHash}):t}),[2,(0,s._)((0,a._)({},o),{state:(0,s._)((0,a._)({},o.state),{images:b,frames:w})})]}})});return function(e){return t.apply(this,arguments)}}()},19320:(t,e,n)=>{n.d(e,{A:()=>_});var r=n(97004),a=n(87025),s=n(39249);let o=function(t,e,n,r){var s=t.images,o=t.frames,i=s.filter(function(t){var a=t.path;return!n.find(function(t){return a===t.destination})&&!e.find(function(t){return a===t.destination})&&!r.find(function(t){return a.indexOf(t)>=-1})}),u=o.filter(function(t){var r=t.path;return!n.find(function(t){return r===t.destination})&&!e.find(function(t){return r===t.destination})});return{upload:e.filter(function(t){var e=t.destination;return!s.find(function(t){return t.path===e})&&!o.find(function(t){return t.path===e})}),del:(0,a._)(i).concat((0,a._)(u))}};var i=n(69229),u=n(69176),c=function(t){switch(t){case"image/png":return"png";case"image/jpg":case"image/jpeg":return"jpg";case"image/webp":return"webp";case"text/plain":return"txt";case"text/markdown":return"md";case"application/json":case"text/json":return"json";default:return console.warn('unknown file extension for type "'.concat(t,'"')),"none"}};let l=function(){var t;return t=(0,r._)(function(t,e){var n,r,o,l,h;return(0,s.YH)(this,function(s){switch(s.label){case 0:return n=[],r=[],o={},t.forEach(function(t){var e,s,i=t.files,u=t.inRepo;(e=r).push.apply(e,(0,a._)(u.map(function(t){var e=t.path,n=e.split("/")[0];return o[n]=o[n]?o[n]+1:1,{destination:e}}))),(s=n).push.apply(s,(0,a._)(i.map(function(t){var e=t.blob,n=t.folder,r=t.filename,a=c(e.type),s=n||a;return o[s]=o[s]?o[s]+1:1,{destination:"".concat(s,"/").concat(r),blob:e}})))}),l=["## Files in this repo:"].concat((0,a._)(Object.keys(o).map(function(t){return" * ".concat(t,": [").concat(o[t],"](/").concat(t,")")}))).join("\n"),[4,(0,u.m)(i.m.JSON_EXPORT,{lastUpdateUTC:e})];case 1:return h=s.sent(),n.push({destination:"README.md",blob:new Blob((0,a._)(l),{type:"text/plain"})},{destination:"settings.json",blob:new Blob((0,a._)(h),{type:"application/json"})}),[2,{toUpload:n.filter(Boolean),toKeep:r.filter(Boolean)}]}})}),function(e,n){return t.apply(this,arguments)}};var h=n(693),f=n(60376),p=n(11760),d=n(53982),g=function(){var t=(0,r._)(function(t,e){var n,a,o;return(0,s.YH)(this,function(i){switch(i.label){case 0:return n=[],o=(a=p.h.getState().frames.map(function(e){return{file:e,searchHashes:[e.hash],inRepo:[t.frames.find(function(t){return t.hash===e.hash})].filter(Boolean)}})).length,[4,Promise.all(a.map(function(t,n){var a=t.file;return t.inRepo.length?(0,f._)((0,h._)({},a),{inRepo:t.inRepo,files:[]}):e("loadFrameData (".concat(n+1,"/").concat(o,") ").concat(a.id),3,(0,r._)(function(){var e;return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,(0,d.mZ)(a.hash)];case 1:return e=n.sent(),[2,(0,f._)((0,h._)({},a),{inRepo:t.inRepo,files:[{folder:"frames",filename:"".concat(a.hash,".json"),blob:new Blob(Array(JSON.stringify(e||"{}",null,2)),{type:"application/json"}),title:a.name}]})]}})}))}))];case 1:return[2,{syncFrames:i.sent().filter(Boolean),missingLocally:n}]}})});return function(e,n){return t.apply(this,arguments)}}(),m=n(2608),v=n(55364),b=n(55685),w=function(){var t=(0,r._)(function(t,e){var n,o,i;return(0,s.YH)(this,function(u){switch(u.label){case 0:var c;return n=[],i=(o=p.h.getState().images.map(function(e){var n=(0,v.pl)(e)?(0,b.A)(Object.values(e.hashes)).filter(Boolean):[e.hash];return{file:e,searchHashes:n,inRepo:t.images.reduce(function(t,e){return n.includes(e.hash)?(0,a._)(t).concat([e]):t},[])}})).length,[4,Promise.all(o.map((c=(0,r._)(function(t,n){return(0,s.YH)(this,function(a){return t.inRepo.length===t.searchHashes.length?[2,{hash:t.file.hash,inRepo:t.inRepo,files:[]}]:[2,e("loadImageTiles (".concat(n+1,"/").concat(i,") ").concat(t.file.title),3,(0,r._)(function(){var e,n,r;return(0,s.YH)(this,function(a){switch(a.label){case 0:if(!(0,v.pl)(t.file))return[3,2];return[4,Promise.all(Object.values((n=t.file).hashes).map(function(t){return(0,m.Z)(t,n.title,t)}))];case 1:return e=a.sent(),[3,4];case 2:return r=t.file,[4,(0,m.Z)(r.hash,r.title,r.hash)];case 3:e=[a.sent()],a.label=4;case 4:return[2,{hash:t.file.hash,files:e,inRepo:t.inRepo}]}})}))]})}),function(t,e){return c.apply(this,arguments)})))];case 1:return[2,{syncImages:u.sent().filter(Boolean),missingLocally:n}]}})});return function(e,n){return t.apply(this,arguments)}}();let _=function(){var t=(0,r._)(function(t,e,n){var r,i,u,c,h,f,p,d,m,v,b,_;return(0,s.YH)(this,function(s){switch(s.label){case 0:return u=l(),c=[],[4,w(t,n)];case 1:return f=(h=s.sent()).syncImages,p=h.missingLocally,(r=c).push.apply(r,(0,a._)(p)),[4,g(t,n)];case 2:return m=(d=s.sent()).syncFrames,v=d.missingLocally,(i=c).push.apply(i,(0,a._)(v)),b=(0,a._)(f).concat((0,a._)(m)),[4,u(b,e)];case 3:return[2,o(t,(_=s.sent()).toUpload,_.toKeep,c)]}})});return function(e,n,r){return t.apply(this,arguments)}}()},41476:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(86447),a=n(693),s=n(60376),o=n(87025),i=n(51368);let u=(0,n(65453).v)(function(t,e){return{progress:[],progressLog:{git:[],dropbox:[]},resetProgressLog:function(){return t({progressLog:{git:[],dropbox:[]}})},startProgress:function(e){var n={id:(0,i.A)(),label:e,value:0};return t(function(t){var e=t.progress;return{progress:(0,o._)(e).concat([n])}}),n.id},setProgress:function(e,n){t(function(t){return{progress:t.progress.map(function(t){return t.id!==e?t:(0,s._)((0,a._)({},t),{value:n})})}})},stopProgress:function(e){t(function(t){return{progress:t.progress.filter(function(t){return t.id!==e})}})},setProgressLog:function(n,i){var u=e().progressLog;t({progressLog:(0,s._)((0,a._)({},u),(0,r._)({},n,[i].concat((0,o._)(u[n]))))})}}})},56277:(t,e,n)=>{n.d(e,{e:()=>a,p:()=>r});var r=function(t){return t.UP="up",t.DOWN="down",t}({}),a=function(t){return t.GIT="git",t.DROPBOX="dropbox",t.DROPBOXIMAGES="dropboximages",t}({})},74335:(t,e,n)=>{n.d(e,{c:()=>s});var r=n(97004),a=n(39249),s=function(){var t=(0,r._)(function(t){return(0,a.YH)(this,function(e){return[2,new Promise(function(e){self.setTimeout(e,t)})]})});return function(e){return t.apply(this,arguments)}}()},93782:(t,e,n)=>{n.d(e,{A:()=>r});let r=function(t){return t.replace(/[^a-z0-9/\\._-]/gi,"").replace(/[\\/]+/gi,"/").replace(/^\//,"").replace(/\/$/,"")}},94979:(t,e,n)=>{n.r(e),n.d(e,{dropBoxSyncTool:()=>N});var r=n(97004),a=n(693),s=n(60376),o=n(87025),i=n(39249),u=n(58617),c=n.n(u),l=n(56277),h=n(71620),f=n(46498),p=n(11760),d=n(41476),g=n(52166),m=n(24463),v=n(74335),b=n(5415),w=n(66785),_=n(19320),y=n(5847);let A=function(){var t=new URLSearchParams(window.location.search).get("code");return t?(window.history.replaceState({},"",window.location.pathname),{dropboxCode:t}):{}};var T=n(31533),S=n(17419),H=n(53982),x=n(82666),C=n(65492),k=n(66214),L=n(78538),Y=n(40662),P=n(87422),R=n(93782),D=n(5672),U=encodeURIComponent("".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname)),B=function(t){function e(t,n){(0,C._)(this,e),(r=(0,x._)(this,e)).queueCallback=n,r.throttle=30,r.rootPath=[];var r,a,s=t.accessToken,o=t.expiresAt,i=t.refreshToken,u=t.path,c=t.autoDropboxSync;r.setRootPath(u),r.dbx=new P.Dropbox({clientId:"err6neqzlljod7b",accessToken:s,accessTokenExpiresAt:new Date(o||0),refreshToken:i});var l=null==(a=r.dbx)?void 0:a.auth;if(!l)throw Error("dbx auth error");return r.auth=l,c&&r.startLongPollSettings(),r}(0,k._)(e,t);var n=e.prototype;return n.addToQueue=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var a=this;return(0,r._)(function(){return(0,i.YH)(this,function(t){if(!a.auth.getAccessToken())throw Error("not logged in");return[2,a.queueCallback.apply(a,(0,o._)(e))]})})()},n.setRootPath=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.rootPath=(0,R.A)(t).split("/")},n.toPath=function(t){var e=(0,o._)(this.rootPath).concat((0,o._)(t.split("/"))).filter(Boolean);return"/".concat(e.join("/"))},n.inSettingsPath=function(t){var e=this.toPath("settings");return(0,R.A)(t.replace(e,""))},n.checkLoginStatus=function(){var t=this;return(0,r._)(function(){var e,n,r,a;return(0,i.YH)(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,t.auth.checkAndRefreshAccessToken()];case 1:return s.sent(),e=t.auth.getAccessToken(),r=(n=t.auth.getAccessTokenExpiresAt().getTime())-new Date().getTime(),t.emit("loginDataUpdate",{accessToken:e,expiresAt:n}),[2,!!e&&r>1e3];case 2:throw a=s.sent(),t.auth.setAccessTokenExpiresAt(new Date(0)),t.auth.setAccessToken(""),a;case 3:return[2]}})})()},n.startAuth=function(){var t=this;return(0,r._)(function(){var e;return(0,i.YH)(this,function(n){switch(n.label){case 0:return[4,t.auth.getAuthenticationUrl(U,void 0,"code","offline",void 0,void 0,!0)];case 1:return e=n.sent(),window.sessionStorage.setItem("dropboxCodeVerifier",t.auth.getCodeVerifier()),window.location.replace(e),[2]}})})()},n.codeAuth=function(t){var e=this;return(0,r._)(function(){var n,r,a,s,o,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(!(n=window.sessionStorage.getItem("dropboxCodeVerifier")))throw Error("no codeVerifier");return e.auth.setCodeVerifier(n),window.sessionStorage.removeItem("dropboxCodeVerifier"),[4,e.auth.getAccessTokenFromCode(U,t)];case 1:return a=(r=i.sent().result).refresh_token,s=r.access_token,o=r.expires_in,u=new Date().getTime()+1e3*o,e.auth.setAccessToken(s),e.auth.setAccessTokenExpiresAt(new Date(u)),e.emit("loginDataUpdate",{refreshToken:a,accessToken:s,expiresAt:u}),[2]}})})()},n.getRemoteSettings=function(t){var e=this;return(0,r._)(function(){var n;return(0,i.YH)(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,e.addToQueue("dbx.filesDownload /settings.json",e.throttle,function(){return e.dbx.filesDownload({path:e.toPath("/settings/settings.json")})},t)];case 1:return n=r.sent().result,[4,(0,D.A)(n.fileBlob,D.Z.TEXT)];case 2:return[2,JSON.parse(r.sent())];case 3:return r.sent(),[2,{state:{lastUpdateUTC:0,version:p.A}}];case 4:return[2]}})})()},n.getRemoteContents=function(){var t=this;return(0,r._)(function(){var e,n,a,s,o,u;return(0,i.YH)(this,function(c){switch(c.label){case 0:return e=["images","frames"],n=!1,[4,t.checkLoginStatus()];case 1:if(!c.sent())throw Error("not logged in");return[4,t.getRemoteSettings(n)];case 2:var l;return a=c.sent(),[4,Promise.all(e.map((l=(0,r._)(function(e){var r,a,s,o,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:s="",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.addToQueue("dbx.filesListFolder /".concat(e),t.throttle,function(){return t.dbx.filesListFolder({path:t.toPath("/settings/".concat(e)),limit:250,recursive:!0})},n)];case 2:return r=(o=i.sent()).result.entries,a=o.result.has_more,s=o.result.cursor,[3,4];case 3:return i.sent(),r=[],a=!1,[3,4];case 4:if(!a)return[3,6];return u=r.concat,[4,t.getMoreContents(s,n)];case 5:r=u.apply(r,[i.sent()]),i.label=6;case 6:return[2,r.filter(function(t){return"file"===t[".tag"]})]}})}),function(t){return l.apply(this,arguments)})))];case 3:return o=(s=L._.apply(void 0,[c.sent(),2]))[0],u=s[1],[2,{images:t.augmentFileList("images",o,n),frames:t.augmentFileList("frames",u,n),settings:a}]}})})()},n.getImageContents=function(){var t=this;return(0,r._)(function(){var e,n,r,a,s;return(0,i.YH)(this,function(i){switch(i.label){case 0:r="",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.addToQueue("dbx.filesListFolder /images",t.throttle,function(){return t.dbx.filesListFolder({path:t.toPath("/images"),limit:250,recursive:!0})})];case 2:return e=(a=i.sent()).result.entries,n=a.result.has_more,r=a.result.cursor,[3,4];case 3:return i.sent(),e=[],n=!1,[3,4];case 4:if(!n)return[3,6];return s=e.concat,[4,t.getMoreContents(r)];case 5:e=s.apply(e,[i.sent()]),i.label=6;case 6:return[2,e.reduce(function(t,e){return"file"===e[".tag"]?(0,o._)(t).concat([e]):t},[])]}})})()},n.getMoreContents=function(t,e){var n=this;return(0,r._)(function(){var r,a,s,o,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:s="",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.addToQueue("dbx.filesListFolderContinue ".concat(t),n.throttle,function(){return n.dbx.filesListFolderContinue({cursor:t})},e)];case 2:return r=(o=i.sent()).result.entries,a=o.result.has_more,s=o.result.cursor,[3,4];case 3:return i.sent(),r=[],a=!1,[3,4];case 4:if(!a)return[3,6];return u=r.concat,[4,n.getMoreContents(s,e)];case 5:r=u.apply(r,[i.sent()]),i.label=6;case 6:return[2,r]}})})()},n.augmentFileList=function(t,e,n){var r=this;return e.map(function(a,s){var o,i=a.path_lower,u=a.content_hash,c=a.name,l=i?r.inSettingsPath(i):"";switch(t){case"images":case"frames":o=c.split(".")[0];break;default:o="-"}return{path:l,name:c,contentHash:u||"",hash:o,getFileContent:function(){return r.getFileContent(l,s,e.length,n)}}})},n.getFileContent=function(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this;return(0,r._)(function(){var r,o,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r=s.toPath("/settings/".concat(t)),o="dbx.filesDownload (".concat(e+1,"/").concat(n,") ").concat(r),[4,s.addToQueue(o,s.throttle,function(){return s.dbx.filesDownload({path:r})},a)];case 1:return u=i.sent().result,[2,(0,D.A)(u.fileBlob,D.Z.TEXT)]}})})()},n.upload=function(t,e){var n=this;return(0,r._)(function(){var a,s,o,u,c,l;return(0,i.YH)(this,function(h){var f,p;switch(h.label){case 0:return a=t.upload,s=t.del,[4,Promise.all(a.map((f=(0,r._)(function(t,r){return(0,i.YH)(this,function(s){switch(s.label){case 0:return[4,n.addToQueue("dbx.filesUpload (".concat(r+1,"/").concat(a.length,") ").concat(t.destination),n.throttle,function(){return n.dbx.filesUpload({path:n.toPath("/".concat(e,"/").concat(t.destination)),contents:t.blob,mode:{".tag":"overwrite"}})})];case 1:return[2,s.sent().result]}})}),function(t,e){return f.apply(this,arguments)})))];case 1:if(o=h.sent(),!s.length)return[2,{uploaded:o,deleted:[]}];return[4,n.addToQueue("dbx.filesDeleteBatch ".concat(s.length," files"),n.throttle,function(){return n.dbx.filesDeleteBatch({entries:s.map(function(t){var e=t.path;return{path:n.toPath("/settings/".concat(e))}})})})];case 2:return u=h.sent().result.async_job_id,p=(0,r._)(function(){var t,e,r;return(0,i.YH)(this,function(a){switch(a.label){case 0:return[4,n.addToQueue("dbx.filesDeleteBatchCheck ".concat(u),2e3,function(){return n.dbx.filesDeleteBatchCheck({async_job_id:u})})];case 1:if(e=(t=a.sent().result)[".tag"],r=t.entries,"in_progress"===e)return[2,c()];return[2,r.map(function(t){return t.metadata})]}})}),[4,(c=function(){return p.apply(this,arguments)})()];case 3:return l=h.sent(),[2,{uploaded:o,deleted:l}]}})})()},n.startLongPollSettings=function(){var t=this;return(0,r._)(function(){var e;return(0,i.YH)(this,function(n){switch(n.label){case 0:console.info("Start dropbox longpolling"),n.label=1;case 1:if(!m.A.getState().dropboxStorage.autoDropboxSync)return[3,7];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,t.getRemoteSettings(!0)];case 3:return(e=n.sent()).state.lastUpdateUTC&&m.A.getState().setSyncLastUpdate("dropbox",e.state.lastUpdateUTC),[3,5];case 4:return console.error("Error polling Dropbox settings:",n.sent()),[3,5];case 5:return[4,(0,v.c)(2e4)];case 6:return n.sent(),[3,1];case 7:return[2]}})})()},e}(Y.EventEmitter),F=n(3899),E=n.n(F);function j(){return(j=(0,r._)(function(t){var e,n,a;return(0,i.YH)(this,function(s){switch(s.label){case 0:var u;return[4,Promise.all(E()(new Uint8Array(t),4194304).map((u=(0,r._)(function(t){var e;return(0,i.YH)(this,function(n){switch(n.label){case 0:return e=Uint8Array.bind,[4,crypto.subtle.digest("SHA-256",new Uint8Array(t))];case 1:return[2,o._.apply(void 0,[new(e.apply(Uint8Array,[void 0,n.sent()]))])]}})}),function(t){return u.apply(this,arguments)})))];case 1:return e=new Uint8Array(s.sent().flat()),a=Uint8Array.bind,[4,crypto.subtle.digest("SHA-256",e)];case 2:return n=new(a.apply(Uint8Array,[void 0,s.sent()])),[2,(0,o._)(n).map(function(t){return t.toString(16).padStart(2,"0")}).join("")]}})})).apply(this,arguments)}var O=[],N=function(t,e){var n,u,x,C,k=f.A.getState(),L=k.setSyncBusy,Y=k.setSyncSelect,P=d.A.getState().setProgressLog,R=new(c())(1,1/0),D=function(t){return function(e,n,a,s){return R.add((0,r._)(function(){return(0,i.YH)(this,function(r){switch(r.label){case 0:return[4,(0,v.c)(n)];case 1:return r.sent(),s||P("dropbox",{timestamp:new Date().getTime()/1e3,message:"".concat(t," runs ").concat(e)}),[2,a()]}})}))}},U=new B(m.A.getState().dropboxStorage,D("Dropbox")),F=(n=(0,r._)(function(t){return(0,i.YH)(this,function(e){return U.setRootPath(t.path||"/"),[2]})}),function(t){return n.apply(this,arguments)}),E=(u=(0,r._)(function(t){var n,r,a,s,o,u,c;return(0,i.YH)(this,function(i){switch(i.label){case 0:return L(!0),Y(!1),n=m.A.getState().syncLastUpdate,[4,U.getRemoteContents()];case 1:switch(r=i.sent(),t){case l.p.UP:return[3,2];case l.p.DOWN:return[3,5]}return[3,8];case 2:return a=(null==n?void 0:n.local)||Math.floor(new Date().getTime()/1e3),[4,(0,_.A)(r,a,D("GBPrinter"))];case 3:return s=i.sent(),[4,U.upload(s,"settings")];case 4:return i.sent(),m.A.getState().setSyncLastUpdate("dropbox",a),[3,9];case 5:return[4,(0,S.Ay)(r)];case 6:return[4,e(i.sent())];case 7:return i.sent(),(c=(null==(u=r.settings)||null==(o=u.state)?void 0:o.lastUpdateUTC)||0)&&m.A.getState().setSyncLastUpdate("dropbox",c),[3,9];case 8:throw Error("dropbox sync: wrong sync case");case 9:return P("dropbox",{timestamp:new Date().getTime()/1e3,message:"."}),L(!1),[2]}})}),function(t){return u.apply(this,arguments)}),N=(x=(0,r._)(function(){var t,e,n,u,c,l,f,d,m,v,_,A,S,x,C,k,R;return(0,i.YH)(this,function(B){var F,E;switch(B.label){case 0:return L(!0),Y(!1),e=(t=p.h.getState()).frames,n=t.palettes,u=t.images,l=(c=g.A.getState()).exportScaleFactors,f=c.exportFileTypes,d=c.handleExportFrame,m=c.fileNameStyle,v=h.A.getState(),_=(0,w.S)({images:u,groups:[]},v),A=(0,b.j)(l,f,d,n,m),S=(0,y.T)(u,e),[4,Promise.all(_.map((F=(0,r._)(function(t,n){return(0,i.YH)(this,function(a){return[2,D("Generate images and hashes")("".concat(n+1,"/").concat(_.length),10,(0,r._)(function(){var n,a,s,o,u;return(0,i.YH)(this,function(c){switch(c.label){case 0:return[4,S(t.hash)];case 1:if(n=c.sent(),!(a=e.find(function(e){return e.id===t.frame})))return[3,3];return[4,(0,H.mZ)(null==a?void 0:a.hash)];case 2:return o=c.sent(),[3,4];case 3:o=null,c.label=4;case 4:if(u=(s=o)?s.upper.length/20:2,!n)throw Error("tiles missing");return[4,A(t)(n,u)];case 5:var l;return[4,Promise.all(c.sent().map((l=(0,r._)(function(t){var e;return(0,i.YH)(this,function(n){switch(n.label){case 0:return e={filename:t.filename},[4,t.blob.arrayBuffer()];case 1:return[2,(e.arrayBuffer=n.sent(),e)]}})}),function(t){return l.apply(this,arguments)})))];case 6:return[2,c.sent()]}})}))]})}),function(t,e){return F.apply(this,arguments)})))];case 1:return x=B.sent().flat(),[4,Promise.all((0,T.A)(x).map((E=(0,r._)(function(t){var e,n;return(0,i.YH)(this,function(r){switch(r.label){case 0:return e=[(0,a._)({},t)],n={},[4,function(t){return j.apply(this,arguments)}(t.arrayBuffer)];case 1:return[2,s._.apply(void 0,e.concat([(n.dropboxContentHash=r.sent(),n)]))]}})}),function(t){return E.apply(this,arguments)})))];case 2:return C=B.sent(),[4,U.getImageContents()];case 3:return k=B.sent(),R=C.reduce(function(t,e){var n=e.arrayBuffer,r=e.dropboxContentHash,a=e.filename;return -1===k.findIndex(function(t){var e=t.content_hash,n=t.name;return e===r&&n===a})?(0,o._)(t).concat([{blob:new Blob([n]),destination:a}]):t},[]),[4,U.upload({upload:R,del:[]},"images")];case 4:return B.sent(),P("dropbox",{timestamp:new Date().getTime()/1e3,message:"."}),L(!1),[2]}})}),function(){return x.apply(this,arguments)}),I=(C=(0,r._)(function(e){var n,r;return(0,i.YH)(this,function(a){switch(a.label){case 0:if(n=t.updateImages,O.includes(e))return[3,3];return O.push(e),[4,U.getFileContent("images/".concat(e,".txt"),0,1,!0)];case 1:return r=a.sent(),[4,(0,S._K)(r)];case 2:a.sent(),n([]),a.label=3;case 3:return[2]}})}),function(t){return C.apply(this,arguments)});U.on("loginDataUpdate",function(t){(0,m.A.getState().setDropboxStorage)(t)});var Q=A().dropboxCode;return Q&&U.codeAuth(Q),m.A.subscribe(function(t){return t.dropboxStorage},F),{updateSettings:F,startSyncData:E,startSyncImages:N,startAuth:function(){return U.startAuth()},recoverImageData:I}}},99451:(t,e,n)=>{n.d(e,{N:()=>a});var r=n(87025),a=function(t,e){return e?(0,r._)(t).concat([e]):t}}}]);