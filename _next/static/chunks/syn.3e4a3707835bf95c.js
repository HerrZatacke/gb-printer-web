"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1575],{4862:(e,t,n)=>{n.d(t,{j:()=>r});var r=function(e){return e.GALLERY_VIEW_SMALL="small",e.GALLERY_VIEW_1X="1x",e.GALLERY_VIEW_2X="2x",e.GALLERY_VIEW_MAX="max",e.PALETTE_VIEW="res2x",e}({})},5672:(e,t,n)=>{n.d(t,{A:()=>o,Z:()=>a});var r=n(49641).Buffer,a=function(e){return e.UINT8_ARRAY="uint8array",e.TEXT="text",e.DATA_URL="dataURL",e.BINARY_STRING="binaryString",e}({});let o=function(e,t){return new Promise(function(n,a){var o=new FileReader;switch(o.onload=function(e){var o=e.target;if(null==o?void 0:o.result)return"uint8array"===t?void n(r.from(o.result)):void n(o.result);a(Error("Filereader has no result"))},o.onerror=function(e){a(e)},t){case"uint8array":o.readAsArrayBuffer(e);break;case"text":o.readAsText(e);break;case"binaryString":o.readAsBinaryString(e);break;case"dataURL":o.readAsDataURL(e);break;default:a(Error('readAs param missing or unknown type "'.concat(t,'"')))}})}},5847:(e,t,n)=>{n.d(t,{T:()=>i,p:()=>u});var r=n(97004),a=n(39249),o=n(55364),s=n(72623),i=function(e,t,n){var i,u=(i=(0,r._)(function(r,i,c,l){var h,f,d,p,g,m,v,b,_,w,y,T;return(0,a.YH)(this,function(a){switch(a.label){case 0:if(f=e.find(function(e){return r===e.hash}),d=("string"==typeof c?c:null==f?void 0:f.frame)||void 0,p=null==(h=t.find(function(e){return e.id===d}))?void 0:h.hash,l||!(!f||!(0,o.pl)(f)))return[3,2];return[4,(0,s.Hh)(r,p,i,n)];case 1:return[2,a.sent()||[]];case 2:if(!(g=l||f.hashes).r)return[3,4];return[4,u(g.r,i,d)];case 3:return v=a.sent(),[3,5];case 4:v=[],a.label=5;case 5:if(m=v,!g.g)return[3,7];return[4,u(g.g,i,d)];case 6:return _=a.sent(),[3,8];case 7:_=[],a.label=8;case 8:if(b=_,!g.b)return[3,10];return[4,u(g.b,i,d)];case 9:return y=a.sent(),[3,11];case 10:y=[],a.label=11;case 11:if(w=y,!g.n)return[3,13];return[4,u(g.n,i,d)];case 12:return T=a.sent(),[3,14];case 13:T=[],a.label=14;case 14:return[2,{r:m,g:b,b:w,n:T}]}})}),function(e,t,n,r){return i.apply(this,arguments)});return u},u=function(e,t){var n,o=i(e,t);return n=(0,r._)(function(e){var t,n,r,s,i;return(0,a.YH)(this,function(a){switch(a.label){case 0:return[4,o(e,!0,"")];case 1:if(t=a.sent())return[2,(null==t?void 0:t.length)||(null==(n=t.r)?void 0:n.length)||(null==(r=t.g)?void 0:r.length)||(null==(s=t.b)?void 0:s.length)||(null==(i=t.n)?void 0:i.length)||0];return[2,0]}})}),function(e){return n.apply(this,arguments)}}},6456:(e,t,n)=>{n.d(t,{PM:()=>u,YZ:()=>s,lt:()=>i});var r=n(693),a=n(60376),o=n(78538),s=function(e,t){return(0,a._)((0,r._)({},e),{sortIndex:t})},i=function(e){return(0,a._)((0,r._)({},e),{sortIndex:void 0})},u=function(e){return function(t,n){if(!e)return 0;var r=(0,o._)(e.split("_"),2),a=r[0],s=r[1],i=t[a],u=n[a],c="desc"===s?-1:1;return i&&u?i>u?c:i<u?-c:t.sortIndex<n.sortIndex?c:-c:0}}},10630:(e,t,n)=>{n.r(t),n.d(t,{gitSyncTool:()=>C,init:()=>R});var r,a,o=n(97004),s=n(39249),i=n(58617),u=n.n(i),c=n(46498),l=n(52166),h=n(24463),f=n(74335),d=n(19320),p=n(17419),g=n(82666),m=n(65492),v=n(66214),b=n(577),_=n(40662),w=n.n(_),y=n(67660),T=n(30832),A=n.n(T),E=n(5672),S=n(49967),L=function(e){function t(e,n,r){var a;return(0,m._)(this,t),(a=(0,g._)(this,t)).octoKit=null,a.busy=!1,a.owner="",a.repo="",a.branch="",a.throttle=10,a.token=null,a.progress=0,a.queueLength=0,a.addToQueue=r,a.getPreferredLocale=n,a.setOctokit(e||{}),a}(0,v._)(t,e);var n=t.prototype;return n.setOctokit=function(e){var t=e.use,n=e.owner,r=e.repo,a=e.branch,o=e.throttle,s=e.token;if(this.busy||!t||!n||!r||!a||!o||!s){this.octoKit=null,this.owner="",this.repo="",this.branch="",this.throttle=10,this.token=null;return}this.owner=n,this.repo=r,this.branch=a,this.throttle=Math.max(o,10)||10,this.token=s,this.octoKit=new y.E({auth:s})},n.progressStart=function(e){this.queueLength=e+7,this.emit("starting",{progress:0,queueLength:this.queueLength}),this.progressTick()},n.progressTick=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.progress=e?0:this.progress+1,this.emit("progress",{progress:this.progress,queueLength:this.queueLength}),e&&(this.queueLength=0)},n.getRepoContents=function(){var e=this;return(0,o._)(function(){var t,n,r,a,o,i,u;return(0,s.YH)(this,function(s){switch(s.label){case 0:return e.progressTick(),[4,e.addToQueue("repos.getBranch ".concat(e.branch),e.throttle,function(){var t;return null==(t=e.octoKit)?void 0:t.repos.getBranch({owner:e.owner,repo:e.repo,branch:e.branch})})];case 1:return t=s.sent().data.commit.sha,[4,e.addToQueue("git.getCommit ".concat(t),e.throttle,function(){var n;return null==(n=e.octoKit)?void 0:n.git.getCommit({owner:e.owner,repo:e.repo,commit_sha:t})})];case 2:return n=s.sent().data.tree.sha,[4,e.addToQueue("git.getTree ".concat(n),e.throttle,function(){var t;return null==(t=e.octoKit)?void 0:t.git.getTree({owner:e.owner,repo:e.repo,tree_sha:n,recursive:"1"})})];case 3:if(a=(r=s.sent().data.tree).find(function(e){return"settings.json"===e.path}),o=e.augmentFileList("images",r.filter(function(e){var t=e.path;return null==t?void 0:t.startsWith("images/")})),i=e.augmentFileList("frames",r.filter(function(e){var t=e.path;return null==t?void 0:t.startsWith("frames/")})),!(null==a?void 0:a.sha))return[3,5];return[4,e.getFileContent(a.sha,0,1)];case 4:return u=s.sent(),[3,6];case 5:u="{}",s.label=6;case 6:return[2,{images:o,frames:i,settings:JSON.parse(u)}]}})})()},n.augmentFileList=function(e,t){var n=this;return t.reduce(function(r,a,o){var s,i=a.path,u=a.sha;if(!i||!u)return r;var c=i.split("/").pop()||"";switch(e){case"images":case"frames":s=c.split(".")[0];break;default:s="-"}var l={path:i,name:c,hash:s,getFileContent:function(){return n.getFileContent(u,o,t.length)}};return(0,b._)(r).concat([l])},[])},n.getFileContent=function(e,t,n){var r=this;return(0,o._)(function(){return(0,s.YH)(this,function(a){switch(a.label){case 0:return r.progressTick(),[4,r.addToQueue("git.getBlob (".concat(t+1,"/").concat(n,") ").concat(e),r.throttle,function(){var t;return null==(t=r.octoKit)?void 0:t.git.getBlob({owner:r.owner,repo:r.repo,file_sha:e})})];case 1:var o;return[2,(o=a.sent().data.content,decodeURIComponent(Array.prototype.map.call(atob(o),function(e){return"%".concat("00".concat(e.charCodeAt(0).toString(16)).slice(-2))}).join("")))]}})})()},n.getCurrentCommit=function(){var e=this;return(0,o._)(function(){var t,n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return e.progressTick(),[4,e.addToQueue("git.getRef heads/".concat(e.branch),e.throttle,function(){var t;return null==(t=e.octoKit)?void 0:t.git.getRef({owner:e.owner,repo:e.repo,ref:"heads/".concat(e.branch)})})];case 1:return t=r.sent().data.object.sha,[4,e.addToQueue("git.getCommit ".concat(t),e.throttle,function(){var n;return null==(n=e.octoKit)?void 0:n.git.getCommit({owner:e.owner,repo:e.repo,commit_sha:t})})];case 2:return n=r.sent().data,[2,{commitSha:t,treeSha:n.tree.sha}]}})})()},n.createBlobForFile=function(e,t,n){var r=e.destination,a=e.blob,i=this;return(0,o._)(function(){var e,o,u;return(0,s.YH)(this,function(s){switch(s.label){case 0:return i.progressTick(),[4,(0,E.A)(a,E.Z.DATA_URL)];case 1:return o=(e=s.sent()).indexOf(";base64,")+8,u=e.slice(o),[4,i.addToQueue("git.createBlob (".concat(t+1,"/").concat(n,") ").concat(r),i.throttle,function(){var e;return null==(e=i.octoKit)?void 0:e.git.createBlob({owner:i.owner,repo:i.repo,content:u,encoding:"base64"})})];case 2:return[2,{filename:r,blobData:s.sent().data}]}})})()},n.createNewTree=function(e,t,n){var r=this;return(0,o._)(function(){var a,o;return(0,s.YH)(this,function(s){switch(s.label){case 0:return r.progressTick(),a=e.map(function(e){return{path:e.filename,mode:"100644",type:"blob",sha:e.blobData.sha}}),o=t.map(function(e){return{path:e.path,mode:"100644",sha:null}}),[4,r.addToQueue("git.createTree ".concat(n),r.throttle,function(){var e;return null==(e=r.octoKit)?void 0:e.git.createTree({owner:r.owner,repo:r.repo,tree:(0,b._)(a).concat((0,b._)(o)),base_tree:n})})];case 1:return[2,s.sent().data.sha]}})})()},n.createNewCommit=function(e,t,n){var r=this;return(0,o._)(function(){return(0,s.YH)(this,function(a){switch(a.label){case 0:return r.progressTick(),[4,r.addToQueue("git.createCommit ".concat(e),r.throttle,function(){var a;return null==(a=r.octoKit)?void 0:a.git.createCommit({owner:r.owner,repo:r.repo,message:e,tree:t,parents:[n]})})];case 1:return[2,a.sent().data.sha]}})})()},n.setBranchToCommit=function(e){var t=this;return(0,o._)(function(){return(0,s.YH)(this,function(n){switch(n.label){case 0:return t.progressTick(),[4,t.addToQueue("git.updateRef ".concat(e),t.throttle,function(){var n;return null==(n=t.octoKit)?void 0:n.git.updateRef({owner:t.owner,repo:t.repo,ref:"heads/".concat(t.branch),sha:e})})];case 1:return n.sent(),[2]}})})()},n.uploadToRepo=function(e){var t=e.upload,n=e.del,r=this;return(0,o._)(function(){var e,a,o,i,u,c,l,h;return(0,s.YH)(this,function(s){switch(s.label){case 0:if(!r.octoKit)throw Error("OctoClient not configured");return e="Sync. ".concat((0,S.A)(A()(),r.getPreferredLocale())),a=t.length,[4,r.getCurrentCommit()];case 1:return i=(o=s.sent()).treeSha,u=o.commitSha,[4,Promise.all(t.map(function(e,t){return r.createBlobForFile(e,t,a)}))];case 2:return c=s.sent(),[4,r.createNewTree(c,n,i)];case 3:return l=s.sent(),[4,r.createNewCommit(e,l,u)];case 4:return h=s.sent(),[4,r.setBranchToCommit(h)];case 5:return s.sent(),[2]}})})()},n.updateRemoteStore=function(e){var t=e.upload,n=e.del,r=this;return(0,o._)(function(){var e;return(0,s.YH)(this,function(a){switch(a.label){case 0:if(a.trys.push([0,2,,3]),r.busy)throw Error("currently busy");if(!t.length&&!n.length)return[2,{}];return r.progressStart(t.length),r.busy=!0,[4,r.uploadToRepo({upload:t,del:n})];case 1:return a.sent(),r.busy=!1,r.progressTick(!0),[2,{uploaded:t.map(function(e){return e.destination}),deleted:n.map(function(e){return e.path}),repo:"https://github.com/".concat(r.owner,"/").concat(r.repo,"/tree/").concat(r.branch)}];case 2:throw e=a.sent(),r.busy=!1,r.emit("error",e),e;case 3:return[2]}})})()},t}(w()),R=function(){var e=h.A.getState().gitStorage,t=c.A.getState().setProgressLog,n=new(u())(1,1/0);r=new L(e,function(){return l.A.getState().preferredLocale},(a=function(e){return function(r,a,i){return n.add((0,o._)(function(){return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,(0,f.c)(a)];case 1:return n.sent(),t("git",{timestamp:new Date().getTime()/1e3,message:"".concat(e," runs ").concat(r)}),[2,i()]}})}))}})("OctoClient"))},C=function(e){var t,n,i=c.A.getState(),u=i.setProgressLog,l=i.setSyncBusy,f=i.setSyncSelect,g=h.A.getState().syncLastUpdate,m=(t=(0,o._)(function(e){return(0,s.YH)(this,function(t){switch(t.label){case 0:return[4,r.setOctokit(e)];case 1:return t.sent(),[2]}})}),function(e){return t.apply(this,arguments)}),v=(n=(0,o._)(function(t){var n,o,i,h;return(0,s.YH)(this,function(s){switch(s.label){case 0:l(!0),f(!1),s.label=1;case 1:return s.trys.push([1,10,,11]),[4,r.getRepoContents()];case 2:switch(n=s.sent(),t){case"up":return[3,3];case"down":return[3,6]}return[3,8];case 3:return o=(null==g?void 0:g.local)||Math.floor(new Date().getTime()/1e3),[4,(0,d.A)(n,o,a("GBPrinter"))];case 4:return i=s.sent(),[4,r.updateRemoteStore(i)];case 5:return s.sent(),[3,9];case 6:return[4,(0,p.Ay)(n)];case 7:return e(s.sent()),[3,9];case 8:throw Error("github sync: wrong sync case");case 9:return u("git",{timestamp:new Date().getTime()/1e3,message:"."}),l(!1),[3,11];case 10:return console.error(h=s.sent()),c.A.getState().setError(h),[3,11];case 11:return[2]}})}),function(e){return n.apply(this,arguments)});return h.A.subscribe(function(e){return e.gitStorage},m),{startSyncData:v,updateSettings:m}}},12360:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(19864);let a=function(e){return function(t){var n=e.filter(function(e){return![r.X3.FILTER_MONOCHROME,r.X3.FILTER_NEW,r.X3.FILTER_RGB,r.X3.FILTER_UNTAGGED,r.X3.FILTER_RECENT,r.X3.FILTER_FAVOURITE,r.X3.FILTER_COMMENTS,r.X3.FILTER_USERNAME].includes(e)});return!n.length||!!t.tags.find(function(e){return n.includes(e)})}}},17419:(e,t,n)=>{n.d(t,{Ay:()=>g,L2:()=>d,_K:()=>f});var r=n(97004),a=n(693),o=n(60376),s=n(577),i=n(39249),u=n(53982),c=n(55364),l=n(99451),h=n(72623),f=function(){var e=(0,r._)(function(e){var t;return(0,i.YH)(this,function(n){return t=e.split("\n").filter(function(e){return e.match(/^[0-9a-f ]+$/gi)}),[2,(0,h.UN)(t)]})});return function(t){return e.apply(this,arguments)}}(),d=function(e){var t=Array(32).fill("f").join(""),n=Array(16).fill(t);return(0,s._)(e.upper).concat((0,s._)(Array(14).fill("").map(function(t,r){return(0,s._)(e.left[r]).concat((0,s._)(n),(0,s._)(e.right[r]))}).flat()),(0,s._)(e.lower))},p=function(){var e=(0,r._)(function(e){var t,n,r;return(0,i.YH)(this,function(a){return n=(t=JSON.parse(e)).upper.length/20,r=d(t),[2,(0,u.R_)(r,n)]})});return function(t){return e.apply(this,arguments)}}();let g=function(){var e=(0,r._)(function(e){var t,n,s,d,g,m,v,b,_;return(0,i.YH)(this,function(w){var y,T;switch(w.label){case 0:return t=e.images,n=e.frames,d=(s=e.settings).state.images||[],g=s.state.frames||[],[4,Promise.all(t.map((y=(0,r._)(function(e){var t,n;return(0,i.YH)(this,function(r){switch(r.label){case 0:return[4,(0,h.Hh)(e.hash,void 0,!0)];case 1:if(null==(t=r.sent())?void 0:t.length)return[2,void 0];return[4,e.getFileContent()];case 2:return[4,f(r.sent())];case 3:if(n=r.sent(),e.hash!==n)return[2,{oldHash:e.hash,newHash:n}];return[2,void 0]}})}),function(e){return y.apply(this,arguments)})))];case 1:return m=w.sent().reduce(l.N,[]),[4,Promise.all(n.map((T=(0,r._)(function(e){var t;return(0,i.YH)(this,function(n){switch(n.label){case 0:return[4,(0,u.mZ)(e.hash)];case 1:if(n.sent())return[2,void 0];return[4,e.getFileContent()];case 2:return[4,p(n.sent())];case 3:if(t=n.sent(),e.hash!==t)return[2,{oldHash:e.hash,newHash:t}];return[2,void 0]}})}),function(e){return T.apply(this,arguments)})))];case 2:return v=w.sent().reduce(l.N,[]),b=d.map(function(e){if((0,c.pl)(e)){var t=(0,a._)({},e.hashes),n=m.find(function(t){return t.oldHash===e.hashes.r}),r=m.find(function(t){return t.oldHash===e.hashes.g}),s=m.find(function(t){return t.oldHash===e.hashes.b}),i=m.find(function(t){return t.oldHash===e.hashes.n});return(null==n?void 0:n.newHash)&&(t.r=null==n?void 0:n.newHash),(null==r?void 0:r.newHash)&&(t.g=null==r?void 0:r.newHash),(null==s?void 0:s.newHash)&&(t.b=null==s?void 0:s.newHash),(null==i?void 0:i.newHash)&&(t.n=null==i?void 0:i.newHash),(0,o._)((0,a._)({},e),{hashes:t})}var u=m.find(function(t){return t.oldHash===e.hash});return(0,o._)((0,a._)({},e),{hash:(null==u?void 0:u.newHash)||e.hash})}),_=g.map(function(e){var t=v.find(function(t){return t.oldHash===e.hash});return t?(0,o._)((0,a._)({},e),{hash:t.newHash}):e}),[2,(0,o._)((0,a._)({},s),{state:(0,o._)((0,a._)({},s.state),{images:b,frames:_})})]}})});return function(t){return e.apply(this,arguments)}}()},19320:(e,t,n)=>{n.d(t,{A:()=>w});var r=n(97004),a=n(577),o=n(39249);let s=function(e,t,n,r){var o=e.images,s=e.frames,i=o.filter(function(e){var a=e.path;return!n.find(function(e){return a===e.destination})&&!t.find(function(e){return a===e.destination})&&!r.find(function(e){return a.indexOf(e)>=-1})}),u=s.filter(function(e){var r=e.path;return!n.find(function(e){return r===e.destination})&&!t.find(function(e){return r===e.destination})});return{upload:t.filter(function(e){var t=e.destination;return!o.find(function(e){return e.path===t})&&!s.find(function(e){return e.path===t})}),del:(0,a._)(i).concat((0,a._)(u))}};var i=n(69229),u=n(45854),c=function(e){switch(e){case"image/png":return"png";case"image/jpg":case"image/jpeg":return"jpg";case"image/webp":return"webp";case"text/plain":return"txt";case"text/markdown":return"md";case"application/json":case"text/json":return"json";default:return console.warn('unknown file extension for type "'.concat(e,'"')),"none"}};let l=function(){var e,t=(0,u.A)();return e=(0,r._)(function(e,n){var r,s,u,l,h;return(0,o.YH)(this,function(o){switch(o.label){case 0:return r=[],s=[],u={},e.forEach(function(e){var t,n,o=e.files,i=e.inRepo;(t=s).push.apply(t,(0,a._)(i.map(function(e){var t=e.path,n=t.split("/")[0];return u[n]=u[n]?u[n]+1:1,{destination:t}}))),(n=r).push.apply(n,(0,a._)(o.map(function(e){var t=e.blob,n=e.folder,r=e.filename,a=c(t.type),o=n||a;return u[o]=u[o]?u[o]+1:1,{destination:"".concat(o,"/").concat(r),blob:t}})))}),l=["## Files in this repo:"].concat((0,a._)(Object.keys(u).map(function(e){return" * ".concat(e,": [").concat(u[e],"](/").concat(e,")")}))).join("\n"),[4,t(i.m.JSON_EXPORT,{lastUpdateUTC:n})];case 1:return h=o.sent(),r.push({destination:"README.md",blob:new Blob((0,a._)(l),{type:"text/plain"})},{destination:"settings.json",blob:new Blob((0,a._)(h),{type:"application/json"})}),[2,{toUpload:r.filter(Boolean),toKeep:s.filter(Boolean)}]}})}),function(t,n){return e.apply(this,arguments)}};var h=n(693),f=n(60376),d=n(11760),p=n(53982),g=function(){var e=(0,r._)(function(e,t){var n,a,s;return(0,o.YH)(this,function(i){switch(i.label){case 0:return n=[],s=(a=d.h.getState().frames.map(function(t){return{file:t,searchHashes:[t.hash],inRepo:[e.frames.find(function(e){return e.hash===t.hash})].filter(Boolean)}})).length,[4,Promise.all(a.map(function(e,n){var a=e.file;return e.inRepo.length?(0,f._)((0,h._)({},a),{inRepo:e.inRepo,files:[]}):t("loadFrameData (".concat(n+1,"/").concat(s,") ").concat(a.id),3,(0,r._)(function(){var t;return(0,o.YH)(this,function(n){switch(n.label){case 0:return[4,(0,p.mZ)(a.hash)];case 1:return t=n.sent(),[2,(0,f._)((0,h._)({},a),{inRepo:e.inRepo,files:[{folder:"frames",filename:"".concat(a.hash,".json"),blob:new Blob(Array(JSON.stringify(t||"{}",null,2)),{type:"application/json"}),title:a.name}]})]}})}))}))];case 1:return[2,{syncFrames:i.sent().filter(Boolean),missingLocally:n}]}})});return function(t,n){return e.apply(this,arguments)}}(),m=n(2608),v=n(55364),b=n(55685),_=function(){var e=(0,r._)(function(e,t){var n,s,i;return(0,o.YH)(this,function(u){switch(u.label){case 0:var c;return n=[],i=(s=d.h.getState().images.map(function(t){var n=(0,v.pl)(t)?(0,b.A)(Object.values(t.hashes)).filter(Boolean):[t.hash];return{file:t,searchHashes:n,inRepo:e.images.reduce(function(e,t){return n.includes(t.hash)?(0,a._)(e).concat([t]):e},[])}})).length,[4,Promise.all(s.map((c=(0,r._)(function(e,n){return(0,o.YH)(this,function(a){return e.inRepo.length===e.searchHashes.length?[2,{hash:e.file.hash,inRepo:e.inRepo,files:[]}]:[2,t("loadImageTiles (".concat(n+1,"/").concat(i,") ").concat(e.file.title),3,(0,r._)(function(){var t,n,r;return(0,o.YH)(this,function(a){switch(a.label){case 0:if(!(0,v.pl)(e.file))return[3,2];return[4,Promise.all(Object.values((n=e.file).hashes).map(function(e){return(0,m.Z)(e,n.title,e)}))];case 1:return t=a.sent(),[3,4];case 2:return r=e.file,[4,(0,m.Z)(r.hash,r.title,r.hash)];case 3:t=[a.sent()],a.label=4;case 4:return[2,{hash:e.file.hash,files:t,inRepo:e.inRepo}]}})}))]})}),function(e,t){return c.apply(this,arguments)})))];case 1:return[2,{syncImages:u.sent().filter(Boolean),missingLocally:n}]}})});return function(t,n){return e.apply(this,arguments)}}();let w=function(){var e=(0,r._)(function(e,t,n){var r,i,u,c,h,f,d,p,m,v,b,w;return(0,o.YH)(this,function(o){switch(o.label){case 0:return u=l(),c=[],[4,_(e,n)];case 1:return f=(h=o.sent()).syncImages,d=h.missingLocally,(r=c).push.apply(r,(0,a._)(d)),[4,g(e,n)];case 2:return m=(p=o.sent()).syncFrames,v=p.missingLocally,(i=c).push.apply(i,(0,a._)(v)),b=(0,a._)(f).concat((0,a._)(m)),[4,u(b,t)];case 3:return[2,s(e,(w=o.sent()).toUpload,w.toKeep,c)]}})});return function(t,n,r){return e.apply(this,arguments)}}()},27803:(e,t,n)=>{n.d(t,{V:()=>r});var r=function(e){return e.DEFAULT_ASC="default_asc",e.DEFAULT_DESC="default_desc",e.USAGE_ASC="usage_asc",e.USAGE_DESC="usage_desc",e.NAME_ASC="name_asc",e.NAME_DESC="name_desc",e}({})},39630:(e,t,n)=>{n.d(t,{V:()=>r});var r=function(e){return e.CHECKBOX="checkbox",e.SELECT="select",e.TEXT="text",e.NUMBER="number",e.INFO="info",e.IMAGE="image",e.META="meta",e}({})},39893:(e,t,n)=>{n.d(t,{C:()=>a,f:()=>r});var r=function(e){return e.WIDER="wider",e.WIDE="wide",e.NORMAL="normal",e.NARROW="narrow",e.NARROWER="narrower",e.EMULATOR="emulator",e}({}),a=[{name:"Wider",baseValues:[0,68,187,255],value:"wider"},{name:"Wide",baseValues:[0,85,170,255],value:"wide"},{name:"Normal",baseValues:[51,102,153,204],value:"normal"},{name:"Narrow",baseValues:[69,115,162,208],value:"narrow"},{name:"Narrower",baseValues:[85,113,141,170],value:"narrower"},{name:"From Emulator",baseValues:[64,144,224,255],value:"emulator"}]},49432:(e,t,n)=>{n.d(t,{A:()=>r});let r=function(e,t){if(!e.trim())return"";if("/"===e&&"ws"!==t)return e;var n=!!e.match(RegExp("^".concat(t,"(s)?:\\/\\/"),"gi"));return"".concat(n?"":"".concat(t,"://")).concat(e).concat(e.endsWith("/")?"":"/")}},49967:(e,t,n)=>{n.d(t,{A:()=>a});var r={weekday:void 0,year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"};let a=function(e,t){return e.toDate().toLocaleString(t,r)}},52166:(e,t,n)=>{n.d(t,{A:()=>w});var r=n(693),a=n(78538),o=n(30832),s=n.n(o),i=n(15905),u=n(65453),c=n(46786),l=n(39893),h=n(81445),f=n(80498),d=n(4862),p=n(27803),g=n(99999),m=n(49432),v=n(49967),b=n(10746),_=function(){if("undefined"!=typeof navigator){var e=(0,a._)(navigator.language.split("-"),2);return[e[0],e[1]].filter(Boolean).join("-")}return""};let w=(0,u.v)((0,c.Zr)(function(e){return{activePalette:"bw",bitmapQueueDither:!0,bitmapQueueSetting:l.f.WIDE,enableDebug:!1,exportFileTypes:["png"],exportScaleFactors:[4],fileNameStyle:h.B.FULL,forceMagicCheck:!0,galleryView:d.j.GALLERY_VIEW_1X,galleryClickAction:f.n.SELECT,handleExportFrame:i.H.FRAMEMODE_KEEP,hideDates:!1,importDeleted:!0,importLastSeen:!0,importPad:!1,pageSize:30,preferredLocale:_(),printerParams:"",printerUrl:"/",savFrameTypes:"int",themeName:g.V.BRIGHT,enableImageGroups:!1,sortPalettes:p.V.DEFAULT_DESC,useSerials:!1,videoParams:{},setActivePalette:function(t){return e({activePalette:t})},setBitmapQueueDither:function(t){return e({bitmapQueueDither:t})},setBitmapQueueSetting:function(t){return e({bitmapQueueSetting:t})},setEnableDebug:function(t){return e({enableDebug:t})},setFileNameStyle:function(t){return e({fileNameStyle:t})},setForceMagicCheck:function(t){return e({forceMagicCheck:t})},setGalleryView:function(t){return e({galleryView:t})},setGalleryClickAction:function(t){return e({galleryClickAction:t})},setHandleExportFrame:function(t){return e({handleExportFrame:t})},setHideDates:function(t){return e({hideDates:t})},setImportDeleted:function(t){return e({importDeleted:t})},setImportLastSeen:function(t){return e({importLastSeen:t})},setImportPad:function(t){return e({importPad:t})},setPageSize:function(t){return e({pageSize:t})},setPrinterParams:function(t){return e({printerParams:t})},setPrinterUrl:function(t){return e({printerUrl:(0,m.A)(t,"http")})},setSavFrameTypes:function(t){return e({savFrameTypes:t})},setThemeName:function(t){return e({themeName:t})},setEnableImageGroups:function(t){return e({enableImageGroups:t})},setSortPalettes:function(t){return e({sortPalettes:t})},setUseSerials:function(t){return e({useSerials:t})},setVideoParams:function(t){return e(function(e){return{videoParams:(0,r._)({},e.videoParams,t)}})},setExportScaleFactors:function(t){return e({exportScaleFactors:t})},setExportFileTypes:function(t){return e({exportFileTypes:t})},setPreferredLocale:function(t){try{(0,v.A)(s()(),t),e({preferredLocale:t})}catch(e){console.error(e)}}}},{name:"".concat(b.z,"-settings"),storage:(0,c.KU)(function(){return localStorage})}))},66785:(e,t,n)=>{n.d(t,{S:()=>i});var r=n(577),a=n(6456),o=n(77840),s=n(12360),i=function(e,t){var n=t.filtersActiveTags,i=t.sortBy,u=t.recentImports;return(0,r._)(e).map(a.YZ).sort((0,a.PM)(i)).map(a.lt).filter((0,o.A)(n,u)).filter((0,s.A)(n))}},74335:(e,t,n)=>{n.d(t,{c:()=>o});var r=n(97004),a=n(39249),o=function(){var e=(0,r._)(function(e){return(0,a.YH)(this,function(t){return[2,new Promise(function(t){window.setTimeout(t,e)})]})});return function(t){return e.apply(this,arguments)}}()},77840:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(577),a=n(30832),o=n.n(a),s=n(5432),i=n(19864),u=n(55364);let c=function(e,t){return function(n){var a,c,l=e.reduce(function(e,t){return[i.X3.FILTER_MONOCHROME,i.X3.FILTER_NEW,i.X3.FILTER_RGB,i.X3.FILTER_UNTAGGED,i.X3.FILTER_RECENT,i.X3.FILTER_FAVOURITE,i.X3.FILTER_COMMENTS,i.X3.FILTER_USERNAME].includes(t)?(0,r._)(e).concat([t]):e},[]);if(l.length&&(l.includes(i.X3.FILTER_UNTAGGED)&&0!==n.tags.length||l.includes(i.X3.FILTER_NEW)&&o()(n.created,s.i$).unix()<=o()().subtract(1,"day").unix()||l.includes(i.X3.FILTER_RECENT)&&!t.map(function(e){return e.hash}).includes(n.hash)||l.includes(i.X3.FILTER_RGB)&&!(0,u.pl)(n)||l.includes(i.X3.FILTER_MONOCHROME)&&(0,u.pl)(n)||l.includes(i.X3.FILTER_FAVOURITE)&&!n.tags.includes(i.X3.FILTER_FAVOURITE)||l.includes(i.X3.FILTER_COMMENTS)&&!(null==(a=n.meta)?void 0:a.comment)||l.includes(i.X3.FILTER_USERNAME)&&!(null==(c=n.meta)?void 0:c.userName)))return!1;return!0}}},80498:(e,t,n)=>{n.d(t,{n:()=>r,s:()=>a});var r=function(e){return e.SELECT="select",e.EDIT="edit",e.VIEW="view",e}({}),a=[{label:"Click selects the item",value:"select"},{label:"Click opens edit dialog",value:"edit"},{label:"Click opens the item in lightbox",value:"view"}]},93782:(e,t,n)=>{n.d(t,{A:()=>r});let r=function(e){return e.replace(/[^a-z0-9/\\._-]/gi,"").replace(/[\\/]+/gi,"/").replace(/^\//,"").replace(/\/$/,"")}},94979:(e,t,n)=>{n.r(t),n.d(t,{dropBoxSyncTool:()=>V});var r=n(97004),a=n(693),o=n(60376),s=n(577),i=n(39249),u=n(30832),c=n.n(u),l=n(58617),h=n.n(l),f=n(39630),d=n(41186),p=n(71620),g=n(46498),m=n(11760),v=n(52166),b=n(24463),_=n(49967),w=n(74335),y=n(5415),T=n(66785),A=n(19320),E=n(5847);let S=function(){var e=new URLSearchParams(window.location.search).get("code");return e?(window.history.replaceState({},"",window.location.pathname),{dropboxCode:e}):{}};var L=n(31533),R=n(17419),C=n(53982),x=n(82666),H=n(65492),F=n(66214),I=n(78538),D=n(40662),k=n(87422),P=n(93782),U=n(5672),Y=encodeURIComponent("".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname)),N=function(e){function t(e,n){(0,H._)(this,t),(r=(0,x._)(this,t)).queueCallback=n,r.throttle=30,r.rootPath=[];var r,a,o=e.accessToken,s=e.expiresAt,i=e.refreshToken,u=e.path,c=e.autoDropboxSync;r.setRootPath(u),r.dbx=new k.Dropbox({clientId:"err6neqzlljod7b",accessToken:o,accessTokenExpiresAt:new Date(s||0),refreshToken:i});var l=null==(a=r.dbx)?void 0:a.auth;if(!l)throw Error("dbx auth error");return r.auth=l,c&&r.startLongPollSettings(),r}(0,F._)(t,e);var n=t.prototype;return n.addToQueue=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=this;return(0,r._)(function(){return(0,i.YH)(this,function(e){if(!a.auth.getAccessToken())throw Error("not logged in");return[2,a.queueCallback.apply(a,(0,s._)(t))]})})()},n.setRootPath=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.rootPath=(0,P.A)(e).split("/")},n.toPath=function(e){var t=(0,s._)(this.rootPath).concat((0,s._)(e.split("/"))).filter(Boolean);return"/".concat(t.join("/"))},n.inSettingsPath=function(e){var t=this.toPath("settings");return(0,P.A)(e.replace(t,""))},n.checkLoginStatus=function(){var e=this;return(0,r._)(function(){var t,n,r,a;return(0,i.YH)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e.auth.checkAndRefreshAccessToken()];case 1:return o.sent(),t=e.auth.getAccessToken(),r=(n=e.auth.getAccessTokenExpiresAt().getTime())-new Date().getTime(),e.emit("loginDataUpdate",{accessToken:t,expiresAt:n}),[2,!!t&&r>1e3];case 2:throw a=o.sent(),e.auth.setAccessTokenExpiresAt(new Date(0)),e.auth.setAccessToken(""),a;case 3:return[2]}})})()},n.startAuth=function(){var e=this;return(0,r._)(function(){var t;return(0,i.YH)(this,function(n){switch(n.label){case 0:return[4,e.auth.getAuthenticationUrl(Y,void 0,"code","offline",void 0,void 0,!0)];case 1:return t=n.sent(),window.sessionStorage.setItem("dropboxCodeVerifier",e.auth.getCodeVerifier()),window.location.replace(t),[2]}})})()},n.codeAuth=function(e){var t=this;return(0,r._)(function(){var n,r,a,o,s,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(!(n=window.sessionStorage.getItem("dropboxCodeVerifier")))throw Error("no codeVerifier");return t.auth.setCodeVerifier(n),window.sessionStorage.removeItem("dropboxCodeVerifier"),[4,t.auth.getAccessTokenFromCode(Y,e)];case 1:return a=(r=i.sent().result).refresh_token,o=r.access_token,s=r.expires_in,u=new Date().getTime()+1e3*s,t.auth.setAccessToken(o),t.auth.setAccessTokenExpiresAt(new Date(u)),t.emit("loginDataUpdate",{refreshToken:a,accessToken:o,expiresAt:u}),[2]}})})()},n.getRemoteContents=function(e){var t=this;return(0,r._)(function(){var n,a,o,s,u,c,l;return(0,i.YH)(this,function(h){switch(h.label){case 0:return n=["images","frames"],a="diff"===e,[4,t.checkLoginStatus()];case 1:if(!h.sent())throw Error("not logged in");h.label=2;case 2:return h.trys.push([2,5,,6]),[4,t.addToQueue("dbx.filesDownload /settings.json",t.throttle,function(){return t.dbx.filesDownload({path:t.toPath("/settings/settings.json")})},a)];case 3:return s=h.sent().result,[4,(0,U.A)(s.fileBlob,U.Z.TEXT)];case 4:return o=JSON.parse(h.sent()),[3,6];case 5:return h.sent(),o={state:{lastUpdateUTC:0,version:m.A}},[3,6];case 6:var f;return[4,Promise.all(n.map((f=(0,r._)(function(e){var n,r,o,s,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:o="",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.addToQueue("dbx.filesListFolder /".concat(e),t.throttle,function(){return t.dbx.filesListFolder({path:t.toPath("/settings/".concat(e)),limit:250,recursive:!0})},a)];case 2:return n=(s=i.sent()).result.entries,r=s.result.has_more,o=s.result.cursor,[3,4];case 3:return i.sent(),n=[],r=!1,[3,4];case 4:if(!r)return[3,6];return u=n.concat,[4,t.getMoreContents(o,a)];case 5:n=u.apply(n,[i.sent()]),i.label=6;case 6:return[2,n.filter(function(e){return"file"===e[".tag"]})]}})}),function(e){return f.apply(this,arguments)})))];case 7:return c=(u=I._.apply(void 0,[h.sent(),2]))[0],l=u[1],[2,{images:t.augmentFileList("images",c,a),frames:t.augmentFileList("frames",l,a),settings:o}]}})})()},n.getImageContents=function(){var e=this;return(0,r._)(function(){var t,n,r,a,o;return(0,i.YH)(this,function(i){switch(i.label){case 0:r="",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.addToQueue("dbx.filesListFolder /images",e.throttle,function(){return e.dbx.filesListFolder({path:e.toPath("/images"),limit:250,recursive:!0})})];case 2:return t=(a=i.sent()).result.entries,n=a.result.has_more,r=a.result.cursor,[3,4];case 3:return i.sent(),t=[],n=!1,[3,4];case 4:if(!n)return[3,6];return o=t.concat,[4,e.getMoreContents(r)];case 5:t=o.apply(t,[i.sent()]),i.label=6;case 6:return[2,t.reduce(function(e,t){return"file"===t[".tag"]?(0,s._)(e).concat([t]):e},[])]}})})()},n.getMoreContents=function(e,t){var n=this;return(0,r._)(function(){var r,a,o,s,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:o="",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.addToQueue("dbx.filesListFolderContinue ".concat(e),n.throttle,function(){return n.dbx.filesListFolderContinue({cursor:e})},t)];case 2:return r=(s=i.sent()).result.entries,a=s.result.has_more,o=s.result.cursor,[3,4];case 3:return i.sent(),r=[],a=!1,[3,4];case 4:if(!a)return[3,6];return u=r.concat,[4,n.getMoreContents(o,t)];case 5:r=u.apply(r,[i.sent()]),i.label=6;case 6:return[2,r]}})})()},n.augmentFileList=function(e,t,n){var r=this;return t.map(function(a,o){var s,i=a.path_lower,u=a.content_hash,c=a.name,l=i?r.inSettingsPath(i):"";switch(e){case"images":case"frames":s=c.split(".")[0];break;default:s="-"}return{path:l,name:c,contentHash:u||"",hash:s,getFileContent:function(){return r.getFileContent(l,o,t.length,n)}}})},n.getFileContent=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this;return(0,r._)(function(){var r,s;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r="dbx.filesDownload (".concat(t+1,"/").concat(n,") ").concat(e),[4,o.addToQueue(r,o.throttle,function(){return o.dbx.filesDownload({path:o.toPath("/settings/".concat(e))})},a)];case 1:return s=i.sent().result,[2,(0,U.A)(s.fileBlob,U.Z.TEXT)]}})})()},n.upload=function(e,t){var n=this;return(0,r._)(function(){var a,o,s,u,c,l;return(0,i.YH)(this,function(h){var f,d;switch(h.label){case 0:return a=e.upload,o=e.del,[4,Promise.all(a.map((f=(0,r._)(function(e,r){return(0,i.YH)(this,function(o){switch(o.label){case 0:return[4,n.addToQueue("dbx.filesUpload (".concat(r+1,"/").concat(a.length,") ").concat(e.destination),n.throttle,function(){return n.dbx.filesUpload({path:n.toPath("/".concat(t,"/").concat(e.destination)),contents:e.blob,mode:{".tag":"overwrite"}})})];case 1:return[2,o.sent().result]}})}),function(e,t){return f.apply(this,arguments)})))];case 1:if(s=h.sent(),!o.length)return[2,{uploaded:s,deleted:[]}];return[4,n.addToQueue("dbx.filesDeleteBatch ".concat(o.length," files"),n.throttle,function(){return n.dbx.filesDeleteBatch({entries:o.map(function(e){var t=e.path;return{path:n.toPath("/settings/".concat(t))}})})})];case 2:return u=h.sent().result.async_job_id,d=(0,r._)(function(){var e,t,r;return(0,i.YH)(this,function(a){switch(a.label){case 0:return[4,n.addToQueue("dbx.filesDeleteBatchCheck ".concat(u),2e3,function(){return n.dbx.filesDeleteBatchCheck({async_job_id:u})})];case 1:if(t=(e=a.sent().result)[".tag"],r=e.entries,"in_progress"===t)return[2,c()];return[2,r.map(function(e){return e.metadata})]}})}),[4,(c=function(){return d.apply(this,arguments)})()];case 3:return l=h.sent(),[2,{uploaded:s,deleted:l}]}})})()},n.startLongPollSettings=function(){var e=this;console.info("Start dropbox longpolling"),this.dbx.filesListFolderGetLatestCursor({path:this.toPath("/settings"),recursive:!1,include_media_info:!1,include_deleted:!1,include_has_explicit_shared_members:!1}).then(function(t){var n=t.result.cursor,r=function(){return e.dbx.filesListFolderLongpoll({cursor:n,timeout:480})};return r().then(function(t){var n=t.result.changes;return(console.info("Longpoll info. Changes: ",n),n)?(e.emit("settingsChanged"),e.addToQueue("Restart longpolling",e.throttle,function(){return e.startLongPollSettings(),Promise.resolve(null)},!0)):r()})}).catch(function(e){g.A.getState().setError(e)})},t}(D.EventEmitter),B=n(3899),O=n.n(B);function M(){return(M=(0,r._)(function(e){var t,n,a;return(0,i.YH)(this,function(o){switch(o.label){case 0:var u;return[4,Promise.all(O()(new Uint8Array(e),4194304).map((u=(0,r._)(function(e){var t;return(0,i.YH)(this,function(n){switch(n.label){case 0:return t=Uint8Array.bind,[4,crypto.subtle.digest("SHA-256",new Uint8Array(e))];case 1:return[2,s._.apply(void 0,[new(t.apply(Uint8Array,[void 0,n.sent()]))])]}})}),function(e){return u.apply(this,arguments)})))];case 1:return t=new Uint8Array(o.sent().flat()),a=Uint8Array.bind,[4,crypto.subtle.digest("SHA-256",t)];case 2:return n=new(a.apply(Uint8Array,[void 0,o.sent()])),[2,(0,s._)(n).map(function(e){return e.toString(16).padStart(2,"0")}).join("")]}})})).apply(this,arguments)}var X=[],V=function(e,t){var n,u,l,x,H=g.A.getState(),F=H.setProgressLog,I=H.resetProgressLog,D=H.setSyncBusy,k=H.setSyncSelect,P=d.A.getState(),U=P.dismissDialog,Y=P.setDialog,B=new(h())(1,1/0),O=function(e){return function(t,n,a,o){return B.add((0,r._)(function(){return(0,i.YH)(this,function(r){switch(r.label){case 0:return[4,(0,w.c)(n)];case 1:return r.sent(),o||F("dropbox",{timestamp:new Date().getTime()/1e3,message:"".concat(e," runs ").concat(t)}),[2,a()]}})}))}},V=new N(b.A.getState().dropboxStorage,O("Dropbox")),j=(n=(0,r._)(function(e){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,V.setRootPath(e.path||"/")];case 1:return t.sent(),[2]}})}),function(e){return n.apply(this,arguments)}),G=(u=(0,r._)(function(e){var n,a,o,s,u,l,h,d,p,g,m,w;return(0,i.YH)(this,function(y){switch(y.label){case 0:return D(!0),k(!1),n=v.A.getState().preferredLocale,a=b.A.getState().syncLastUpdate,[4,V.getRemoteContents(e)];case 1:switch(o=y.sent(),e){case"diff":return[3,2];case"up":return[3,3];case"down":return[3,6]}return[3,8];case 2:if((null==o||null==(u=o.settings)||null==(s=u.state)?void 0:s.lastUpdateUTC)===null)return[3,9];return h=(null==(l=o.settings.state)?void 0:l.lastUpdateUTC)===void 0?Date.now()/1e3:o.settings.state.lastUpdateUTC,b.A.getState().setSyncLastUpdate("dropbox",h),h>(null==a?void 0:a.local)&&Y({message:"There is newer content in your dropbox!",questions:function(){return["Your dropbox contains changes from ".concat((0,_.A)(c()(1e3*h),n)),"Your last local update was ".concat((null==a?void 0:a.local)?(0,_.A)(c()(1e3*a.local),n):"never","."),"Do you want to load the changes?"].map(function(e,t){return{label:e,key:"info".concat(t),type:f.V.INFO}})},confirm:(0,r._)(function(){return(0,i.YH)(this,function(e){return U(0),G("down"),[2]})}),deny:(0,r._)(function(){return(0,i.YH)(this,function(e){return[2,U(0)]})})}),[3,9];case 3:return d=(null==a?void 0:a.local)||Math.floor(new Date().getTime()/1e3),[4,(0,A.A)(o,d,O("GBPrinter"))];case 4:return p=y.sent(),[4,V.upload(p,"settings")];case 5:return y.sent(),b.A.getState().setSyncLastUpdate("dropbox",d),[3,9];case 6:return[4,(0,R.Ay)(o)];case 7:return t(y.sent()),(w=(null==(m=o.settings)||null==(g=m.state)?void 0:g.lastUpdateUTC)||0)&&b.A.getState().setSyncLastUpdate("dropbox",w),[3,9];case 8:throw Error("dropbox sync: wrong sync case");case 9:return"diff"!==e?F("dropbox",{timestamp:new Date().getTime()/1e3,message:"."}):I(),D(!1),[2]}})}),function(e){return u.apply(this,arguments)}),Q=(l=(0,r._)(function(){var e,t,n,u,c,l,h,f,d,g,b,_,w,A,S,R,x;return(0,i.YH)(this,function(H){var I,P;switch(H.label){case 0:return D(!0),k(!1),t=(e=m.h.getState()).frames,n=e.palettes,u=e.images,l=(c=v.A.getState()).exportScaleFactors,h=c.exportFileTypes,f=c.handleExportFrame,d=c.fileNameStyle,g=p.A.getState(),b=(0,T.S)(u,g),_=(0,y.j)(l,h,f,n,d),w=(0,E.T)(u,t),[4,Promise.all(b.map((I=(0,r._)(function(e,n){return(0,i.YH)(this,function(a){return[2,O("Generate images and hashes")("".concat(n+1,"/").concat(b.length),10,(0,r._)(function(){var n,a,o,s,u;return(0,i.YH)(this,function(c){switch(c.label){case 0:return[4,w(e.hash)];case 1:if(n=c.sent(),!(a=t.find(function(t){return t.id===e.frame})))return[3,3];return[4,(0,C.mZ)(null==a?void 0:a.hash)];case 2:return s=c.sent(),[3,4];case 3:s=null,c.label=4;case 4:if(u=(o=s)?o.upper.length/20:2,!n)throw Error("tiles missing");return[4,_(e)(n,u)];case 5:var l;return[4,Promise.all(c.sent().map((l=(0,r._)(function(e){var t;return(0,i.YH)(this,function(n){switch(n.label){case 0:return t={filename:e.filename},[4,e.blob.arrayBuffer()];case 1:return[2,(t.arrayBuffer=n.sent(),t)]}})}),function(e){return l.apply(this,arguments)})))];case 6:return[2,c.sent()]}})}))]})}),function(e,t){return I.apply(this,arguments)})))];case 1:return A=H.sent().flat(),[4,Promise.all((0,L.A)(A).map((P=(0,r._)(function(e){var t,n;return(0,i.YH)(this,function(r){switch(r.label){case 0:return t=[(0,a._)({},e)],n={},[4,function(e){return M.apply(this,arguments)}(e.arrayBuffer)];case 1:return[2,o._.apply(void 0,t.concat([(n.dropboxContentHash=r.sent(),n)]))]}})}),function(e){return P.apply(this,arguments)})))];case 2:return S=H.sent(),[4,V.getImageContents()];case 3:return R=H.sent(),x=S.reduce(function(e,t){var n=t.arrayBuffer,r=t.dropboxContentHash,a=t.filename;return -1===R.findIndex(function(e){var t=e.content_hash,n=e.name;return t===r&&n===a})?(0,s._)(e).concat([{blob:new Blob([n]),destination:a}]):e},[]),[4,V.upload({upload:x,del:[]},"images")];case 4:return H.sent(),F("dropbox",{timestamp:new Date().getTime()/1e3,message:"."}),D(!1),[2]}})}),function(){return l.apply(this,arguments)}),K=(x=(0,r._)(function(t){var n,r;return(0,i.YH)(this,function(a){switch(a.label){case 0:if(n=e.updateImages,X.includes(t))return[3,3];return X.push(t),[4,V.getFileContent("images/".concat(t,".txt"),0,1,!0)];case 1:return r=a.sent(),[4,(0,R._K)(r)];case 2:a.sent(),n([]),a.label=3;case 3:return[2]}})}),function(e){return x.apply(this,arguments)}),W=function(){G("diff")};b.A.getState().dropboxStorage.autoDropboxSync&&(W(),V.on("settingsChanged",function(){W()})),V.on("loginDataUpdate",function(e){(0,b.A.getState().setDropboxStorage)(e)});var Z=S().dropboxCode;return Z&&V.codeAuth(Z),b.A.subscribe(function(e){return e.dropboxStorage},j),{updateSettings:j,startSyncData:G,startSyncImages:Q,startAuth:function(){return V.startAuth()},recoverImageData:K}}},99451:(e,t,n)=>{n.d(t,{N:()=>a});var r=n(577),a=function(e,t){return t?(0,r._)(e).concat([t]):e}},99999:(e,t,n)=>{n.d(t,{V:()=>r});var r=function(e){return e.BRIGHT="theme-bright",e.DARK="theme-dark",e}({})}}]);