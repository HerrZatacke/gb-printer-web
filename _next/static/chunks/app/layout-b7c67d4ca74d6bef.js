(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{933:(t,e,n)=>{"use strict";n.d(e,{E:()=>u});var r,i=n(97004),a=n(39249),s=n(24463),u=function(t,e){var u,o,c,l,f=(u=(0,i._)(function(){var i;return(0,a.YH)(this,function(a){switch(a.label){case 0:if(r)return[3,2];return[4,Promise.all([n.e(9268),n.e(5678),n.e(1753),n.e(1575)]).then(n.bind(n,94979))];case 1:i=a.sent().dropBoxSyncTool,r=r||i(t,e),a.label=2;case 2:return[2,r]}})}),function(){return u.apply(this,arguments)});return s.A.getState().dropboxStorage.use&&f(),{recoverImageData:(o=(0,i._)(function(t){return(0,a.YH)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return[2,e.sent().recoverImageData(t)]}})}),function(t){return o.apply(this,arguments)}),startAuth:(0,i._)(function(){return(0,a.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().startAuth()]}})}),startSyncData:(c=(0,i._)(function(t){return(0,a.YH)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return[2,e.sent().startSyncData(t)]}})}),function(t){return c.apply(this,arguments)}),startSyncImages:(0,i._)(function(){return(0,a.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().startSyncImages()]}})}),updateSettings:(l=(0,i._)(function(t){return(0,a.YH)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return[2,e.sent().updateSettings(t)]}})}),function(t){return l.apply(this,arguments)}),subscribe:function(){var t;return s.A.subscribe(function(t){return t.dropboxStorage},(t=(0,i._)(function(t){return(0,a.YH)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return e.sent().updateSettings(t),[2]}})}),function(e){return t.apply(this,arguments)}))}}}},1441:(t,e,n)=>{"use strict";n.d(e,{default:()=>g});var r,i,a=n(97004),s=n(577),u=n(39249),o=n(95155),c=n(12115),l=n(45686),f=n(64768),h=n(41186),d=n(46498),m=n(52166),p=n(30891);let g=function(t){var e=t.children,g=d.A.getState(),v=g.setProgress,b=g.setPrinterFunctions,w=g.setPrinterBusy,P=g.setPrinterData,y=h.A.getState(),_=y.dismissDialog,E=y.setDialog,A=(0,f.A)().handleFileImport;(0,c.useEffect)(function(){var t=function(t){var e,n=m.A.getState().printerUrl;try{e=new URL(n).origin}catch(t){e=new URL(window.location.href).origin}if(t.origin===e){var o=t.data.fromRemotePrinter,c=void 0===o?{}:o,l=c.lines,f=c.progress,h=c.blob,p=c.blobsdone,g=c.commands,y=c.printerData,I=t.source;if(g&&(r&&JSON.stringify(g)===JSON.stringify(d.A.getState().printerFunctions)||(b(g),w(!1),P(null)),i=I,window.clearTimeout(r),r=window.setTimeout(function(){r=null,i=null,w(!0),P(null),b([])},1500)),l&&A([new File([l.join("\n")],"Text input.txt",{type:"text/plain"})]),void 0!==f&&v("printer",f),h&&A([new File([h],"blob.unknown")]),p){if("string"==typeof p[0])return void window.setTimeout(function(){alert("You should update the web-app to a version > 1.16.0 on your printer for an optimized import experience :-)")},200);var S=p.reduce(function(t,e){if(!e.blob||!e.ok)return t;var n=p.length>1?(t.length+1).toString(10).padStart(2,"0"):"";return(0,s._)(t).concat([new File([e.blob],"Printer ".concat(n).trim(),{type:e.contentType})])},[]);S.length?A(S,{fromPrinter:!0}):E({message:"No valid files received from WiFi-Printer",confirm:(0,a._)(function(){return(0,u.YH)(this,function(t){return _(0),w(!1),P(null),[2]})})})}y&&(P(y),w(!1))}};return window.addEventListener("message",t),function(){return window.removeEventListener("message",t)}},[_,A,E,w,P,b,v]);var I=(0,c.useMemo)(function(){var t;return{callRemoteFunction:(t=(0,a._)(function(t){var e,r;return(0,u.YH)(this,function(a){switch(a.label){case 0:return e=d.A.getState().printerData,w(!0),t===l.n.FETCHIMAGES&&e&&(r={dumps:null==e?void 0:e.dumps}),[4,Promise.resolve().then(n.t.bind(n,52491,23))];case 1:return a.sent(),[4,Promise.resolve().then(n.t.bind(n,98933,23))];case 2:if(a.sent(),!i)throw Error("remote printer window object is missing");return i.postMessage({toRemotePrinter:{command:t,params:r}},"*"),[2]}})}),function(e){return t.apply(this,arguments)})}},[w]);return(0,o.jsx)(p.G.Provider,{value:I,children:e})}},1607:(t,e,n)=>{"use strict";n.d(e,{D:()=>o,EnvProvider:()=>c}),n(97004),n(693),n(60376);var r=n(78538),i=(n(39249),n(95155)),a=n(12115),s=n(52166),u=(n(75380),(0,a.createContext)(null)),o=function(){return(0,a.useContext)(u)},c=function(t){var e=t.children,n=(0,r._)((0,a.useState)(null),2),o=n[0],c=(n[1],(0,s.A)().setPrinterUrl);return(0,a.useEffect)(function(){},[c]),(0,i.jsx)(u.Provider,{value:o,children:e})}},6617:(t,e,n)=>{"use strict";n.d(e,{h:()=>u,i:()=>s});var r=n(97004),i=n(39249),a=n(12115),s=(0,a.createContext)({runWithImage:(0,r._)(function(){return(0,i.YH)(this,function(t){throw Error("Plugin Context is missing")})}),runWithImages:(0,r._)(function(){return(0,i.YH)(this,function(t){throw Error("Plugin Context is missing")})}),validateAndAddPlugin:(0,r._)(function(){return(0,i.YH)(this,function(t){throw Error("Plugin Context is missing")})})}),u=function(){return(0,a.useContext)(s)}},30891:(t,e,n)=>{"use strict";n.d(e,{G:()=>s,b:()=>u});var r=n(97004),i=n(39249),a=n(12115),s=(0,a.createContext)({callRemoteFunction:(0,r._)(function(){return(0,i.YH)(this,function(t){return[2]})})}),u=function(){return(0,a.useContext)(s)}},34409:(t,e,n)=>{Promise.resolve().then(n.bind(n,94116)),Promise.resolve().then(n.bind(n,99976)),Promise.resolve().then(n.bind(n,1607)),Promise.resolve().then(n.bind(n,32134)),Promise.resolve().then(n.bind(n,33782)),Promise.resolve().then(n.bind(n,52588)),Promise.resolve().then(n.bind(n,1441))},40774:(t,e,n)=>{"use strict";n.d(e,{B:()=>r,Q:()=>i});var r=function(t){return t.CONFIRM_ASK="CONFIRM_ASK",t.CONFIRM_ANSWERED="CONFIRM_ANSWERED",t.ADD_IMAGES="ADD_IMAGES",t.IMPORT_FILES="IMPORT_FILES",t}({}),i=function(t){return t.NUMBER="number",t.STRING="string",t.MULTILINE="multiline",t}({})},45686:(t,e,n)=>{"use strict";n.d(e,{n:()=>r});var r=function(t){return t.TESTFILE="testFile",t.CHECKPRINTER="checkPrinter",t.FETCHIMAGES="fetchImages",t.CLEARPRINTER="clearPrinter",t.TEAR="tear",t}({})},47457:(t,e,n)=>{"use strict";n.d(e,{A:()=>I});var r=n(97004),i=n(693),a=n(577),s=n(39249),u=n(30832),o=n.n(u),c=n(91540),l=n(12115),f=n(5432),h=n(46498),d=n(11760),m=n(75380),p=n(72623),g=function(t,e){return!!e.find(function(e){var n=e.hashes;return!!n&&Object.values(n).includes(t)})},v=function(t,e){return!!e.find(function(e){return e.hash===t})},b=function(){var t=(0,r._)(function(t){var e,n;return(0,s.YH)(this,function(r){var i,a;switch(r.label){case 0:return e=t.images,n=t.frames,[4,(0,m.ZU)()];case 1:return r.sent(),[4,m.mU.keys()];case 2:return r.sent().forEach((i=e,function(t){g(t,i)||v(t,i)||(0,p.yH)(t)})),[4,m.Uv.keys()];case 3:return r.sent().forEach((a=n,function(t){a.find(function(e){return e.hash===t})||(0,p.t9)(t)})),[2]}})});return function(e){return t.apply(this,arguments)}}(),w=function(){var t=(0,r._)(function(t){return(0,s.YH)(this,function(e){switch(e.label){case 0:return[4,(0,m.ZU)()];case 1:return e.sent(),[4,m.mU.keys()];case 2:return[2,e.sent().filter(function(t){return!t.startsWith("dummy")}).filter(function(e){return!g(e,t)&&!v(e,t)})]}})});return function(e){return t.apply(this,arguments)}}(),P=function(){var t=(0,r._)(function(t){return(0,s.YH)(this,function(e){switch(e.label){case 0:return[4,(0,m.ZU)()];case 1:return e.sent(),[4,m.Uv.keys()];case 2:return[2,e.sent().filter(function(t){return!t.startsWith("dummy")}).filter(function(e){return!t.find(function(t){return t.hash===e})})]}})});return function(e){return t.apply(this,arguments)}}(),y=n(55364),_=n(50263),E=n(99451),A=function(){var t=(0,r._)(function(t,e){return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,(0,m.ZU)()];case 1:var i;return n.sent(),[4,Promise.all(t.map((i=(0,r._)(function(t){var n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,e.getItem(t)];case 1:if(!(n=r.sent()))return[2,null];return[4,(0,_.U)(n)];case 2:return[2,{hash:t,lines:r.sent().split("\n"),binary:n}];case 3:return r.sent(),[2,null];case 4:return[2]}})}),function(t){return i.apply(this,arguments)})))];case 2:return[2,n.sent().reduce(E.N,[])]}})});return function(e,n){return t.apply(this,arguments)}}();let I=function(){var t,e=(0,h.A)(),n=e.trashCount,u=e.showTrashCount,p=(0,d.h)(),g=p.frames,v=p.images,_=(0,h.A)().updateTrashCount,I=(t=(0,r._)(function(){var t,e,n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return[4,w(v)];case 1:return[4,A(r.sent(),m.mU)];case 2:return t=r.sent(),e={},n={state:{images:t.map(function(t){try{return e[t.hash]=t.binary,{hash:t.hash,created:o()().format(f.i$),title:"Backup export ".concat(t.hash),lines:t.lines.length,tags:["backup"],palette:"bw",framePalette:"bw",invertPalette:!1,invertFramePalette:!1,frame:""}}catch(t){return null}}).reduce(y.iy,[]),lastUpdateUTC:Math.floor(new Date().getTime()/1e3),version:d.A}},(0,c.saveAs)(new Blob((0,a._)(JSON.stringify((0,i._)({},n,e),null,2))),"backup_images.json"),[2]}})}),function(){return t.apply(this,arguments)}),S=(0,l.useCallback)((0,r._)(function(){var t,e,n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return[4,P(g)];case 1:return[4,A(r.sent(),m.Uv)];case 2:return t=r.sent(),e={},n={state:{frames:t.map(function(t,n){try{return e["frame-".concat(t.hash)]=t.binary,{hash:t.hash,name:"Backup export ".concat(t.hash),id:"bak".concat(n.toString(10).padStart(2,"0"))}}catch(t){return null}}).reduce(E.N,[]),frameGroups:[{id:"bak",name:"Re-imported trash frames"}],lastUpdateUTC:Math.floor(new Date().getTime()/1e3),version:d.A}},(0,c.saveAs)(new Blob((0,a._)(JSON.stringify((0,i._)({},n,e),null,2))),"backup_frames.json"),[2]}})}),[g]),C=(0,l.useCallback)((0,r._)(function(){var t,e;return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,P(g)];case 1:return t=n.sent().length,[4,w(v)];case 2:return e=n.sent().length,_(t,e),[2]}})}),[g,v,_]),F=(0,l.useCallback)((0,r._)(function(){return(0,s.YH)(this,function(t){switch(t.label){case 0:return[4,b({images:v,frames:g})];case 1:return t.sent(),u(!1),window.requestAnimationFrame(function(){C()}),[2]}})}),[C,g,v,u]);return{showTrashCount:u,purgeTrash:F,downloadImages:I,downloadFrames:S,checkUpdateTrashCount:C,trashCount:n}}},52588:(t,e,n)=>{"use strict";n.d(e,{PluginsContext:()=>k});var r=n(97004),i=n(39249),a=n(95155),s=n(12115),u=n(83936),o=n(633),c=n(46498),l=n(11760),f=n(693),h=n(60376),d=n(15905),m=n(52166),p=n(53982),g=n(18335),v=n(77683),b=n(86964),w=n(55364),P=n(5847),y=function(t){return function(e){var n,a=l.h.getState(),s=a.frames,u=a.palettes,o=m.A.getState().handleExportFrame,c=t.find(function(t){return t.hash===e});if(!c)throw Error("image not found");var y=(0,g.s)(u,c),_=y.palette,E=y.framePalette;if(!_)throw Error("selectedPalette not found");var A=function(){return(0,P.T)(t,s)(c.hash)},I=(0,w.pl)(c),S=(n=(0,r._)(function(){var t,e,n,r,a,u,l,h,m,g,w,P,y,S,C,F,H,k,T,Y,D,R,U,x,N,M,L=arguments;return(0,i.YH)(this,function(i){switch(i.label){case 0:return n=void 0===(e=(t=L.length>0&&void 0!==L[0]?L[0]:{}).scaleFactor)?1:e,a=void 0===(r=t.palette)?_:r,l=void 0===(u=t.framePalette)?E:u,h=t.lockFrame,m=t.invertPalette,g=t.invertFramePalette,P=void 0===(w=t.handleExportFrame)?o:w,[4,A()];case 1:if(y=i.sent(),!(C=s.find(function(t){return t.id===c.frame})))return[3,3];return[4,(0,p.mZ)(C.hash)];case 2:return H=i.sent(),[3,4];case 3:H=null,i.label=4;case 4:if(k=(F=H)?F.upper.length/20:2,!I)return[3,6];return[4,(0,d.y1)({tiles:y,palette:a,lockFrame:void 0!==h?h:c.lockFrame,imageStartLine:k,rotation:c.rotation,scaleFactor:n,handleExportFrame:P},"image/png")];case 5:return S=i.sent(),[3,8];case 6:return T=(null==a?void 0:a.palette)||d.CU,Y=(null==l?void 0:l.palette)||d.CU,R=(D=(0,b.f)(c)).invertPalette,U=D.invertFramePalette,x=(0,v.C)({imagePalette:T,framePalette:Y,invertPalette:void 0!==m?m:R,invertFramePalette:void 0!==g?g:U}),[4,(0,d.Yn)((0,f._)({tiles:y,imageStartLine:k,rotation:c.rotation,scaleFactor:n,handleExportFrame:P},x),"image/png")];case 7:S=i.sent(),i.label=8;case 8:return[4,createImageBitmap(S)];case 9:return N=i.sent(),(M=document.createElement("canvas")).width=N.width,M.height=N.height,M.getContext("2d").drawImage(N,0,0),[2,M]}})}),function(){return n.apply(this,arguments)});return{getMeta:(0,r._)(function(){return(0,i.YH)(this,function(t){return[2,(0,h._)((0,f._)({},c),{isRGBN:I})]})}),getPalette:(0,r._)(function(){return(0,i.YH)(this,function(t){return[2,_]})}),getTiles:A,getCanvas:S}}},_=n(91540),E=n(39630),A=n(40774),I=n(27338),S=function(t,e){var n=t.addImages,a=t.setDialog,s=t.dismissDialog;return{importFiles:(0,I.A)(e),setDialog:a,alert:function(t,e){return a({message:"Plugin: ".concat(t),questions:function(){return[{label:e,key:"info",type:E.V.INFO}]},confirm:(0,r._)(function(){return(0,i.YH)(this,function(t){return[2,s(0)]})})})},dismissDialog:function(){return s(0)},addImages:n}},C=function(t,e){var n=S(t,e),r=n.setDialog,i=n.dismissDialog,a=n.importFiles,s=n.addImages,u=n.alert;return{dispatch:function(t){switch(console.warn('You are using a legacy method: "dispatch('.concat(t.type,')". Please refer to "env.functions" from your plugin to switch to up-to-date methods')),t.type){case A.B.CONFIRM_ASK:r(t.payload);break;case A.B.CONFIRM_ANSWERED:i();break;case A.B.IMPORT_FILES:a(t.payload.files);break;case A.B.ADD_IMAGES:s(t.payload);break;default:u("Plugin error:",'Unhandled Compatibility Action (type:"'.concat(t.type,'")'))}}}},F=function(t,e){var n=t.setProgress,r=t.addUpdatePluginProperties,i=t.collectImageData,a=t.stores,s=t.importFn,u=e.url,o=e.config,c=void 0===o?{}:o,l=function(t){n("plugin",t%1)};return new Promise(function(t){window.gbpwRegisterPlugin=function(e){if(window.gbpwRegisterPlugin=function(){},!e)return void t(null);try{var n=new e({saveAs:_.saveAs,progress:l,store:C(a,s),functions:S(a,s),collectImageData:i},c),o=n.name,f=n.description,h=n.configParams,d=n.config;r({url:u,name:o,description:void 0===f?"":f,configParams:void 0===h?{}:h,config:void 0===d?{}:d,loading:!1,error:!1}),t(n)}catch(e){r({url:u,loading:!1,error:null==e?void 0:e.message}),t(null)}};var e=document.createElement("script");document.head.appendChild(e),e.addEventListener("error",function(){window.gbpwRegisterPlugin=function(){},r({url:u,loading:!1,error:"Loading error"}),t(null)}),e.src=u})},H=n(6617);function k(t){var e,n=t.children,f=(0,l.h)(),h=f.plugins,d=f.images,m=f.addUpdatePluginProperties,p=(0,o.g)(),g=(0,c.A)().setProgress,v=(0,u.W)().jsonImport,b=(0,s.useMemo)(function(){return{collectImageData:y(d),addUpdatePluginProperties:m,setProgress:g,stores:p,importFn:v}},[d,m,g,p,v]),w=(0,s.useMemo)(function(){var t;return t=(0,r._)(function(t){return(0,i.YH)(this,function(e){return[2,F(b,h.find(function(e){return e.url===t})||{url:""})]})}),function(e){return t.apply(this,arguments)}},[b,h]),P=(0,s.useCallback)((e=(0,r._)(function(t){return(0,i.YH)(this,function(e){switch(e.label){case 0:return[4,F(b,t)];case 1:return[2,!!e.sent()]}})}),function(t){return e.apply(this,arguments)}),[b]),_=(0,s.useMemo)(function(){var t,e;return{runWithImage:(t=(0,r._)(function(t,e){var n,r;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r=y(d)(e),[4,w(t)];case 1:return null==(n=i.sent())||n.withImage(r),[2]}})}),function(e,n){return t.apply(this,arguments)}),runWithImages:(e=(0,r._)(function(t,e){var n,r;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r=e.map(y(d)),[4,w(t)];case 1:return null==(n=i.sent())||n.withSelection(r),[2]}})}),function(t,n){return e.apply(this,arguments)}),validateAndAddPlugin:P}},[w,d,P]);return(0,a.jsx)(H.i.Provider,{value:_,children:n})}},99976:(t,e,n)=>{"use strict";n.d(e,{default:()=>g});var r,i=n(12115),a=n(97004),s=n(577),u=n(39249),o=n(83936),c=n(46498),l=n(27338),f=!1;let h=function(){var t=(0,c.A)(),e=t.setDragover,n=t.setError,h=(0,o.W)().jsonImport,d=(0,i.useMemo)(function(){return(0,l.A)(h)},[h]),m=(0,i.useCallback)(function(){var t,i=function(t){t.preventDefault(),f||e(!0),window.clearTimeout(r),f=!0,r=window.setTimeout(function(){f=!1,e(!1)},250)},o=(t=(0,a._)(function(t){var e,r,i;return(0,u.YH)(this,function(a){switch(a.label){case 0:t.preventDefault(),(r=t.dataTransfer.items)?e=(0,s._)(r).reduce(function(t,e){if("file"===e.kind){var n=e.getAsFile();return n?(0,s._)(t).concat([n]):t}return t},[]):(i=t.dataTransfer.files,e=(0,s._)(i)),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,d(e)];case 2:return a.sent(),[3,4];case 3:return n(a.sent()),[3,4];case 4:return[2]}})}),function(e){return t.apply(this,arguments)}),c=document.querySelector("body");if(!c)throw Error("dafuq?");return c.addEventListener("dragover",i),c.addEventListener("drop",o),function(){c.removeEventListener("dragover",i),c.removeEventListener("drop",o)}},[d,e,n]);(0,i.useEffect)(m,[m])};var d=n(633),m=n(47457),p=n(933);let g=function(t){var e=t.children;h();var n=(0,d.g)(),r=(0,o.W)().remoteImport;(0,i.useEffect)(function(){return(0,(0,p.E)(n,r).subscribe)()},[r,n]);var a=(0,m.A)().checkUpdateTrashCount;return(0,i.useEffect)(function(){a()},[a]),e}}},t=>{var e=e=>t(t.s=e);t.O(0,[4453,7271,4831,5394,9758,5744,1760,3936,4768,929,8441,1684,7358],()=>e(34409)),_N_E=t.O()}]);