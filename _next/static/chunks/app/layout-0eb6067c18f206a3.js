(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{933:(e,t,n)=>{"use strict";n.d(t,{E:()=>u});var r,i=n(97004),a=n(39249),s=n(24463),u=function(e,t){var u,o,c,l,f=(u=(0,i._)(function(){var i;return(0,a.YH)(this,function(a){switch(a.label){case 0:if(r)return[3,2];return[4,Promise.all([n.e(9268),n.e(5678),n.e(1753),n.e(1575)]).then(n.bind(n,94979))];case 1:i=a.sent().dropBoxSyncTool,r=r||i(e,t),a.label=2;case 2:return[2,r]}})}),function(){return u.apply(this,arguments)});return s.A.getState().dropboxStorage.use&&f(),{recoverImageData:(o=(0,i._)(function(e){return(0,a.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().recoverImageData(e)]}})}),function(e){return o.apply(this,arguments)}),startAuth:(0,i._)(function(){return(0,a.YH)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return[2,e.sent().startAuth()]}})}),startSyncData:(c=(0,i._)(function(e){return(0,a.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().startSyncData(e)]}})}),function(e){return c.apply(this,arguments)}),startSyncImages:(0,i._)(function(){return(0,a.YH)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return[2,e.sent().startSyncImages()]}})}),updateSettings:(l=(0,i._)(function(e){return(0,a.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().updateSettings(e)]}})}),function(e){return l.apply(this,arguments)}),subscribe:function(){var e;return s.A.subscribe(function(e){return e.dropboxStorage},(e=(0,i._)(function(e){return(0,a.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return t.sent().updateSettings(e),[2]}})}),function(t){return e.apply(this,arguments)}))}}}},1441:(e,t,n)=>{"use strict";n.d(t,{default:()=>v});var r,i,a=n(97004),s=n(577),u=n(39249),o=n(95155),c=n(12115),l=n(45686),f=n(64768),h=n(41186),d=n(46498),m=n(52166),p=n(30891);let v=function(e){var t=e.children,v=d.A.getState(),g=v.setProgress,w=v.setPrinterFunctions,b=v.setPrinterBusy,P=v.setPrinterData,y=h.A.getState(),_=y.dismissDialog,E=y.setDialog,A=(0,f.A)().handleFileImport;(0,c.useEffect)(function(){var e=function(e){var t,n=m.A.getState().printerUrl;try{t=new URL(n).origin}catch(e){t=new URL(window.location.href).origin}if(e.origin===t){var o=e.data.fromRemotePrinter,c=void 0===o?{}:o,l=c.lines,f=c.progress,h=c.blob,p=c.blobsdone,v=c.commands,y=c.printerData,I=e.source;if(v&&(r&&JSON.stringify(v)===JSON.stringify(d.A.getState().printerFunctions)||(w(v),b(!1),P(null)),i=I,window.clearTimeout(r),r=window.setTimeout(function(){r=null,i=null,b(!0),P(null),w([])},1500)),l&&A([new File([l.join("\n")],"Text input.txt",{type:"text/plain"})]),void 0!==f&&g("printer",f),h&&A([new File([h],"blob.unknown")]),p){if("string"==typeof p[0])return void window.setTimeout(function(){alert("You should update the web-app to a version > 1.16.0 on your printer for an optimized import experience :-)")},200);var S=p.reduce(function(e,t){if(!t.blob||!t.ok)return e;var n=p.length>1?(e.length+1).toString(10).padStart(2,"0"):"";return(0,s._)(e).concat([new File([t.blob],"Printer ".concat(n).trim(),{type:t.contentType})])},[]);S.length?A(S,{fromPrinter:!0}):E({message:"No valid files received from WiFi-Printer",confirm:(0,a._)(function(){return(0,u.YH)(this,function(e){return _(0),b(!1),P(null),[2]})})})}y&&(P(y),b(!1))}};return window.addEventListener("message",e),function(){return window.removeEventListener("message",e)}},[_,A,E,b,P,w,g]);var I=(0,c.useMemo)(function(){var e;return{callRemoteFunction:(e=(0,a._)(function(e){var t,r;return(0,u.YH)(this,function(a){switch(a.label){case 0:return t=d.A.getState().printerData,b(!0),e===l.n.FETCHIMAGES&&t&&(r={dumps:null==t?void 0:t.dumps}),[4,Promise.resolve().then(n.t.bind(n,52491,23))];case 1:return a.sent(),[4,Promise.resolve().then(n.t.bind(n,98933,23))];case 2:if(a.sent(),!i)throw Error("remote printer window object is missing");return i.postMessage({toRemotePrinter:{command:e,params:r}},"*"),[2]}})}),function(t){return e.apply(this,arguments)})}},[b]);return(0,o.jsx)(p.G.Provider,{value:I,children:t})}},1607:(e,t,n)=>{"use strict";n.d(t,{D:()=>d,EnvProvider:()=>m});var r=n(97004),i=n(693),a=n(60376),s=n(78538),u=n(39249),o=n(95155),c=n(12115),l=n(52166),f=n(75380),h=(0,c.createContext)(null),d=function(){return(0,c.useContext)(h)},m=function(e){var t=e.children,n=(0,s._)((0,c.useState)(null),2),d=n[0],m=n[1],p=(0,l.A)().setPrinterUrl;return(0,c.useEffect)(function(){var e=["/gb-printer-web","/env.json"].filter(Boolean).join("/");e&&(0,r._)(function(){var t,n,r,s;return(0,u.YH)(this,function(u){switch(u.label){case 0:return u.trys.push([0,5,,6]),[4,(0,f.ZU)()];case 1:return u.sent(),[4,fetch(e)];case 2:return[4,u.sent().json()];case 3:return t=u.sent(),r=[(0,i._)({},t)],s={},[4,f.mU.driver()];case 4:return"esp8266"===(n=a._.apply(void 0,r.concat([(s.localforage=u.sent(),s)]))).env&&p("/"),m(n),[3,6];case 5:return u.sent(),m({version:"0.0.0",maximages:0,localforage:"error",env:"error",fstype:"-",bootmode:"-",oled:!1}),[3,6];case 6:return[2]}})})()},[p]),(0,o.jsx)(h.Provider,{value:d,children:t})}},6617:(e,t,n)=>{"use strict";n.d(t,{h:()=>u,i:()=>s});var r=n(97004),i=n(39249),a=n(12115),s=(0,a.createContext)({runWithImage:(0,r._)(function(){return(0,i.YH)(this,function(e){throw Error("Plugin Context is missing")})}),runWithImages:(0,r._)(function(){return(0,i.YH)(this,function(e){throw Error("Plugin Context is missing")})}),validateAndAddPlugin:(0,r._)(function(){return(0,i.YH)(this,function(e){throw Error("Plugin Context is missing")})})}),u=function(){return(0,a.useContext)(s)}},30891:(e,t,n)=>{"use strict";n.d(t,{G:()=>s,b:()=>u});var r=n(97004),i=n(39249),a=n(12115),s=(0,a.createContext)({callRemoteFunction:(0,r._)(function(){return(0,i.YH)(this,function(e){return[2]})})}),u=function(){return(0,a.useContext)(s)}},34409:(e,t,n)=>{Promise.resolve().then(n.bind(n,94116)),Promise.resolve().then(n.bind(n,99976)),Promise.resolve().then(n.bind(n,1607)),Promise.resolve().then(n.bind(n,32134)),Promise.resolve().then(n.bind(n,33782)),Promise.resolve().then(n.bind(n,52588)),Promise.resolve().then(n.bind(n,1441))},40774:(e,t,n)=>{"use strict";n.d(t,{B:()=>r,Q:()=>i});var r=function(e){return e.CONFIRM_ASK="CONFIRM_ASK",e.CONFIRM_ANSWERED="CONFIRM_ANSWERED",e.ADD_IMAGES="ADD_IMAGES",e.IMPORT_FILES="IMPORT_FILES",e}({}),i=function(e){return e.NUMBER="number",e.STRING="string",e.MULTILINE="multiline",e}({})},45686:(e,t,n)=>{"use strict";n.d(t,{n:()=>r});var r=function(e){return e.TESTFILE="testFile",e.CHECKPRINTER="checkPrinter",e.FETCHIMAGES="fetchImages",e.CLEARPRINTER="clearPrinter",e.TEAR="tear",e}({})},47457:(e,t,n)=>{"use strict";n.d(t,{A:()=>I});var r=n(97004),i=n(693),a=n(577),s=n(39249),u=n(30832),o=n.n(u),c=n(91540),l=n(12115),f=n(5432),h=n(46498),d=n(11760),m=n(75380),p=n(72623),v=function(e,t){return!!t.find(function(t){var n=t.hashes;return!!n&&Object.values(n).includes(e)})},g=function(e,t){return!!t.find(function(t){return t.hash===e})},w=function(){var e=(0,r._)(function(e){var t,n;return(0,s.YH)(this,function(r){var i,a;switch(r.label){case 0:return t=e.images,n=e.frames,[4,(0,m.ZU)()];case 1:return r.sent(),[4,m.mU.keys()];case 2:return r.sent().forEach((i=t,function(e){v(e,i)||g(e,i)||(0,p.yH)(e)})),[4,m.Uv.keys()];case 3:return r.sent().forEach((a=n,function(e){a.find(function(t){return t.hash===e})||(0,p.t9)(e)})),[2]}})});return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,r._)(function(e){return(0,s.YH)(this,function(t){switch(t.label){case 0:return[4,(0,m.ZU)()];case 1:return t.sent(),[4,m.mU.keys()];case 2:return[2,t.sent().filter(function(e){return!e.startsWith("dummy")}).filter(function(t){return!v(t,e)&&!g(t,e)})]}})});return function(t){return e.apply(this,arguments)}}(),P=function(){var e=(0,r._)(function(e){return(0,s.YH)(this,function(t){switch(t.label){case 0:return[4,(0,m.ZU)()];case 1:return t.sent(),[4,m.Uv.keys()];case 2:return[2,t.sent().filter(function(e){return!e.startsWith("dummy")}).filter(function(t){return!e.find(function(e){return e.hash===t})})]}})});return function(t){return e.apply(this,arguments)}}(),y=n(55364),_=n(50263),E=n(99451),A=function(){var e=(0,r._)(function(e,t){return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,(0,m.ZU)()];case 1:var i;return n.sent(),[4,Promise.all(e.map((i=(0,r._)(function(e){var n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,t.getItem(e)];case 1:if(!(n=r.sent()))return[2,null];return[4,(0,_.U)(n)];case 2:return[2,{hash:e,lines:r.sent().split("\n"),binary:n}];case 3:return r.sent(),[2,null];case 4:return[2]}})}),function(e){return i.apply(this,arguments)})))];case 2:return[2,n.sent().reduce(E.N,[])]}})});return function(t,n){return e.apply(this,arguments)}}();let I=function(){var e,t=(0,h.A)(),n=t.trashCount,u=t.showTrashCount,p=(0,d.h)(),v=p.frames,g=p.images,_=(0,h.A)().updateTrashCount,I=(e=(0,r._)(function(){var e,t,n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return[4,b(g)];case 1:return[4,A(r.sent(),m.mU)];case 2:return e=r.sent(),t={},n={state:{images:e.map(function(e){try{return t[e.hash]=e.binary,{hash:e.hash,created:o()().format(f.i$),title:"Backup export ".concat(e.hash),lines:e.lines.length,tags:["backup"],palette:"bw",framePalette:"bw",invertPalette:!1,invertFramePalette:!1,frame:""}}catch(e){return null}}).reduce(y.iy,[]),lastUpdateUTC:Math.floor(new Date().getTime()/1e3),version:d.A}},(0,c.saveAs)(new Blob((0,a._)(JSON.stringify((0,i._)({},n,t),null,2))),"backup_images.json"),[2]}})}),function(){return e.apply(this,arguments)}),S=(0,l.useCallback)((0,r._)(function(){var e,t,n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return[4,P(v)];case 1:return[4,A(r.sent(),m.Uv)];case 2:return e=r.sent(),t={},n={state:{frames:e.map(function(e,n){try{return t["frame-".concat(e.hash)]=e.binary,{hash:e.hash,name:"Backup export ".concat(e.hash),id:"bak".concat(n.toString(10).padStart(2,"0"))}}catch(e){return null}}).reduce(E.N,[]),frameGroups:[{id:"bak",name:"Re-imported trash frames"}],lastUpdateUTC:Math.floor(new Date().getTime()/1e3),version:d.A}},(0,c.saveAs)(new Blob((0,a._)(JSON.stringify((0,i._)({},n,t),null,2))),"backup_frames.json"),[2]}})}),[v]),C=(0,l.useCallback)((0,r._)(function(){var e,t;return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,P(v)];case 1:return e=n.sent().length,[4,b(g)];case 2:return t=n.sent().length,_(e,t),[2]}})}),[v,g,_]),F=(0,l.useCallback)((0,r._)(function(){return(0,s.YH)(this,function(e){switch(e.label){case 0:return[4,w({images:g,frames:v})];case 1:return e.sent(),u(!1),window.requestAnimationFrame(function(){C()}),[2]}})}),[C,v,g,u]);return{showTrashCount:u,purgeTrash:F,downloadImages:I,downloadFrames:S,checkUpdateTrashCount:C,trashCount:n}}},52588:(e,t,n)=>{"use strict";n.d(t,{PluginsContext:()=>T});var r=n(97004),i=n(39249),a=n(95155),s=n(12115),u=n(83936),o=n(633),c=n(46498),l=n(11760),f=n(693),h=n(60376),d=n(15905),m=n(52166),p=n(53982),v=n(18335),g=n(77683),w=n(86964),b=n(55364),P=n(5847),y=function(e){return function(t){var n,a=l.h.getState(),s=a.frames,u=a.palettes,o=m.A.getState().handleExportFrame,c=e.find(function(e){return e.hash===t});if(!c)throw Error("image not found");var y=(0,v.s)(u,c),_=y.palette,E=y.framePalette;if(!_)throw Error("selectedPalette not found");var A=function(){return(0,P.T)(e,s)(c.hash)},I=(0,b.pl)(c),S=(n=(0,r._)(function(){var e,t,n,r,a,u,l,h,m,v,b,P,y,S,C,F,H,T,Y,k,D,R,U,x,N,M,L=arguments;return(0,i.YH)(this,function(i){switch(i.label){case 0:return n=void 0===(t=(e=L.length>0&&void 0!==L[0]?L[0]:{}).scaleFactor)?1:t,a=void 0===(r=e.palette)?_:r,l=void 0===(u=e.framePalette)?E:u,h=e.lockFrame,m=e.invertPalette,v=e.invertFramePalette,P=void 0===(b=e.handleExportFrame)?o:b,[4,A()];case 1:if(y=i.sent(),!(C=s.find(function(e){return e.id===c.frame})))return[3,3];return[4,(0,p.mZ)(C.hash)];case 2:return H=i.sent(),[3,4];case 3:H=null,i.label=4;case 4:if(T=(F=H)?F.upper.length/20:2,!I)return[3,6];return[4,(0,d.y1)({tiles:y,palette:a,lockFrame:void 0!==h?h:c.lockFrame,imageStartLine:T,rotation:c.rotation,scaleFactor:n,handleExportFrame:P},"image/png")];case 5:return S=i.sent(),[3,8];case 6:return Y=(null==a?void 0:a.palette)||d.CU,k=(null==l?void 0:l.palette)||d.CU,R=(D=(0,w.f)(c)).invertPalette,U=D.invertFramePalette,x=(0,g.C)({imagePalette:Y,framePalette:k,invertPalette:void 0!==m?m:R,invertFramePalette:void 0!==v?v:U}),[4,(0,d.Yn)((0,f._)({tiles:y,imageStartLine:T,rotation:c.rotation,scaleFactor:n,handleExportFrame:P},x),"image/png")];case 7:S=i.sent(),i.label=8;case 8:return[4,createImageBitmap(S)];case 9:return N=i.sent(),(M=document.createElement("canvas")).width=N.width,M.height=N.height,M.getContext("2d").drawImage(N,0,0),[2,M]}})}),function(){return n.apply(this,arguments)});return{getMeta:(0,r._)(function(){return(0,i.YH)(this,function(e){return[2,(0,h._)((0,f._)({},c),{isRGBN:I})]})}),getPalette:(0,r._)(function(){return(0,i.YH)(this,function(e){return[2,_]})}),getTiles:A,getCanvas:S}}},_=n(91540),E=n(39630),A=n(40774),I=n(27338),S=function(e,t){var n=e.addImages,a=e.setDialog,s=e.dismissDialog;return{importFiles:(0,I.A)(t),setDialog:a,alert:function(e,t){return a({message:"Plugin: ".concat(e),questions:function(){return[{label:t,key:"info",type:E.V.INFO}]},confirm:(0,r._)(function(){return(0,i.YH)(this,function(e){return[2,s(0)]})})})},dismissDialog:function(){return s(0)},addImages:n}},C=function(e,t){var n=S(e,t),r=n.setDialog,i=n.dismissDialog,a=n.importFiles,s=n.addImages,u=n.alert;return{dispatch:function(e){switch(console.warn('You are using a legacy method: "dispatch('.concat(e.type,')". Please refer to "env.functions" from your plugin to switch to up-to-date methods')),e.type){case A.B.CONFIRM_ASK:r(e.payload);break;case A.B.CONFIRM_ANSWERED:i();break;case A.B.IMPORT_FILES:a(e.payload.files);break;case A.B.ADD_IMAGES:s(e.payload);break;default:u("Plugin error:",'Unhandled Compatibility Action (type:"'.concat(e.type,'")'))}}}},F=function(e,t){var n=e.setProgress,r=e.addUpdatePluginProperties,i=e.collectImageData,a=e.stores,s=e.importFn,u=t.url,o=t.config,c=void 0===o?{}:o,l=function(e){n("plugin",e%1)};return new Promise(function(e){window.gbpwRegisterPlugin=function(t){if(window.gbpwRegisterPlugin=function(){},!t)return void e(null);try{var n=new t({saveAs:_.saveAs,progress:l,store:C(a,s),functions:S(a,s),collectImageData:i},c),o=n.name,f=n.description,h=n.configParams,d=n.config;r({url:u,name:o,description:void 0===f?"":f,configParams:void 0===h?{}:h,config:void 0===d?{}:d,loading:!1,error:!1}),e(n)}catch(t){r({url:u,loading:!1,error:null==t?void 0:t.message}),e(null)}};var t=document.createElement("script");document.head.appendChild(t),t.addEventListener("error",function(){window.gbpwRegisterPlugin=function(){},r({url:u,loading:!1,error:"Loading error"}),e(null)}),t.src=u})},H=n(6617);function T(e){var t,n=e.children,f=(0,l.h)(),h=f.plugins,d=f.images,m=f.addUpdatePluginProperties,p=(0,o.g)(),v=(0,c.A)().setProgress,g=(0,u.W)().jsonImport,w=(0,s.useMemo)(function(){return{collectImageData:y(d),addUpdatePluginProperties:m,setProgress:v,stores:p,importFn:g}},[d,m,v,p,g]),b=(0,s.useMemo)(function(){var e;return e=(0,r._)(function(e){return(0,i.YH)(this,function(t){return[2,F(w,h.find(function(t){return t.url===e})||{url:""})]})}),function(t){return e.apply(this,arguments)}},[w,h]),P=(0,s.useCallback)((t=(0,r._)(function(e){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,F(w,e)];case 1:return[2,!!t.sent()]}})}),function(e){return t.apply(this,arguments)}),[w]),_=(0,s.useMemo)(function(){var e,t;return{runWithImage:(e=(0,r._)(function(e,t){var n,r;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r=y(d)(t),[4,b(e)];case 1:return null==(n=i.sent())||n.withImage(r),[2]}})}),function(t,n){return e.apply(this,arguments)}),runWithImages:(t=(0,r._)(function(e,t){var n,r;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r=t.map(y(d)),[4,b(e)];case 1:return null==(n=i.sent())||n.withSelection(r),[2]}})}),function(e,n){return t.apply(this,arguments)}),validateAndAddPlugin:P}},[b,d,P]);return(0,a.jsx)(H.i.Provider,{value:_,children:n})}},99976:(e,t,n)=>{"use strict";n.d(t,{default:()=>v});var r,i=n(12115),a=n(97004),s=n(577),u=n(39249),o=n(83936),c=n(46498),l=n(27338),f=!1;let h=function(){var e=(0,c.A)(),t=e.setDragover,n=e.setError,h=(0,o.W)().jsonImport,d=(0,i.useMemo)(function(){return(0,l.A)(h)},[h]),m=(0,i.useCallback)(function(){var e,i=function(e){e.preventDefault(),f||t(!0),window.clearTimeout(r),f=!0,r=window.setTimeout(function(){f=!1,t(!1)},250)},o=(e=(0,a._)(function(e){var t,r,i;return(0,u.YH)(this,function(a){switch(a.label){case 0:e.preventDefault(),(r=e.dataTransfer.items)?t=(0,s._)(r).reduce(function(e,t){if("file"===t.kind){var n=t.getAsFile();return n?(0,s._)(e).concat([n]):e}return e},[]):(i=e.dataTransfer.files,t=(0,s._)(i)),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,d(t)];case 2:return a.sent(),[3,4];case 3:return n(a.sent()),[3,4];case 4:return[2]}})}),function(t){return e.apply(this,arguments)}),c=document.querySelector("body");if(!c)throw Error("dafuq?");return c.addEventListener("dragover",i),c.addEventListener("drop",o),function(){c.removeEventListener("dragover",i),c.removeEventListener("drop",o)}},[d,t,n]);(0,i.useEffect)(m,[m])};var d=n(633),m=n(47457),p=n(933);let v=function(e){var t=e.children;h();var n=(0,d.g)(),r=(0,o.W)().remoteImport;(0,i.useEffect)(function(){return(0,(0,p.E)(n,r).subscribe)()},[r,n]);var a=(0,m.A)().checkUpdateTrashCount;return(0,i.useEffect)(function(){var e=window.setTimeout(function(){a()},1);return function(){return window.clearTimeout(e)}},[a]),t}}},e=>{var t=t=>e(e.s=t);e.O(0,[4453,7271,4831,5394,9758,5744,1760,3936,4768,929,8441,1684,7358],()=>t(34409)),_N_E=e.O()}]);