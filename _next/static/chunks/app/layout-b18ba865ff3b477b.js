(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{933:(e,t,r)=>{"use strict";r.d(t,{E:()=>o});var n,a=r(97004),i=r(39249),s=r(24463),o=function(e,t){var o,u,c,l,f=(o=(0,a._)(function(){var a;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(n)return[3,2];return[4,Promise.all([r.e(9268),r.e(7431),r.e(6950),r.e(1575)]).then(r.bind(r,94979))];case 1:a=i.sent().dropBoxSyncTool,n=n||a(e,t),i.label=2;case 2:return[2,n]}})}),function(){return o.apply(this,arguments)});return s.A.getState().dropboxStorage.use&&f(),{recoverImageData:(u=(0,a._)(function(e){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().recoverImageData(e)]}})}),function(e){return u.apply(this,arguments)}),startAuth:(0,a._)(function(){return(0,i.YH)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return[2,e.sent().startAuth()]}})}),startSyncData:(c=(0,a._)(function(e){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().startSyncData(e)]}})}),function(e){return c.apply(this,arguments)}),startSyncImages:(0,a._)(function(){return(0,i.YH)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return[2,e.sent().startSyncImages()]}})}),updateSettings:(l=(0,a._)(function(e){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().updateSettings(e)]}})}),function(e){return l.apply(this,arguments)}),subscribe:function(){var e;return s.A.subscribe(function(e){return e.dropboxStorage},(e=(0,a._)(function(e){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return t.sent().updateSettings(e),[2]}})}),function(t){return e.apply(this,arguments)}))}}}},1441:(e,t,r)=>{"use strict";r.d(t,{default:()=>m});var n,a,i=r(97004),s=r(577),o=r(39249),u=r(95155),c=r(12115),l=r(45686),f=r(64768),d=r(41186),p=r(46498),h=r(41476),g=r(52166),v=r(30891);let m=function(e){var t=e.children,m=p.A.getState(),w=m.setPrinterFunctions,b=m.setPrinterBusy,E=m.setPrinterData,I=h.A.getState(),P=I.startProgress,_=I.setProgress,S=I.stopProgress,y=d.A.getState(),A=y.dismissDialog,T=y.setDialog,R=(0,f.A)().handleFileImport,C=(0,c.useRef)(""),k=(0,c.useCallback)(function(e){var t=Math.min(1,Math.max(0,e));if(C&&(0===t||1===t)){S(C.current),C.current="";return}C.current||(C.current=P("Getting items from printer")),_(C.current,t)},[_,P,S]);(0,c.useEffect)(function(){var e=function(e){var t,r=g.A.getState().printerUrl;try{t=new URL(r).origin}catch(e){t=new URL(window.location.href).origin}if(e.origin===t){var u=e.data.fromRemotePrinter,c=void 0===u?{}:u,l=c.lines,f=c.progress,d=c.blob,h=c.blobsdone,v=c.commands,m=c.printerData,I=e.source;if(v&&(n&&JSON.stringify(v)===JSON.stringify(p.A.getState().printerFunctions)||(w(v),b(!1),E(null)),a=I,window.clearTimeout(n),n=window.setTimeout(function(){n=null,a=null,b(!0),E(null),w([])},1500)),l&&R([new File([l.join("\n")],"Text input.txt",{type:"text/plain"})]),void 0!==f&&k(f),d&&R([new File([d],"blob.unknown")]),h){if("string"==typeof h[0])return void window.setTimeout(function(){alert("You should update the web-app to a version > 1.16.0 on your printer for an optimized import experience :-)")},200);var P=h.reduce(function(e,t){if(!t.blob||!t.ok)return e;var r=h.length>1?(e.length+1).toString(10).padStart(2,"0"):"";return(0,s._)(e).concat([new File([t.blob],"Printer ".concat(r).trim(),{type:t.contentType})])},[]);P.length?R(P,{fromPrinter:!0}):T({message:"No valid files received from WiFi-Printer",confirm:(0,i._)(function(){return(0,o.YH)(this,function(e){return A(0),b(!1),E(null),[2]})})})}m&&(E(m),b(!1))}};return window.addEventListener("message",e),function(){return window.removeEventListener("message",e)}},[A,R,T,b,E,w,k]);var U=(0,c.useMemo)(function(){var e;return{callRemoteFunction:(e=(0,i._)(function(e){var t,n;return(0,o.YH)(this,function(i){switch(i.label){case 0:return t=p.A.getState().printerData,b(!0),e===l.n.FETCHIMAGES&&t&&(n={dumps:null==t?void 0:t.dumps}),[4,Promise.resolve().then(r.t.bind(r,52491,23))];case 1:return i.sent(),[4,Promise.resolve().then(r.t.bind(r,98933,23))];case 2:if(i.sent(),!a)throw Error("remote printer window object is missing");return a.postMessage({toRemotePrinter:{command:e,params:n}},"*"),[2]}})}),function(t){return e.apply(this,arguments)})}},[b]);return(0,u.jsx)(v.G.Provider,{value:U,children:t})}},1470:(e,t,r)=>{"use strict";r.d(t,{t:()=>n,z:()=>a});var n="ROOT",a=function(){return{id:n,slug:"",created:"",title:"Home",coverImage:"",images:[],groups:[],tags:[]}}},1607:(e,t,r)=>{"use strict";r.d(t,{D:()=>p,EnvProvider:()=>h});var n=r(97004),a=r(693),i=r(60376),s=r(62570),o=r(39249),u=r(95155),c=r(12115),l=r(52166),f=r(75380),d=(0,c.createContext)(null),p=function(){return(0,c.useContext)(d)},h=function(e){var t=e.children,r=(0,s._)((0,c.useState)(null),2),p=r[0],h=r[1],g=(0,l.A)().setPrinterUrl;return(0,c.useEffect)(function(){var e=["/gb-printer-web","/env.json"].filter(Boolean).join("/");e&&(0,n._)(function(){var t,r,n,s;return(0,o.YH)(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),[4,(0,f.ZU)()];case 1:return o.sent(),[4,fetch(e)];case 2:return[4,o.sent().json()];case 3:return t=o.sent(),n=[(0,a._)({},t)],s={},[4,f.mU.driver()];case 4:return"esp8266"===(r=i._.apply(void 0,n.concat([(s.localforage=o.sent(),s)]))).env&&g("/"),h(r),[3,6];case 5:return o.sent(),h({version:"0.0.0",maximages:0,localforage:"error",env:"error",fstype:"-",bootmode:"-",oled:!1}),[3,6];case 6:return[2]}})})()},[g]),(0,u.jsx)(d.Provider,{value:p,children:t})}},6617:(e,t,r)=>{"use strict";r.d(t,{h:()=>o,i:()=>s});var n=r(97004),a=r(39249),i=r(12115),s=(0,i.createContext)({runWithImage:(0,n._)(function(){return(0,a.YH)(this,function(e){throw Error("Plugin Context is missing")})}),runWithImages:(0,n._)(function(){return(0,a.YH)(this,function(e){throw Error("Plugin Context is missing")})}),validateAndAddPlugin:(0,n._)(function(){return(0,a.YH)(this,function(e){throw Error("Plugin Context is missing")})})}),o=function(){return(0,i.useContext)(s)}},7119:(e,t,r)=>{"use strict";r.d(t,{NavigationToolsProvider:()=>g,g:()=>v});var n=r(95155),a=r(12115),i=r(62570),s=r(35695),o=r(95939),u=r(45465),c=r(71620),l=r(52166),f=r(1470),d=r(66785),p=function(){var e=(0,s.useRouter)(),t=(0,o.Z)(),r=t.paths,n=t.root,p=t.isWorking,h=(0,i._)((0,a.useState)(!1),2),g=h[0],v=h[1],m=(0,c.A)(),w=m.sortBy,b=m.filtersActiveTags,E=m.recentImports,I=(0,l.A)().pageSize,P=(0,u.Y)(),_=P.path,S=P.getUrl,y=(0,a.useCallback)(function(e){return(0,d.S)(e,{filtersActiveTags:b,sortBy:w,recentImports:E})},[b,E,w]),A=(0,a.useCallback)(function(e,t){return Math.floor(y(t.images).findIndex(function(t){return t.hash===e})/I)},[y,I]),T=(0,a.useCallback)(function(e,t){var n;return e===f.t?S({pageIndex:t,group:""}):S({pageIndex:t,group:(null==(n=r.find(function(t){return e===t.group.id}))?void 0:n.absolutePath)||""})},[S,r]),R=(0,a.useMemo)(function(){var e;return(null==(e=r.find(function(e){return e.absolutePath===_}))?void 0:e.group)||n},[_,r,n]),C=(0,a.useCallback)(function(e){var t=r.find(function(t){return t.group.images.map(function(e){return e.hash}).includes(e)}),a=(null==t?void 0:t.absolutePath)||"";return S({pageIndex:A(e,(null==t?void 0:t.group)||n),group:a})},[A,S,r,n]),k=(0,a.useCallback)(function(e,t){p||window.setTimeout(function(){v({group:{id:e,pageIndex:t}})},1)},[p]),U=(0,a.useCallback)(function(e){window.setTimeout(function(){v({imageHash:e})},1)},[]);return(0,a.useEffect)(function(){if(!p&&g){var t=window.setTimeout(function(){g.imageHash?(e.push(C(g.imageHash)),v(!1)):g.group&&(e.push(T(g.group.id,g.group.pageIndex)),v(!1))},1);return function(){window.clearTimeout(t)}}},[T,C,p,e,g]),{currentGroup:R,getGroupPath:T,getImagePageIndexInGroup:A,navigateToGroup:k,navigateToImage:U}},h=(0,a.createContext)(null);function g(e){var t=e.children,r=p();return(0,n.jsx)(h.Provider,{value:r,children:t})}var v=function(){var e=(0,a.useContext)(h);if(!e)throw Error("useNavigationToolsContext must be used within an NavigationToolsProvider");return e}},9718:(e,t,r)=>{"use strict";r.d(t,{OU:()=>c,_Y:()=>s,k4:()=>l,qt:()=>i,vK:()=>o,vx:()=>u});var n,a=r(86447),i=function(e){return e.USB="USB",e.SERIAL="SERIAL",e}({}),s=function(e){return e.UNKNOWN="unknown",e.PASSIVE="passive",e.INACTIVE="inactive",e.PACKET_CAPTURE="packet_capture",e.SUPER_PRINTER_INTERFACE="super_printer_interface",e}({}),o=(n={},(0,a._)(n,"unknown","Unknown Device"),(0,a._)(n,"passive","Passive Device"),(0,a._)(n,"inactive","Inactive Device"),(0,a._)(n,"packet_capture","Packet Capture device"),(0,a._)(n,"super_printer_interface","Super Printer Interface"),n),u=function(e){return e.OPEN="OPEN",e.SEND_DATA="SEND_DATA",e.ANSWER="ANSWER",e}({}),c=function(e){return e.ENABLED_STATE="ENABLED_STATE",e.ERROR="ERROR",e.PORTS_CHANGE="PORTS_CHANGE",e.DATA="DATA",e.RECEIVING="RECEIVING",e.QUESTION="QUESTION",e}({}),l=[{vendorId:9025,productId:32822},{vendorId:9025,productId:32823},{vendorId:9025,productId:32845},{vendorId:9025,productId:32846},{vendorId:9025,productId:32847},{vendorId:9025,productId:32848},{vendorId:9025,productId:32850},{vendorId:9025,productId:32851},{vendorId:9025,productId:32852},{vendorId:9025,productId:32853},{vendorId:9025,productId:32854},{vendorId:9025,productId:32855},{vendorId:9114}]},29032:(e,t,r)=>{"use strict";r.d(t,{j:()=>s});var n=r(62570),a=r(35695),i=r(12115),s=function(){var e=(0,a.usePathname)(),t=(0,n._)((0,i.useState)(new URLSearchParams),2),r=t[0],s=t[1];(0,i.useEffect)(function(){var e=function(){window.setTimeout(function(){s(new URLSearchParams(window.location.search))},1)};e(),window.addEventListener("popstate",e);var t=history.pushState,r=history.replaceState;return history.pushState=function(){for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];t.apply(this,n),e()},history.replaceState=function(){for(var t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];r.apply(this,n),e()},function(){window.removeEventListener("popstate",e),history.pushState=t,history.replaceState=r}},[e]);var o=(0,i.useMemo)(function(){return r.toString()},[r]);return{fullPath:(0,i.useMemo)(function(){return o?"".concat(e,"?").concat(o):e},[e,o]),pathname:e,query:o,searchParams:r}}},30891:(e,t,r)=>{"use strict";r.d(t,{G:()=>s,b:()=>o});var n=r(97004),a=r(39249),i=r(12115),s=(0,i.createContext)({callRemoteFunction:(0,n._)(function(){return(0,a.YH)(this,function(e){return[2]})})}),o=function(){return(0,i.useContext)(s)}},32134:(e,t,r)=>{"use strict";r.d(t,{GalleryTreeContext:()=>p,K:()=>d});var n=r(62570),a=r(95155),i=r(7062),s=r(12115),o=r(45465),u=r(46498),c=r(11760),l=r(52166),f=r(1470),d=(0,s.createContext)({root:(0,f.z)(),view:(0,f.z)(),images:[],covers:[],paths:[],pathsOptions:[],isWorking:!1});function p(e){var t=e.children,p=(0,n._)((0,s.useState)(!0),2),h=p[0],g=p[1],v=(0,n._)((0,s.useState)((0,f.z)()),2),m=v[0],w=v[1],b=(0,n._)((0,s.useState)([]),2),E=b[0],I=b[1],P=(0,n._)((0,s.useState)([]),2),_=P[0],S=P[1],y=(0,l.A)(),A=y.enableImageGroups,T=y.enableDebug,R=(0,u.A)().setError,C=(0,c.h)(),k=C.imageGroups,U=C.images,x=C.setImageGroups,D=(0,s.useMemo)(function(){return A?k:[]},[A,k]),N=(0,o.Y)().path;(0,s.useEffect)(function(){var e=new Worker(r.tu(new URL(r.p+r.u(2819),r.b)),{type:void 0}),t=(0,i.LV)(e),n=[],a=(0,i.BX)(function(e){n.push(e)});return g(!0),t.calculate({imageGroups:D,stateImages:U},a).then(function(e){if(w(e.root),I(e.paths),S(e.pathsOptions),n.length&&R(Error(n.join("\n"))),A&&(console.log(1,k.length,e.paths.length),k.length>e.paths.length)){console.log(2);var t=e.paths.map(function(e){return e.group.id});x(k.filter(function(e){var r=e.id;return t.includes(r)}))}T&&console.info("worker ran for ".concat(e.duration.toFixed(2),"ms"))}).catch(function(e){console.error(e),R(e)}).finally(function(){g(!1),e.terminate()}),function(){e.terminate(),g(!1)}},[T,A,D,R,x,k,U]);var Y=(0,s.useMemo)(function(){var e,t=(null==(e=E.find(function(e){return e.absolutePath===N}))?void 0:e.group)||m,r=t.groups.map(function(e){return e.coverImage}),n=t.images.filter(function(e){return!r.includes(e.hash)});return{view:t,covers:r,paths:E,images:n,pathsOptions:_,root:m,isWorking:h}},[N,E,_,m,h]);return(0,a.jsx)(d.Provider,{value:Y,children:t})}},32521:(e,t,r)=>{"use strict";r.d(t,{U:()=>a,Z:()=>i});var n=r(12115),a=(0,n.createContext)({webSerialActivePorts:[],webSerialIsReceiving:!1,webSerialEnabled:!1,openWebSerial:function(){throw Error("PortsContext is missing")},webUSBActivePorts:[],webUSBIsReceiving:!1,webUSBEnabled:!1,openWebUSB:function(){throw Error("PortsContext is missing")},unknownDeviceResponse:null,hasInactiveDevices:!1,sendDeviceMessage:function(){throw Error("PortsContext is missing")},worker:null}),i=function(){return(0,n.useContext)(a)}},40774:(e,t,r)=>{"use strict";r.d(t,{B:()=>n,Q:()=>a});var n=function(e){return e.CONFIRM_ASK="CONFIRM_ASK",e.CONFIRM_ANSWERED="CONFIRM_ANSWERED",e.ADD_IMAGES="ADD_IMAGES",e.IMPORT_FILES="IMPORT_FILES",e}({}),a=function(e){return e.NUMBER="number",e.STRING="string",e.MULTILINE="multiline",e}({})},41476:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var n=r(86447),a=r(693),i=r(60376),s=r(577),o=r(51368);let u=(0,r(65453).v)(function(e,t){return{progress:[],progressLog:{git:[],dropbox:[]},resetProgressLog:function(){return e({progressLog:{git:[],dropbox:[]}})},startProgress:function(t){var r={id:(0,o.A)(),label:t,value:0};return e(function(e){var t=e.progress;return{progress:(0,s._)(t).concat([r])}}),r.id},setProgress:function(t,r){e(function(e){return{progress:e.progress.map(function(e){return e.id!==t?e:(0,i._)((0,a._)({},e),{value:r})})}})},stopProgress:function(t){e(function(e){return{progress:e.progress.filter(function(e){return e.id!==t})}})},setProgressLog:function(r,o){var u=t().progressLog;e({progressLog:(0,i._)((0,a._)({},u),(0,n._)({},r,[o].concat((0,s._)(u[r]))))})}}})},43178:(e,t,r)=>{Promise.resolve().then(r.bind(r,94116)),Promise.resolve().then(r.bind(r,53585)),Promise.resolve().then(r.bind(r,1607)),Promise.resolve().then(r.bind(r,32134)),Promise.resolve().then(r.bind(r,7119)),Promise.resolve().then(r.bind(r,52588)),Promise.resolve().then(r.bind(r,63669)),Promise.resolve().then(r.bind(r,1441))},45465:(e,t,r)=>{"use strict";r.d(t,{Y:()=>o});var n=r(62570),a=r(12115),i=r(29032),s="/gallery/",o=function(){var e,t=(0,i.j)(),r=t.searchParams,o=t.pathname,u=(0,n._)((0,a.useState)(""),2),c=u[0],l=u[1],f=parseInt(null!=(e=r.get("page"))?e:"1",10)-1,d=r.get("group")||"",p=(0,a.useCallback)(function(e){var t="number"==typeof e.pageIndex?e.pageIndex:f,r="string"==typeof e.group?e.group:d,n="".concat(s,"?page=").concat(t+1);return r.length&&(n="".concat(n,"&group=").concat(r)),n},[f,d]);return(0,a.useEffect)(function(){o===s&&l(p({pageIndex:f,group:d}))},[d,f,o,p]),{pageIndex:f,path:d,lastGalleryLink:c,getUrl:p}}},45686:(e,t,r)=>{"use strict";r.d(t,{n:()=>n});var n=function(e){return e.TESTFILE="testFile",e.CHECKPRINTER="checkPrinter",e.FETCHIMAGES="fetchImages",e.CLEARPRINTER="clearPrinter",e.TEAR="tear",e}({})},47457:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var n=r(97004),a=r(693),i=r(577),s=r(39249),o=r(30832),u=r.n(o),c=r(91540),l=r(12115),f=r(5432),d=r(46498),p=r(11760),h=r(75380),g=r(72623),v=function(e,t){return!!t.find(function(t){var r=t.hashes;return!!r&&Object.values(r).includes(e)})},m=function(e,t){return!!t.find(function(t){return t.hash===e})},w=function(){var e=(0,n._)(function(e){var t,r;return(0,s.YH)(this,function(n){var a,i;switch(n.label){case 0:return t=e.images,r=e.frames,[4,(0,h.ZU)()];case 1:return n.sent(),[4,h.mU.keys()];case 2:return n.sent().forEach((a=t,function(e){v(e,a)||m(e,a)||(0,g.yH)(e)})),[4,h.Uv.keys()];case 3:return n.sent().forEach((i=r,function(e){i.find(function(t){return t.hash===e})||(0,g.t9)(e)})),[2]}})});return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,n._)(function(e){return(0,s.YH)(this,function(t){switch(t.label){case 0:return[4,(0,h.ZU)()];case 1:return t.sent(),[4,h.mU.keys()];case 2:return[2,t.sent().filter(function(e){return!e.startsWith("dummy")}).filter(function(t){return!v(t,e)&&!m(t,e)})]}})});return function(t){return e.apply(this,arguments)}}(),E=function(){var e=(0,n._)(function(e){return(0,s.YH)(this,function(t){switch(t.label){case 0:return[4,(0,h.ZU)()];case 1:return t.sent(),[4,h.Uv.keys()];case 2:return[2,t.sent().filter(function(e){return!e.startsWith("dummy")}).filter(function(t){return!e.find(function(e){return e.hash===t})})]}})});return function(t){return e.apply(this,arguments)}}(),I=r(55364),P=r(50263),_=r(99451),S=function(){var e=(0,n._)(function(e,t){return(0,s.YH)(this,function(r){switch(r.label){case 0:return[4,(0,h.ZU)()];case 1:var a;return r.sent(),[4,Promise.all(e.map((a=(0,n._)(function(e){var r;return(0,s.YH)(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,t.getItem(e)];case 1:if(!(r=n.sent()))return[2,null];return[4,(0,P.U)(r)];case 2:return[2,{hash:e,lines:n.sent().split("\n"),binary:r}];case 3:return n.sent(),[2,null];case 4:return[2]}})}),function(e){return a.apply(this,arguments)})))];case 2:return[2,r.sent().reduce(_.N,[])]}})});return function(t,r){return e.apply(this,arguments)}}();let y=function(){var e,t=(0,d.A)(),r=t.trashCount,o=t.showTrashCount,g=(0,p.h)(),v=g.frames,m=g.images,P=(0,d.A)().updateTrashCount,y=(e=(0,n._)(function(){var e,t,r;return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,b(m)];case 1:return[4,S(n.sent(),h.mU)];case 2:return e=n.sent(),t={},r={state:{images:e.map(function(e){try{return t[e.hash]=e.binary,{hash:e.hash,created:u()().format(f.i$),title:"Backup export ".concat(e.hash),lines:e.lines.length,tags:["backup"],palette:"bw",framePalette:"bw",invertPalette:!1,invertFramePalette:!1,frame:""}}catch(e){return null}}).reduce(I.iy,[]),lastUpdateUTC:Math.floor(new Date().getTime()/1e3),version:p.A}},(0,c.saveAs)(new Blob((0,i._)(JSON.stringify((0,a._)({},r,t),null,2))),"backup_images.json"),[2]}})}),function(){return e.apply(this,arguments)}),A=(0,l.useCallback)((0,n._)(function(){var e,t,r;return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,E(v)];case 1:return[4,S(n.sent(),h.Uv)];case 2:return e=n.sent(),t={},r={state:{frames:e.map(function(e,r){try{return t["frame-".concat(e.hash)]=e.binary,{hash:e.hash,name:"Backup export ".concat(e.hash),id:"bak".concat(r.toString(10).padStart(2,"0"))}}catch(e){return null}}).reduce(_.N,[]),frameGroups:[{id:"bak",name:"Re-imported trash frames"}],lastUpdateUTC:Math.floor(new Date().getTime()/1e3),version:p.A}},(0,c.saveAs)(new Blob((0,i._)(JSON.stringify((0,a._)({},r,t),null,2))),"backup_frames.json"),[2]}})}),[v]),T=(0,l.useCallback)((0,n._)(function(){var e,t;return(0,s.YH)(this,function(r){switch(r.label){case 0:return[4,E(v)];case 1:return e=r.sent().length,[4,b(m)];case 2:return t=r.sent().length,P(e,t),[2]}})}),[v,m,P]),R=(0,l.useCallback)((0,n._)(function(){return(0,s.YH)(this,function(e){switch(e.label){case 0:return[4,w({images:m,frames:v})];case 1:return e.sent(),o(!1),window.requestAnimationFrame(function(){T()}),[2]}})}),[T,v,m,o]);return{showTrashCount:o,purgeTrash:R,downloadImages:y,downloadFrames:A,checkUpdateTrashCount:T,trashCount:r}}},52588:(e,t,r)=>{"use strict";r.d(t,{PluginsContext:()=>k});var n=r(97004),a=r(39249),i=r(95155),s=r(12115),o=r(83936),u=r(633),c=r(11760),l=r(41476),f=r(693),d=r(60376),p=r(15905),h=r(52166),g=r(53982),v=r(18335),m=r(77683),w=r(86964),b=r(55364),E=r(5847),I=function(e){return function(t){var r,i=c.h.getState(),s=i.frames,o=i.palettes,u=h.A.getState().handleExportFrame,l=e.find(function(e){return e.hash===t});if(!l)throw Error("image not found");var I=(0,v.s)(o,l),P=I.palette,_=I.framePalette;if(!P)throw Error("selectedPalette not found");var S=function(){return(0,E.T)(e,s)(l.hash)},y=(0,b.pl)(l),A=(r=(0,n._)(function(){var e,t,r,n,i,o,c,d,h,v,b,E,I,A,T,R,C,k,U,x,D,N,Y,F,H,L,M=arguments;return(0,a.YH)(this,function(a){switch(a.label){case 0:return r=void 0===(t=(e=M.length>0&&void 0!==M[0]?M[0]:{}).scaleFactor)?1:t,i=void 0===(n=e.palette)?P:n,c=void 0===(o=e.framePalette)?_:o,d=e.lockFrame,h=e.invertPalette,v=e.invertFramePalette,E=void 0===(b=e.handleExportFrame)?u:b,[4,S()];case 1:if(I=a.sent(),!(T=s.find(function(e){return e.id===l.frame})))return[3,3];return[4,(0,g.mZ)(T.hash)];case 2:return C=a.sent(),[3,4];case 3:C=null,a.label=4;case 4:if(k=(R=C)?R.upper.length/20:2,!y)return[3,6];return[4,(0,p.y1)({tiles:I,palette:i,lockFrame:void 0!==d?d:l.lockFrame,imageStartLine:k,rotation:l.rotation,scaleFactor:r,handleExportFrame:E},"image/png")];case 5:return A=a.sent(),[3,8];case 6:return U=(null==i?void 0:i.palette)||p.CU,x=(null==c?void 0:c.palette)||p.CU,N=(D=(0,w.f)(l)).invertPalette,Y=D.invertFramePalette,F=(0,m.C)({imagePalette:U,framePalette:x,invertPalette:void 0!==h?h:N,invertFramePalette:void 0!==v?v:Y}),[4,(0,p.Yn)((0,f._)({tiles:I,imageStartLine:k,rotation:l.rotation,scaleFactor:r,handleExportFrame:E},F),"image/png")];case 7:A=a.sent(),a.label=8;case 8:return[4,createImageBitmap(A)];case 9:return H=a.sent(),(L=document.createElement("canvas")).width=H.width,L.height=H.height,L.getContext("2d").drawImage(H,0,0),[2,L]}})}),function(){return r.apply(this,arguments)});return{getMeta:(0,n._)(function(){return(0,a.YH)(this,function(e){return[2,(0,d._)((0,f._)({},l),{isRGBN:y})]})}),getPalette:(0,n._)(function(){return(0,a.YH)(this,function(e){return[2,P]})}),getTiles:S,getCanvas:A}}},P=r(91540),_=r(39630),S=r(40774),y=r(27338),A=function(e,t){var r=e.addImages,i=e.setDialog,s=e.dismissDialog;return{importFiles:(0,y.A)(t),setDialog:i,alert:function(e,t){return i({message:"Plugin: ".concat(e),questions:function(){return[{label:t,key:"info",type:_.V.INFO}]},confirm:(0,n._)(function(){return(0,a.YH)(this,function(e){return[2,s(0)]})})})},dismissDialog:function(){return s(0)},addImages:r}},T=function(e,t){var r=A(e,t),n=r.setDialog,a=r.dismissDialog,i=r.importFiles,s=r.addImages,o=r.alert;return{dispatch:function(e){switch(console.warn('You are using a legacy method: "dispatch('.concat(e.type,')". Please refer to "env.functions" from your plugin to switch to up-to-date methods')),e.type){case S.B.CONFIRM_ASK:n(e.payload);break;case S.B.CONFIRM_ANSWERED:a();break;case S.B.IMPORT_FILES:i(e.payload.files);break;case S.B.ADD_IMAGES:s(e.payload);break;default:o("Plugin error:",'Unhandled Compatibility Action (type:"'.concat(e.type,'")'))}}}},R=function(e,t){var r=e.startProgress,n=e.setProgress,a=e.stopProgress,i=e.addUpdatePluginProperties,s=e.collectImageData,o=e.stores,u=e.importFn,c=t.url,l=t.config,f=void 0===l?{}:l,d="",p=function(e){var i=Math.min(1,Math.max(0,e));if(d&&(0===i||1===i)){a(d),d="";return}d||(d=r(t.name||"Plugin")),n(d,i)};return new Promise(function(e){window.gbpwRegisterPlugin=function(t){if(window.gbpwRegisterPlugin=function(){},!t)return void e(null);try{var r=new t({saveAs:P.saveAs,progress:p,store:T(o,u),functions:A(o,u),collectImageData:s},f),n=r.name,a=r.description,l=r.configParams,d=r.config;i({url:c,name:n,description:void 0===a?"":a,configParams:void 0===l?{}:l,config:void 0===d?{}:d,loading:!1,error:!1}),e(r)}catch(t){i({url:c,loading:!1,error:null==t?void 0:t.message}),e(null)}};var t=document.createElement("script");document.head.appendChild(t),t.addEventListener("error",function(){window.gbpwRegisterPlugin=function(){},i({url:c,loading:!1,error:"Loading error"}),e(null)}),t.src=c})},C=r(6617);function k(e){var t,r=e.children,f=(0,c.h)(),d=f.plugins,p=f.images,h=f.addUpdatePluginProperties,g=(0,u.g)(),v=(0,l.A)(),m=v.startProgress,w=v.setProgress,b=v.stopProgress,E=(0,o.W)().jsonImport,P=(0,s.useMemo)(function(){return{collectImageData:I(p),addUpdatePluginProperties:h,startProgress:m,setProgress:w,stopProgress:b,stores:g,importFn:E}},[p,h,m,w,b,g,E]),_=(0,s.useMemo)(function(){var e;return e=(0,n._)(function(e){return(0,a.YH)(this,function(t){return[2,R(P,d.find(function(t){return t.url===e})||{url:""})]})}),function(t){return e.apply(this,arguments)}},[P,d]),S=(0,s.useCallback)((t=(0,n._)(function(e){return(0,a.YH)(this,function(t){switch(t.label){case 0:return[4,R(P,e)];case 1:return[2,!!t.sent()]}})}),function(e){return t.apply(this,arguments)}),[P]),y=(0,s.useMemo)(function(){var e,t;return{runWithImage:(e=(0,n._)(function(e,t){var r,n;return(0,a.YH)(this,function(a){switch(a.label){case 0:return n=I(p)(t),[4,_(e)];case 1:return null==(r=a.sent())||r.withImage(n),[2]}})}),function(t,r){return e.apply(this,arguments)}),runWithImages:(t=(0,n._)(function(e,t){var r,n;return(0,a.YH)(this,function(a){switch(a.label){case 0:return n=t.map(I(p)),[4,_(e)];case 1:return null==(r=a.sent())||r.withSelection(n),[2]}})}),function(e,r){return t.apply(this,arguments)}),validateAndAddPlugin:S}},[_,p,S]);return(0,i.jsx)(C.i.Provider,{value:y,children:r})}},53585:(e,t,r)=>{"use strict";r.d(t,{default:()=>E});var n,a=r(12115),i=r(97004),s=r(577),o=r(39249),u=r(83936),c=r(46498),l=r(27338),f=!1;let d=function(){var e=(0,c.A)(),t=e.setDragover,r=e.setError,d=(0,u.W)().jsonImport,p=(0,a.useMemo)(function(){return(0,l.A)(d)},[d]),h=(0,a.useCallback)(function(){var e,a=function(e){e.preventDefault(),f||t(!0),window.clearTimeout(n),f=!0,n=window.setTimeout(function(){f=!1,t(!1)},250)},u=(e=(0,i._)(function(e){var t,n,a;return(0,o.YH)(this,function(i){switch(i.label){case 0:e.preventDefault(),(n=e.dataTransfer.items)?t=(0,s._)(n).reduce(function(e,t){if("file"===t.kind){var r=t.getAsFile();return r?(0,s._)(e).concat([r]):e}return e},[]):(a=e.dataTransfer.files,t=(0,s._)(a)),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,p(t)];case 2:return i.sent(),[3,4];case 3:return r(i.sent()),[3,4];case 4:return[2]}})}),function(t){return e.apply(this,arguments)}),c=document.querySelector("body");if(!c)throw Error("dafuq?");return c.addEventListener("dragover",a),c.addEventListener("drop",u),function(){c.removeEventListener("dragover",a),c.removeEventListener("drop",u)}},[p,t,r]);(0,a.useEffect)(h,[h])};var p=r(62570),h=r(35695),g=r(45465),v=function(){var e=(0,g.Y)().getUrl,t=window.location.hash.length<2?"":window.location.hash;(0,a.useEffect)(function(){if(t){var r=t.slice(1).split("/").filter(Boolean),n=r[0],a="";switch(n){case"gallery":var i,s=(0,p._)(r.slice(-2),2),o=s[0],u=s[1];(i="page"===o?r.slice(1,-2).join("/"):r.slice(1).join("/")).length||(null==u?void 0:u.length)?(i.length&&(i="".concat(i,"/")),a=e({group:i,pageIndex:parseInt(u,10)-1})):a="/gallery/";break;case"add-plugin":a="add-plugin/?pluginUrl=".concat(r.slice(1).join("/"));break;case"settings":var c=r[1];a="settings/".concat(c,"/");break;case"home":break;default:(null==n?void 0:n.length)&&(a="".concat(r.join("/"),"/"))}window.location.hash="",window.setTimeout(function(){(0,h.redirect)(a)},10)}},[e,t])},m=r(633),w=r(47457),b=r(933);let E=function(e){var t=e.children;d(),v();var r=(0,m.g)(),n=(0,u.W)().remoteImport;(0,a.useEffect)(function(){return(0,(0,b.E)(r,n).subscribe)()},[n,r]);var i=(0,w.A)().checkUpdateTrashCount;return(0,a.useEffect)(function(){var e=window.setTimeout(function(){i()},1);return function(){return window.clearTimeout(e)}},[i]),t}},63669:(e,t,r)=>{"use strict";r.d(t,{PortsContext:()=>P});var n=r(97004),a=r(62570),i=r(577),s=r(39249),o=r(95155),u=r(12115),c=r(9718),l=r(39630),f=r(41186),d=r(52166),p=[2400,4800,9600,19200,28800,38400,57600,76800,115200,230400,25e4,460800,576e3,921600,1e6],h=function(){var e=(0,f.A)(),t=e.setDialog,r=e.dismissDialog,a=(0,d.A)().setLastBaudRate;return{querySettings:(0,u.useCallback)(function(){var e=d.A.getState().lastBaudRate;return new Promise(function(i){var o;t({confirm:(o=(0,n._)(function(e){var t;return(0,s.YH)(this,function(n){return r(0),i({baudRate:t=parseInt((null==e?void 0:e.baudRate)||"115200",10)}),a(t),[2]})}),function(e){return o.apply(this,arguments)}),deny:(0,n._)(function(){return(0,s.YH)(this,function(e){return r(0),i(null),[2]})}),message:"Specify Baudrate for Port",questions:function(){return[{key:"baudRate",label:"Baud Rate",type:l.V.SELECT,options:p.map(function(t){return{value:t.toString(10),name:t.toString(10),selected:t===e}})}]}})})},[r,t,a])}},g=r(64768);let v=function(){var e=(0,g.A)().handleFileImport;return(0,u.useCallback)(function(t){e([new File((0,i._)(t),"Text input.txt",{type:"text/plain"})])},[e])};var m=r(46498),w=function(e){var t=e.filter(Boolean),r=new Uint8Array(t.reduce(function(e,t){return e+t.length},0)),n=0,a=!0,i=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var c=o.value;r.set(c,n),n+=c.length}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}return r},b=function(e){var t=e.filter(Boolean);return{bytes:w(t.map(function(e){return e.bytes})),deviceId:t[0].deviceId,portDeviceType:t[0].portDeviceType,string:t.map(function(e){return e.string}).join("")}},E=r(80360),I=r(32521);function P(e){var t=e.children,l=(0,a._)((0,u.useState)(null),2),f=l[0],d=l[1],p=(0,a._)((0,u.useState)(!1),2),g=p[0],w=p[1],P=(0,a._)((0,u.useState)(!1),2),_=P[0],S=P[1],y=(0,a._)((0,u.useState)([]),2),A=y[0],T=y[1],R=(0,a._)((0,u.useState)(!1),2),C=R[0],k=R[1],U=(0,a._)((0,u.useState)([]),2),x=U[0],D=U[1],N=(0,a._)((0,u.useState)(!1),2),Y=N[0],F=N[1],H=(0,a._)((0,u.useState)(null),2),L=H[0],M=H[1],O=(0,a._)((0,u.useState)(null),2),B=O[0],G=O[1],W=(0,u.useRef)(0),j=v(),q=h().querySettings,K=(0,m.A)().setError;(0,u.useEffect)(function(){var e,t=new Worker(r.tu(new URL(r.p+r.u(3143),r.b)));return t.addEventListener("message",(e=(0,n._)(function(e){var r,n,a,o;return(0,s.YH)(this,function(s){switch(s.label){case 0:switch((r=e.data).type){case c.OU.ENABLED_STATE:return[3,1];case c.OU.ERROR:return[3,2];case c.OU.PORTS_CHANGE:return[3,3];case c.OU.DATA:return[3,4];case c.OU.RECEIVING:return[3,5];case c.OU.QUESTION:return[3,6]}return[3,8];case 1:return w(r.webSerialEnabled),S(r.webUSBEnabled),[3,9];case 2:return K(Error(r.errorMessage)),[3,9];case 3:switch(r.portType){case c.qt.SERIAL:D(r.activePorts);break;case c.qt.USB:T(r.activePorts)}return[3,9];case 4:switch(r.readResults[0].portDeviceType){case c._Y.PACKET_CAPTURE:G(function(e){return b([e].concat((0,i._)(r.readResults)))}),M(null);break;case c._Y.SUPER_PRINTER_INTERFACE:M(null);break;case c._Y.INACTIVE:case c._Y.UNKNOWN:default:M(function(e){return b([e].concat((0,i._)(r.readResults)))})}return[3,9];case 5:if(r.portDeviceType===c._Y.PACKET_CAPTURE)switch(r.portType){case c.qt.SERIAL:F(!0);break;case c.qt.USB:k(!0)}return[3,9];case 6:return n=r.questionId,[4,q()];case 7:return a=s.sent(),o={portType:c.qt.SERIAL,type:c.vx.ANSWER,questionId:n,response:a},t.postMessage(o),[3,9];case 8:return[3,9];case 9:return[2]}})}),function(t){return e.apply(this,arguments)})),t.addEventListener("error",function(e){K(Error(e.message))}),d(t),function(){t.terminate(),d(null)}},[q,K]);var V=(0,u.useMemo)(function(){return!!(0,i._)(A).concat((0,i._)(x)).find(function(e){return e.portDeviceType===c._Y.INACTIVE})},[x,A]),Z=(0,u.useCallback)((0,n._)(function(){var e;return(0,s.YH)(this,function(t){switch(t.label){case 0:if(!(g&&f))return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,navigator.serial.requestPort()];case 2:return t.sent().readable&&K(Error("device already opened")),e={type:c.vx.OPEN,portType:c.qt.SERIAL},f.postMessage(e),[3,4];case 3:return t.sent(),[3,4];case 4:return[2]}})}),[K,g,f]),z=(0,u.useCallback)((0,n._)(function(){var e;return(0,s.YH)(this,function(t){switch(t.label){case 0:if(!(_&&f))return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,navigator.usb.requestDevice({filters:c.k4})];case 2:return t.sent().opened&&K(Error("device already opened")),e={type:c.vx.OPEN,portType:c.qt.USB},f.postMessage(e),[3,4];case 3:return t.sent(),[3,4];case 4:return[2]}})}),[K,_,f]),J=(0,u.useCallback)(function(e,t,r,n){if(!f)throw Error("no worker");var a=(0,E.z)(),i={type:c.vx.SEND_DATA,deviceId:t,message:e,messageId:a,readParamss:r,flush:n};return new Promise(function(e){var t=function(r){var n=r.data;n.type===c.OU.DATA&&n.replyToMessageId===a&&(f.removeEventListener("message",t),e(n.readResults))};f.addEventListener("message",t),f.postMessage(i)})},[f]);(0,u.useEffect)(function(){if(B)return window.clearTimeout(W.current),W.current=window.setTimeout(function(){if(B.string.length){var e=B.string;G(null),F(!1),k(!1),j(e)}},250),function(){window.clearTimeout(W.current)}},[B,j]);var Q=(0,u.useMemo)(function(){return{hasInactiveDevices:V,openWebSerial:Z,openWebUSB:z,sendDeviceMessage:J,unknownDeviceResponse:L,webSerialActivePorts:x,webSerialEnabled:g,webSerialIsReceiving:Y,webUSBActivePorts:A,webUSBEnabled:_,webUSBIsReceiving:C,worker:f}},[V,Z,z,J,L,x,g,Y,A,_,C,f]);return(0,o.jsx)(I.U.Provider,{value:Q,children:t})}},95939:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r(12115),a=r(32134),i=function(){return(0,n.useContext)(a.K)}}},e=>{var t=t=>e(e.s=t);e.O(0,[4453,7271,4831,5394,9758,4723,1760,3936,6950,4768,8441,5955,1684,7358],()=>t(43178)),_N_E=e.O()}]);