(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7437],{11081:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});var r=function(e){return e.CHECKBOX="checkbox",e.SELECT="select",e.TEXT="text",e.NUMBER="number",e.INFO="info",e.IMAGE="image",e.META="meta",e}({})},14217:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});var r=n(74879).A},32614:(e,t,n)=>{"use strict";n.d(t,{D:()=>p,EnvProvider:()=>g});var r=n(61975),u=n(82732),i=n(45849),o=n(22043),a=n(71450),s=n(95155),l=n(12115),c=n(10022),f=n(94468),d=(0,l.createContext)(null),p=function(){return(0,l.useContext)(d)},g=function(e){var t=e.children,n=(0,o._)((0,l.useState)(null),2),p=n[0],g=n[1],v=(0,c.C$)().setPrinterUrl;return(0,l.useEffect)(function(){var e=["/gb-printer-web","/env.json"].filter(Boolean).join("/");e&&(0,r._)(function(){var t,n,r,o;return(0,a.YH)(this,function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),[4,(0,f.ZU)()];case 1:return a.sent(),[4,fetch(e)];case 2:return[4,a.sent().json()];case 3:return t=a.sent(),r=[(0,u._)({},t)],o={},[4,f.mU.driver()];case 4:return"esp8266"===(n=i._.apply(void 0,r.concat([(o.localforage=a.sent(),o)]))).env&&v("/"),g(n),[3,6];case 5:return a.sent(),g({version:"0.0.0",maximages:0,localforage:"error",env:"error",fstype:"-",bootmode:"-",oled:!1}),[3,6];case 6:return[2]}})})()},[v]),(0,s.jsx)(d.Provider,{value:p,children:t})}},38584:(e,t,n)=>{Promise.resolve().then(n.bind(n,78119))},40433:(e,t,n)=>{"use strict";n.d(t,{j:()=>f});var r=n(61975),u=n(22043),i=n(71450),o=n(12115),a=n(30986),s=(0,a.A)("percentage",a.U.DESC),l=function(){var e=0;for(var t in localStorage)if(localStorage.hasOwnProperty(t)){var n=localStorage.getItem(t);null!==n&&(e+=t.length+n.length)}return e},c=function(){var e="__test_localStorage_limit__",t=0,n=0xf00000,r=0;try{for(;t<=n;){var u=Math.floor((t+n)/2),i="A".repeat(u);try{localStorage.setItem(e,i),r=u,t=u+1}catch(e){n=u-1}}}finally{localStorage.removeItem(e)}return r},f=function(){var e=(0,u._)((0,o.useState)([]),2),t=e[0],n=e[1];return(0,o.useEffect)(function(){window.setTimeout(function(){return(0,r._)(function(){var e,t,r,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:return[4,null==(e=navigator.storage)?void 0:e.estimate()];case 1:return t=i.sent()||null,n([{type:"localStorage",total:u=(r=l())+c(),used:r,percentage:r/u*100},{type:"indexedDB",total:(null==t?void 0:t.quota)||0,used:(null==t?void 0:t.usage)||0,percentage:u?((null==t?void 0:t.usage)||0)/((null==t?void 0:t.quota)||1)*100:100}]),[2]}})})()},10)},[]),{criticalStorageEstimate:s(t.filter(function(e){return e.percentage>75}))[0]||null,storageEstimate:t}}},55703:(e,t,n)=>{"use strict";n.d(t,{T:()=>r});var r=function(e){return e.GAPI_SHEETS="gapiSheets",e}({})},65301:(e,t,n)=>{"use strict";n.d(t,{t:()=>d});var r=n(61975),u=n(71450),i=n(18955),o=n(12115),a=n(56265),s=n(11081),l=n(89386),c=n(96112),f=n(10022),d=function(){var e=(0,i.c)("useImageGroups"),t=(0,l.Z)().view,n=(0,f.M2)(),d=n.dismissDialog,p=n.setDialog,g=(0,f.vT)().setEditImageGroup,v=(0,f.Vs)(),h=v.deleteImageGroup,m=v.setImageGroups,I=v.images,E=(0,f.cr)().imageSelection,_=(0,o.useMemo)(function(){if(!E.length)return"";var t,n=I.filter(function(e){var t=e.hash;return E.includes(t)}).map(function(e){return e.title}).filter(function(e){return e.length>3}),r=null==(t=(0,a.Hg)(n).filter(function(e){return e.length>3})[0])?void 0:t.trim();return r?r.replace(/[_-]/g," ").replace(/^\s*\d+\s+|\s+\d+\s*$/g,"").trim():e("newGroupDefault")},[E,I,e]);return{resetGroups:function(){p({message:e("resetGroupsMessage"),questions:function(){return[{key:"info",type:s.V.INFO,label:e("resetGroupsInfo")}]},confirm:function(){return(0,r._)(function(){return(0,u.YH)(this,function(e){return d(0),m([]),[2]})})()},deny:function(){return(0,r._)(function(){return(0,u.YH)(this,function(e){return d(0),[2]})})()}})},createGroup:function(e){g({groupId:c.Ll,newGroupCover:e,newGroupTitle:_})},editGroup:function(e){g({groupId:e})},deleteGroup:function(n){var i=t.groups.find(function(e){return e.id===n});i&&p({message:e("deleteGroupMessage"),questions:function(){return[{key:"info",type:s.V.INFO,label:e("deleteGroupInfo",{groupTitle:i.title||i.slug})}]},confirm:function(){return(0,r._)(function(){return(0,u.YH)(this,function(e){return d(0),h(n),[2]})})()},deny:function(){return(0,r._)(function(){return(0,u.YH)(this,function(e){return d(0),[2]})})()}})}}}},78119:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>L});var r=n(95155),u=n(41574),i=n(41942),o=n(80317),a=n(18955),s=n(45377),l=n(32893),c=n.n(l),f=n(12115),d=n(32614),p=n(40433);let g=function(){var e=(0,d.D)(),t=(0,a.c)("EnvInfo"),n=(0,p.j)().storageEstimate,u=(0,f.useMemo)(function(){return e?[t("appVersion",{value:"1.53.0"}),t("appBranch",{value:"master"}),t("printerVersion",{value:e.version}),t("maxImages",{value:e.maximages}),t("storageDriver",{value:e.localforage})].concat((0,s._)(n.map(function(e){return t("storageEstimate",{type:e.type,total:c()(e.total),used:c()(e.used),percentage:e.percentage.toFixed(2)})})),[t("envType",{value:e.env}),t("filesystem",{value:e.fstype}),t("bootmode",{value:e.bootmode}),t("hasOled",{value:e.oled?t("yes"):t("no")})]):[]},[e,n,t]);return(0,r.jsx)(i.A,{component:"ul",direction:"column",children:u.map(function(e){return(0,r.jsx)(o.A,{component:"li",variant:"caption",color:"textDisabled",align:"right",lineHeight:1.25,children:e},e)})})};var v=n(64647),h=n(32968),m=n(46544),I=n(65301),E=n(83231),_=n(61975),S=n(22043),T=n(71450),G=function(e){return e.PERSISTED="persisted",e.NOT_PERSISTED="not-persisted",e.FAILED="failed",e.NO_API="no_api",e}({}),P=!!("undefined"!=typeof navigator&&navigator.storage&&navigator.storage.persist);let b=function(){var e=(0,S._)((0,f.useState)("not-persisted"),2),t=e[0],n=e[1];return(0,f.useEffect)(function(){(0,_._)(function(){return(0,T.YH)(this,function(e){switch(e.label){case 0:if(!P)return[3,2];return[4,navigator.storage.persisted()];case 1:return n(e.sent()?"persisted":"not-persisted"),[3,3];case 2:n("no_api"),e.label=3;case 3:return[2]}})})()},[]),{persistAPIAvailable:P,persisted:t,requestPersist:function(){return(0,_._)(function(){return(0,T.YH)(this,function(e){return(0,_._)(function(){return(0,T.YH)(this,function(e){switch(e.label){case 0:if(!P)return[3,2];return[4,navigator.storage.persist()];case 1:return n(e.sent()?"persisted":"failed"),[3,3];case 2:n("no_api"),e.label=3;case 3:return[2]}})})(),[2]})})()}}};var x=function(e){switch(e){case G.PERSISTED:return"persistState.isPersistent";case G.NOT_PERSISTED:return"persistState.requestPersistence";case G.NO_API:return"persistState.apiUnavailable";case G.FAILED:default:return"persistState.failed"}};let A=function(){var e=(0,E.W)().downloadSettings,t=(0,a.c)("ExportSettings"),n=(0,I.t)().resetGroups,u=function(t){return e(t)},i=b(),o=i.persisted,s=i.requestPersist;return(0,r.jsxs)(h.A,{variant:"contained",fullWidth:!0,children:[(0,r.jsx)(v.A,{title:t(x(o)),disabled:o!==G.NOT_PERSISTED,onClick:s,children:t(x(o))}),(0,r.jsx)(v.A,{title:t("resetGroups"),onClick:n,children:t("resetGroups")}),(0,r.jsx)(v.A,{title:t("exportAll"),onClick:function(){return u(m.m.ALL)},children:t("exportAll")}),(0,r.jsx)(v.A,{title:t("exportPlugins"),onClick:function(){return u(m.m.PLUGINS)},children:t("exportPlugins")})]})};var N=n(75416),w=n(86586),C=n(52619),D=n.n(C),y=n(20063),j=n(10022),M=n(81200),O=n(55703),H=n(95704);let k=function(){var e=(0,y.usePathname)(),t=(0,j.C$)().featureFlags,n=(0,d.D)(),u=(0,a.c)("SettingsTabs"),i=(0,f.useMemo)(function(){return[{path:"/settings/generic/",headline:u("genericSettings"),prefetch:!0},H.env.NEXT_PUBLIC_GOOGLE_OAUTH_CLIENT_ID&&H.env.NEXT_PUBLIC_GOOGLE_SCOPE&&t.includes(O.T.GAPI_SHEETS)?{path:"/settings/gsheets/",headline:u("gapiSheetsSettings"),prefetch:!1}:null,{path:"/settings/dropbox/",headline:u("dropboxSettings"),prefetch:!1},(null==n?void 0:n.env)==="esp8266"||(null==n?void 0:n.env)==="webpack-dev"?{path:"/settings/wifi/",headline:u("wifiSettings"),prefetch:!1}:null,{path:"/settings/plugins/",headline:u("pluginSettings"),prefetch:!1},{path:"/settings/git/",headline:u("gitSettings"),prefetch:!1}].reduce(M.N,[])},[u,t,null==n?void 0:n.env]),o=(0,f.useMemo)(function(){return i.length&&"/settings"!==e&&-1!==i.findIndex(function(t){return t.path===e})?e:null},[e,i]);return o?(0,r.jsx)(w.A,{value:o,children:i.map(function(e){var t=e.headline,n=e.path,u=e.prefetch;return(0,r.jsx)(N.A,{label:t,component:D(),href:n,prefetch:u,value:n},n)})}):null};function L(e){var t,n,s,l=e.children,c=(0,a.c)("Navigation"),d=(n=(t=(0,S._)((0,f.useState)(!1),2))[0],s=t[1],(0,f.useEffect)(function(){if("function"==typeof window.requestIdleCallback){var e=requestIdleCallback(function(){return s(!0)});return function(){window.cancelIdleCallback(e)}}var t=window.setTimeout(function(){return s(!0)},1e3);return function(){window.clearTimeout(t)}},[]),n);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{component:"h1",variant:"h1",children:c("settings")}),d&&(0,r.jsxs)(i.A,{direction:"column",gap:4,justifyContent:"space-between",sx:{flexGrow:1},children:[(0,r.jsxs)(i.A,{direction:"column",gap:6,children:[(0,r.jsx)(k,{}),(0,r.jsx)(u.A,{children:l}),(0,r.jsx)(A,{})]}),(0,r.jsx)(g,{})]})]})}},96112:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>I,BF:()=>v,Ll:()=>g});var r=n(61975),u=n(82732),i=n(45849),o=n(22043),a=n(71450),s=n(12115),l=n(89386),c=n(4599),f=n(10022),d=n(14217),p=n(71667),g="NEW_GROUP",v=function(e){return e.trim().replace(/[^A-Z0-9_-]+/gi,"_").toLowerCase()},h=function(e,t){return e.find(function(e){return e.group.groups.find(function(e){return e.id===t})})||null},m=function(e){return e.CREATE_NEW="CREATE_NEW",e.EDIT_EXISTING="EDIT_EXISTING",e.NOT_EDITING="NOT_EDITING",e}(m||{});let I=function(){var e,t=(0,f.cr)().imageSelection,n=(0,f.vT)(),m=n.editImageGroup,I=n.cancelEditImageGroup,E=(0,f.Vs)(),_=E.imageGroups,S=E.addImageGroup,T=E.updateImageGroup,G=E.groupImagesAdd,P=E.ungroupImages,b=(0,c.g)(),x=b.navigateToGroup,A=b.navigateToImage,N=(0,l.Z)(),w=N.path,C=N.view,D=N.paths,y=N.pathsOptions,j=t.length,M=(null==m?void 0:m.groupId)?m.groupId===g?"CREATE_NEW":"EDIT_EXISTING":"NOT_EDITING",O=(0,s.useMemo)(function(){switch(M){case"CREATE_NEW":var e=(null==m?void 0:m.newGroupTitle)||"";return{imageGroup:null,parentPathMap:D.find(function(e){return e.group.id===C.id})||null,title:e,slug:v(e),slugTouched:!1};case"EDIT_EXISTING":var t=_.find(function(e){return e.id===(null==m?void 0:m.groupId)})||null;return{imageGroup:t,parentPathMap:(null==m?void 0:m.groupId)?h(D,m.groupId):null,title:(null==t?void 0:t.title)||"",slug:(null==t?void 0:t.slug)||"",slugTouched:!0};default:return{imageGroup:null,parentPathMap:null,title:"",slug:"",slugTouched:!1}}},[m,M,_,D,C]),H=(0,o._)((0,s.useState)(O.title),2),k=H[0],L=H[1],R=(0,o._)((0,s.useState)(O.slug),2),U=R[0],W=R[1],X=(0,o._)((0,s.useState)(O.slugTouched),2),Y=X[0],q=X[1],F=(0,o._)((0,s.useState)((null==(e=O.parentPathMap)?void 0:e.absolutePath)||""),2),B=F[0],V=F[1],Z=(0,s.useMemo)(function(){if(!(null==m?void 0:m.groupId))return"";if((null==m?void 0:m.groupId)===g)return"".concat(w).concat(U,"/");var e=h(D,m.groupId),t=(null==e?void 0:e.absolutePath)||"";return"".concat(t).concat(U,"/")},[m,D,w,U]),$=(0,s.useMemo)(function(){return!!D.find(function(e){return e.absolutePath===Z})},[Z,D]),z=(0,s.useMemo)(function(){var e;return U!==(null==(e=O.imageGroup)?void 0:e.slug)},[O,U]),J=(0,s.useMemo)(function(){return!!U&&("CREATE_NEW"===M?!$:"EDIT_EXISTING"===M&&(!z||!$))},[M,U,$,z]),K=(0,s.useMemo)(function(){var e,t,n=(null==(e=D.find(function(e){return e.absolutePath===B}))?void 0:e.group.id)||"";return((null==(t=O.parentPathMap)?void 0:t.group.id)||"")!==n},[O,B,D]),Q=(0,s.useMemo)(function(){switch(M){case"EDIT_EXISTING":var e,t=(null==(e=D.find(function(e){return e.group.id===(null==m?void 0:m.groupId)}))?void 0:e.absolutePath)||"";return y.filter(function(e){var n=e.value;return!n.startsWith(Z)&&n!==t});case"CREATE_NEW":return y;default:return[]}},[Z,m,M,D,y]);return{editId:(null==m?void 0:m.groupId)||null,absoluteSlug:Z,possibleParents:Q,slug:U,title:k,canConfirm:J,canMove:K,slugIsInUse:$,slugWasChanged:z,parentSlug:B,selectionCount:j,setSlug:function(e){W(e),q(!0)},setTitle:function(e){L(e),(e.length<2||!Y)&&(q(!1),W(v(e)))},setParentSlug:V,confirm:function(){if(I(),J&&m){var e,n=(null==(e=D.find(function(e){return e.absolutePath===B}))?void 0:e.group.id)||"";if(m.groupId===g){if(!m.newGroupCover)return;var r=(0,d.z)();S({id:r,slug:U,title:k,created:(0,p.J)(),coverImage:m.newGroupCover,images:t,groups:[]},n),x(r,0)}else{if(!O.imageGroup)return;T((0,i._)((0,u._)({},O.imageGroup),{slug:U,title:k}),n),x(m.groupId,0)}}},move:function(){return(0,r._)(function(){var e,n;return(0,a.YH)(this,function(r){return I(),K&&((n=(null==(e=D.find(function(e){return e.absolutePath===B}))?void 0:e.group.id)||"")?G(n,t):P(t),A(t[0])),[2]})})()},cancelEditImageGroup:I}}}},e=>{e.O(0,[5266,7400,8955,3632,317,1346,4647,2968,7164,8428,6685,6265,1934,4468,3231,4599,8441,9342,1255,7358],()=>e(e.s=38584)),_N_E=e.O()}]);