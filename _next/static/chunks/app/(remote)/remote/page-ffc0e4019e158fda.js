(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4021],{20063:(e,n,t)=>{"use strict";var r=t(47260);t.o(r,"RedirectType")&&t.d(n,{RedirectType:function(){return r.RedirectType}}),t.o(r,"redirect")&&t.d(n,{redirect:function(){return r.redirect}}),t.o(r,"usePathname")&&t.d(n,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(n,{useRouter:function(){return r.useRouter}}),t.o(r,"useServerInsertedHTML")&&t.d(n,{useServerInsertedHTML:function(){return r.useServerInsertedHTML}})},21860:(e,n,t)=>{var r=t(95704);e.exports=t(r.env.PROMISE_QUEUE_COVERAGE?49901:29372)},25969:(e,n,t)=>{"use strict";t.d(n,{j:()=>u});var r=t(22043),o=t(20063),s=t(12115),u=function(){var e=(0,o.usePathname)(),n=(0,r._)((0,s.useState)(window.location.search),2),t=n[0],u=n[1],i=(0,s.useMemo)(function(){return new URLSearchParams(t)},[t]);(0,s.useEffect)(function(){var e=function(){window.setTimeout(function(){u(function(e){return window.location.search!==e?window.location.search:e})},1)};e(),window.addEventListener("popstate",e);var n=history.pushState,t=history.replaceState;return history.pushState=function(){for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];n.apply(this,r),e()},history.replaceState=function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];t.apply(this,r),e()},function(){window.removeEventListener("popstate",e),history.pushState=n,history.replaceState=t}},[i,e]);var a=(0,s.useMemo)(function(){return i.toString()},[i]);return{fullPath:(0,s.useMemo)(function(){return a?"".concat(e,"?").concat(a):e},[e,a]),pathname:e,query:a,searchParams:i}}},29372:function(e,n,t){var r,o;!function(s,u){"use strict";e.exports&&1?e.exports=u():void 0===(o="function"==typeof(r=u)?r.call(n,t,n,e):r)||(e.exports=o)}(0,function(){"use strict";var e="undefined"!=typeof Promise?Promise:function(){return{then:function(){throw Error("Queue.configure() before use Queue")}}},n=function(){};function t(e,n,t){this.options=t=t||{},this.pendingPromises=0,this.maxPendingPromises=void 0!==e?e:1/0,this.maxQueuedPromises=void 0!==n?n:1/0,this.queue=[]}return t.configure=function(n){e=n},t.prototype.add=function(t){var r=this;return new e(function(e,o,s){if(r.queue.length>=r.maxQueuedPromises)return void o(Error("Queue limit reached"));r.queue.push({promiseGenerator:t,resolve:e,reject:o,notify:s||n}),r._dequeue()})},t.prototype.getPendingLength=function(){return this.pendingPromises},t.prototype.getQueueLength=function(){return this.queue.length},t.prototype._dequeue=function(){var n,t=this;if(this.pendingPromises>=this.maxPendingPromises)return!1;var r=this.queue.shift();if(!r)return this.options.onEmpty&&this.options.onEmpty(),!1;try{this.pendingPromises++,((n=r.promiseGenerator())&&"function"==typeof n.then?n:new e(function(e){e(n)})).then(function(e){t.pendingPromises--,r.resolve(e),t._dequeue()},function(e){t.pendingPromises--,r.reject(e),t._dequeue()},function(e){r.notify(e)})}catch(e){t.pendingPromises--,r.reject(e),t._dequeue()}return!0},t})},32614:(e,n,t)=>{"use strict";t.d(n,{D:()=>p,EnvProvider:()=>m});var r=t(61975),o=t(82732),s=t(45849),u=t(22043),i=t(71450),a=t(95155),c=t(12115),f=t(10022),d=t(94468),h=(0,c.createContext)(null),p=function(){return(0,c.useContext)(h)},m=function(e){var n=e.children,t=(0,u._)((0,c.useState)(null),2),p=t[0],m=t[1],l=(0,f.C$)().setPrinterUrl;return(0,c.useEffect)(function(){var e=["/gb-printer-web","/env.json"].filter(Boolean).join("/");e&&(0,r._)(function(){var n,t,r,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),[4,(0,d.ZU)()];case 1:return i.sent(),[4,fetch(e)];case 2:return[4,i.sent().json()];case 3:return n=i.sent(),r=[(0,o._)({},n)],u={},[4,d.mU.driver()];case 4:return"esp8266"===(t=s._.apply(void 0,r.concat([(u.localforage=i.sent(),u)]))).env&&l("/"),m(t),[3,6];case 5:return i.sent(),m({version:"0.0.0",maximages:0,localforage:"error",env:"error",fstype:"-",bootmode:"-",oled:!1}),[3,6];case 6:return[2]}})})()},[l]),(0,a.jsx)(h.Provider,{value:p,children:n})}},34164:(e,n,t)=>{"use strict";t.d(n,{default:()=>S});var r=t(82732),o=t(45849),s=t(95155),u=t(18955),i=t(12115),a=t(22043),c=t(32614),f=t(25969),d=t(61975),h=t(71450),p=t(45407),m=t(45377);let l=function(){return(0,d._)(function(){var e;return(0,h.YH)(this,function(n){switch(n.label){case 0:return[4,fetch("/dumps/list")];case 1:return[4,n.sent().json()];case 2:if((e=n.sent()).fs&&e.fs.dumpcount!==e.dumps.length)throw Error("Inconststent image count received from printer.");return[2,{printerData:(0,o._)((0,r._)({},e),{dumps:(0,m._)(e.dumps).sort()})}]}})})()},v=function(){return(0,d._)(function(){return(0,h.YH)(this,function(e){switch(e.label){case 0:return[4,fetch("/dumps/clear")];case 1:return[4,e.sent().json()];case 2:if(void 0!==e.sent().deleted)return[2,l()];throw Error("error while deleting images")}})})()};var w=t(21860),E=t.n(w),P=function(e,n){return(0,d._)(function(){var t,r,o;return(0,h.YH)(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,fetch(e)];case 1:return t=s.sent(),[3,3];case 2:if(r=s.sent(),n<=1)throw r;return[2,P(e,n-1)];case 3:return o={},t.headers.forEach(function(e,n){o[n]=e}),[2,t.blob().then(function(e){return{blob:e,contentType:t.headers.get("content-type")||void 0,meta:{headers:o},status:t.status,ok:t.ok}})]}})})()},g=new(E())(1,1/0),R=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;return g.add(function(){return(0,d._)(function(){return(0,h.YH)(this,function(t){switch(t.label){case 0:return[4,new Promise(function(e){window.setTimeout(e,n)})];case 1:return t.sent(),[2,e()]}})})()})};let y=function(e,n,t){var r=n.dumps;return(0,d._)(function(){var n,o,s,u;return(0,h.YH)(this,function(i){switch(i.label){case 0:return n=parseInt(t.get("delay")||"250",10),o=parseInt(t.get("retries")||"3",10),s=r.map(function(t,s){return(0,d._)(function(){return(0,h.YH)(this,function(u){return[2,R(function(){return(0,d._)(function(){var n;return(0,h.YH)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,P("/".concat(t.replace(/^\//,"")),o)];case 1:return n=u.sent(),e.postMessage({fromRemotePrinter:{progress:(s+1)/r.length}},"*"),[2,n];case 2:return console.warn(u.sent()),[2,{ok:!1,blob:new Blob}];case 3:return[2]}})})()},n)]})})()}),u={},[4,Promise.all(s)];case 1:return[2,(u.blobsdone=i.sent(),u)]}})})()};var _=t(52467);let T=function(){return(0,d._)(function(){return(0,h.YH)(this,function(e){return[2,{lines:_.default}]})})()},b=function(e,n,t){var r=e.targetWindow,o=[];switch(n){case"webpack-dev":o.push({name:p.n.TESTFILE,fn:T},{name:p.n.CHECKPRINTER,fn:l},{name:p.n.FETCHIMAGES,fn:y},{name:p.n.CLEARPRINTER,fn:v});break;case"esp8266":o.push({name:p.n.CHECKPRINTER,fn:l},{name:p.n.FETCHIMAGES,fn:y},{name:p.n.CLEARPRINTER,fn:v});break;case"pico-gb":o.push({name:p.n.CHECKPRINTER,fn:l},{name:p.n.FETCHIMAGES,fn:y})}return window.addEventListener("message",function(e){return(0,d._)(function(){var n,s;return(0,h.YH)(this,function(u){switch(u.label){case 0:if(e.source!==r||!(n=e.data.toRemotePrinter))return[2];switch(n.command){case p.n.FETCHIMAGES:return[3,1];case p.n.CLEARPRINTER:case p.n.CHECKPRINTER:return[3,3];case p.n.TESTFILE:return[3,5]}return[3,7];case 1:return[4,o.find(function(e){return e.name===n.command}).fn(r,n.params,t)];case 2:case 4:case 6:return s=u.sent(),[3,8];case 3:return[4,o.find(function(e){return e.name===n.command}).fn()];case 5:return[4,o.find(function(e){return e.name===n.command}).fn()];case 7:s=null,u.label=8;case 8:return s&&r.postMessage({fromRemotePrinter:s},"*"),[2]}})})()}),o},I=function(e,n){var t=e.targetWindow,r=window.setInterval(function(){t&&t.postMessage({fromRemotePrinter:{height:document.body.getBoundingClientRect().height,commands:n}},"*")},500);return function(){window.clearInterval(r)}};var C=function(e){return e.NONE="none",e.IFRAME="iframe",e.POPUP="popup",e}({}),H=function(){var e=(0,a._)((0,i.useState)("none"),2),n=e[0],t=e[1],r=(0,c.D)(),o=(0,f.j)().searchParams;return(0,i.useEffect)(function(){var e=window.opener||window.parent,n=e===window.parent&&e!==window,s=e===window.opener&&e!==window,u={targetWindow:e,isIframe:n,isPopup:s,isRemote:n||s};n?t("iframe"):s?t("popup"):t("none");var i=(null==r?void 0:r.env)?b(u,r.env,o):[],a=I(u,i.map(function(e){return e.name}));return console.log("started"),a},[r,o]),{parentType:n}};let S=function(){var e=(0,u.c)("Remote"),n=H().parentType,t={p:function(e){return(0,s.jsx)("p",{children:e})},em:function(e){return(0,s.jsx)("span",{className:"remote-info--em",children:e})}};switch(n){case C.IFRAME:return(0,s.jsx)("div",{className:"remote-info",children:e.rich("iframe",t)});case C.POPUP:return(0,s.jsx)("div",{className:"remote-info",children:e.rich("popup",(0,o._)((0,r._)({},t),{host:window.location.host}))});case C.NONE:default:return(0,s.jsx)("div",{className:"remote-info",children:e.rich("noReference",t)})}}},42269:(e,n,t)=>{Promise.resolve().then(t.bind(t,34164))},45407:(e,n,t)=>{"use strict";t.d(n,{n:()=>r});var r=function(e){return e.TESTFILE="testFile",e.CHECKPRINTER="checkPrinter",e.FETCHIMAGES="fetchImages",e.CLEARPRINTER="clearPrinter",e.TEAR="tear",e}({})},49901:()=>{}},e=>{e.O(0,[5266,7400,8955,4468,7963,8441,9342,1255,7358],()=>e(e.s=42269)),_N_E=e.O()}]);