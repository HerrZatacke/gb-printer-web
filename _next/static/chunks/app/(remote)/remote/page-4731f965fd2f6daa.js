(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4021],{1607:(e,t,n)=>{"use strict";n.d(t,{D:()=>d,EnvProvider:()=>p});var r=n(97004),s=n(693),a=n(60376),i=n(78538),u=n(39249),o=n(95155),c=n(12115),l=n(52166),f=n(75380),m=(0,c.createContext)(null),d=function(){return(0,c.useContext)(m)},p=function(e){var t=e.children,n=(0,i._)((0,c.useState)(null),2),d=n[0],p=n[1],h=(0,l.A)().setPrinterUrl;return(0,c.useEffect)(function(){var e=["/gb-printer-web","/env.json"].filter(Boolean).join("/");e&&(0,r._)(function(){var t,n,r,i;return(0,u.YH)(this,function(u){switch(u.label){case 0:return u.trys.push([0,5,,6]),[4,(0,f.ZU)()];case 1:return u.sent(),[4,fetch(e)];case 2:return[4,u.sent().json()];case 3:return t=u.sent(),r=[(0,s._)({},t)],i={},[4,f.mU.driver()];case 4:return"esp8266"===(n=a._.apply(void 0,r.concat([(i.localforage=u.sent(),i)]))).env&&h("/"),p(n),[3,6];case 5:return u.sent(),p({version:"0.0.0",maximages:0,localforage:"error",env:"error",fstype:"-",bootmode:"-",oled:!1}),[3,6];case 6:return[2]}})})()},[h]),(0,o.jsx)(m.Provider,{value:d,children:t})}},4862:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});var r=function(e){return e.GALLERY_VIEW_SMALL="small",e.GALLERY_VIEW_1X="1x",e.GALLERY_VIEW_2X="2x",e.GALLERY_VIEW_MAX="max",e.PALETTE_VIEW="res2x",e}({})},10746:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});var r="gbp-z-web"},27803:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});var r=function(e){return e.DEFAULT_ASC="default_asc",e.DEFAULT_DESC="default_desc",e.USAGE_ASC="usage_asc",e.USAGE_DESC="usage_desc",e.NAME_ASC="name_asc",e.NAME_DESC="name_desc",e}({})},29032:(e,t,n)=>{"use strict";n.d(t,{j:()=>a});var r=n(35695),s=n(12115),a=function(){var e=(0,r.usePathname)(),t=(0,r.useSearchParams)(),n=(0,s.useMemo)(function(){return t.toString()},[t]);return{fullPath:(0,s.useMemo)(function(){return n?"".concat(e,"?").concat(n):e},[e,n]),pathname:e,query:n,searchParams:t}}},35695:(e,t,n)=>{"use strict";var r=n(18999);n.o(r,"RedirectType")&&n.d(t,{RedirectType:function(){return r.RedirectType}}),n.o(r,"redirect")&&n.d(t,{redirect:function(){return r.redirect}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}}),n.o(r,"useServerInsertedHTML")&&n.d(t,{useServerInsertedHTML:function(){return r.useServerInsertedHTML}})},36816:()=>{},39893:(e,t,n)=>{"use strict";n.d(t,{C:()=>s,f:()=>r});var r=function(e){return e.WIDER="wider",e.WIDE="wide",e.NORMAL="normal",e.NARROW="narrow",e.NARROWER="narrower",e.EMULATOR="emulator",e}({}),s=[{name:"Wider",baseValues:[0,68,187,255],value:"wider"},{name:"Wide",baseValues:[0,85,170,255],value:"wide"},{name:"Normal",baseValues:[51,102,153,204],value:"normal"},{name:"Narrow",baseValues:[69,115,162,208],value:"narrow"},{name:"Narrower",baseValues:[85,113,141,170],value:"narrower"},{name:"From Emulator",baseValues:[64,144,224,255],value:"emulator"}]},42269:(e,t,n)=>{Promise.resolve().then(n.bind(n,81713))},45686:(e,t,n)=>{"use strict";n.d(t,{n:()=>r});var r=function(e){return e.TESTFILE="testFile",e.CHECKPRINTER="checkPrinter",e.FETCHIMAGES="fetchImages",e.CLEARPRINTER="clearPrinter",e.TEAR="tear",e}({})},49432:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let r=function(e,t){if(!e.trim())return"";if("/"===e&&"ws"!==t)return e;var n=!!e.match(RegExp("^".concat(t,"(s)?:\\/\\/"),"gi"));return"".concat(n?"":"".concat(t,"://")).concat(e).concat(e.endsWith("/")?"":"/")}},49967:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r={weekday:void 0,year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"};let s=function(e,t){return e.toDate().toLocaleString(t,r)}},52166:(e,t,n)=>{"use strict";n.d(t,{A:()=>P});var r=n(693),s=n(78538),a=n(30832),i=n.n(a),u=n(15905),o=n(65453),c=n(46786),l=n(39893),f=n(81445),m=n(80498),d=n(4862),p=n(27803),h=n(99999),v=n(49432),E=n(49967),w=n(10746),g=function(){if("undefined"!=typeof navigator){var e=(0,s._)(navigator.language.split("-"),2);return[e[0],e[1]].filter(Boolean).join("-")}return""};let P=(0,o.v)((0,c.Zr)(function(e){return{activePalette:"bw",bitmapQueueDither:!0,bitmapQueueSetting:l.f.WIDE,enableDebug:!1,exportFileTypes:["png"],exportScaleFactors:[4],fileNameStyle:f.B.FULL,forceMagicCheck:!0,galleryView:d.j.GALLERY_VIEW_1X,galleryClickAction:m.n.SELECT,handleExportFrame:u.H.FRAMEMODE_KEEP,hideDates:!1,importDeleted:!0,importLastSeen:!0,importPad:!1,pageSize:30,preferredLocale:g(),printerParams:"",printerUrl:"/",savFrameTypes:"int",themeName:h.V.BRIGHT,enableImageGroups:!1,sortPalettes:p.V.DEFAULT_DESC,useSerials:!1,videoParams:{},setActivePalette:function(t){return e({activePalette:t})},setBitmapQueueDither:function(t){return e({bitmapQueueDither:t})},setBitmapQueueSetting:function(t){return e({bitmapQueueSetting:t})},setEnableDebug:function(t){return e({enableDebug:t})},setFileNameStyle:function(t){return e({fileNameStyle:t})},setForceMagicCheck:function(t){return e({forceMagicCheck:t})},setGalleryView:function(t){return e({galleryView:t})},setGalleryClickAction:function(t){return e({galleryClickAction:t})},setHandleExportFrame:function(t){return e({handleExportFrame:t})},setHideDates:function(t){return e({hideDates:t})},setImportDeleted:function(t){return e({importDeleted:t})},setImportLastSeen:function(t){return e({importLastSeen:t})},setImportPad:function(t){return e({importPad:t})},setPageSize:function(t){return e({pageSize:t})},setPrinterParams:function(t){return e({printerParams:t})},setPrinterUrl:function(t){return e({printerUrl:(0,v.A)(t,"http")})},setSavFrameTypes:function(t){return e({savFrameTypes:t})},setThemeName:function(t){return e({themeName:t})},setEnableImageGroups:function(t){return e({enableImageGroups:t})},setSortPalettes:function(t){return e({sortPalettes:t})},setUseSerials:function(t){return e({useSerials:t})},setVideoParams:function(t){return e(function(e){return{videoParams:(0,r._)({},e.videoParams,t)}})},setExportScaleFactors:function(t){return e({exportScaleFactors:t})},setExportFileTypes:function(t){return e({exportFileTypes:t})},setPreferredLocale:function(t){try{(0,E.A)(i()(),t),e({preferredLocale:t})}catch(e){console.error(e)}}}},{name:"".concat(w.z,"-settings"),storage:(0,c.KU)(function(){return localStorage})}))},58617:(e,t,n)=>{var r=n(49509);e.exports=n(r.env.PROMISE_QUEUE_COVERAGE?36816:71669)},71669:function(e,t,n){var r,s;!function(a,i){"use strict";e.exports&&1?e.exports=i():void 0===(s="function"==typeof(r=i)?r.call(t,n,t,e):r)||(e.exports=s)}(0,function(){"use strict";var e="undefined"!=typeof Promise?Promise:function(){return{then:function(){throw Error("Queue.configure() before use Queue")}}},t=function(){};function n(e,t,n){this.options=n=n||{},this.pendingPromises=0,this.maxPendingPromises=void 0!==e?e:1/0,this.maxQueuedPromises=void 0!==t?t:1/0,this.queue=[]}return n.configure=function(t){e=t},n.prototype.add=function(n){var r=this;return new e(function(e,s,a){if(r.queue.length>=r.maxQueuedPromises)return void s(Error("Queue limit reached"));r.queue.push({promiseGenerator:n,resolve:e,reject:s,notify:a||t}),r._dequeue()})},n.prototype.getPendingLength=function(){return this.pendingPromises},n.prototype.getQueueLength=function(){return this.queue.length},n.prototype._dequeue=function(){var t,n=this;if(this.pendingPromises>=this.maxPendingPromises)return!1;var r=this.queue.shift();if(!r)return this.options.onEmpty&&this.options.onEmpty(),!1;try{this.pendingPromises++,((t=r.promiseGenerator())&&"function"==typeof t.then?t:new e(function(e){e(t)})).then(function(e){n.pendingPromises--,r.resolve(e),n._dequeue()},function(e){n.pendingPromises--,r.reject(e),n._dequeue()},function(e){r.notify(e)})}catch(e){n.pendingPromises--,r.reject(e),n._dequeue()}return!0},n})},75380:(e,t,n)=>{"use strict";n.d(t,{Uv:()=>l,mU:()=>c,ZU:()=>f});var r=n(97004),s=n(39249),a=n(77271),i=n.n(a),u="dummy".concat(new Date().getTime());let o=function(e){var t,n,a,o,c=i().createInstance(e),l=(t=(0,r._)(function(){return(0,s.YH)(this,function(e){switch(e.label){case 0:return[4,c.setItem(u,u)];case 1:return e.sent(),[4,c.removeItem(u)];case 2:return e.sent(),[2]}})}),function(){return t.apply(this,arguments)});return{ready:(0,r._)(function(){var t;return(0,s.YH)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,c.ready()];case 1:return n.sent(),[2,l()];case 2:throw t=n.sent(),c=i().createInstance(e),t;case 3:return[2]}})}),keys:(0,r._)(function(){return(0,s.YH)(this,function(t){try{return[2,c.keys()]}catch(t){throw c=i().createInstance(e),t}})}),driver:(0,r._)(function(){var t;return(0,s.YH)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,c.driver()];case 1:return[2,n.sent()];case 2:throw t=n.sent(),c=i().createInstance(e),t;case 3:return[2]}})}),setItem:(n=(0,r._)(function(t,n){var r;return(0,s.YH)(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,c.setItem(t,n)];case 1:return[2,s.sent()];case 2:throw r=s.sent(),c=i().createInstance(e),r;case 3:return[2]}})}),function(e,t){return n.apply(this,arguments)}),getItem:(a=(0,r._)(function(t){var n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,c.getItem(t)];case 1:return[2,r.sent()];case 2:throw n=r.sent(),c=i().createInstance(e),n;case 3:return[2]}})}),function(e){return a.apply(this,arguments)}),removeItem:(o=(0,r._)(function(t){var n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,c.removeItem(t)];case 1:return[2,r.sent()];case 2:throw n=r.sent(),c=i().createInstance(e),n;case 3:return[2]}})}),function(e){return o.apply(this,arguments)})}};var c=o({name:"GB Printer Web",storeName:"gb-printer-web-images"}),l=o({name:"GB Printer Web",storeName:"gb-printer-web-frames"});window.lfi=c,window.lff=l;var f=function(){var e=(0,r._)(function(){return(0,s.YH)(this,function(e){switch(e.label){case 0:return[4,l.ready()];case 1:return e.sent(),[4,c.ready()];case 2:return e.sent(),[4,new Promise(function(e){window.setTimeout(e,5)})];case 3:return e.sent(),[2]}})});return function(){return e.apply(this,arguments)}}()},80498:(e,t,n)=>{"use strict";n.d(t,{n:()=>r,s:()=>s});var r=function(e){return e.SELECT="select",e.EDIT="edit",e.VIEW="view",e}({}),s=[{label:"Click selects the item",value:"select"},{label:"Click opens edit dialog",value:"edit"},{label:"Click opens the item in lightbox",value:"view"}]},81445:(e,t,n)=>{"use strict";n.d(t,{B:()=>r,y:()=>s});var r=function(e){return e.FULL="FULL",e.TITLE_ONLY="TITLE_ONLY",e.DATE_TITLE="DATE_TITLE",e}({}),s=[{id:"FULL",name:"Full Title"},{id:"DATE_TITLE",name:"Date and Title"},{id:"TITLE_ONLY",name:"Title only"}]},81713:(e,t,n)=>{"use strict";n.d(t,{default:()=>S});var r=n(95155),s=n(78538),a=n(12115),i=n(1607),u=n(29032),o=n(97004),c=n(39249),l=n(45686),f=n(693),m=n(60376),d=n(577),p=function(){var e=(0,o._)(function(){var e;return(0,c.YH)(this,function(t){switch(t.label){case 0:return[4,fetch("/dumps/list")];case 1:return[4,t.sent().json()];case 2:if((e=t.sent()).fs&&e.fs.dumpcount!==e.dumps.length)throw Error("Inconststent image count received from printer.");return[2,{printerData:(0,m._)((0,f._)({},e),{dumps:(0,d._)(e.dumps).sort()})}]}})});return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,o._)(function(){return(0,c.YH)(this,function(e){switch(e.label){case 0:return[4,fetch("/dumps/clear")];case 1:return[4,e.sent().json()];case 2:if(void 0!==e.sent().deleted)return[2,p()];throw Error("error while deleting images")}})});return function(){return e.apply(this,arguments)}}(),v=n(58617),E=n.n(v),w=function(){var e=(0,o._)(function(e,t){var n,r,s;return(0,c.YH)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,fetch(e)];case 1:return n=a.sent(),[3,3];case 2:if(r=a.sent(),t<=1)throw r;return[2,w(e,t-1)];case 3:return s={},n.headers.forEach(function(e,t){s[t]=e}),[2,n.blob().then(function(e){return{blob:e,contentType:n.headers.get("content-type")||void 0,meta:{headers:s},status:n.status,ok:n.ok}})]}})});return function(t,n){return e.apply(this,arguments)}}(),g=new(E())(1,1/0),P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;return g.add((0,o._)(function(){return(0,c.YH)(this,function(n){switch(n.label){case 0:return[4,new Promise(function(e){window.setTimeout(e,t)})];case 1:return n.sent(),[2,e()]}})}))},y=function(){var e=(0,o._)(function(e,t,n){var r,s,a,i,u;return(0,c.YH)(this,function(l){switch(l.label){case 0:var f;return r=t.dumps,s=parseInt(n.get("delay")||"250",10),a=parseInt(n.get("retries")||"3",10),i=r.map((f=(0,o._)(function(t,n){return(0,c.YH)(this,function(i){return[2,P((0,o._)(function(){var s;return(0,c.YH)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,w("/".concat(t.replace(/^\//,"")),a)];case 1:return s=i.sent(),e.postMessage({fromRemotePrinter:{progress:(n+1)/r.length}},"*"),[2,s];case 2:return console.warn(i.sent()),[2,{ok:!1,blob:new Blob}];case 3:return[2]}})}),s)]})}),function(e,t){return f.apply(this,arguments)})),u={},[4,Promise.all(i)];case 1:return[2,(u.blobsdone=l.sent(),u)]}})});return function(t,n,r){return e.apply(this,arguments)}}(),b=n(35796),I=function(){var e=(0,o._)(function(){return(0,c.YH)(this,function(e){return[2,{lines:b.default}]})});return function(){return e.apply(this,arguments)}}();let T=function(e,t,n){var r,s=e.targetWindow,a=[];switch(t){case"webpack-dev":a.push({name:l.n.TESTFILE,fn:I},{name:l.n.CHECKPRINTER,fn:p},{name:l.n.FETCHIMAGES,fn:y},{name:l.n.CLEARPRINTER,fn:h});break;case"esp8266":a.push({name:l.n.CHECKPRINTER,fn:p},{name:l.n.FETCHIMAGES,fn:y},{name:l.n.CLEARPRINTER,fn:h});break;case"pico-gb":a.push({name:l.n.CHECKPRINTER,fn:p},{name:l.n.FETCHIMAGES,fn:y})}return window.addEventListener("message",(r=(0,o._)(function(e){var t,r;return(0,c.YH)(this,function(i){switch(i.label){case 0:if(e.source!==s||!(t=e.data.toRemotePrinter))return[2];switch(t.command){case l.n.FETCHIMAGES:return[3,1];case l.n.CLEARPRINTER:case l.n.CHECKPRINTER:return[3,3];case l.n.TESTFILE:return[3,5]}return[3,7];case 1:return[4,a.find(function(e){return e.name===t.command}).fn(s,t.params,n)];case 2:case 4:case 6:return r=i.sent(),[3,8];case 3:return[4,a.find(function(e){return e.name===t.command}).fn()];case 5:return[4,a.find(function(e){return e.name===t.command}).fn()];case 7:r=null,i.label=8;case 8:return r&&s.postMessage({fromRemotePrinter:r},"*"),[2]}})}),function(e){return r.apply(this,arguments)})),a},_=function(e,t){var n=e.targetWindow,r=window.setInterval(function(){n&&n.postMessage({fromRemotePrinter:{height:document.body.getBoundingClientRect().height,commands:t}},"*")},500);return function(){window.clearInterval(r)}};var L=function(e){return e.NONE="none",e.IFRAME="iframe",e.POPUP="popup",e}({}),R=function(){var e=(0,s._)((0,a.useState)("none"),2),t=e[0],n=e[1],r=(0,i.D)(),o=(0,u.j)().searchParams;return(0,a.useEffect)(function(){var e=window.opener||window.parent,t=e===window.parent&&e!==window,s=e===window.opener&&e!==window,a={targetWindow:e,isIframe:t,isPopup:s,isRemote:t||s};t?n("iframe"):s?n("popup"):n("none");var i=(null==r?void 0:r.env)?T(a,r.env,o):[],u=_(a,i.map(function(e){return e.name}));return console.log("started"),u},[r,o]),{parentType:t}};let S=function(){switch(R().parentType){case L.IFRAME:return(0,r.jsx)("div",{className:"remote-info",children:(0,r.jsxs)("p",{children:["This is a remote window which is included in an iframe on your main page. ",(0,r.jsx)("span",{className:"remote-info--em",children:"You should not see this message."})]})});case L.POPUP:return(0,r.jsxs)("div",{className:"remote-info",children:[(0,r.jsx)("p",{children:"This is your WiFi-printer's remote control page."}),(0,r.jsx)("p",{children:window.location.host}),(0,r.jsx)("p",{children:"You can go back to your main app and start importing your images."}),(0,r.jsx)("p",{className:"remote-info--em",children:"In order for the import to work, this window needs to remain open!"})]});case L.NONE:default:return(0,r.jsxs)("div",{className:"remote-info",children:[(0,r.jsx)("p",{children:"This window is missing the reference to your main app."}),(0,r.jsx)("p",{className:"remote-info--em",children:"It must be opened from the settings page of your main app in order to work!"})]})}}},99999:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});var r=function(e){return e.BRIGHT="theme-bright",e.DARK="theme-dark",e}({})}},e=>{var t=t=>e(e.s=t);e.O(0,[7271,4831,7963,8441,8857,1684,7358],()=>t(42269)),_N_E=e.O()}]);