(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{933:(e,t,n)=>{"use strict";n.d(t,{E:()=>u});var r,a=n(97004),i=n(39249),s=n(24463),u=function(e,t){var u,o,c,l,f=(u=(0,a._)(function(){var a;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(r)return[3,2];return[4,Promise.all([n.e(9268),n.e(7431),n.e(6950),n.e(1575)]).then(n.bind(n,94979))];case 1:a=i.sent().dropBoxSyncTool,r=r||a(e,t),i.label=2;case 2:return[2,r]}})}),function(){return u.apply(this,arguments)});return s.A.getState().dropboxStorage.use&&f(),{recoverImageData:(o=(0,a._)(function(e){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().recoverImageData(e)]}})}),function(e){return o.apply(this,arguments)}),startAuth:(0,a._)(function(){return(0,i.YH)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return[2,e.sent().startAuth()]}})}),startSyncData:(c=(0,a._)(function(e){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().startSyncData(e)]}})}),function(e){return c.apply(this,arguments)}),startSyncImages:(0,a._)(function(){return(0,i.YH)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return[2,e.sent().startSyncImages()]}})}),updateSettings:(l=(0,a._)(function(e){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return[2,t.sent().updateSettings(e)]}})}),function(e){return l.apply(this,arguments)}),subscribe:function(){var e;return s.A.subscribe(function(e){return e.dropboxStorage},(e=(0,a._)(function(e){return(0,i.YH)(this,function(t){switch(t.label){case 0:return[4,f()];case 1:return t.sent().updateSettings(e),[2]}})}),function(t){return e.apply(this,arguments)}))}}}},1441:(e,t,n)=>{"use strict";n.d(t,{default:()=>g});var r,a,i=n(97004),s=n(577),u=n(39249),o=n(95155),c=n(12115),l=n(45686),f=n(64768),d=n(41186),p=n(46498),h=n(52166),v=n(30891);let g=function(e){var t=e.children,g=p.A.getState(),m=g.startProgress,b=g.setProgress,w=g.stopProgress,E=g.setPrinterFunctions,I=g.setPrinterBusy,P=g.setPrinterData,_=d.A.getState(),S=_.dismissDialog,y=_.setDialog,A=(0,f.A)().handleFileImport,T=(0,c.useRef)(""),C=(0,c.useCallback)(function(e){var t=Math.min(1,Math.max(0,e));if(T&&(0===t||1===t)){w(T.current),T.current="";return}T.current||(T.current=m("Getting items from printer")),b(T.current,t)},[b,m,w]);(0,c.useEffect)(function(){var e=function(e){var t,n=h.A.getState().printerUrl;try{t=new URL(n).origin}catch(e){t=new URL(window.location.href).origin}if(e.origin===t){var o=e.data.fromRemotePrinter,c=void 0===o?{}:o,l=c.lines,f=c.progress,d=c.blob,v=c.blobsdone,g=c.commands,m=c.printerData,b=e.source;if(g&&(r&&JSON.stringify(g)===JSON.stringify(p.A.getState().printerFunctions)||(E(g),I(!1),P(null)),a=b,window.clearTimeout(r),r=window.setTimeout(function(){r=null,a=null,I(!0),P(null),E([])},1500)),l&&A([new File([l.join("\n")],"Text input.txt",{type:"text/plain"})]),void 0!==f&&C(f),d&&A([new File([d],"blob.unknown")]),v){if("string"==typeof v[0])return void window.setTimeout(function(){alert("You should update the web-app to a version > 1.16.0 on your printer for an optimized import experience :-)")},200);var w=v.reduce(function(e,t){if(!t.blob||!t.ok)return e;var n=v.length>1?(e.length+1).toString(10).padStart(2,"0"):"";return(0,s._)(e).concat([new File([t.blob],"Printer ".concat(n).trim(),{type:t.contentType})])},[]);w.length?A(w,{fromPrinter:!0}):y({message:"No valid files received from WiFi-Printer",confirm:(0,i._)(function(){return(0,u.YH)(this,function(e){return S(0),I(!1),P(null),[2]})})})}m&&(P(m),I(!1))}};return window.addEventListener("message",e),function(){return window.removeEventListener("message",e)}},[S,A,y,I,P,E,C]);var R=(0,c.useMemo)(function(){var e;return{callRemoteFunction:(e=(0,i._)(function(e){var t,r;return(0,u.YH)(this,function(i){switch(i.label){case 0:return t=p.A.getState().printerData,I(!0),e===l.n.FETCHIMAGES&&t&&(r={dumps:null==t?void 0:t.dumps}),[4,Promise.resolve().then(n.t.bind(n,52491,23))];case 1:return i.sent(),[4,Promise.resolve().then(n.t.bind(n,98933,23))];case 2:if(i.sent(),!a)throw Error("remote printer window object is missing");return a.postMessage({toRemotePrinter:{command:e,params:r}},"*"),[2]}})}),function(t){return e.apply(this,arguments)})}},[I]);return(0,o.jsx)(v.G.Provider,{value:R,children:t})}},1470:(e,t,n)=>{"use strict";n.d(t,{t:()=>r,z:()=>a});var r="ROOT",a=function(){return{id:r,slug:"",created:"",title:"Home",coverImage:"",images:[],groups:[],tags:[]}}},1607:(e,t,n)=>{"use strict";n.d(t,{D:()=>p,EnvProvider:()=>h});var r=n(97004),a=n(693),i=n(60376),s=n(78538),u=n(39249),o=n(95155),c=n(12115),l=n(52166),f=n(75380),d=(0,c.createContext)(null),p=function(){return(0,c.useContext)(d)},h=function(e){var t=e.children,n=(0,s._)((0,c.useState)(null),2),p=n[0],h=n[1],v=(0,l.A)().setPrinterUrl;return(0,c.useEffect)(function(){var e=["/gb-printer-web","/env.json"].filter(Boolean).join("/");e&&(0,r._)(function(){var t,n,r,s;return(0,u.YH)(this,function(u){switch(u.label){case 0:return u.trys.push([0,5,,6]),[4,(0,f.ZU)()];case 1:return u.sent(),[4,fetch(e)];case 2:return[4,u.sent().json()];case 3:return t=u.sent(),r=[(0,a._)({},t)],s={},[4,f.mU.driver()];case 4:return"esp8266"===(n=i._.apply(void 0,r.concat([(s.localforage=u.sent(),s)]))).env&&v("/"),h(n),[3,6];case 5:return u.sent(),h({version:"0.0.0",maximages:0,localforage:"error",env:"error",fstype:"-",bootmode:"-",oled:!1}),[3,6];case 6:return[2]}})})()},[v]),(0,o.jsx)(d.Provider,{value:p,children:t})}},6617:(e,t,n)=>{"use strict";n.d(t,{h:()=>u,i:()=>s});var r=n(97004),a=n(39249),i=n(12115),s=(0,i.createContext)({runWithImage:(0,r._)(function(){return(0,a.YH)(this,function(e){throw Error("Plugin Context is missing")})}),runWithImages:(0,r._)(function(){return(0,a.YH)(this,function(e){throw Error("Plugin Context is missing")})}),validateAndAddPlugin:(0,r._)(function(){return(0,a.YH)(this,function(e){throw Error("Plugin Context is missing")})})}),u=function(){return(0,i.useContext)(s)}},9718:(e,t,n)=>{"use strict";n.d(t,{OU:()=>c,_Y:()=>s,k4:()=>l,qt:()=>i,vK:()=>u,vx:()=>o});var r,a=n(86447),i=function(e){return e.USB="USB",e.SERIAL="SERIAL",e}({}),s=function(e){return e.UNKNOWN="unknown",e.PASSIVE="passive",e.INACTIVE="inactive",e.PACKET_CAPTURE="packet_capture",e.SUPER_PRINTER_INTERFACE="super_printer_interface",e}({}),u=(r={},(0,a._)(r,"unknown","Unknown Device"),(0,a._)(r,"passive","Passive Device"),(0,a._)(r,"inactive","Inactive Device"),(0,a._)(r,"packet_capture","Packet Capture device"),(0,a._)(r,"super_printer_interface","Super Printer Interface"),r),o=function(e){return e.OPEN="OPEN",e.SEND_DATA="SEND_DATA",e.ANSWER="ANSWER",e}({}),c=function(e){return e.ENABLED_STATE="ENABLED_STATE",e.ERROR="ERROR",e.PORTS_CHANGE="PORTS_CHANGE",e.DATA="DATA",e.RECEIVING="RECEIVING",e.QUESTION="QUESTION",e}({}),l=[{vendorId:9025,productId:32822},{vendorId:9025,productId:32823},{vendorId:9025,productId:32845},{vendorId:9025,productId:32846},{vendorId:9025,productId:32847},{vendorId:9025,productId:32848},{vendorId:9025,productId:32850},{vendorId:9025,productId:32851},{vendorId:9025,productId:32852},{vendorId:9025,productId:32853},{vendorId:9025,productId:32854},{vendorId:9025,productId:32855},{vendorId:9114}]},29032:(e,t,n)=>{"use strict";n.d(t,{j:()=>i});var r=n(35695),a=n(12115),i=function(){var e=(0,r.usePathname)(),t=(0,r.useSearchParams)(),n=(0,a.useMemo)(function(){return t.toString()},[t]);return{fullPath:(0,a.useMemo)(function(){return n?"".concat(e,"?").concat(n):e},[e,n]),pathname:e,query:n,searchParams:t}}},30891:(e,t,n)=>{"use strict";n.d(t,{G:()=>s,b:()=>u});var r=n(97004),a=n(39249),i=n(12115),s=(0,i.createContext)({callRemoteFunction:(0,r._)(function(){return(0,a.YH)(this,function(e){return[2]})})}),u=function(){return(0,i.useContext)(s)}},32134:(e,t,n)=>{"use strict";n.d(t,{GalleryTreeContext:()=>d,K:()=>f});var r=n(78538),a=n(95155),i=n(12115),s=n(45465),u=n(46498),o=n(11760),c=n(52166),l=n(1470),f=(0,i.createContext)({root:(0,l.z)(),view:(0,l.z)(),images:[],covers:[],paths:[],pathsOptions:[],isWorking:!1});function d(e){var t=e.children,d=(0,r._)((0,i.useState)(null),2),p=d[0],h=d[1],v=(0,r._)((0,i.useState)(!0),2),g=v[0],m=v[1],b=(0,r._)((0,i.useState)((0,l.z)()),2),w=b[0],E=b[1],I=(0,r._)((0,i.useState)([]),2),P=I[0],_=I[1],S=(0,r._)((0,i.useState)([]),2),y=S[0],A=S[1],T=(0,c.A)(),C=T.enableImageGroups,R=T.enableDebug,k=(0,u.A)().setError,U=(0,o.h)(),x=U.imageGroups,D=U.images,N=U.setImageGroups,Y=(0,i.useMemo)(function(){return C?x:[]},[C,x]),F=(0,s.Y)().path;(0,i.useEffect)(function(){var e=new Worker(n.tu(new URL(n.p+n.u(2814),n.b)));return e.onmessage=function(e){if("result"===e.data.type){if(E(e.data.root),_(e.data.paths),A(e.data.pathsOptions),m(!1),C&&x.length>e.data.paths.length){var t=e.data.paths.map(function(e){return e.group.id});N(x.filter(function(e){var n=e.id;return t.includes(n)}))}R&&console.info("worker ran for ".concat(e.data.duration,"ms"))}else"error"===e.data.type&&k(Error(e.data.error))},e.onerror=function(e){k(Error(e.message)),m(!1)},h(e),function(){e.terminate(),h(null)}},[R,C,k,N,x]),(0,i.useEffect)(function(){p&&(m(!0),p.postMessage({imageGroups:Y,stateImages:D}))},[Y,D,p]);var H=(0,i.useMemo)(function(){var e,t=(null==(e=P.find(function(e){return e.absolutePath===F}))?void 0:e.group)||w,n=t.groups.map(function(e){return e.coverImage}),r=t.images.filter(function(e){return!n.includes(e.hash)});return{view:t,covers:n,paths:P,images:r,pathsOptions:y,root:w,isWorking:g}},[F,P,y,w,g]);return(0,a.jsx)(f.Provider,{value:H,children:t})}},32521:(e,t,n)=>{"use strict";n.d(t,{U:()=>a,Z:()=>i});var r=n(12115),a=(0,r.createContext)({webSerialActivePorts:[],webSerialIsReceiving:!1,webSerialEnabled:!1,openWebSerial:function(){throw Error("PortsContext is missing")},webUSBActivePorts:[],webUSBIsReceiving:!1,webUSBEnabled:!1,openWebUSB:function(){throw Error("PortsContext is missing")},unknownDeviceResponse:null,hasInactiveDevices:!1,sendDeviceMessage:function(){throw Error("PortsContext is missing")},worker:null}),i=function(){return(0,r.useContext)(a)}},33782:(e,t,n)=>{"use strict";n.d(t,{NavigationToolsProvider:()=>u,g:()=>o});var r=n(95155),a=n(12115),i=n(70940),s=(0,a.createContext)(null);function u(e){var t=e.children,n=(0,i.n)();return(0,r.jsx)(s.Provider,{value:n,children:t})}var o=function(){var e=(0,a.useContext)(s);if(!e)throw Error("useNavigationToolsContext must be used within an NavigationToolsProvider");return e}},40774:(e,t,n)=>{"use strict";n.d(t,{B:()=>r,Q:()=>a});var r=function(e){return e.CONFIRM_ASK="CONFIRM_ASK",e.CONFIRM_ANSWERED="CONFIRM_ANSWERED",e.ADD_IMAGES="ADD_IMAGES",e.IMPORT_FILES="IMPORT_FILES",e}({}),a=function(e){return e.NUMBER="number",e.STRING="string",e.MULTILINE="multiline",e}({})},43178:(e,t,n)=>{Promise.resolve().then(n.bind(n,94116)),Promise.resolve().then(n.bind(n,53585)),Promise.resolve().then(n.bind(n,1607)),Promise.resolve().then(n.bind(n,32134)),Promise.resolve().then(n.bind(n,33782)),Promise.resolve().then(n.bind(n,52588)),Promise.resolve().then(n.bind(n,63669)),Promise.resolve().then(n.bind(n,1441))},45465:(e,t,n)=>{"use strict";n.d(t,{Y:()=>u});var r=n(78538),a=n(12115),i=n(29032),s="/gallery/",u=function(){var e,t=(0,i.j)(),n=t.searchParams,u=t.pathname,o=(0,r._)((0,a.useState)(""),2),c=o[0],l=o[1],f=parseInt(null!=(e=n.get("page"))?e:"1",10)-1,d=n.get("group")||"",p=(0,a.useCallback)(function(e){var t="number"==typeof e.pageIndex?e.pageIndex:f,n="string"==typeof e.group?e.group:d,r="".concat(s,"?page=").concat(t+1);return n.length&&(r="".concat(r,"&group=").concat(n)),r},[f,d]);return(0,a.useEffect)(function(){u===s&&l(p({pageIndex:f,group:d}))},[d,f,u,p]),{pageIndex:f,path:d,lastGalleryLink:c,getUrl:p}}},45686:(e,t,n)=>{"use strict";n.d(t,{n:()=>r});var r=function(e){return e.TESTFILE="testFile",e.CHECKPRINTER="checkPrinter",e.FETCHIMAGES="fetchImages",e.CLEARPRINTER="clearPrinter",e.TEAR="tear",e}({})},47457:(e,t,n)=>{"use strict";n.d(t,{A:()=>y});var r=n(97004),a=n(693),i=n(577),s=n(39249),u=n(30832),o=n.n(u),c=n(91540),l=n(12115),f=n(5432),d=n(46498),p=n(11760),h=n(75380),v=n(72623),g=function(e,t){return!!t.find(function(t){var n=t.hashes;return!!n&&Object.values(n).includes(e)})},m=function(e,t){return!!t.find(function(t){return t.hash===e})},b=function(){var e=(0,r._)(function(e){var t,n;return(0,s.YH)(this,function(r){var a,i;switch(r.label){case 0:return t=e.images,n=e.frames,[4,(0,h.ZU)()];case 1:return r.sent(),[4,h.mU.keys()];case 2:return r.sent().forEach((a=t,function(e){g(e,a)||m(e,a)||(0,v.yH)(e)})),[4,h.Uv.keys()];case 3:return r.sent().forEach((i=n,function(e){i.find(function(t){return t.hash===e})||(0,v.t9)(e)})),[2]}})});return function(t){return e.apply(this,arguments)}}(),w=function(){var e=(0,r._)(function(e){return(0,s.YH)(this,function(t){switch(t.label){case 0:return[4,(0,h.ZU)()];case 1:return t.sent(),[4,h.mU.keys()];case 2:return[2,t.sent().filter(function(e){return!e.startsWith("dummy")}).filter(function(t){return!g(t,e)&&!m(t,e)})]}})});return function(t){return e.apply(this,arguments)}}(),E=function(){var e=(0,r._)(function(e){return(0,s.YH)(this,function(t){switch(t.label){case 0:return[4,(0,h.ZU)()];case 1:return t.sent(),[4,h.Uv.keys()];case 2:return[2,t.sent().filter(function(e){return!e.startsWith("dummy")}).filter(function(t){return!e.find(function(e){return e.hash===t})})]}})});return function(t){return e.apply(this,arguments)}}(),I=n(55364),P=n(50263),_=n(99451),S=function(){var e=(0,r._)(function(e,t){return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,(0,h.ZU)()];case 1:var a;return n.sent(),[4,Promise.all(e.map((a=(0,r._)(function(e){var n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,t.getItem(e)];case 1:if(!(n=r.sent()))return[2,null];return[4,(0,P.U)(n)];case 2:return[2,{hash:e,lines:r.sent().split("\n"),binary:n}];case 3:return r.sent(),[2,null];case 4:return[2]}})}),function(e){return a.apply(this,arguments)})))];case 2:return[2,n.sent().reduce(_.N,[])]}})});return function(t,n){return e.apply(this,arguments)}}();let y=function(){var e,t=(0,d.A)(),n=t.trashCount,u=t.showTrashCount,v=(0,p.h)(),g=v.frames,m=v.images,P=(0,d.A)().updateTrashCount,y=(e=(0,r._)(function(){var e,t,n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return[4,w(m)];case 1:return[4,S(r.sent(),h.mU)];case 2:return e=r.sent(),t={},n={state:{images:e.map(function(e){try{return t[e.hash]=e.binary,{hash:e.hash,created:o()().format(f.i$),title:"Backup export ".concat(e.hash),lines:e.lines.length,tags:["backup"],palette:"bw",framePalette:"bw",invertPalette:!1,invertFramePalette:!1,frame:""}}catch(e){return null}}).reduce(I.iy,[]),lastUpdateUTC:Math.floor(new Date().getTime()/1e3),version:p.A}},(0,c.saveAs)(new Blob((0,i._)(JSON.stringify((0,a._)({},n,t),null,2))),"backup_images.json"),[2]}})}),function(){return e.apply(this,arguments)}),A=(0,l.useCallback)((0,r._)(function(){var e,t,n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return[4,E(g)];case 1:return[4,S(r.sent(),h.Uv)];case 2:return e=r.sent(),t={},n={state:{frames:e.map(function(e,n){try{return t["frame-".concat(e.hash)]=e.binary,{hash:e.hash,name:"Backup export ".concat(e.hash),id:"bak".concat(n.toString(10).padStart(2,"0"))}}catch(e){return null}}).reduce(_.N,[]),frameGroups:[{id:"bak",name:"Re-imported trash frames"}],lastUpdateUTC:Math.floor(new Date().getTime()/1e3),version:p.A}},(0,c.saveAs)(new Blob((0,i._)(JSON.stringify((0,a._)({},n,t),null,2))),"backup_frames.json"),[2]}})}),[g]),T=(0,l.useCallback)((0,r._)(function(){var e,t;return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,E(g)];case 1:return e=n.sent().length,[4,w(m)];case 2:return t=n.sent().length,P(e,t),[2]}})}),[g,m,P]),C=(0,l.useCallback)((0,r._)(function(){return(0,s.YH)(this,function(e){switch(e.label){case 0:return[4,b({images:m,frames:g})];case 1:return e.sent(),u(!1),window.requestAnimationFrame(function(){T()}),[2]}})}),[T,g,m,u]);return{showTrashCount:u,purgeTrash:C,downloadImages:y,downloadFrames:A,checkUpdateTrashCount:T,trashCount:n}}},52588:(e,t,n)=>{"use strict";n.d(t,{PluginsContext:()=>k});var r=n(97004),a=n(39249),i=n(95155),s=n(12115),u=n(83936),o=n(633),c=n(46498),l=n(11760),f=n(693),d=n(60376),p=n(15905),h=n(52166),v=n(53982),g=n(18335),m=n(77683),b=n(86964),w=n(55364),E=n(5847),I=function(e){return function(t){var n,i=l.h.getState(),s=i.frames,u=i.palettes,o=h.A.getState().handleExportFrame,c=e.find(function(e){return e.hash===t});if(!c)throw Error("image not found");var I=(0,g.s)(u,c),P=I.palette,_=I.framePalette;if(!P)throw Error("selectedPalette not found");var S=function(){return(0,E.T)(e,s)(c.hash)},y=(0,w.pl)(c),A=(n=(0,r._)(function(){var e,t,n,r,i,u,l,d,h,g,w,E,I,A,T,C,R,k,U,x,D,N,Y,F,H,M,O=arguments;return(0,a.YH)(this,function(a){switch(a.label){case 0:return n=void 0===(t=(e=O.length>0&&void 0!==O[0]?O[0]:{}).scaleFactor)?1:t,i=void 0===(r=e.palette)?P:r,l=void 0===(u=e.framePalette)?_:u,d=e.lockFrame,h=e.invertPalette,g=e.invertFramePalette,E=void 0===(w=e.handleExportFrame)?o:w,[4,S()];case 1:if(I=a.sent(),!(T=s.find(function(e){return e.id===c.frame})))return[3,3];return[4,(0,v.mZ)(T.hash)];case 2:return R=a.sent(),[3,4];case 3:R=null,a.label=4;case 4:if(k=(C=R)?C.upper.length/20:2,!y)return[3,6];return[4,(0,p.y1)({tiles:I,palette:i,lockFrame:void 0!==d?d:c.lockFrame,imageStartLine:k,rotation:c.rotation,scaleFactor:n,handleExportFrame:E},"image/png")];case 5:return A=a.sent(),[3,8];case 6:return U=(null==i?void 0:i.palette)||p.CU,x=(null==l?void 0:l.palette)||p.CU,N=(D=(0,b.f)(c)).invertPalette,Y=D.invertFramePalette,F=(0,m.C)({imagePalette:U,framePalette:x,invertPalette:void 0!==h?h:N,invertFramePalette:void 0!==g?g:Y}),[4,(0,p.Yn)((0,f._)({tiles:I,imageStartLine:k,rotation:c.rotation,scaleFactor:n,handleExportFrame:E},F),"image/png")];case 7:A=a.sent(),a.label=8;case 8:return[4,createImageBitmap(A)];case 9:return H=a.sent(),(M=document.createElement("canvas")).width=H.width,M.height=H.height,M.getContext("2d").drawImage(H,0,0),[2,M]}})}),function(){return n.apply(this,arguments)});return{getMeta:(0,r._)(function(){return(0,a.YH)(this,function(e){return[2,(0,d._)((0,f._)({},c),{isRGBN:y})]})}),getPalette:(0,r._)(function(){return(0,a.YH)(this,function(e){return[2,P]})}),getTiles:S,getCanvas:A}}},P=n(91540),_=n(39630),S=n(40774),y=n(27338),A=function(e,t){var n=e.addImages,i=e.setDialog,s=e.dismissDialog;return{importFiles:(0,y.A)(t),setDialog:i,alert:function(e,t){return i({message:"Plugin: ".concat(e),questions:function(){return[{label:t,key:"info",type:_.V.INFO}]},confirm:(0,r._)(function(){return(0,a.YH)(this,function(e){return[2,s(0)]})})})},dismissDialog:function(){return s(0)},addImages:n}},T=function(e,t){var n=A(e,t),r=n.setDialog,a=n.dismissDialog,i=n.importFiles,s=n.addImages,u=n.alert;return{dispatch:function(e){switch(console.warn('You are using a legacy method: "dispatch('.concat(e.type,')". Please refer to "env.functions" from your plugin to switch to up-to-date methods')),e.type){case S.B.CONFIRM_ASK:r(e.payload);break;case S.B.CONFIRM_ANSWERED:a();break;case S.B.IMPORT_FILES:i(e.payload.files);break;case S.B.ADD_IMAGES:s(e.payload);break;default:u("Plugin error:",'Unhandled Compatibility Action (type:"'.concat(e.type,'")'))}}}},C=function(e,t){var n=e.startProgress,r=e.setProgress,a=e.stopProgress,i=e.addUpdatePluginProperties,s=e.collectImageData,u=e.stores,o=e.importFn,c=t.url,l=t.config,f=void 0===l?{}:l,d="",p=function(e){var i=Math.min(1,Math.max(0,e));if(d&&(0===i||1===i)){a(d),d="";return}d||(d=n(t.name||"Plugin")),r(d,i)};return new Promise(function(e){window.gbpwRegisterPlugin=function(t){if(window.gbpwRegisterPlugin=function(){},!t)return void e(null);try{var n=new t({saveAs:P.saveAs,progress:p,store:T(u,o),functions:A(u,o),collectImageData:s},f),r=n.name,a=n.description,l=n.configParams,d=n.config;i({url:c,name:r,description:void 0===a?"":a,configParams:void 0===l?{}:l,config:void 0===d?{}:d,loading:!1,error:!1}),e(n)}catch(t){i({url:c,loading:!1,error:null==t?void 0:t.message}),e(null)}};var t=document.createElement("script");document.head.appendChild(t),t.addEventListener("error",function(){window.gbpwRegisterPlugin=function(){},i({url:c,loading:!1,error:"Loading error"}),e(null)}),t.src=c})},R=n(6617);function k(e){var t,n=e.children,f=(0,l.h)(),d=f.plugins,p=f.images,h=f.addUpdatePluginProperties,v=(0,o.g)(),g=(0,c.A)(),m=g.startProgress,b=g.setProgress,w=g.stopProgress,E=(0,u.W)().jsonImport,P=(0,s.useMemo)(function(){return{collectImageData:I(p),addUpdatePluginProperties:h,startProgress:m,setProgress:b,stopProgress:w,stores:v,importFn:E}},[p,h,m,b,w,v,E]),_=(0,s.useMemo)(function(){var e;return e=(0,r._)(function(e){return(0,a.YH)(this,function(t){return[2,C(P,d.find(function(t){return t.url===e})||{url:""})]})}),function(t){return e.apply(this,arguments)}},[P,d]),S=(0,s.useCallback)((t=(0,r._)(function(e){return(0,a.YH)(this,function(t){switch(t.label){case 0:return[4,C(P,e)];case 1:return[2,!!t.sent()]}})}),function(e){return t.apply(this,arguments)}),[P]),y=(0,s.useMemo)(function(){var e,t;return{runWithImage:(e=(0,r._)(function(e,t){var n,r;return(0,a.YH)(this,function(a){switch(a.label){case 0:return r=I(p)(t),[4,_(e)];case 1:return null==(n=a.sent())||n.withImage(r),[2]}})}),function(t,n){return e.apply(this,arguments)}),runWithImages:(t=(0,r._)(function(e,t){var n,r;return(0,a.YH)(this,function(a){switch(a.label){case 0:return r=t.map(I(p)),[4,_(e)];case 1:return null==(n=a.sent())||n.withSelection(r),[2]}})}),function(e,n){return t.apply(this,arguments)}),validateAndAddPlugin:S}},[_,p,S]);return(0,i.jsx)(R.i.Provider,{value:y,children:n})}},53585:(e,t,n)=>{"use strict";n.d(t,{default:()=>E});var r,a=n(12115),i=n(97004),s=n(577),u=n(39249),o=n(83936),c=n(46498),l=n(27338),f=!1;let d=function(){var e=(0,c.A)(),t=e.setDragover,n=e.setError,d=(0,o.W)().jsonImport,p=(0,a.useMemo)(function(){return(0,l.A)(d)},[d]),h=(0,a.useCallback)(function(){var e,a=function(e){e.preventDefault(),f||t(!0),window.clearTimeout(r),f=!0,r=window.setTimeout(function(){f=!1,t(!1)},250)},o=(e=(0,i._)(function(e){var t,r,a;return(0,u.YH)(this,function(i){switch(i.label){case 0:e.preventDefault(),(r=e.dataTransfer.items)?t=(0,s._)(r).reduce(function(e,t){if("file"===t.kind){var n=t.getAsFile();return n?(0,s._)(e).concat([n]):e}return e},[]):(a=e.dataTransfer.files,t=(0,s._)(a)),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,p(t)];case 2:return i.sent(),[3,4];case 3:return n(i.sent()),[3,4];case 4:return[2]}})}),function(t){return e.apply(this,arguments)}),c=document.querySelector("body");if(!c)throw Error("dafuq?");return c.addEventListener("dragover",a),c.addEventListener("drop",o),function(){c.removeEventListener("dragover",a),c.removeEventListener("drop",o)}},[p,t,n]);(0,a.useEffect)(h,[h])};var p=n(78538),h=n(35695),v=n(45465),g=function(){var e=(0,v.Y)().getUrl,t=window.location.hash.length<2?"":window.location.hash;(0,a.useEffect)(function(){if(t){var n=t.slice(1).split("/").filter(Boolean),r=n[0],a="";switch(r){case"gallery":var i,s=(0,p._)(n.slice(-2),2),u=s[0],o=s[1];(i="page"===u?n.slice(1,-2).join("/"):n.slice(1).join("/")).length||(null==o?void 0:o.length)?(i.length&&(i="".concat(i,"/")),a=e({group:i,pageIndex:parseInt(o,10)-1})):a="/gallery/";break;case"add-plugin":a="add-plugin/?pluginUrl=".concat(n.slice(1).join("/"));break;case"settings":var c=n[1];a="settings/".concat(c,"/");break;case"home":break;default:(null==r?void 0:r.length)&&(a="".concat(n.join("/"),"/"))}window.location.hash="",window.setTimeout(function(){(0,h.redirect)(a)},10)}},[e,t])},m=n(633),b=n(47457),w=n(933);let E=function(e){var t=e.children;d(),g();var n=(0,m.g)(),r=(0,o.W)().remoteImport;(0,a.useEffect)(function(){return(0,(0,w.E)(n,r).subscribe)()},[r,n]);var i=(0,b.A)().checkUpdateTrashCount;return(0,a.useEffect)(function(){var e=window.setTimeout(function(){i()},1);return function(){return window.clearTimeout(e)}},[i]),t}},63669:(e,t,n)=>{"use strict";n.d(t,{PortsContext:()=>w});var r=n(97004),a=n(78538),i=n(577),s=n(39249),u=n(95155),o=n(12115),c=n(9718),l=n(39630),f=n(41186),d=[2400,4800,9600,19200,28800,38400,57600,76800,115200,230400,25e4,460800,576e3,921600,1e6],p=function(){var e=(0,f.A)(),t=e.setDialog,n=e.dismissDialog;return{querySettings:(0,o.useCallback)(function(){return new Promise(function(e){var a;t({confirm:(a=(0,r._)(function(t){return(0,s.YH)(this,function(r){return n(0),e({baudRate:parseInt((null==t?void 0:t.baudRate)||"115200",10)}),[2]})}),function(e){return a.apply(this,arguments)}),deny:(0,r._)(function(){return(0,s.YH)(this,function(t){return n(0),e(null),[2]})}),message:"Specify Baudrate for Port",questions:function(){return[{key:"baudRate",label:"Baud Rate",type:l.V.SELECT,options:d.map(function(e){return{value:e.toString(10),name:e.toString(10),selected:115200===e}})}]}})})},[n,t])}},h=n(64768);let v=function(){var e=(0,h.A)().handleFileImport;return(0,o.useCallback)(function(t){e([new File((0,i._)(t),"Text input.txt",{type:"text/plain"})])},[e])};var g=n(46498),m=function(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},b=n(32521);function w(e){var t=e.children,l=(0,a._)((0,o.useState)(null),2),f=l[0],d=l[1],h=(0,a._)((0,o.useState)(!1),2),w=h[0],E=h[1],I=(0,a._)((0,o.useState)(!1),2),P=I[0],_=I[1],S=(0,a._)((0,o.useState)([]),2),y=S[0],A=S[1],T=(0,a._)((0,o.useState)(!1),2),C=T[0],R=T[1],k=(0,a._)((0,o.useState)([]),2),U=k[0],x=k[1],D=(0,a._)((0,o.useState)(!1),2),N=D[0],Y=D[1],F=(0,a._)((0,o.useState)(null),2),H=F[0],M=F[1],O=v(),B=p().querySettings,L=(0,g.A)().setError;(0,o.useEffect)(function(){var e,t=new Worker(n.tu(new URL(n.p+n.u(9307),n.b)));return t.addEventListener("message",(e=(0,r._)(function(e){var n,r,a,i;return(0,s.YH)(this,function(s){switch(s.label){case 0:switch((n=e.data).type){case c.OU.ENABLED_STATE:return[3,1];case c.OU.ERROR:return[3,2];case c.OU.PORTS_CHANGE:return[3,3];case c.OU.DATA:return[3,4];case c.OU.RECEIVING:return[3,5];case c.OU.QUESTION:return[3,6]}return[3,8];case 1:return E(n.webSerialEnabled),_(n.webUSBEnabled),[3,9];case 2:return L(Error(n.errorMessage)),[3,9];case 3:switch(n.portType){case c.qt.SERIAL:x(n.activePorts);break;case c.qt.USB:A(n.activePorts)}return[3,9];case 4:switch(n.readResult.portDeviceType){case c._Y.PACKET_CAPTURE:O(n.readResult.string),M(null);break;case c._Y.SUPER_PRINTER_INTERFACE:M(null);break;case c._Y.INACTIVE:case c._Y.UNKNOWN:default:M(function(e){var t;return e?(t=n.readResult,{bytes:m(e.bytes,t.bytes),deviceId:e.deviceId||t.deviceId,portDeviceType:e.portDeviceType||t.portDeviceType,string:"".concat(e.string).concat(t.string)}):n.readResult})}switch(n.portType){case c.qt.SERIAL:Y(!1);break;case c.qt.USB:R(!1)}return[3,9];case 5:if(n.portDeviceType===c._Y.PACKET_CAPTURE)switch(n.portType){case c.qt.SERIAL:Y(!0);break;case c.qt.USB:R(!0)}return[3,9];case 6:return r=n.questionId,[4,B()];case 7:return a=s.sent(),i={portType:c.qt.SERIAL,type:c.vx.ANSWER,questionId:r,response:a},t.postMessage(i),[3,9];case 8:return[3,9];case 9:return[2]}})}),function(t){return e.apply(this,arguments)})),t.addEventListener("error",function(e){L(Error(e.message))}),d(t),function(){t.terminate(),d(null)}},[O,B,L]);var G=(0,o.useMemo)(function(){return!!(0,i._)(y).concat((0,i._)(U)).find(function(e){return e.portDeviceType===c._Y.INACTIVE})},[U,y]),W=(0,o.useCallback)((0,r._)(function(){var e;return(0,s.YH)(this,function(t){switch(t.label){case 0:if(!(w&&f))return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,navigator.serial.requestPort()];case 2:return t.sent().readable&&L(Error("device already opened")),e={type:c.vx.OPEN,portType:c.qt.SERIAL},f.postMessage(e),[3,4];case 3:return t.sent(),[3,4];case 4:return[2]}})}),[L,w,f]),j=(0,o.useCallback)((0,r._)(function(){var e;return(0,s.YH)(this,function(t){switch(t.label){case 0:if(!(P&&f))return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,navigator.usb.requestDevice({filters:c.k4})];case 2:return t.sent().opened&&L(Error("device already opened")),e={type:c.vx.OPEN,portType:c.qt.USB},f.postMessage(e),[3,4];case 3:return t.sent(),[3,4];case 4:return[2]}})}),[L,P,f]),q=(0,o.useCallback)(function(e,t){if(f){var n={type:c.vx.SEND_DATA,deviceId:t,message:e};f.postMessage(n)}},[f]),K=(0,o.useMemo)(function(){return{hasInactiveDevices:G,openWebSerial:W,openWebUSB:j,sendDeviceMessage:q,unknownDeviceResponse:H,webSerialActivePorts:U,webSerialEnabled:w,webSerialIsReceiving:N,webUSBActivePorts:y,webUSBEnabled:P,webUSBIsReceiving:C,worker:f}},[G,W,j,q,H,U,w,N,y,P,C,f]);return(0,u.jsx)(b.U.Provider,{value:K,children:t})}},70940:(e,t,n)=>{"use strict";n.d(t,{n:()=>d});var r=n(78538),a=n(35695),i=n(12115),s=n(95939),u=n(45465),o=n(71620),c=n(52166),l=n(1470),f=n(66785),d=function(){var e=(0,a.useRouter)(),t=(0,s.Z)(),n=t.paths,d=t.root,p=t.isWorking,h=(0,r._)((0,i.useState)(!1),2),v=h[0],g=h[1],m=(0,o.A)(),b=m.sortBy,w=m.filtersActiveTags,E=m.recentImports,I=(0,c.A)().pageSize,P=(0,u.Y)(),_=P.path,S=P.getUrl,y=(0,i.useCallback)(function(e){return(0,f.S)(e,{filtersActiveTags:w,sortBy:b,recentImports:E})},[w,E,b]),A=(0,i.useCallback)(function(e,t){return Math.floor(y(t.images).findIndex(function(t){return t.hash===e})/I)},[y,I]),T=(0,i.useCallback)(function(e,t){var r;return e===l.t?S({pageIndex:t,group:""}):S({pageIndex:t,group:(null==(r=n.find(function(t){return e===t.group.id}))?void 0:r.absolutePath)||""})},[S,n]),C=(0,i.useMemo)(function(){var e;return(null==(e=n.find(function(e){return e.absolutePath===_}))?void 0:e.group)||d},[_,n,d]),R=(0,i.useCallback)(function(e){var t=n.find(function(t){return t.group.images.map(function(e){return e.hash}).includes(e)}),r=(null==t?void 0:t.absolutePath)||"";return S({pageIndex:A(e,(null==t?void 0:t.group)||d),group:r})},[A,S,n,d]),k=(0,i.useCallback)(function(e,t){window.setTimeout(function(){g({group:{id:e,pageIndex:t}})},1)},[]),U=(0,i.useCallback)(function(e){window.setTimeout(function(){g({imageHash:e})},1)},[]);return(0,i.useEffect)(function(){if(!p&&v){var t=window.setTimeout(function(){v.imageHash?(e.push(R(v.imageHash)),g(!1)):v.group&&(e.push(T(v.group.id,v.group.pageIndex)),g(!1))},1);return function(){window.clearTimeout(t)}}},[T,R,p,e,v]),{currentGroup:C,getGroupPath:T,getImagePageIndexInGroup:A,navigateToGroup:k,navigateToImage:U}}},95939:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(12115),a=n(32134),i=function(){return(0,r.useContext)(a.K)}}},e=>{var t=t=>e(e.s=t);e.O(0,[4453,7271,4831,5394,9758,5744,1760,3936,6950,4768,8441,8857,1684,7358],()=>t(43178)),_N_E=e.O()}]);