"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1575],{7451:(t,e,n)=>{n.d(e,{c:()=>a});var r=n(61975),s=n(71450),a=function(t){return(0,r._)(function(){return(0,s.YH)(this,function(e){return[2,new Promise(function(e){self.setTimeout(e,t)})]})})()}},18609:(t,e,n)=>{n.d(e,{A:()=>r});let r=function(t){return t.replace(/[^a-z0-9/\\._-]/gi,"").replace(/[\\/]+/gi,"/").replace(/^\//,"").replace(/\/$/,"")}},19357:(t,e,n)=>{n.d(e,{A:()=>a,Z:()=>s});var r=n(15376).Buffer,s=function(t){return t.UINT8_ARRAY="uint8array",t.TEXT="text",t.DATA_URL="dataURL",t}({});let a=function(t,e){return new Promise(function(n,s){var a=new FileReader;switch(a.onload=function(t){var a=t.target;if(null==a?void 0:a.result)return"uint8array"===e?void n(r.from(a.result)):void n(a.result);s(Error("Filereader has no result"))},a.onerror=function(t){s(t)},e){case"uint8array":a.readAsArrayBuffer(t);break;case"text":a.readAsText(t);break;case"dataURL":a.readAsDataURL(t);break;default:s(Error('readAs param missing or unknown type "'.concat(e,'"')))}})}},24849:(t,e,n)=>{n.d(e,{T:()=>o,p:()=>u});var r=n(61975),s=n(71450),a=n(17403),i=n(75036),o=function(t,e,n){var o=function(u,c,l,h){return(0,r._)(function(){var r,f,d,p,g,m,b,v,w,_,T,y;return(0,s.YH)(this,function(s){switch(s.label){case 0:if(f=t.find(function(t){return u===t.hash}),d=("string"==typeof l?l:null==f?void 0:f.frame)||void 0,p=null==(r=e.find(function(t){return t.id===d}))?void 0:r.hash,h||!(!f||!(0,a.pl)(f)))return[3,2];return[4,(0,i.Hh)(u,p,c,n)];case 1:return[2,s.sent()||[]];case 2:if(!(g=h||f.hashes).r)return[3,4];return[4,o(g.r,c,d)];case 3:return b=s.sent(),[3,5];case 4:b=[],s.label=5;case 5:if(m=b,!g.g)return[3,7];return[4,o(g.g,c,d)];case 6:return w=s.sent(),[3,8];case 7:w=[],s.label=8;case 8:if(v=w,!g.b)return[3,10];return[4,o(g.b,c,d)];case 9:return T=s.sent(),[3,11];case 10:T=[],s.label=11;case 11:if(_=T,!g.n)return[3,13];return[4,o(g.n,c,d)];case 12:return y=s.sent(),[3,14];case 13:y=[],s.label=14;case 14:return[2,{r:m,g:v,b:_,n:y}]}})})()};return o},u=function(t,e){var n=o(t,e);return function(t){return(0,r._)(function(){var e,r,a,i,o;return(0,s.YH)(this,function(s){switch(s.label){case 0:return[4,n(t,!0,"")];case 1:if(e=s.sent())return[2,(null==e?void 0:e.length)||(null==(r=e.r)?void 0:r.length)||(null==(a=e.g)?void 0:a.length)||(null==(i=e.b)?void 0:i.length)||(null==(o=e.n)?void 0:o.length)||0];return[2,0]}})})()}}},26213:(t,e,n)=>{n.d(e,{A:()=>l,F:()=>c});var r=n(87922),s=n(82732),a=n(45849),i=n(45377),o=n(74879),u=n(25959),c=function(t){return t.ERROR="error",t.DONE="done",t.MESSAGE="message",t}({});let l=(0,u.v)(function(t,e){return{progress:[],progressLog:{git:[],dropbox:[]},resetProgressLog:function(){return t({progressLog:{git:[],dropbox:[]}})},startProgress:function(e){var n={id:(0,o.A)(),label:e,value:0};return t(function(t){var e=t.progress;return{progress:(0,i._)(e).concat([n])}}),n.id},setProgress:function(e,n){t(function(t){return{progress:t.progress.map(function(t){return t.id!==e?t:(0,a._)((0,s._)({},t),{value:n})})}})},stopProgress:function(e){t(function(t){return{progress:t.progress.filter(function(t){return t.id!==e})}})},setProgressLog:function(n,o){var u=e().progressLog;t({progressLog:(0,a._)((0,s._)({},u),(0,r._)({},n,[o].concat((0,i._)(u[n]))))})}}})},42485:(t,e,n)=>{n.d(e,{A:()=>s});var r=n(45073);let s=function(t){return function(e){var n=t.filter(function(t){return![r.X3.FILTER_MONOCHROME,r.X3.FILTER_NEW,r.X3.FILTER_RGB,r.X3.FILTER_UNTAGGED,r.X3.FILTER_RECENT,r.X3.FILTER_FAVOURITE,r.X3.FILTER_COMMENTS,r.X3.FILTER_USERNAME].includes(t)});return!n.length||!!e.tags.find(function(t){return n.includes(t)})}}},62107:(t,e,n)=>{n.r(e),n.d(e,{dropBoxSyncTool:()=>B});var r=n(61975),s=n(82732),a=n(45849),i=n(45377),o=n(71450),u=n(21860),c=n.n(u),l=n(68370),h=n(57203),f=n(50751),d=n(72879),p=n(26213),g=n(15431),m=n(28802),b=n(7451),v=n(84784),w=n(84470),_=n(86790),T=n(24849);let y=function(){var t=new URLSearchParams(window.location.search).get("code");return t?(window.history.replaceState({},"",window.location.pathname),{dropboxCode:t}):{}};var A=n(92878),E=n(80404),R=n(41175),S=n(87773),H=n(44351),x=n(3037),L=n(22043),F=n(16459),C=n(26613),k=n(18609),D=n(19357),P=function(){return encodeURIComponent("".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname))},Y=function(t){function e(t,n){(0,H._)(this,e),(r=(0,S._)(this,e)).queueCallback=n,r.throttle=30,r.rootPath=[];var r,s,a=t.accessToken,i=t.expiresAt,o=t.refreshToken,u=t.path,c=t.autoDropboxSync;r.setRootPath(u),r.dbx=new C.Dropbox({clientId:"err6neqzlljod7b",accessToken:a,accessTokenExpiresAt:new Date(i||0),refreshToken:o});var l=null==(s=r.dbx)?void 0:s.auth;if(!l)throw Error("dbx auth error");return r.auth=l,c&&r.startLongPollSettings(),r}(0,x._)(e,t);var n=e.prototype;return n.addToQueue=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return(0,r._)(function(){return(0,o.YH)(this,function(t){if(!this.auth.getAccessToken())throw Error("not logged in");return[2,this.queueCallback.apply(this,(0,i._)(e))]})}).call(this)},n.setRootPath=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.rootPath=(0,k.A)(t).split("/")},n.toPath=function(t){var e=(0,i._)(this.rootPath).concat((0,i._)(t.split("/"))).filter(Boolean);return"/".concat(e.join("/"))},n.inSettingsPath=function(t){var e=this.toPath("settings");return(0,k.A)(t.replace(e,""))},n.checkLoginStatus=function(){return(0,r._)(function(){var t,e,n,r;return(0,o.YH)(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.auth.checkAndRefreshAccessToken()];case 1:return s.sent(),t=this.auth.getAccessToken(),n=(e=this.auth.getAccessTokenExpiresAt().getTime())-new Date().getTime(),this.emit("loginDataUpdate",{accessToken:t,expiresAt:e}),[2,!!t&&n>1e3];case 2:throw r=s.sent(),this.auth.setAccessTokenExpiresAt(new Date(0)),this.auth.setAccessToken(""),r;case 3:return[2]}})}).call(this)},n.startAuth=function(){return(0,r._)(function(){var t;return(0,o.YH)(this,function(e){switch(e.label){case 0:return[4,this.auth.getAuthenticationUrl(P(),void 0,"code","offline",void 0,void 0,!0)];case 1:return t=e.sent(),window.sessionStorage.setItem("dropboxCodeVerifier",this.auth.getCodeVerifier()),window.location.replace(t),[2]}})}).call(this)},n.codeAuth=function(t){return(0,r._)(function(){var e,n,r,s,a,i;return(0,o.YH)(this,function(o){switch(o.label){case 0:if(!(e=window.sessionStorage.getItem("dropboxCodeVerifier")))throw Error("no codeVerifier");return this.auth.setCodeVerifier(e),window.sessionStorage.removeItem("dropboxCodeVerifier"),[4,this.auth.getAccessTokenFromCode(P(),t)];case 1:return r=(n=o.sent().result).refresh_token,s=n.access_token,a=n.expires_in,i=new Date().getTime()+1e3*a,this.auth.setAccessToken(s),this.auth.setAccessTokenExpiresAt(new Date(i)),this.emit("loginDataUpdate",{refreshToken:r,accessToken:s,expiresAt:i}),[2]}})}).call(this)},n.getRemoteSettings=function(t){return(0,r._)(function(){var e,n;return(0,o.YH)(this,function(r){switch(r.label){case 0:e=this,r.label=1;case 1:return r.trys.push([1,4,,5]),[4,this.addToQueue("dbx.filesDownload /settings.json",this.throttle,function(){return e.dbx.filesDownload({path:e.toPath("/settings/settings.json")})},t)];case 2:return n=r.sent().result,[4,(0,D.A)(n.fileBlob,D.Z.TEXT)];case 3:return[2,JSON.parse(r.sent())];case 4:return r.sent(),[2,{state:{lastUpdateUTC:0,version:d.A}}];case 5:return[2]}})}).call(this)},n.getRemoteContents=function(){return(0,r._)(function(){var t,e,n,s,a,i,u;return(0,o.YH)(this,function(c){switch(c.label){case 0:return t=this,e=["images","frames"],n=!1,[4,this.checkLoginStatus()];case 1:if(!c.sent())throw Error("not logged in");return[4,this.getRemoteSettings(n)];case 2:return s=c.sent(),[4,Promise.all(e.map(function(e){return(0,r._)(function(){var t,r,s,a,i,u;return(0,o.YH)(this,function(o){switch(o.label){case 0:t=this,a="",o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.addToQueue("dbx.filesListFolder /".concat(e),this.throttle,function(){return t.dbx.filesListFolder({path:t.toPath("/settings/".concat(e)),limit:250,recursive:!0})},n)];case 2:return r=(i=o.sent()).result.entries,s=i.result.has_more,a=i.result.cursor,[3,4];case 3:return o.sent(),r=[],s=!1,[3,4];case 4:if(!s)return[3,6];return u=r.concat,[4,this.getMoreContents(a,n)];case 5:r=u.apply(r,[o.sent()]),o.label=6;case 6:return[2,r.filter(function(t){return"file"===t[".tag"]})]}})}).call(t)}))];case 3:return i=(a=L._.apply(void 0,[c.sent(),2]))[0],u=a[1],[2,{images:this.augmentFileList("images",i,n),frames:this.augmentFileList("frames",u,n),settings:s}]}})}).call(this)},n.getImageContents=function(){return(0,r._)(function(){var t,e,n,r,s,a;return(0,o.YH)(this,function(o){switch(o.label){case 0:t=this,r="",o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.addToQueue("dbx.filesListFolder /images",this.throttle,function(){return t.dbx.filesListFolder({path:t.toPath("/images"),limit:250,recursive:!0})})];case 2:return e=(s=o.sent()).result.entries,n=s.result.has_more,r=s.result.cursor,[3,4];case 3:return o.sent(),e=[],n=!1,[3,4];case 4:if(!n)return[3,6];return a=e.concat,[4,this.getMoreContents(r)];case 5:e=a.apply(e,[o.sent()]),o.label=6;case 6:return[2,e.reduce(function(t,e){return"file"===e[".tag"]?(0,i._)(t).concat([e]):t},[])]}})}).call(this)},n.getMoreContents=function(t,e){return(0,r._)(function(){var n,r,s,a,i,u;return(0,o.YH)(this,function(o){switch(o.label){case 0:n=this,a="",o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.addToQueue("dbx.filesListFolderContinue ".concat(t),this.throttle,function(){return n.dbx.filesListFolderContinue({cursor:t})},e)];case 2:return r=(i=o.sent()).result.entries,s=i.result.has_more,a=i.result.cursor,[3,4];case 3:return o.sent(),r=[],s=!1,[3,4];case 4:if(!s)return[3,6];return u=r.concat,[4,this.getMoreContents(a,e)];case 5:r=u.apply(r,[o.sent()]),o.label=6;case 6:return[2,r]}})}).call(this)},n.augmentFileList=function(t,e,n){var r=this;return e.map(function(s,a){var i,o=s.path_lower,u=s.content_hash,c=s.name,l=o?r.inSettingsPath(o):"";switch(t){case"images":case"frames":i=c.split(".")[0];break;default:i="-"}return{path:l,name:c,contentHash:u||"",hash:i,getFileContent:function(){return r.getFileContent(l,a,e.length,n)}}})},n.getFileContent=function(t,e,n){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,r._)(function(){var r,a,i,u;return(0,o.YH)(this,function(o){switch(o.label){case 0:return r=this,a=this.toPath("/settings/".concat(t)),i="dbx.filesDownload (".concat(e+1,"/").concat(n,") ").concat(a," ").concat(JSON.stringify(this.rootPath)),[4,this.addToQueue(i,this.throttle,function(){return r.dbx.filesDownload({path:a})},s)];case 1:return u=o.sent().result,[2,(0,D.A)(u.fileBlob,D.Z.TEXT)]}})}).call(this)},n.upload=function(t,e){return(0,r._)(function(){var n,s,a,i,u,c,l;return(0,o.YH)(this,function(h){switch(h.label){case 0:return n=this,s=t.upload,a=t.del,[4,Promise.all(s.map(function(t,a){return(0,r._)(function(){var n;return(0,o.YH)(this,function(r){switch(r.label){case 0:return n=this,[4,this.addToQueue("dbx.filesUpload (".concat(a+1,"/").concat(s.length,") ").concat(t.destination),this.throttle,function(){return n.dbx.filesUpload({path:n.toPath("/".concat(e,"/").concat(t.destination)),contents:t.blob,mode:{".tag":"overwrite"}})})];case 1:return[2,r.sent().result]}})}).call(n)}))];case 1:if(i=h.sent(),!a.length)return[2,{uploaded:i,deleted:[]}];return[4,this.addToQueue("dbx.filesDeleteBatch ".concat(a.length," files"),this.throttle,function(){return n.dbx.filesDeleteBatch({entries:a.map(function(t){var e=t.path;return{path:n.toPath("/settings/".concat(e))}})})})];case 2:return u=h.sent().result.async_job_id,[4,(c=function(){return(0,r._)(function(){var t,e,n,r;return(0,o.YH)(this,function(s){switch(s.label){case 0:return t=this,[4,this.addToQueue("dbx.filesDeleteBatchCheck ".concat(u),2e3,function(){return t.dbx.filesDeleteBatchCheck({async_job_id:u})})];case 1:if(n=(e=s.sent().result)[".tag"],r=e.entries,"in_progress"===n)return[2,c()];return[2,r.map(function(t){return t.metadata})]}})}).call(n)})()];case 3:return l=h.sent(),[2,{uploaded:i,deleted:l}]}})}).call(this)},n.startLongPollSettings=function(){return(0,r._)(function(){var t;return(0,o.YH)(this,function(e){switch(e.label){case 0:console.info("Start dropbox longpolling"),e.label=1;case 1:if(!m.A.getState().dropboxStorage.autoDropboxSync)return[3,7];e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.getRemoteSettings(!0)];case 3:return(t=e.sent()).state.lastUpdateUTC&&m.A.getState().setSyncLastUpdate("dropbox",t.state.lastUpdateUTC),[3,5];case 4:return console.error("Error polling Dropbox settings:",e.sent()),[3,5];case 5:return[4,(0,b.c)(2e4)];case 6:return e.sent(),[3,1];case 7:return[2]}})}).call(this)},e}(F.EventEmitter),I=n(51638),U=n.n(I),O=[],B=function(t,e){var n=f.A.getState(),u=n.setSyncBusy,S=n.setSyncSelect,H=p.A.getState().setProgressLog,x=new(c())(1,1/0),L=function(t){return function(e,n,s,a){return x.add(function(){return(0,r._)(function(){return(0,o.YH)(this,function(r){switch(r.label){case 0:return[4,(0,b.c)(n)];case 1:return r.sent(),a||H("dropbox",{timestamp:new Date().getTime()/1e3,message:"".concat(t," runs ").concat(e),type:p.F.MESSAGE}),[2,s()]}})})()})}},F=new Y(m.A.getState().dropboxStorage,L("Dropbox")),C=function(t){return(0,r._)(function(){return(0,o.YH)(this,function(e){return F.setRootPath(t.path||"/"),[2]})})()};F.on("loginDataUpdate",function(t){(0,m.A.getState().setDropboxStorage)(t)});var k=y().dropboxCode;return k&&F.codeAuth(k),m.A.subscribe(function(t){return t.dropboxStorage},C),{updateSettings:C,startSyncData:function(t){return(0,r._)(function(){var n,r,s,a,i,c,h,f;return(0,o.YH)(this,function(o){switch(o.label){case 0:u(!0),S(!1),o.label=1;case 1:return o.trys.push([1,11,,12]),n=m.A.getState().syncLastUpdate,[4,F.getRemoteContents()];case 2:switch(r=o.sent(),t){case l.p.UP:return[3,3];case l.p.DOWN:return[3,6]}return[3,9];case 3:return s=(null==n?void 0:n.local)||Math.floor(new Date().getTime()/1e3),[4,(0,_.A)(r,s,L("GBPrinter"))];case 4:return a=o.sent(),[4,F.upload(a,"settings")];case 5:return o.sent(),m.A.getState().setSyncLastUpdate("dropbox",s),[3,10];case 6:return[4,(0,E.Ay)(r)];case 7:return[4,e(o.sent())];case 8:return o.sent(),(h=(null==(c=r.settings)||null==(i=c.state)?void 0:i.lastUpdateUTC)||0)&&m.A.getState().setSyncLastUpdate("dropbox",h),[3,10];case 9:throw Error("dropbox sync: wrong sync case");case 10:return[3,12];case 11:return f=o.sent(),H("dropbox",{timestamp:new Date().getTime()/1e3,message:"Encountered an error during sync: ".concat(f.message),type:p.F.ERROR}),[3,12];case 12:return H("dropbox",{timestamp:new Date().getTime()/1e3,message:".",type:p.F.DONE}),u(!1),[2]}})})()},startSyncImages:function(){return(0,r._)(function(){var t,e,n,c,l,f,m,b,_,y,E,x,C,k,D,P,Y;return(0,o.YH)(this,function(I){switch(I.label){case 0:return u(!0),S(!1),e=(t=d.h.getState()).frames,n=t.palettes,c=t.images,f=(l=g.A.getState()).exportScaleFactors,m=l.exportFileTypes,b=l.handleExportFrame,_=l.fileNameStyle,y=h.A.getState(),E=(0,w.S)({images:c,groups:[]},y),x=(0,v.j)(f,m,b,n,_),C=(0,T.T)(c,e),[4,Promise.all(E.map(function(t,n){return(0,r._)(function(){return(0,o.YH)(this,function(s){return[2,L("Generate images and hashes")("".concat(n+1,"/").concat(E.length),10,function(){return(0,r._)(function(){var n,s,a,i,u;return(0,o.YH)(this,function(c){switch(c.label){case 0:return[4,C(t.hash)];case 1:if(n=c.sent(),!(s=e.find(function(e){return e.id===t.frame})))return[3,3];return[4,(0,R.mZ)(null==s?void 0:s.hash)];case 2:return i=c.sent(),[3,4];case 3:i=null,c.label=4;case 4:if(u=(a=i)?a.upper.length/20:2,!n)throw Error("tiles missing");return[4,x(t,n,u)];case 5:return[4,Promise.all(c.sent().map(function(t){return(0,r._)(function(){var e;return(0,o.YH)(this,function(n){switch(n.label){case 0:return e={filename:t.filename},[4,t.blob.arrayBuffer()];case 1:return[2,(e.arrayBuffer=n.sent(),e)]}})})()}))];case 6:return[2,c.sent()]}})})()})]})})()}))];case 1:return k=I.sent().flat(),[4,Promise.all((0,A.A)(k).map(function(t){return(0,r._)(function(){var e,n;return(0,o.YH)(this,function(u){switch(u.label){case 0:var c;return e=[(0,s._)({},t)],n={},[4,(c=t.arrayBuffer,(0,r._)(function(){var t,e,n;return(0,o.YH)(this,function(s){switch(s.label){case 0:return[4,Promise.all(U()(new Uint8Array(c),4194304).map(function(t){return(0,r._)(function(){var e;return(0,o.YH)(this,function(n){switch(n.label){case 0:return e=Uint8Array.bind,[4,crypto.subtle.digest("SHA-256",new Uint8Array(t))];case 1:return[2,i._.apply(void 0,[new(e.apply(Uint8Array,[void 0,n.sent()]))])]}})})()}))];case 1:return t=new Uint8Array(s.sent().flat()),n=Uint8Array.bind,[4,crypto.subtle.digest("SHA-256",t)];case 2:return e=new(n.apply(Uint8Array,[void 0,s.sent()])),[2,(0,i._)(e).map(function(t){return t.toString(16).padStart(2,"0")}).join("")]}})})())];case 1:return[2,a._.apply(void 0,e.concat([(n.dropboxContentHash=u.sent(),n)]))]}})})()}))];case 2:return D=I.sent(),[4,F.getImageContents()];case 3:return P=I.sent(),Y=D.reduce(function(t,e){var n=e.arrayBuffer,r=e.dropboxContentHash,s=e.filename;return -1===P.findIndex(function(t){var e=t.content_hash,n=t.name;return e===r&&n===s})?(0,i._)(t).concat([{blob:new Blob([n]),destination:s}]):t},[]),[4,F.upload({upload:Y,del:[]},"images")];case 4:return I.sent(),H("dropbox",{timestamp:new Date().getTime()/1e3,message:".",type:p.F.DONE}),u(!1),[2]}})})()},startAuth:function(){return F.startAuth()},recoverImageData:function(e){return(0,r._)(function(){var n,r;return(0,o.YH)(this,function(s){switch(s.label){case 0:if(n=t.updateImages,O.includes(e))return[3,3];return O.push(e),[4,F.getFileContent("images/".concat(e,".txt"),0,1,!0)];case 1:return r=s.sent(),[4,(0,E._K)(r)];case 2:s.sent(),n([]),s.label=3;case 3:return[2]}})})()}}}},66375:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(45377),s=n(36117),a=n.n(s),i=n(45073),o=n(17403);let u=function(t,e,n,s,u){var c=function(u){var c,l,h=t.reduce(function(t,e){return[i.X3.FILTER_MONOCHROME,i.X3.FILTER_NEW,i.X3.FILTER_RGB,i.X3.FILTER_UNTAGGED,i.X3.FILTER_RECENT,i.X3.FILTER_FAVOURITE,i.X3.FILTER_COMMENTS,i.X3.FILTER_USERNAME].includes(e)?(0,r._)(t).concat([e]):t},[]);if(h.length&&(h.includes(i.X3.FILTER_UNTAGGED)&&0!==u.tags.length||h.includes(i.X3.FILTER_NEW)&&a()(new Date(u.created)).unix()<=a()().subtract(1,"day").unix()||h.includes(i.X3.FILTER_RECENT)&&!s.map(function(t){return t.hash}).includes(u.hash)||h.includes(i.X3.FILTER_RGB)&&!(0,o.pl)(u)||h.includes(i.X3.FILTER_MONOCHROME)&&(0,o.pl)(u)||h.includes(i.X3.FILTER_FAVOURITE)&&!u.tags.includes(i.X3.FILTER_FAVOURITE)||h.includes(i.X3.FILTER_COMMENTS)&&!(null==(c=u.meta)?void 0:c.comment)||h.includes(i.X3.FILTER_USERNAME)&&!(null==(l=u.meta)?void 0:l.userName)))return!1;return(!n.length||"string"==typeof u.palette&&!!n.includes(u.palette))&&(!e.length||!!u.frame&&!!e.includes(u.frame))};return function(t){if(c(t))return!0;var e=u.find(function(e){return e.coverImage===t.hash})||null;return!!e&&e.allImages.some(c)}}},68370:(t,e,n)=>{n.d(e,{e:()=>s,p:()=>r});var r=function(t){return t.UP="up",t.DOWN="down",t}({}),s=function(t){return t.GIT="git",t.DROPBOX="dropbox",t.DROPBOXIMAGES="dropboximages",t}({})},80404:(t,e,n)=>{n.d(e,{Ay:()=>p,L2:()=>d,_K:()=>f});var r=n(61975),s=n(82732),a=n(45849),i=n(45377),o=n(71450),u=n(41175),c=n(17403),l=n(81200),h=n(75036),f=function(t){return(0,r._)(function(){var e;return(0,o.YH)(this,function(n){return e=t.split("\n").filter(function(t){return t.match(/^[0-9a-f ]+$/gi)}),[2,(0,h.UN)(e)]})})()},d=function(t){var e=Array(32).fill("f").join(""),n=Array(16).fill(e);return(0,i._)(t.upper).concat((0,i._)(Array(14).fill("").map(function(e,r){return(0,i._)(t.left[r]).concat((0,i._)(n),(0,i._)(t.right[r]))}).flat()),(0,i._)(t.lower))};let p=function(t){var e=t.images,n=t.frames,i=t.settings;return(0,r._)(function(){var t,p,g,m,b,v;return(0,o.YH)(this,function(w){switch(w.label){case 0:return t=i.state.images||[],p=i.state.frames||[],[4,Promise.all(e.map(function(t){return(0,r._)(function(){var e,n;return(0,o.YH)(this,function(r){switch(r.label){case 0:return[4,(0,h.Hh)(t.hash,void 0,!0)];case 1:if(null==(e=r.sent())?void 0:e.length)return[2,void 0];return[4,t.getFileContent()];case 2:return[4,f(r.sent())];case 3:if(n=r.sent(),t.hash!==n)return[2,{oldHash:t.hash,newHash:n}];return[2,void 0]}})})()}))];case 1:return g=w.sent().reduce(l.N,[]),[4,Promise.all(n.map(function(t){return(0,r._)(function(){var e;return(0,o.YH)(this,function(n){switch(n.label){case 0:return[4,(0,u.mZ)(t.hash)];case 1:if(n.sent())return[2,void 0];return[4,t.getFileContent()];case 2:var s;return[4,(s=n.sent(),(0,r._)(function(){var t,e,n;return(0,o.YH)(this,function(r){return e=(t=JSON.parse(s)).upper.length/20,n=d(t),[2,(0,u.R_)(n,e)]})})())];case 3:if(e=n.sent(),t.hash!==e)return[2,{oldHash:t.hash,newHash:e}];return[2,void 0]}})})()}))];case 2:return m=w.sent().reduce(l.N,[]),b=t.map(function(t){if((0,c.pl)(t)){var e=(0,s._)({},t.hashes),n=g.find(function(e){return e.oldHash===t.hashes.r}),r=g.find(function(e){return e.oldHash===t.hashes.g}),i=g.find(function(e){return e.oldHash===t.hashes.b}),o=g.find(function(e){return e.oldHash===t.hashes.n});return(null==n?void 0:n.newHash)&&(e.r=null==n?void 0:n.newHash),(null==r?void 0:r.newHash)&&(e.g=null==r?void 0:r.newHash),(null==i?void 0:i.newHash)&&(e.b=null==i?void 0:i.newHash),(null==o?void 0:o.newHash)&&(e.n=null==o?void 0:o.newHash),(0,a._)((0,s._)({},t),{hashes:e})}var u=g.find(function(e){return e.oldHash===t.hash});return(0,a._)((0,s._)({},t),{hash:(null==u?void 0:u.newHash)||t.hash})}),v=p.map(function(t){var e=m.find(function(e){return e.oldHash===t.hash});return e?(0,a._)((0,s._)({},t),{hash:e.newHash}):t}),[2,(0,a._)((0,s._)({},i),{state:(0,a._)((0,s._)({},i.state),{images:b,frames:v})})]}})})()}},81200:(t,e,n)=>{n.d(e,{N:()=>s});var r=n(45377),s=function(t,e){return e?(0,r._)(t).concat([e]):t}},81457:(t,e,n)=>{n.r(e),n.d(e,{gitSyncTool:()=>H,init:()=>S});var r,s,a=n(61975),i=n(71450),o=n(21860),u=n.n(o),c=n(68370),l=n(50751),h=n(26213),f=n(15431),d=n(28802),p=n(7451),g=n(86790),m=n(80404),b=n(87773),v=n(44351),w=n(3037),_=n(45377),T=n(16459),y=n.n(T),A=n(316),E=n(19357),R=function(t){function e(t,n,r){var s;return(0,v._)(this,e),(s=(0,b._)(this,e)).octoKit=null,s.busy=!1,s.owner="",s.repo="",s.branch="",s.throttle=10,s.token=null,s.progress=0,s.queueLength=0,s.addToQueue=r,s.getPreferredLocale=n,s.setOctokit(t||{}),s}(0,w._)(e,t);var n=e.prototype;return n.setOctokit=function(t){var e=t.use,n=t.owner,r=t.repo,s=t.branch,a=t.throttle,i=t.token;if(this.busy||!e||!n||!r||!s||!a||!i){this.octoKit=null,this.owner="",this.repo="",this.branch="",this.throttle=10,this.token=null;return}this.owner=n,this.repo=r,this.branch=s,this.throttle=Math.max(a,10)||10,this.token=i,this.octoKit=new A.E({auth:i})},n.progressStart=function(t){this.queueLength=t+7,this.emit("starting",{progress:0,queueLength:this.queueLength}),this.progressTick()},n.progressTick=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.progress=t?0:this.progress+1,this.emit("progress",{progress:this.progress,queueLength:this.queueLength}),t&&(this.queueLength=0)},n.getRepoContents=function(){return(0,a._)(function(){var t,e,n,r,s,a,o,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:return t=this,this.progressTick(),[4,this.addToQueue("repos.getBranch ".concat(this.branch),this.throttle,function(){var e;return null==(e=t.octoKit)?void 0:e.repos.getBranch({owner:t.owner,repo:t.repo,branch:t.branch})})];case 1:return e=i.sent().data.commit.sha,[4,this.addToQueue("git.getCommit ".concat(e),this.throttle,function(){var n;return null==(n=t.octoKit)?void 0:n.git.getCommit({owner:t.owner,repo:t.repo,commit_sha:e})})];case 2:return n=i.sent().data.tree.sha,[4,this.addToQueue("git.getTree ".concat(n),this.throttle,function(){var e;return null==(e=t.octoKit)?void 0:e.git.getTree({owner:t.owner,repo:t.repo,tree_sha:n,recursive:"1"})})];case 3:if(s=(r=i.sent().data.tree).find(function(t){return"settings.json"===t.path}),a=this.augmentFileList("images",r.filter(function(t){var e=t.path;return null==e?void 0:e.startsWith("images/")})),o=this.augmentFileList("frames",r.filter(function(t){var e=t.path;return null==e?void 0:e.startsWith("frames/")})),!(null==s?void 0:s.sha))return[3,5];return[4,this.getFileContent(s.sha,0,1)];case 4:return u=i.sent(),[3,6];case 5:u="{}",i.label=6;case 6:return[2,{images:a,frames:o,settings:JSON.parse(u)}]}})}).call(this)},n.augmentFileList=function(t,e){var n=this;return e.reduce(function(r,s,a){var i,o=s.path,u=s.sha;if(!o||!u)return r;var c=o.split("/").pop()||"";switch(t){case"images":case"frames":i=c.split(".")[0];break;default:i="-"}var l={path:o,name:c,hash:i,getFileContent:function(){return n.getFileContent(u,a,e.length)}};return(0,_._)(r).concat([l])},[])},n.getFileContent=function(t,e,n){return(0,a._)(function(){var r;return(0,i.YH)(this,function(s){switch(s.label){case 0:return r=this,this.progressTick(),[4,this.addToQueue("git.getBlob (".concat(e+1,"/").concat(n,") ").concat(t),this.throttle,function(){var e;return null==(e=r.octoKit)?void 0:e.git.getBlob({owner:r.owner,repo:r.repo,file_sha:t})})];case 1:var a;return[2,(a=s.sent().data.content,decodeURIComponent(Array.prototype.map.call(atob(a),function(t){return"%".concat("00".concat(t.charCodeAt(0).toString(16)).slice(-2))}).join("")))]}})}).call(this)},n.getCurrentCommit=function(){return(0,a._)(function(){var t,e,n;return(0,i.YH)(this,function(r){switch(r.label){case 0:return t=this,this.progressTick(),[4,this.addToQueue("git.getRef heads/".concat(this.branch),this.throttle,function(){var e;return null==(e=t.octoKit)?void 0:e.git.getRef({owner:t.owner,repo:t.repo,ref:"heads/".concat(t.branch)})})];case 1:return e=r.sent().data.object.sha,[4,this.addToQueue("git.getCommit ".concat(e),this.throttle,function(){var n;return null==(n=t.octoKit)?void 0:n.git.getCommit({owner:t.owner,repo:t.repo,commit_sha:e})})];case 2:return n=r.sent().data,[2,{commitSha:e,treeSha:n.tree.sha}]}})}).call(this)},n.createBlobForFile=function(t,e,n){return(0,a._)(function(t,e,n){var r,s,a,o,u,c,l;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r=this,s=t.destination,a=t.blob,this.progressTick(),[4,(0,E.A)(a,E.Z.DATA_URL)];case 1:return u=(o=i.sent()).indexOf(";base64,")+8,c=o.slice(u),[4,this.addToQueue("git.createBlob (".concat(e+1,"/").concat(n,") ").concat(s),this.throttle,function(){var t;return null==(t=r.octoKit)?void 0:t.git.createBlob({owner:r.owner,repo:r.repo,content:c,encoding:"base64"})})];case 2:return l=i.sent().data,[2,{filename:s,blobData:l}]}})}).apply(this,arguments)},n.createNewTree=function(t,e,n){return(0,a._)(function(){var r,s,a;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r=this,this.progressTick(),s=t.map(function(t){return{path:t.filename,mode:"100644",type:"blob",sha:t.blobData.sha}}),a=e.map(function(t){return{path:t.path,mode:"100644",sha:null}}),[4,this.addToQueue("git.createTree ".concat(n),this.throttle,function(){var t;return null==(t=r.octoKit)?void 0:t.git.createTree({owner:r.owner,repo:r.repo,tree:(0,_._)(s).concat((0,_._)(a)),base_tree:n})})];case 1:return[2,i.sent().data.sha]}})}).call(this)},n.createNewCommit=function(t,e,n){return(0,a._)(function(){var r;return(0,i.YH)(this,function(s){switch(s.label){case 0:return r=this,this.progressTick(),[4,this.addToQueue("git.createCommit ".concat(t),this.throttle,function(){var s;return null==(s=r.octoKit)?void 0:s.git.createCommit({owner:r.owner,repo:r.repo,message:t,tree:e,parents:[n]})})];case 1:return[2,s.sent().data.sha]}})}).call(this)},n.setBranchToCommit=function(t){return(0,a._)(function(){var e;return(0,i.YH)(this,function(n){switch(n.label){case 0:return e=this,this.progressTick(),[4,this.addToQueue("git.updateRef ".concat(t),this.throttle,function(){var n;return null==(n=e.octoKit)?void 0:n.git.updateRef({owner:e.owner,repo:e.repo,ref:"heads/".concat(e.branch),sha:t})})];case 1:return n.sent(),[2]}})}).call(this)},n.uploadToRepo=function(t){return(0,a._)(function(t){var e,n,r,s,a,o,u,c,l,h,f;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(e=this,n=t.upload,r=t.del,!this.octoKit)throw Error("OctoClient not configured");return s="Sync. ".concat(new Date().toLocaleString(this.getPreferredLocale())),a=n.length,[4,this.getCurrentCommit()];case 1:return u=(o=i.sent()).treeSha,c=o.commitSha,[4,Promise.all(n.map(function(t,n){return e.createBlobForFile(t,n,a)}))];case 2:return l=i.sent(),[4,this.createNewTree(l,r,u)];case 3:return h=i.sent(),[4,this.createNewCommit(s,h,c)];case 4:return f=i.sent(),[4,this.setBranchToCommit(f)];case 5:return i.sent(),[2]}})}).apply(this,arguments)},n.updateRemoteStore=function(t){return(0,a._)(function(t){var e,n,r;return(0,i.YH)(this,function(s){switch(s.label){case 0:e=t.upload,n=t.del,s.label=1;case 1:if(s.trys.push([1,3,,4]),this.busy)throw Error("currently busy");if(!e.length&&!n.length)return[2,{}];return this.progressStart(e.length),this.busy=!0,[4,this.uploadToRepo({upload:e,del:n})];case 2:return s.sent(),this.busy=!1,this.progressTick(!0),[2,{uploaded:e.map(function(t){return t.destination}),deleted:n.map(function(t){return t.path}),repo:"https://github.com/".concat(this.owner,"/").concat(this.repo,"/tree/").concat(this.branch)}];case 3:throw r=s.sent(),this.busy=!1,this.emit("error",r),r;case 4:return[2]}})}).apply(this,arguments)},e}(y()),S=function(){var t=d.A.getState().gitStorage,e=h.A.getState().setProgressLog,n=new(u())(1,1/0);r=new R(t,function(){return f.A.getState().preferredLocale},(s=function(t){return function(r,s,o){return n.add(function(){return(0,a._)(function(){return(0,i.YH)(this,function(n){switch(n.label){case 0:return[4,(0,p.c)(s)];case 1:return n.sent(),e("git",{timestamp:new Date().getTime()/1e3,message:"".concat(t," runs ").concat(r),type:h.F.MESSAGE}),[2,o()]}})})()})}})("OctoClient"))},H=function(t){var e=l.A.getState(),n=e.setSyncBusy,o=e.setSyncSelect,u=h.A.getState().setProgressLog,f=d.A.getState().syncLastUpdate,p=function(t){return(0,a._)(function(){return(0,i.YH)(this,function(e){switch(e.label){case 0:return[4,r.setOctokit(t)];case 1:return e.sent(),[2]}})})()};return d.A.subscribe(function(t){return t.gitStorage},p),{startSyncData:function(e){return(0,a._)(function(){var a,l,d,p;return(0,i.YH)(this,function(i){switch(i.label){case 0:n(!0),o(!1),i.label=1;case 1:return i.trys.push([1,10,,11]),[4,r.getRepoContents()];case 2:switch(a=i.sent(),e){case c.p.UP:return[3,3];case c.p.DOWN:return[3,6]}return[3,8];case 3:return l=(null==f?void 0:f.local)||Math.floor(new Date().getTime()/1e3),[4,(0,g.A)(a,l,s("GBPrinter"))];case 4:return d=i.sent(),[4,r.updateRemoteStore(d)];case 5:return i.sent(),[3,9];case 6:return[4,(0,m.Ay)(a)];case 7:return t(i.sent()),[3,9];case 8:throw Error("github sync: wrong sync case");case 9:return[3,11];case 10:return p=i.sent(),u("git",{timestamp:new Date().getTime()/1e3,message:"Encountered an error during sync: ".concat(p.message),type:h.F.ERROR}),[3,11];case 11:return u("git",{timestamp:new Date().getTime()/1e3,message:".",type:h.F.DONE}),n(!1),[2]}})})()},updateSettings:p}}},84470:(t,e,n)=>{n.d(e,{S:()=>o});var r=n(45377),s=n(85773),a=n(66375),i=n(42485),o=function(t,e){var n=t.images,o=t.groups,u=e.filtersTags,c=e.filtersFrames,l=e.filtersPalettes,h=e.sortBy,f=e.recentImports;return(0,r._)(n).map(s.YZ).sort((0,s.PM)(h)).map(s.lt).filter((0,a.A)(u,c,l,f,o)).filter((0,i.A)(u))}},85773:(t,e,n)=>{n.d(e,{PM:()=>u,YZ:()=>i,lt:()=>o});var r=n(82732),s=n(45849),a=n(22043),i=function(t,e){return(0,s._)((0,r._)({},t),{sortIndex:e})},o=function(t){return(0,s._)((0,r._)({},t),{sortIndex:void 0})},u=function(t){return function(e,n){if(!t)return 0;var r=(0,a._)(t.split("_"),2),s=r[0],i=r[1],o=e[s],u=n[s],c="desc"===i?-1:1;return o&&u?o>u?c:o<u?-c:e.sortIndex<n.sortIndex?c:-c:0}}},86790:(t,e,n)=>{n.d(e,{A:()=>b});var r=n(61975),s=n(45377),a=n(71450);let i=function(t,e,n,r){var a=t.images,i=t.frames,o=a.filter(function(t){var s=t.path;return!n.find(function(t){return s===t.destination})&&!e.find(function(t){return s===t.destination})&&!r.find(function(t){return s.indexOf(t)>=-1})}),u=i.filter(function(t){var r=t.path;return!n.find(function(t){return r===t.destination})&&!e.find(function(t){return r===t.destination})});return{upload:e.filter(function(t){var e=t.destination;return!a.find(function(t){return t.path===e})&&!i.find(function(t){return t.path===e})}),del:(0,s._)(o).concat((0,s._)(u))}};var o=n(46544),u=n(43230),c=function(t){switch(t){case"image/png":return"png";case"image/jpg":case"image/jpeg":return"jpg";case"image/webp":return"webp";case"text/plain":return"txt";case"text/markdown":return"md";case"application/json":case"text/json":return"json";default:return console.warn('unknown file extension for type "'.concat(t,'"')),"none"}},l=n(82732),h=n(45849),f=n(72879),d=n(41175),p=n(31343),g=n(17403),m=n(36336);let b=function(t,e,n){return(0,r._)(function(){var b,v,w,_,T,y,A,E,R,S,H,x;return(0,a.YH)(this,function(L){switch(L.label){case 0:return w=function(t,e){return(0,r._)(function(){var n,r,i,l,h;return(0,a.YH)(this,function(a){switch(a.label){case 0:return n=[],r=[],i={},t.forEach(function(t){var e,a,o=t.files,u=t.inRepo;(e=r).push.apply(e,(0,s._)(u.map(function(t){var e=t.path,n=e.split("/")[0];return i[n]=i[n]?i[n]+1:1,{destination:e}}))),(a=n).push.apply(a,(0,s._)(o.map(function(t){var e=t.blob,n=t.folder,r=t.filename,s=c(e.type),a=n||s;return i[a]=i[a]?i[a]+1:1,{destination:"".concat(a,"/").concat(r),blob:e}})))}),l=["## Files in this repo:"].concat((0,s._)(Object.keys(i).map(function(t){return" * ".concat(t,": [").concat(i[t],"](/").concat(t,")")}))).join("\n"),[4,(0,u.m)(o.m.JSON_EXPORT,{lastUpdateUTC:e})];case 1:return h=a.sent(),n.push({destination:"README.md",blob:new Blob((0,s._)(l),{type:"text/plain"})},{destination:"settings.json",blob:new Blob((0,s._)(h),{type:"application/json"})}),[2,{toUpload:n.filter(Boolean),toKeep:r.filter(Boolean)}]}})})()},_=[],[4,(0,r._)(function(){var e,i,o;return(0,a.YH)(this,function(u){switch(u.label){case 0:return e=[],o=(i=f.h.getState().images.map(function(e){var n=(0,g.pl)(e)?(0,m.A)(Object.values(e.hashes)).filter(Boolean):[e.hash];return{file:e,searchHashes:n,inRepo:t.images.reduce(function(t,e){return n.includes(e.hash)?(0,s._)(t).concat([e]):t},[])}})).length,[4,Promise.all(i.map(function(t,e){return(0,r._)(function(){return(0,a.YH)(this,function(s){return t.inRepo.length===t.searchHashes.length?[2,{hash:t.file.hash,inRepo:t.inRepo,files:[]}]:[2,n("loadImageTiles (".concat(e+1,"/").concat(o,") ").concat(t.file.title),3,function(){return(0,r._)(function(){var e,n,r;return(0,a.YH)(this,function(s){switch(s.label){case 0:if(!(0,g.pl)(t.file))return[3,2];return[4,Promise.all(Object.values((n=t.file).hashes).map(function(t){return(0,p.Z)(t,n.title,t)}))];case 1:return e=s.sent(),[3,4];case 2:return r=t.file,[4,(0,p.Z)(r.hash,r.title,r.hash)];case 3:e=[s.sent()],s.label=4;case 4:return[2,{hash:t.file.hash,files:e,inRepo:t.inRepo}]}})})()})]})})()}))];case 1:return[2,{syncImages:u.sent().filter(Boolean),missingLocally:e}]}})})()];case 1:return y=(T=L.sent()).syncImages,A=T.missingLocally,(b=_).push.apply(b,(0,s._)(A)),[4,(0,r._)(function(){var e,s,i;return(0,a.YH)(this,function(o){switch(o.label){case 0:return e=[],i=(s=f.h.getState().frames.map(function(e){return{file:e,searchHashes:[e.hash],inRepo:[t.frames.find(function(t){return t.hash===e.hash})].filter(Boolean)}})).length,[4,Promise.all(s.map(function(t,e){var s=t.file;return t.inRepo.length?(0,h._)((0,l._)({},s),{inRepo:t.inRepo,files:[]}):n("loadFrameData (".concat(e+1,"/").concat(i,") ").concat(s.id),3,function(){return(0,r._)(function(){var e;return(0,a.YH)(this,function(n){switch(n.label){case 0:return[4,(0,d.mZ)(s.hash)];case 1:return e=n.sent(),[2,(0,h._)((0,l._)({},s),{inRepo:t.inRepo,files:[{folder:"frames",filename:"".concat(s.hash,".json"),blob:new Blob(Array(JSON.stringify(e||"{}",null,2)),{type:"application/json"}),title:s.name}]})]}})})()})}))];case 1:return[2,{syncFrames:o.sent().filter(Boolean),missingLocally:e}]}})})()];case 2:return R=(E=L.sent()).syncFrames,S=E.missingLocally,(v=_).push.apply(v,(0,s._)(S)),H=(0,s._)(y).concat((0,s._)(R)),[4,w(H,e)];case 3:return[2,i(t,(x=L.sent()).toUpload,x.toKeep,_)]}})})()}}}]);