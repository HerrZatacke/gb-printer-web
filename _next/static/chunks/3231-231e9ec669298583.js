"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3231],{17654:(e,t,r)=>{r.d(t,{s:()=>i});var a=r(15719),n=r(17403),i=function(e,t){if((0,n.pl)(t))return{palette:t.palette};var r=e.find(function(e){return e.shortName===t.palette})||a.Fv,i=e.find(function(e){return e.shortName===t.framePalette})||a.Fv;return{palette:r,framePalette:t.lockFrame?i:r}}},26490:(e,t,r)=>{r.d(t,{C:()=>u});var a=r(45377),n=r(96569),i=function(e){var t=e.replace("#","");if(!/^([0-9a-fA-F]{6})$/.test(t))throw Error("Invalid hex color");return parseInt(t,16)},u=function(e){var t=e.imagePalette,r=e.framePalette,u=e.invertPalette,s=e.invertFramePalette,c=(t||n.CU).map(i),o=(null==r?void 0:r.map(i))||c;return{imagePalette:void 0!==u&&u?(0,a._)(c).reverse():(0,a._)(c),framePalette:void 0!==s&&s?(0,a._)(o).reverse():(0,a._)(o)}}},31343:(e,t,r)=>{r.d(t,{Z:()=>c});var a=r(61975),n=r(45377),i=r(71450),u=r(15719),s=r(75036),c=function(e,t,r){return(0,a._)(function(){var a,c;return(0,i.YH)(this,function(i){switch(i.label){case 0:return[4,(0,s.Hh)(e)];case 1:return a=(i.sent()||[]).map(function(e){var t;return(null==(t=e.match(/.{1,2}/g))?void 0:t.join(" "))||""}).reduce(function(e,t,r){return r%40?(0,n._)(e).concat([t]):(0,n._)(e).concat([u.g0,t])},[]),c=[u.dm].concat((0,n._)(a),[u.R2,u.Ys]).join("\n"),[2,{folder:"images",filename:"".concat(r,".txt"),blob:new Blob(Array(c),{type:"text/plain"}),title:t}]}})})()}},35797:(e,t,r)=>{r.d(t,{f:()=>a});var a=function(e){var t=e.invertPalette||!1;if(!e.lockFrame)return{invertPalette:t,invertFramePalette:t};var r=e.invertFramePalette;return{invertPalette:t,invertFramePalette:void 0===r?t:r}}},43230:(e,t,r)=>{r.d(t,{m:()=>_});var a=r(61975),n=r(82732),i=r(45849),u=r(71450),s=r(46544),c=r(99861),o=r(72879),l=r(10022),f=r(94468);let m=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";switch(e){case"frames":return t;case"current_framegroup":return t.filter(function(e){return e.id.startsWith(r)});default:return[]}},p=function(e,t,r){switch(e){case"images":return t.map(function(e){return e.hash});case"selected_images":return r;default:return[]}};var d=r(45377),h=r(17403),g=r(36336),v=function(e){switch(e){case s.m.ALL:case s.m.JSON_EXPORT:return["frameGroups","frames","imageGroups","images","palettes","plugins"];case s.m.SELECTED_IMAGES:return["images"];case s.m.IMAGES:return["images","imageGroups"];case s.m.PALETTES:return["palettes"];case s.m.FRAMES:case s.m.CURRENT_FRAMEGROUP:return["frames","frameGroups"];case s.m.PLUGINS:return["plugins"];default:return[]}},_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.lastUpdateUTC,_=t.selectedFrameGroup;return(0,a._)(function(){var t,E,w,S,P,b,A,R,G,F,I,U,C,T,M;return(0,u.YH)(this,function(y){var L,N;switch(y.label){case 0:if(S=(w=l.Vs.getState()).frames,P=w.images,b=w.palettes,A=w.imageGroups,R=w.frameGroups,G=w.plugins,F=l.cr.getState().imageSelection,I=(0,i._)((0,n._)({},v(e).reduce(function(t,r){switch(r){case"frameGroups":return(0,i._)((0,n._)({},t),{frameGroups:e===s.m.CURRENT_FRAMEGROUP?R.filter(function(e){return e.id===_}):(0,c.E)(S,R)});case"frames":var a=e===s.m.FRAMES?s.m.FRAMES:s.m.CURRENT_FRAMEGROUP;return(0,i._)((0,n._)({},t),{frames:m(a,S,_)});case"imageGroups":return(0,i._)((0,n._)({},t),{imageGroups:A});case"images":var u=p(e===s.m.SELECTED_IMAGES?"selected_images":"images",P,F);return(0,i._)((0,n._)({},t),{images:P.filter(function(e){var t=e.hash;return u.includes(t)})});case"palettes":return(0,i._)((0,n._)({},t),{palettes:b.filter(function(e){return!e.isPredefined})});case"plugins":return(0,i._)((0,n._)({},t),{plugins:G});default:return t}},{})),{lastUpdateUTC:r||Math.floor(new Date().getTime()/1e3),version:o.A}),U={},!((null==(t=I.images)?void 0:t.length)&&[s.m.IMAGES,s.m.SELECTED_IMAGES,s.m.ALL].includes(e)))return[3,2];return C=[{},U],[4,(L=I.images,(0,a._)(function(){var e,t;return(0,u.YH)(this,function(r){switch(r.label){case 0:return[4,Promise.all(L.reduce(function(e,t){var r=(0,h.pl)(t)?(0,g.A)(Object.values(t.hashes)):[t.hash];return(0,d._)(e).concat((0,d._)(r))},[]).map(function(e){return(0,a._)(function(){return(0,u.YH)(this,function(t){switch(t.label){case 0:return[4,f.mU.getItem(e)];case 1:return[2,{hash:e,data:t.sent()}]}})})()}))];case 1:return e=r.sent(),t={},e.forEach(function(e){var r=e.hash,a=e.data;a&&(t[r]=a)}),[2,t]}})})())];case 1:U=n._.apply(void 0,C.concat([y.sent()])),y.label=2;case 2:if(!((null==(E=I.frames)?void 0:E.length)&&[s.m.FRAMES,s.m.CURRENT_FRAMEGROUP,s.m.ALL].includes(e)))return[3,4];return T=e===s.m.CURRENT_FRAMEGROUP?s.m.CURRENT_FRAMEGROUP:s.m.FRAMES,M=[{},U],[4,(N=m(T,S,_).map(function(e){return e.hash}),(0,a._)(function(){var e,t;return(0,u.YH)(this,function(r){switch(r.label){case 0:return[4,Promise.all(N.map(function(e){return(0,a._)(function(){return(0,u.YH)(this,function(t){switch(t.label){case 0:return[4,f.Uv.getItem(e)];case 1:return[2,{hash:e,data:t.sent()}]}})})()}))];case 1:return e=r.sent(),t={},e.forEach(function(e){var r=e.hash,a=e.data;a&&(t["frame-".concat(r)]=a)}),[2,t]}})})())];case 3:U=n._.apply(void 0,M.concat([y.sent()])),y.label=4;case 4:return[2,JSON.stringify((0,n._)({state:I},U),null,2)]}})})()}},46544:(e,t,r)=>{r.d(t,{m:()=>a});var a=function(e){return e.ALL="all",e.JSON_EXPORT="json_export",e.FRAMES="frames",e.CURRENT_FRAMEGROUP="current_framegroup",e.IMAGES="images",e.SELECTED_IMAGES="selected_images",e.PALETTES="palettes",e.PLUGINS="plugins",e}({})},55382:(e,t,r)=>{r.d(t,{g:()=>u});var a=r(12115),n=r(57203),i=r(10022),u=function(){var e=(0,i.M2)(),t=e.dismissDialog,r=e.setDialog,u=(0,i.vT)(),s=u.cancelEditFrame,c=u.cancelEditImages,o=u.cancelEditPalette,l=(0,i.cr)(),f=l.updateRecentImports,m=l.updateImageSelection,p=(0,i.lJ)().importQueueCancel,d=(0,i.I0)().setPrinterBusy,h=(0,i.Vs)(),g=h.addImages,v=h.deleteImages,_=h.setImageGroups,E=h.updateFrameGroups,w=h.updateImageHash,S=h.updateImages,P=h.setFrames,b=h.setImages,A=h.setPalettes,R=(0,i.N$)().setSyncLastUpdate;return(0,a.useMemo)(function(){var e=function(){return R("local",Math.floor(new Date().getTime()/1e3))},a=function(){d(!1),p()};return{addImages:function(r){g(r),t(0),e(),a(),f(r)},deleteImages:function(r){v(r),m(n.N.REMOVE,r),t(0),e()},dismissDialog:t,globalUpdate:function(t){s(),o(),c(),t.lastUpdateUTC?R("local",t.lastUpdateUTC):e(),t.palettes&&A(t.palettes),t.images&&(b(t.images),f(t.images)),t.frames&&P(t.frames),t.frameGroups&&E(t.frameGroups),t.imageGroups&&_(t.imageGroups)},importQueueCancel:a,setDialog:r,updateImageHash:function(t,r){c(),e(),w(t,r)},updateImages:function(t){S(t),e()},updateLastSyncLocalNow:e}},[g,s,c,o,v,t,p,r,P,b,A,_,d,R,E,w,m,S,f])}},83231:(e,t,r)=>{r.d(t,{W:()=>b});var a=r(61975),n=r(71450),i=r(12115),u=r(55382),s=r(65113),c=r(10022),o=r(84784),l=r(43230),f=r(94468),m=r(82732),p=r(45849),d=r(45377),h=r(37145),g=function(e){var t=(0,h.A)(e);return function(r,a){var n=new Map(r.map(function(t){return[t[e],t]})),i=a.map(function(t){var r=n.get(t[e]);return r?(0,m._)({},r,t):t});return t((0,d._)(i).concat((0,d._)(r)))}},v=g("hash"),_=g("id"),E=g("shortName"),w=g("id");let S=function(e,t,r,a,n,i){var u=e,s=r,c=t,o=a;return i?(n.frames&&n.frames.length&&(u=_(u,n.frames)),n.images&&n.images.length&&(s=v(s,n.images)),n.palettes&&n.palettes.length&&(c=E(c,n.palettes)),n.imageGroups&&n.imageGroups.length&&(o=w(o,n.imageGroups))):(u=n.frames||e,s=n.images||r,c=n.palettes||t,o=n.imageGroups||a),(0,p._)((0,m._)({},n),{images:s,frames:u,palettes:c,imageGroups:o})};var P=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a._)(function(){var r,a,i,u,o,l;return(0,n.YH)(this,function(n){switch(n.label){case 0:return a=(r=c.Vs.getState()).frames,i=r.palettes,u=r.images,o=r.imageGroups,[4,(0,s.i)(e)];case 1:return Object.keys(l=n.sent()).forEach(function(e){if("state"!==e){var t=l[e];e.match(/^[a-f0-9]{40,}$/gi)?f.mU.setItem("".concat(e),t):e.startsWith("frame-")&&f.Uv.setItem("".concat(e.split("frame-").pop()),t)}}),[2,S(a,i,u,o,l.state||{},t)]}})})()},b=function(){var e=(0,u.g)().globalUpdate;return{downloadSettings:(0,i.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,a._)(function(){var r,a;return(0,n.YH)(this,function(n){switch(n.label){case 0:return[4,(0,l.m)(e,{selectedFrameGroup:t})];case 1:return r=n.sent(),a="frames"===e?"frames":[e,t].filter(Boolean).join("_"),(0,o.R)(null)([{blob:new Blob(Array(r)),filename:"".concat(a,".json")}]),[2]}})})()},[]),jsonImport:(0,i.useCallback)(function(t){return(0,a._)(function(){return(0,n.YH)(this,function(r){switch(r.label){case 0:return[4,P(t,!0)];case 1:return e(r.sent()),[2]}})})()},[e]),remoteImport:(0,i.useCallback)(function(t){return(0,a._)(function(){return(0,n.YH)(this,function(r){switch(r.label){case 0:return[4,P(t,!1)];case 1:return e(r.sent()),[2]}})})()},[e])}}},84784:(e,t,r)=>{r.d(t,{R:()=>o,j:()=>w});var a=r(61975),n=r(71450),i=r(20097),u=r(7496),s=r.n(u),c=r(92878);let o=function(e){return function(t){return(0,a._)(function(){var r,a,u,o;return(0,n.YH)(this,function(n){switch(n.label){case 0:if(1===t.length)return r=t[0],[2,(0,i.saveAs)(r.blob,r.filename)];return a=new(s()),[4,Promise.all(t.map(function(e){var t,r=e.filename;return("function"==typeof(t=e.blob).arrayBuffer?t.arrayBuffer():new Promise(function(e){var r=new FileReader;r.onload=function(t){if(!t.target)throw Error("no file");var r=t.target.result;if("string"==typeof r||null===r)throw Error("unexpected filereader result");e(r)},r.readAsArrayBuffer(t)})).then(function(e){return{filename:r,arrayBuffer:e}})}))];case 1:return u=n.sent(),(0,c.A)(u).forEach(function(e){var t=e.filename,r=e.arrayBuffer;a.file(t,r)}),[4,a.generateAsync({type:"blob",compression:"DEFLATE"})];case 2:if(o=n.sent(),!e)throw Error("missing filename");return[2,(0,i.saveAs)(o,"".concat(e,".zip"))]}})})()}};var l=r(82732),f=r(45849),m=r(45377),p=r(96569),d=r(99353),h=r(17654),g=r(26490),v=r(35797),_=r(17403),E=r(31343);let w=function(e,t,r,i,u){return function(s,c,o){return(0,a._)(function(){var w,S,P,b,A,R,G,F,I;return(0,n.YH)(this,function(U){switch(U.label){case 0:if(w=(0,_.pl)(s),S=s.lockFrame||!1,P=s.rotation||0,A=(b=(0,h.s)(i,s)).palette,R=b.framePalette,!A)throw Error("Palette missing?");return G=function(e,t){return(0,a._)(function(){var a,i,u,m;return(0,n.YH)(this,function(n){return w?[2,(0,p.y1)({tiles:c,palette:A,lockFrame:S,imageStartLine:o,rotation:P,scaleFactor:t,handleExportFrame:r},e)]:(i=(a=(0,v.f)(s)).invertPalette,u=a.invertFramePalette,m=(0,g.C)({imagePalette:A.palette||p.CU,framePalette:(null==R?void 0:R.palette)||p.CU,invertPalette:i,invertFramePalette:u}),[2,(0,p.Yn)((0,f._)((0,l._)({tiles:c,rotation:P,scaleFactor:t,handleExportFrame:r},m),{imageStartLine:o}),e)])})})()},F=(0,m._)(e).filter(function(e){return"number"==typeof e}),I=(0,m._)(t),F.length||F.push(4),I.length||I.push("png"),[4,Promise.all(F.map(function(e){return I.map(function(t){return new Promise(function(r){var a=(0,d.A)({image:s,palette:A,exportScaleFactor:e,fileNameStyle:u});switch(t){case"txt":if(w)return void r(null);(0,E.Z)(s.hash,s.title,a).then(r);break;case"pgm":if(w)return void r(null);G("image/png",e).then(createImageBitmap).then(function(e){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var i=n.getContext("2d");i.drawImage(e,0,0);var u=A.palette;if(!i||!(null==u?void 0:u.length))return void r(null);for(var c=["P2","#","# Exported from ".concat(window.location.origin),"#","# hash: ".concat(s.hash),"# created: ".concat(s.created),"# title: ".concat(s.title),"# tags: ".concat(s.tags.join(", ")),"# dimension: ".concat(n.width,"*").concat(n.height," pixels"),"#","".concat(n.width," ").concat(n.height),"3","#"],o=0;o<n.height;o+=1){for(var l=[],f=0;f<n.width;f+=1){var m=i.getImageData(f,o,1,1).data,d="#"+m[0].toString(16).padStart(2,"0")+m[1].toString(16).padStart(2,"0")+m[2].toString(16).padStart(2,"0"),h=A.palette.indexOf(d);-1===h&&(h=p.eJ.indexOf(parseInt(d.slice(1),16))),l.push(3-h)}c.push(l.join(" "))}r({filename:"".concat(a,".").concat(t),blob:new Blob([c.join("\n")],{type:"text/plain"}),title:s.title})});break;default:G("image/".concat(t),e).then(function(e){r({filename:"".concat(a,".").concat(t),blob:e,title:s.title})}).catch(function(){return r(null)})}})})}).flat())];case 1:return[2,U.sent().reduce(function(e,t){return t?(0,m._)(e).concat([t]):e},[])]}})})()}}},92878:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(82732),n=r(45849);let i=function(e){var t=[];return e.map(function(e){var r=e.filename,i=r.split("."),u=i.pop();if(!u)throw Error("unknown file type");for(var s=i.join("."),c=r,o=0;t.includes(c);)o+=1,c="".concat(s,"_(").concat(o,").").concat(u);return t.includes(c)||t.push(c),(0,n._)((0,a._)({},e),{filename:c})})}},99353:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(36117),n=r.n(a),i=r(49611),u=r(89922),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return e.reduce(function(e,r){return r?"".concat(e).concat(e?t:"").concat(r):e},"")},c=function(e){var t=e.r,r=e.g,a=e.b,n=e.n,i=function(e){return e.toString(16).padStart(2,"0")};return s([(null==t?void 0:t.map(i).join(""))||"",(null==r?void 0:r.map(i).join(""))||"",(null==a?void 0:a.map(i).join(""))||"",(null==n?void 0:n.map(i).join(""))||""],".")};let o=function(e){var t,r,a=e.image||null,o=e.palette||null,l=e.exportScaleFactor||null,f=e.useCurrentDate||null,m=(null==(t=e.frameRate)?void 0:t.toString(10))||"",p=e.altTitle||"",d=e.frameName||"",h=e.paletteShort||"",g=e.fileNameStyle,v=!f&&(null==a?void 0:a.created)?n()(new Date(a.created)):n()(),_=v.isValid()?v.format("YYYYMMDD-HHmmss"):"",E=h||(o?o.shortName||c(o):""),w=a&&a.title?a.title:p;switch(g){case u.B.TITLE_ONLY:r=[w];break;case u.B.DATE_TITLE:r=[_,w];break;case u.B.FULL:default:r=[_,w,l?"".concat(l,"x"):"",m?"".concat(m,"fps"):"",d,E]}var S=s(r);return(0,i.A)(S,{replacement:""})}},99861:(e,t,r)=>{r.d(t,{E:()=>s,R:()=>c});var a=r(12115),n=r(10022),i=function(e,t,r){var a=r.find(function(t){return t.id===e});if(a)return a.name;switch(e){case"hk":return"Hallo Katze!";case"int":return"International Frames (GameBoy Camera)";case"jp":return"Japanese Frames (Pocket Camera)";default:return t}},u=function(e){switch(e){case"int":return"_1";case"jp":return"_2";case"hk":return"_3";default:return e}},s=function(e,t){return e.reduce(function(e,r){var a=r.id,n=r.name;try{var u,s=null==(u=a.match(/^[a-z]+/g))?void 0:u[0];if(!s)return e;return e.find(function(e){return e.id===s})||e.push({id:s,name:i(s,n,t)}),e}catch(t){return e}},[]).sort(function(e,t){var r=e.id,a=t.id,n=u(r),i=u(a);return n>i?1:n<i?-1:0})},c=function(){var e=(0,n.Vs)(),t=e.frameGroups,r=e.frames;return{frameGroups:(0,a.useMemo)(function(){return s(r,t)},[t,r])}}}}]);