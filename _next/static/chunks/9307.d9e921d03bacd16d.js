(()=>{var e={19307:(e,t,r)=>{"use strict";var n,i=r(577),a=r(86447),c=function(e){return e.USB="USB",e.SERIAL="SERIAL",e}({}),s=function(e){return e.UNKNOWN="unknown",e.PASSIVE="passive",e.INACTIVE="inactive",e.PACKET_CAPTURE="packet_capture",e.SUPER_PRINTER_INTERFACE="super_printer_interface",e}({});n={},(0,a._)(n,"unknown","Unknown Device"),(0,a._)(n,"passive","Passive Device"),(0,a._)(n,"inactive","Inactive Device"),(0,a._)(n,"packet_capture","Packet Capture device"),(0,a._)(n,"super_printer_interface","Super Printer Interface");var o=function(e){return e.OPEN="OPEN",e.SEND_DATA="SEND_DATA",e.ANSWER="ANSWER",e}({}),u=function(e){return e.ENABLED_STATE="ENABLED_STATE",e.ERROR="ERROR",e.PORTS_CHANGE="PORTS_CHANGE",e.DATA="DATA",e.RECEIVING="RECEIVING",e.QUESTION="QUESTION",e}({}),d=r(97004),v=r(26002),f=r(65492),p=r(66214),l=r(39249),g=r(40662),h=r.n(g),y=function(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r},P=function(e){function t(){var e;return(0,f._)(this,t),(e=(0,v._)(this,t)).portDeviceType=s.UNKNOWN,e.readTimeoutDuration=1e3,e}(0,p._)(t,e);var r=t.prototype;return r.getPortDeviceType=function(){return this.portDeviceType},r.detectPassiveDevice=function(){var e=this;return(0,d._)(function(){return(0,l.YH)(this,function(t){switch(t.label){case 0:return[4,e.send(new Uint8Array([13,10]))];case 1:return t.sent(),[4,e.send(new Uint8Array([161]))];case 2:return t.sent(),[2]}})})()},r.readLoop=function(){var e=this;return(0,d._)(function(){var t,r,n,a,c,o,u,v;return(0,l.YH)(this,function(f){var p,g;switch(f.label){case 0:t=0,r={string:"",bytes:new Uint8Array([]),deviceId:e.getId(),portDeviceType:e.portDeviceType},n=function(){(0!==r.string.length||0!==r.bytes.byteLength)&&(e.emit("data",r),r.string="",r.bytes=new Uint8Array([]))},a=self.setTimeout((0,d._)(function(){return(0,l.YH)(this,function(t){return e.portDeviceType=s.PASSIVE,e.emit("typechange"),e.detectPassiveDevice(),a=self.setTimeout((0,d._)(function(){return(0,l.YH)(this,function(t){return n(),e.portDeviceType=s.INACTIVE,e.emit("typechange"),[2]})}),1500),[2]})}),1500),c=function(){-1!==r.string.indexOf("GAMEBOY PRINTER Packet Capture")||-1!==r.string.indexOf("GAMEBOY PRINTER Emulator")?(e.portDeviceType=s.PACKET_CAPTURE,self.clearTimeout(a),e.emit("typechange")):-1!==r.string.indexOf("Super Printer Interface by Rapha\xebl BOICHOT")&&(e.portDeviceType=s.SUPER_PRINTER_INTERFACE,e.readTimeoutDuration=10,self.clearTimeout(a),e.emit("typechange"))},p=(0,d._)(function(){return(0,l.YH)(this,function(t){return console.log((0,i._)(r.bytes)),e.portDeviceType=s.INACTIVE,self.clearTimeout(a),e.emit("typechange"),[2]})}),o=function(){return p.apply(this,arguments)},f.label=1;case 1:f.trys.push([1,8,,9]),f.label=2;case 2:if(!e.canRead())return[3,7];return[4,e.read()];case 3:if(u=f.sent(),e.emit("receiving"),self.clearTimeout(t),r={bytes:y((g=r).bytes,u.bytes),deviceId:g.deviceId||u.deviceId,portDeviceType:g.portDeviceType||u.portDeviceType,string:"".concat(g.string).concat(u.string)},e.portDeviceType!==s.UNKNOWN)return[3,4];return c(),[3,6];case 4:if(e.portDeviceType!==s.PASSIVE)return[3,6];return[4,o()];case 5:f.sent(),f.label=6;case 6:return t=self.setTimeout(n,e.readTimeoutDuration),[3,2];case 7:return[3,9];case 8:return v=f.sent(),e.emit("error",v.message),[3,9];case 9:return[2]}})})()},t}(h()),b=r(51368).A,T=function(e){function t(e){var r;return(0,f._)(this,t),(r=(0,v._)(this,t)).device=e,r.baudRate=0,r.reader=null,r.textDecoder=new TextDecoder,r.id=b(),r}(0,p._)(t,e);var r=t.prototype;return r.getDevice=function(){return this.device},r.getBaudRate=function(){return this.baudRate},r.getId=function(){return this.id},r.canRead=function(){return!!(this.reader&&this.getPortDeviceType()!==s.INACTIVE)},r.read=function(){var e=this;return(0,d._)(function(){var t,r,n;return(0,l.YH)(this,function(i){switch(i.label){case 0:return[4,null==(t=e.reader)?void 0:t.read()];case 1:return[2,{bytes:n=null==(r=i.sent())?void 0:r.value,string:e.textDecoder.decode(n),portDeviceType:e.getPortDeviceType(),deviceId:e.getId()}]}})})()},r.queryPortSettings=function(){var e=this;return(0,d._)(function(){var t;return(0,l.YH)(this,function(r){switch(r.label){case 0:return[4,new Promise(function(e){var t=b(),r=function(n){n.data.type===o.ANSWER&&n.data.questionId===t&&(self.removeEventListener("message",r),e(n.data.response))};self.addEventListener("message",r),postMessage({type:u.QUESTION,questionId:t})})];case 1:return e.baudRate=(null==(t=r.sent())?void 0:t.baudRate)||0,[2]}})})()},r.connect=function(){var e=this;return(0,d._)(function(){return(0,l.YH)(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,e.queryPortSettings()];case 1:if(t.sent(),!e.baudRate)return[2];return[4,e.device.open({baudRate:e.baudRate})];case 2:return t.sent(),e.device.addEventListener("disconnect",function(){e.emit("close")}),e.reader=e.device.readable.getReader(),e.readLoop(),[3,4];case 3:return console.error(t.sent()),e.emit("errormessage","could not mount device"),[3,4];case 4:return[2]}})})()},r.send=function(e){var t=this;return(0,d._)(function(){var r,n;return(0,l.YH)(this,function(i){switch(i.label){case 0:(null==(r=t.device)?void 0:r.writable)||t.emit("errormessage","device is not writable"),n=t.device.writable.getWriter(),i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,n.write(e)];case 2:return i.sent(),[3,5];case 3:return i.sent(),console.error("Failed to write to serial port"),[3,5];case 4:return n.releaseLock(),[7];case 5:return[2]}})})()},t}(P),E=new(function(e){function t(){var e;return(0,f._)(this,t),(e=(0,v._)(this,t)).enabled="undefined"!=typeof navigator&&!!navigator.serial&&!!TextDecoderStream,e.activePorts=[],e.initPorts(),e}(0,p._)(t,e);var r=t.prototype;return r.getActivePorts=function(){return this.activePorts},r.getWorkerPorts=function(){return this.getActivePorts().map(function(e){return{id:e.getId(),description:"".concat(e.getBaudRate()," baud"),portDeviceType:e.getPortDeviceType()}})},r.initDevice=function(e){var t=this;return(0,d._)(function(){var r;return(0,l.YH)(this,function(n){switch(n.label){case 0:if(e.readable)return[2];return(r=new T(e)).addListener("error",function(e){console.warn(e),t.activePorts=t.activePorts.filter(function(e){return e!==r}),t.emit("activePortsChange")}),r.addListener("errormessage",function(e){t.emit("errormessage",e)}),r.addListener("data",function(e){t.emit("data",e)}),r.addListener("receiving",function(){t.emit("receiving",r.getPortDeviceType())}),r.addListener("typechange",function(){t.emit("activePortsChange")}),[4,r.connect()];case 1:return n.sent(),t.activePorts.push(r),t.emit("activePortsChange"),[2]}})})()},r.initPorts=function(){var e=this;return(0,d._)(function(){return(0,l.YH)(this,function(t){switch(t.label){case 0:if(!e.enabled)return[2];return[4,navigator.serial.getPorts()];case 1:return t.sent().forEach(function(t){return e.initDevice(t)}),navigator.serial.addEventListener("connect",function(t){e.initDevice(t.target)}),navigator.serial.addEventListener("disconnect",function(t){e.activePorts=e.activePorts.filter(function(e){if(e.getDevice()===t.target)return!1}),e.emit("activePortsChange")}),[2]}})})()},t}(h())),m=function(e){function t(e){var r;return(0,f._)(this,t),(r=(0,v._)(this,t)).device=e,r.productName=e.productName||"",r.interfaceNumber=2,r.endpointIn=5,r.endpointOut=4,r.textDecoder=new TextDecoder,r.id=b(),r}(0,p._)(t,e);var r=t.prototype;return r.getDevice=function(){return this.device},r.getProductName=function(){return this.productName},r.getId=function(){return this.id},r.canRead=function(){return!!(this.device&&this.device.opened&&this.getPortDeviceType()!==s.INACTIVE)},r.read=function(){var e=this;return(0,d._)(function(){var t,r,n;return(0,l.YH)(this,function(i){switch(i.label){case 0:return[4,e.device.transferIn(e.endpointIn,64)];case 1:return r=(null==(t=i.sent())?void 0:t.data)||new DataView(new Uint8Array([]).buffer),[2,{bytes:n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),string:e.textDecoder.decode(n),portDeviceType:e.getPortDeviceType(),deviceId:e.getId()}]}})})()},r.connect=function(){var e=this;return(0,d._)(function(){var t,r,n,i;return(0,l.YH)(this,function(a){switch(a.label){case 0:return a.trys.push([0,6,,7]),[4,e.device.open()];case 1:return a.sent(),[4,null==(r=e.device)||null==(t=r.selectConfiguration)?void 0:t.call(r,1)];case 2:if(a.sent(),!(i=null==(n=e.device.configuration)?void 0:n.interfaces))return[2];return i.forEach(function(t){t.alternates.forEach(function(r){255===r.interfaceClass&&(e.interfaceNumber=t.interfaceNumber,r.endpoints.forEach(function(t){"out"===t.direction&&(e.endpointOut=t.endpointNumber),"in"===t.direction&&(e.endpointIn=t.endpointNumber)}))})}),[4,e.device.claimInterface(e.interfaceNumber)];case 3:return a.sent(),[4,e.device.selectAlternateInterface(e.interfaceNumber,0)];case 4:return a.sent(),[4,e.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:1,index:e.interfaceNumber})];case 5:return a.sent(),e.readLoop(),[3,7];case 6:return console.error(a.sent()),e.emit("errormessage","could not mount device"),[3,7];case 7:return[2]}})})()},r.send=function(e){var t=this;return(0,d._)(function(){return(0,l.YH)(this,function(r){switch(r.label){case 0:return[4,t.device.transferOut(t.endpointOut,e)];case 1:return r.sent(),[2]}})})()},t}(P),_=new(function(e){function t(){var e;return(0,f._)(this,t),(e=(0,v._)(this,t)).enabled="undefined"!=typeof navigator&&!!navigator.usb&&!!navigator.usb.getDevices,e.activePorts=[],e.initPorts(),e}(0,p._)(t,e);var r=t.prototype;return r.getActivePorts=function(){return this.activePorts},r.getWorkerPorts=function(){return this.getActivePorts().map(function(e){return{id:e.getId(),description:e.getProductName(),portDeviceType:e.getPortDeviceType()}})},r.initDevice=function(e){var t=this;return(0,d._)(function(){var r;return(0,l.YH)(this,function(n){switch(n.label){case 0:if(e.opened)return[2];return(r=new m(e)).addListener("error",function(e){console.warn(e),t.activePorts=t.activePorts.filter(function(e){return e!==r}),t.emit("activePortsChange")}),r.addListener("errormessage",function(e){t.emit("errormessage",e)}),r.addListener("data",function(e){t.emit("data",e)}),r.addListener("receiving",function(){t.emit("receiving",r.getPortDeviceType())}),r.addListener("typechange",function(){t.emit("activePortsChange")}),[4,r.connect()];case 1:return n.sent(),t.activePorts.push(r),t.emit("activePortsChange"),[2]}})})()},r.initPorts=function(){var e=this;return(0,d._)(function(){return(0,l.YH)(this,function(t){switch(t.label){case 0:if(!e.enabled)return[2];return[4,navigator.usb.getDevices()];case 1:return t.sent().forEach(function(t){return e.initDevice(t)}),navigator.usb.addEventListener("connect",function(t){e.initDevice(t.device)}),navigator.usb.addEventListener("disconnect",function(t){e.activePorts=e.activePorts.filter(function(e){if(e.getDevice()===t.device)return!1}),e.emit("activePortsChange")}),[2]}})})()},t}(h())),D=function(e){return function(){var t=e===c.SERIAL?E.getWorkerPorts():_.getWorkerPorts(),r={type:u.PORTS_CHANGE,activePorts:t,portType:e};self.postMessage(r)}};E.addListener("activePortsChange",D(c.SERIAL)),_.addListener("activePortsChange",D(c.USB));var A=function(e){return function(t){var r={type:u.DATA,readResult:t,portType:e};self.postMessage(r)}};E.addListener("data",A(c.SERIAL)),_.addListener("data",A(c.USB));var I=function(e){return function(t){var r={type:u.RECEIVING,portDeviceType:t,portType:e};self.postMessage(r)}};E.addListener("receiving",I(c.SERIAL)),_.addListener("receiving",I(c.USB)),self.onmessage=function(e){switch(e.data.type){case o.OPEN:switch(e.data.portType){case c.SERIAL:E.initPorts();break;case c.USB:_.initPorts()}break;case o.SEND_DATA:var t=e.data,r=t.deviceId,n=t.message,a=(0,i._)(E.getActivePorts()).concat((0,i._)(_.getActivePorts())).find(function(e){return e.getId()===r});if(!a)throw Error("device not found");a.send(n);break;case o.ANSWER:break;default:console.log(e)}},function(){var e={type:u.ENABLED_STATE,webSerialEnabled:E.enabled,webUSBEnabled:_.enabled};self.postMessage(e)}()}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}},c=!0;try{e[n](a,a.exports,r),c=!1}finally{c&&delete t[n]}return a.exports}r.m=e,r.x=()=>{var e=r.O(void 0,[8857,5294],()=>r(19307));return r.O(e)},(()=>{var e=[];r.O=(t,n,i,a)=>{if(n){a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,i,a];return}for(var s=1/0,c=0;c<e.length;c++){for(var[n,i,a]=e[c],o=!0,u=0;u<n.length;u++)(!1&a||s>=a)&&Object.keys(r.O).every(e=>r.O[e](n[u]))?n.splice(u--,1):(o=!1,a<s&&(s=a));if(o){e.splice(c--,1);var d=i();void 0!==d&&(t=d)}}return t}})(),r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce((t,n)=>(r.f[n](e,t),t),[])),r.u=e=>8857===e?"static/chunks/8857-c6bd5fbdb95a53ad.js":"static/chunks/"+e+".67e3aac338532d38.js",r.miniCssF=e=>{},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.tt=()=>(void 0===e&&(e={createScriptURL:e=>e},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(e=trustedTypes.createPolicy("nextjs#bundler",e))),e)})(),r.tu=e=>r.tt().createScriptURL(e),r.p="/gb-printer-web/_next/",(()=>{var e={9307:1};r.f.i=(t,n)=>{e[t]||importScripts(r.tu(r.p+r.u(t)))};var t=self.webpackChunk_N_E=self.webpackChunk_N_E||[],n=t.push.bind(t);t.push=t=>{var[i,a,c]=t;for(var s in a)r.o(a,s)&&(r.m[s]=a[s]);for(c&&c(r);i.length;)e[i.pop()]=1;n(t)}})(),(()=>{var e=r.x;r.x=()=>Promise.all([r.e(8857),r.e(5294)]).then(e)})(),_N_E=r.x()})();