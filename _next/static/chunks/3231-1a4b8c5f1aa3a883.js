"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3231],{17654:(e,t,r)=>{r.d(t,{s:()=>i});var n=r(15719),a=r(17403),i=function(e,t){if((0,a.pl)(t))return{palette:t.palette};var r=e.find(function(e){return e.shortName===t.palette})||n.Fv,i=e.find(function(e){return e.shortName===t.framePalette})||n.Fv;return{palette:r,framePalette:t.lockFrame?i:r}}},26490:(e,t,r)=>{r.d(t,{C:()=>u});var n=r(45377),a=r(96569),i=function(e){var t=e.replace("#","");if(!/^([0-9a-fA-F]{6})$/.test(t))throw Error("Invalid hex color");return parseInt(t,16)},u=function(e){var t=e.imagePalette,r=e.framePalette,u=e.invertPalette,c=e.invertFramePalette,s=(t||a.CU).map(i),o=(null==r?void 0:r.map(i))||s;return{imagePalette:void 0!==u&&u?(0,n._)(s).reverse():(0,n._)(s),framePalette:void 0!==c&&c?(0,n._)(o).reverse():(0,n._)(o)}}},31343:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(61975),a=r(45377),i=r(71450),u=r(15719),c=r(75036),s=function(e,t,r){return(0,n._)(function(){var n,s;return(0,i.YH)(this,function(i){switch(i.label){case 0:return[4,(0,c.Hh)(e)];case 1:return n=(i.sent()||[]).map(function(e){var t;return(null==(t=e.match(/.{1,2}/g))?void 0:t.join(" "))||""}).reduce(function(e,t,r){return r%40?(0,a._)(e).concat([t]):(0,a._)(e).concat([u.g0,t])},[]),s=[u.dm].concat((0,a._)(n),[u.R2,u.Ys]).join("\n"),[2,{folder:"images",filename:"".concat(r,".txt"),blob:new Blob(Array(s),{type:"text/plain"}),title:t}]}})})()}},35797:(e,t,r)=>{r.d(t,{f:()=>n});var n=function(e){var t=e.invertPalette||!1;if(!e.lockFrame)return{invertPalette:t,invertFramePalette:t};var r=e.invertFramePalette;return{invertPalette:t,invertFramePalette:void 0===r?t:r}}},43230:(e,t,r)=>{r.d(t,{m:()=>_});var n=r(61975),a=r(82732),i=r(45849),u=r(71450),c=r(46544),s=r(99861),o=r(72879),l=r(10022),f=r(94468);let m=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";switch(e){case"frames":return t;case"current_framegroup":return t.filter(function(e){return e.id.startsWith(r)});default:return[]}},p=function(e,t,r){switch(e){case"images":return t.map(function(e){return e.hash});case"selected_images":return r;default:return[]}};var d=r(45377),h=r(17403),g=r(36336),v=function(e){switch(e){case c.m.ALL:case c.m.JSON_EXPORT:return["frameGroups","frames","imageGroups","images","palettes","plugins"];case c.m.SELECTED_IMAGES:return["images"];case c.m.IMAGES:return["images","imageGroups"];case c.m.PALETTES:return["palettes"];case c.m.FRAMES:case c.m.CURRENT_FRAMEGROUP:return["frames","frameGroups"];case c.m.PLUGINS:return["plugins"];default:return[]}},_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.lastUpdateUTC,_=t.selectedFrameGroup;return(0,n._)(function(){var t,E,w,S,P,b,A,R,G,F,I,U,C,T,M;return(0,u.YH)(this,function(y){var L,N;switch(y.label){case 0:if(S=(w=l.Vs.getState()).frames,P=w.images,b=w.palettes,A=w.imageGroups,R=w.frameGroups,G=w.plugins,F=l.cr.getState().imageSelection,I=(0,i._)((0,a._)({},v(e).reduce(function(t,r){switch(r){case"frameGroups":return(0,i._)((0,a._)({},t),{frameGroups:e===c.m.CURRENT_FRAMEGROUP?R.filter(function(e){return e.id===_}):(0,s.E)(S,R)});case"frames":var n=e===c.m.FRAMES?c.m.FRAMES:c.m.CURRENT_FRAMEGROUP;return(0,i._)((0,a._)({},t),{frames:m(n,S,_)});case"imageGroups":return(0,i._)((0,a._)({},t),{imageGroups:A});case"images":var u=p(e===c.m.SELECTED_IMAGES?"selected_images":"images",P,F);return(0,i._)((0,a._)({},t),{images:P.filter(function(e){var t=e.hash;return u.includes(t)})});case"palettes":return(0,i._)((0,a._)({},t),{palettes:b.filter(function(e){return!e.isPredefined})});case"plugins":return(0,i._)((0,a._)({},t),{plugins:G});default:return t}},{})),{lastUpdateUTC:r||Math.floor(new Date().getTime()/1e3),version:o.A}),U={},!((null==(t=I.images)?void 0:t.length)&&[c.m.IMAGES,c.m.SELECTED_IMAGES,c.m.ALL].includes(e)))return[3,2];return C=[{},U],[4,(L=I.images,(0,n._)(function(){var e,t;return(0,u.YH)(this,function(r){switch(r.label){case 0:return[4,Promise.all(L.reduce(function(e,t){var r=(0,h.pl)(t)?(0,g.A)(Object.values(t.hashes)):[t.hash];return(0,d._)(e).concat((0,d._)(r))},[]).map(function(e){return(0,n._)(function(){return(0,u.YH)(this,function(t){switch(t.label){case 0:return[4,f.mU.getItem(e)];case 1:return[2,{hash:e,data:t.sent()}]}})})()}))];case 1:return e=r.sent(),t={},e.forEach(function(e){var r=e.hash,n=e.data;n&&(t[r]=n)}),[2,t]}})})())];case 1:U=a._.apply(void 0,C.concat([y.sent()])),y.label=2;case 2:if(!((null==(E=I.frames)?void 0:E.length)&&[c.m.FRAMES,c.m.CURRENT_FRAMEGROUP,c.m.ALL].includes(e)))return[3,4];return T=e===c.m.CURRENT_FRAMEGROUP?c.m.CURRENT_FRAMEGROUP:c.m.FRAMES,M=[{},U],[4,(N=m(T,S,_).map(function(e){return e.hash}),(0,n._)(function(){var e,t;return(0,u.YH)(this,function(r){switch(r.label){case 0:return[4,Promise.all(N.map(function(e){return(0,n._)(function(){return(0,u.YH)(this,function(t){switch(t.label){case 0:return[4,f.Uv.getItem(e)];case 1:return[2,{hash:e,data:t.sent()}]}})})()}))];case 1:return e=r.sent(),t={},e.forEach(function(e){var r=e.hash,n=e.data;n&&(t["frame-".concat(r)]=n)}),[2,t]}})})())];case 3:U=a._.apply(void 0,M.concat([y.sent()])),y.label=4;case 4:return[2,JSON.stringify((0,a._)({state:I},U),null,2)]}})})()}},46544:(e,t,r)=>{r.d(t,{m:()=>n});var n=function(e){return e.ALL="all",e.JSON_EXPORT="json_export",e.FRAMES="frames",e.CURRENT_FRAMEGROUP="current_framegroup",e.IMAGES="images",e.SELECTED_IMAGES="selected_images",e.PALETTES="palettes",e.PLUGINS="plugins",e}({})},55382:(e,t,r)=>{r.d(t,{g:()=>u});var n=r(12115),a=r(57203),i=r(10022),u=function(){var e=(0,i.M2)(),t=e.dismissDialog,r=e.setDialog,u=(0,i.vT)(),c=u.cancelEditFrame,s=u.cancelEditImages,o=u.cancelEditPalette,l=(0,i.cr)(),f=l.updateRecentImports,m=l.updateImageSelection,p=(0,i.lJ)().importQueueCancel,d=(0,i.I0)().setPrinterBusy,h=(0,i.Vs)(),g=h.addImages,v=h.deleteImages,_=h.setImageGroups,E=h.updateFrameGroups,w=h.updateImages,S=h.setFrames,P=h.setImages,b=h.setPalettes,A=(0,i.N$)().setSyncLastUpdate;return(0,n.useMemo)(function(){var e=function(){return A("local",Math.floor(new Date().getTime()/1e3))},n=function(){d(!1),p()};return{addImages:function(r){g(r),t(0),e(),n(),f(r)},deleteImages:function(r){v(r),m(a.N.REMOVE,r),t(0),e()},dismissDialog:t,globalUpdate:function(t){c(),o(),s(),t.lastUpdateUTC?A("local",t.lastUpdateUTC):e(),t.palettes&&b(t.palettes),t.images&&(P(t.images),f(t.images)),t.frames&&S(t.frames),t.frameGroups&&E(t.frameGroups),t.imageGroups&&_(t.imageGroups)},importQueueCancel:n,setDialog:r,updateImages:function(t){w(t),e()},updateLastSyncLocalNow:e}},[g,c,s,o,v,t,p,r,S,P,b,_,d,A,E,m,w,f])}},83231:(e,t,r)=>{r.d(t,{W:()=>b});var n=r(61975),a=r(71450),i=r(12115),u=r(55382),c=r(65113),s=r(10022),o=r(84784),l=r(43230),f=r(94468),m=r(82732),p=r(45849),d=r(45377),h=r(37145),g=function(e){var t=(0,h.A)(e);return function(r,n){var a=new Map(r.map(function(t){return[t[e],t]})),i=n.map(function(t){var r=a.get(t[e]);return r?(0,m._)({},r,t):t});return t((0,d._)(i).concat((0,d._)(r)))}},v=g("hash"),_=g("id"),E=g("shortName"),w=g("id");let S=function(e,t,r,n,a,i){var u=e,c=r,s=t,o=n;return i?(a.frames&&a.frames.length&&(u=_(u,a.frames)),a.images&&a.images.length&&(c=v(c,a.images)),a.palettes&&a.palettes.length&&(s=E(s,a.palettes)),a.imageGroups&&a.imageGroups.length&&(o=w(o,a.imageGroups))):(u=a.frames||e,c=a.images||r,s=a.palettes||t,o=a.imageGroups||n),(0,p._)((0,m._)({},a),{images:c,frames:u,palettes:s,imageGroups:o})};var P=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,n._)(function(){var r,n,i,u,o,l;return(0,a.YH)(this,function(a){switch(a.label){case 0:return n=(r=s.Vs.getState()).frames,i=r.palettes,u=r.images,o=r.imageGroups,[4,(0,c.i)(e)];case 1:return Object.keys(l=a.sent()).forEach(function(e){if("state"!==e){var t=l[e];e.match(/^[a-f0-9]{40,}$/gi)?f.mU.setItem("".concat(e),t):e.startsWith("frame-")&&f.Uv.setItem("".concat(e.split("frame-").pop()),t)}}),[2,S(n,i,u,o,l.state||{},t)]}})})()},b=function(){var e=(0,u.g)().globalUpdate;return{downloadSettings:(0,i.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,n._)(function(){var r,n;return(0,a.YH)(this,function(a){switch(a.label){case 0:return[4,(0,l.m)(e,{selectedFrameGroup:t})];case 1:return r=a.sent(),n="frames"===e?"frames":[e,t].filter(Boolean).join("_"),(0,o.R)(null)([{blob:new Blob(Array(r)),filename:"".concat(n,".json")}]),[2]}})})()},[]),jsonImport:(0,i.useCallback)(function(t){return(0,n._)(function(){return(0,a.YH)(this,function(r){switch(r.label){case 0:return[4,P(t,!0)];case 1:return e(r.sent()),[2]}})})()},[e]),remoteImport:(0,i.useCallback)(function(t){return(0,n._)(function(){return(0,a.YH)(this,function(r){switch(r.label){case 0:return[4,P(t,!1)];case 1:return e(r.sent()),[2]}})})()},[e])}}},84784:(e,t,r)=>{r.d(t,{R:()=>o,j:()=>w});var n=r(61975),a=r(71450),i=r(20097),u=r(7496),c=r.n(u),s=r(92878);let o=function(e){return function(t){return(0,n._)(function(){var r,n,u,o;return(0,a.YH)(this,function(a){switch(a.label){case 0:if(1===t.length)return r=t[0],[2,(0,i.saveAs)(r.blob,r.filename)];return n=new(c()),[4,Promise.all(t.map(function(e){var t,r=e.filename;return("function"==typeof(t=e.blob).arrayBuffer?t.arrayBuffer():new Promise(function(e){var r=new FileReader;r.onload=function(t){if(!t.target)throw Error("no file");var r=t.target.result;if("string"==typeof r||null===r)throw Error("unexpected filereader result");e(r)},r.readAsArrayBuffer(t)})).then(function(e){return{filename:r,arrayBuffer:e}})}))];case 1:return u=a.sent(),(0,s.A)(u).forEach(function(e){var t=e.filename,r=e.arrayBuffer;n.file(t,r)}),[4,n.generateAsync({type:"blob",compression:"DEFLATE"})];case 2:if(o=a.sent(),!e)throw Error("missing filename");return[2,(0,i.saveAs)(o,"".concat(e,".zip"))]}})})()}};var l=r(82732),f=r(45849),m=r(45377),p=r(96569),d=r(99353),h=r(17654),g=r(26490),v=r(35797),_=r(17403),E=r(31343);let w=function(e,t,r,i,u){return function(c,s,o){return(0,n._)(function(){var w,S,P,b,A,R,G,F,I;return(0,a.YH)(this,function(U){switch(U.label){case 0:if(w=(0,_.pl)(c),S=c.lockFrame||!1,P=c.rotation||0,A=(b=(0,h.s)(i,c)).palette,R=b.framePalette,!A)throw Error("Palette missing?");return G=function(e,t){return(0,n._)(function(){var n,i,u,m;return(0,a.YH)(this,function(a){return w?[2,(0,p.y1)({tiles:s,palette:A,lockFrame:S,imageStartLine:o,rotation:P,scaleFactor:t,handleExportFrame:r},e)]:(i=(n=(0,v.f)(c)).invertPalette,u=n.invertFramePalette,m=(0,g.C)({imagePalette:A.palette||p.CU,framePalette:(null==R?void 0:R.palette)||p.CU,invertPalette:i,invertFramePalette:u}),[2,(0,p.Yn)((0,f._)((0,l._)({tiles:s,rotation:P,scaleFactor:t,handleExportFrame:r},m),{imageStartLine:o}),e)])})})()},F=(0,m._)(e).filter(function(e){return"number"==typeof e}),I=(0,m._)(t),F.length||F.push(4),I.length||I.push("png"),[4,Promise.all(F.map(function(e){return I.map(function(t){return new Promise(function(r){var n=(0,d.A)({image:c,palette:A,exportScaleFactor:e,fileNameStyle:u});switch(t){case"txt":if(w)return void r(null);(0,E.Z)(c.hash,c.title,n).then(r);break;case"pgm":if(w)return void r(null);G("image/png",e).then(createImageBitmap).then(function(e){var a=document.createElement("canvas");a.width=e.width,a.height=e.height;var i=a.getContext("2d");i.drawImage(e,0,0);var u=A.palette;if(!i||!(null==u?void 0:u.length))return void r(null);for(var s=["P2","#","# Exported from ".concat(window.location.origin),"#","# hash: ".concat(c.hash),"# created: ".concat(c.created),"# title: ".concat(c.title),"# tags: ".concat(c.tags.join(", ")),"# dimension: ".concat(a.width,"*").concat(a.height," pixels"),"#","".concat(a.width," ").concat(a.height),"3","#"],o=0;o<a.height;o+=1){for(var l=[],f=0;f<a.width;f+=1){var m=i.getImageData(f,o,1,1).data,d="#"+m[0].toString(16).padStart(2,"0")+m[1].toString(16).padStart(2,"0")+m[2].toString(16).padStart(2,"0"),h=A.palette.indexOf(d);-1===h&&(h=p.eJ.indexOf(parseInt(d.slice(1),16))),l.push(3-h)}s.push(l.join(" "))}r({filename:"".concat(n,".").concat(t),blob:new Blob([s.join("\n")],{type:"text/plain"}),title:c.title})});break;default:G("image/".concat(t),e).then(function(e){r({filename:"".concat(n,".").concat(t),blob:e,title:c.title})}).catch(function(){return r(null)})}})})}).flat())];case 1:return[2,U.sent().reduce(function(e,t){return t?(0,m._)(e).concat([t]):e},[])]}})})()}}},92878:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(82732),a=r(45849);let i=function(e){var t=[];return e.map(function(e){var r=e.filename,i=r.split("."),u=i.pop();if(!u)throw Error("unknown file type");for(var c=i.join("."),s=r,o=0;t.includes(s);)o+=1,s="".concat(c,"_(").concat(o,").").concat(u);return t.includes(s)||t.push(s),(0,a._)((0,n._)({},e),{filename:s})})}},99353:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(36117),a=r.n(n),i=r(49611),u=r(89922),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return e.reduce(function(e,r){return r?"".concat(e).concat(e?t:"").concat(r):e},"")},s=function(e){var t=e.r,r=e.g,n=e.b,a=e.n,i=function(e){return e.toString(16).padStart(2,"0")};return c([(null==t?void 0:t.map(i).join(""))||"",(null==r?void 0:r.map(i).join(""))||"",(null==n?void 0:n.map(i).join(""))||"",(null==a?void 0:a.map(i).join(""))||""],".")};let o=function(e){var t,r,n=e.image||null,o=e.palette||null,l=e.exportScaleFactor||null,f=e.useCurrentDate||null,m=(null==(t=e.frameRate)?void 0:t.toString(10))||"",p=e.altTitle||"",d=e.frameName||"",h=e.paletteShort||"",g=e.fileNameStyle,v=!f&&(null==n?void 0:n.created)?a()(new Date(n.created)):a()(),_=v.isValid()?v.format("YYYYMMDD-HHmmss"):"",E=h||(o?o.shortName||s(o):""),w=n&&n.title?n.title:p;switch(g){case u.B.TITLE_ONLY:r=[w];break;case u.B.DATE_TITLE:r=[_,w];break;case u.B.FULL:default:r=[_,w,l?"".concat(l,"x"):"",m?"".concat(m,"fps"):"",d,E]}var S=c(r);return(0,i.A)(S,{replacement:""})}},99861:(e,t,r)=>{r.d(t,{E:()=>c,R:()=>s});var n=r(12115),a=r(10022),i=function(e,t,r){var n=r.find(function(t){return t.id===e});if(n)return n.name;switch(e){case"hk":return"Hallo Katze!";case"int":return"International Frames (GameBoy Camera)";case"jp":return"Japanese Frames (Pocket Camera)";default:return t}},u=function(e){switch(e){case"int":return"_1";case"jp":return"_2";case"hk":return"_3";default:return e}},c=function(e,t){return e.reduce(function(e,r){var n=r.id,a=r.name;try{var u,c=null==(u=n.match(/^[a-z]+/g))?void 0:u[0];if(!c)return e;return e.find(function(e){return e.id===c})||e.push({id:c,name:i(c,a,t)}),e}catch(t){return e}},[]).sort(function(e,t){var r=e.id,n=t.id,a=u(r),i=u(n);return a>i?1:a<i?-1:0})},s=function(){var e=(0,a.Vs)(),t=e.frameGroups,r=e.frames;return{frameGroups:(0,n.useMemo)(function(){return c(r,t)},[t,r])}}}}]);