"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[771],{1108:(e,t,r)=>{r.d(t,{A:()=>u});var n=r(19357),a=function(e){e.fillStyle="#000",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.filter="grayscale(1)",e.imageSmoothingEnabled=!1};let u=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(r,u){var s=document.createElement("img"),i=document.createElement("canvas");i.width=160;var o=i.getContext("2d");if(!o)return void u(Error("No canvas context"));s.onerror=u,s.onload=function(){var n,u=s.naturalWidth,c=s.naturalHeight;.875==c/u?(i.height=144,n=s.naturalWidth/128,t||a(o),o.drawImage(s,0,0,u,c,16,16,i.width-32,i.height-32)):(i.height=i.width*c/u,n=u/160,t||a(o),o.drawImage(s,0,0,u,c,0,0,i.width,i.height)),r({imageData:o.getImageData(0,0,i.width,i.height),scaleFactor:n,width:i.width,height:i.height,fileName:e.name,lastModified:e.lastModified||null})},(0,n.A)(e,n.Z.DATA_URL).then(function(e){s.src=e})})}},11081:(e,t,r)=>{r.d(t,{V:()=>n});var n=function(e){return e.CHECKBOX="checkbox",e.SELECT="select",e.TEXT="text",e.NUMBER="number",e.INFO="info",e.IMAGE="image",e.META="meta",e}({})},14217:(e,t,r)=>{r.d(t,{z:()=>n});var n=r(74879).A},19357:(e,t,r)=>{r.d(t,{A:()=>u,Z:()=>a});var n=r(15376).Buffer,a=function(e){return e.UINT8_ARRAY="uint8array",e.TEXT="text",e.DATA_URL="dataURL",e}({});let u=function(e,t){return new Promise(function(r,a){var u=new FileReader;switch(u.onload=function(e){var u=e.target;if(null==u?void 0:u.result)return"uint8array"===t?void r(n.from(u.result)):void r(u.result);a(Error("Filereader has no result"))},u.onerror=function(e){a(e)},t){case"uint8array":u.readAsArrayBuffer(e);break;case"text":u.readAsText(e);break;case"dataURL":u.readAsDataURL(e);break;default:a(Error('readAs param missing or unknown type "'.concat(t,'"')))}})}},30771:(e,t,r)=>{r.d(t,{A:()=>c});var n=r(61975),a=r(71450),u=r(12115),s=r(50751),i=r(45786),o=r(83231);let c=function(){var e=s.A.getState().setError,t=(0,o.W)().jsonImport,r=(0,u.useMemo)(function(){return(0,i.A)(t)},[t]);return{handleFileImport:(0,u.useCallback)(function(t,u){return(0,n._)(function(){return(0,a.YH)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,r(t,u)];case 1:return n.sent(),[3,3];case 2:return e(n.sent()),[3,3];case 3:return[2]}})})()},[r,e])}}},45786:(e,t,r)=>{r.d(t,{A:()=>eV});var n=r(61975),a=r(71450),u=r(19357),s=r(39852),i=r(14217),o=r(75036),c=r(80904),l=r(1108),f=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,n._)(function(){var r;return(0,a.YH)(this,function(n){switch(n.label){case 0:return[4,(0,l.A)(e)];case 1:return r=n.sent(),t?(0,c._)({bitmapQueue:[r],dither:!1,contrastBaseValues:[0,85,170,255],importQueueAdd:s.A.getState().importQueueAdd}):s.A.getState().bitmapQueueAdd([r]),[2,!0]}})})()},m=r(18786);let p=function(e){var t=e.split("\n").map(function(e){return e.trim()}).filter(function(e){return e.length&&0!==e.indexOf("//")&&0!==e.indexOf("/*")}).map(function(e){return e.split(" ")}).flat().map(function(e){return parseInt(e,16)}).filter(function(e){return!isNaN(e)});return(0,m.gV)(t)};var d=r(45377),h=r(15719),g=function(e){return e.NEW_LINES="NEW_LINES",e.IMAGE_COMPLETE="IMAGE_COMPLETE",e.PARSE_ERROR="PARSE_ERROR",e}({});let v=function(e){if("#"===e.charAt(0)||"/"===e.charAt(0))return null;if("!"===e.charAt(0)||"{"===e.charAt(0)){try{var t=JSON.parse(e.slice(e.indexOf("{")).trim()),r=t.command,n=t.margin_lower;if("PRNT"===r&&n>0)return{type:g.IMAGE_COMPLETE}}catch(e){return{type:g.PARSE_ERROR,payload:"Error while trying to parse JSON data command block"}}return null}var a=e.replace(/[^0-9A-F]/ig,"");return a.length?{type:g.NEW_LINES,payload:[a]}:null},b=function(e,t){var r="".concat(e,"\n").concat(h.Ys).split("\n").map(v).reduce(function(e,t){switch(null==t?void 0:t.type){case g.NEW_LINES:var r;return(r=e[e.length-1]).push.apply(r,(0,d._)(t.payload)),e;case g.IMAGE_COMPLETE:return(0,d._)(e).concat([[]]);default:return e}},[[]]).filter(function(e){return e.length>0});return r.length||console.warn("File ".concat(t," did not contain images")),r};var y=r(11081),V=r(34093),w=r(52556),E=r(15431),A=r(93194),_=r(81200),S=r(82732),D=r(21860),I=r.n(D),B=r(96132),N=r(6818),k=r(30986),M=r(22043),C={86:"A",87:"B",88:"C",89:"D",90:"E",91:"F",92:"G",93:"H",94:"I",95:"J",96:"K",97:"L",98:"M",99:"N",100:"O",101:"P",102:"Q",103:"R",104:"S",105:"T",106:"U",107:"V",108:"W",109:"X",110:"Y",111:"Z",112:"_",113:"'",114:",",115:".",116:"\xc1",117:"\xc2",118:"\xc0",119:"\xc4",120:"\xc9",121:"\xca",122:"\xc8",123:"\xcb",124:"\xcd",125:"\xcf",126:"\xd3",127:"\xd6",128:"\xda",129:"\xdc",130:"\xd1",131:"-",132:"&",133:"!",134:"?",135:" ",136:"a",137:"b",138:"c",139:"d",140:"e",141:"f",142:"g",143:"h",144:"i",145:"j",146:"k",147:"l",148:"m",149:"n",150:"o",151:"p",152:"q",153:"r",154:"s",155:"t",156:"u",157:"v",158:"w",159:"x",160:"y",161:"z",162:"•",163:"~",164:"\uD83D\uDCF1",165:" ",166:"\xe1",167:"\xe2",168:"\xe0",169:"\xe4",170:"\xe9",171:"\xea",172:"\xe8",173:"\xeb",174:"\xed",175:"\xef",176:"\xf3",177:"\xf6",178:"\xfa",179:"\xfc",180:"\xf1",181:"ḉ",182:"\xdf",183:"\uD83D\uDE04",184:"\uD83D\uDE1F",185:"\uD83D\uDE05",186:"0",187:"1",188:"2",189:"3",190:"4",191:"5",192:"6",193:"7",194:"8",195:"9",196:"/",197:":",198:"~",199:'"',200:"@"},H={1:"あ",2:"い",3:"う",4:"え",5:"お",6:"か",7:"き",8:"く",9:"け",10:"こ",11:"さ",12:"し",13:"す",14:"せ",15:"そ",16:"た",17:"ち",18:"つ",19:"て",20:"と",21:"な",22:"に",23:"ぬ",24:"ね",25:"の",26:"は",27:"ひ",28:"ふ",29:"へ",30:"ほ",31:"ま",32:"み",33:"む",34:"め",35:"も",36:"や",37:"ゆ",38:"よ",39:"、",40:"。",41:"ら",42:"り",43:"る",44:"れ",45:"ろ",46:"わ",47:"を",48:"ん",49:"〜",50:"♥",51:"が",52:"ぎ",53:"ぐ",54:"げ",55:"ご",56:"ざ",57:"じ",58:"ず",59:"ぜ",60:"ぞ",61:"だ",62:"ぢ",63:"づ",64:"で",65:"ど",66:"ば",67:"び",68:"ぶ",69:"べ",70:"ぼ",71:"ぱ",72:"ぴ",73:"ぷ",74:"ぺ",75:"ぽ",76:"っ",77:"ゃ",78:"ゅ",79:"ょ",80:"・",81:"ぁ",82:"ぃ",83:"ぅ",84:"ぇ",85:"ぉ",86:"ア",87:"イ",88:"ウ",89:"エ",90:"オ",91:"カ",92:"キ",93:"ク",94:"ケ",95:"コ",96:"サ",97:"シ",98:"ス",99:"セ",100:"ソ",101:"タ",102:"チ",103:"ツ",104:"テ",105:"ト",106:"ナ",107:"ニ",108:"ヌ",109:"ネ",110:"ノ",111:"ハ",112:"ヒ",113:"フ",114:"ヘ",115:"ホ",116:"マ",117:"ミ",118:"ム",119:"メ",120:"モ",121:"ヤ",122:"ユ",123:"ヨ",124:"!",125:"?",126:"ラ",127:"リ",128:"ル",129:"レ",130:"ロ",131:"ワ",132:"ヲ",133:"ン",134:"ヴ",135:" ",136:"ガ",137:"ギ",138:"グ",139:"ゲ",140:"ゴ",141:"ザ",142:"ジ",143:"ズ",144:"ゼ",145:"ゾ",146:"ダ",147:"ヂ",148:"ヅ",149:"デ",150:"ド",151:"バ",152:"ビ",153:"ブ",154:"ベ",155:"ボ",156:"パ",157:"ピ",158:"プ",159:"ペ",160:"ポ",161:"ッ",162:"ャ",163:"ュ",164:"ョ",165:"ー",166:"ァ",167:"ィ",168:"ゥ",169:"ェ",170:"ォ",171:"A",172:"B",173:"C",174:"D",175:"E",176:"F",177:"G",178:"H",179:"I",180:"J",181:"K",182:"L",183:"M",184:"N",185:"O",186:"P",187:"Q",188:"R",189:"S",190:"T",191:"U",192:"V",193:"W",194:"X",195:"Y",196:"Z",197:"_",198:"'",199:",",200:".",201:"a",202:"b",203:"c",204:"d",205:"e",206:"f",207:"g",208:"h",209:"i",210:"j",211:"k",212:"l",213:"m",214:"n",215:"o",216:"p",217:"q",218:"r",219:"s",220:"t",221:"u",222:"v",223:"w",224:"x",225:"y",226:"z",227:"\uD83D\uDCF1",228:"\uD83D\uDE05",229:"\uD83D\uDE04",230:"_",231:"0",232:"1",233:"2",234:"3",235:"4",236:"5",237:"6",238:"7",239:"8",240:"9",241:"/",242:":",243:"~",244:'"',245:"@"},T="00123456789?????",O=function(e){return e.PHOTO="photo",e.STOCK="stock",e.PXLR="pxlr",e}({}),x={positive:2,negative:0},R={140:0,155:1,170:2,185:3,200:4,"200Dup":16,215:5,"215Dup":17,230:6,"230Dup":18,245:7,"245Dup":19,260:8,"260Dup":20,275:21,290:9,"290Dup":22,305:23,320:10,"320Dup":24,350:11,"350Dup":25,380:12,"380Dup":26,410:13,"410Dup":27,440:28,455:14,470:29,515:15,"515Dup":30,575:31},P={none:0,horizontal:32,vertical:64,"2d":96},L={on:128,off:0},Y={"050":0,"075":16,100:32,125:48,200:64,300:80,400:96,500:112},z={on:8,off:0},F={"00v":0,"05v":1,"10v":2,"15v":3,"20v":4,"25v":5,"30v":6,"35v":7},j={disabled:0,positive:128,negative:64},U={neg992:31,neg960:30,neg928:29,neg896:28,neg864:27,neg832:26,neg800:25,neg768:24,neg736:23,neg704:22,neg672:21,neg640:20,neg608:19,neg576:18,neg544:17,neg512:16,neg480:15,neg448:14,neg416:13,neg384:12,neg352:11,neg320:10,neg288:9,neg256:8,neg224:7,neg192:6,neg160:5,neg128:4,neg096:3,neg064:2,neg032:1,neg000:0,pos000:32,pos032:33,pos064:34,pos096:35,pos128:36,pos160:37,pos192:38,pos224:39,pos256:40,pos288:41,pos320:42,pos352:43,pos384:44,pos416:45,pos448:46,pos480:47,pos512:48,pos544:49,pos576:50,pos608:51,pos640:52,pos672:53,pos704:54,pos736:55,pos768:56,pos800:57,pos832:58,pos864:59,pos896:60,pos928:61,pos960:62,pos992:63},W={setHigh:0,setLow:1,on:0,off:16},Q={thumbnailByteCapture:0,thumbnailByteEdgegains:16,thumbnailByteExposureHigh:32,thumbnailByteExposureLow:48,thumbnailByteEdmovolt:198,thumbnailByteVoutzero:214,thumbnailByteDitherset:230,thumbnailByteContrast:246},X={thumbnailByteCapture:200,thumbnailByteEdgegains:201,thumbnailByteExposureHigh:203,thumbnailByteExposureLow:202,thumbnailByteEdmovolt:204,thumbnailByteVoutzero:205,thumbnailByteDitherset:200,thumbnailByteContrast:200},G=function(e,t){var r=.016*e+4.096*t;return r<10?"".concat(r.toFixed(1),"ms"):"".concat(Math.floor(r),"ms")},Z=function(e){switch(e){case x.positive:return"positive";case x.negative:return"negative";default:return"unknown"}},J=function(e){switch(e){case L.on:return"on";case L.off:return"off";default:return"unknown"}},K=function(e){switch(e){case P.none:return"none";case P.horizontal:return"horizontal";case P.vertical:return"vertical";case P["2d"]:return"2d";default:return"unknown"}},q=function(e){switch(e){case R["140"]:return"14.0";case R["155"]:return"15.5";case R["170"]:return"17.0";case R["185"]:return"18.5";case R["200"]:return"20.0";case R["200Dup"]:return"20.0 (d)";case R["215"]:return"21.5";case R["215Dup"]:return"21.5 (d)";case R["230"]:return"23.0";case R["230Dup"]:return"23.0 (d)";case R["245"]:return"24.5";case R["245Dup"]:return"24.5 (d)";case R["260"]:return"26.0";case R["260Dup"]:return"26.0 (d)";case R["275"]:return"27.5";case R["290"]:return"29.0";case R["290Dup"]:return"29.0 (d)";case R["305"]:return"30.5";case R["320"]:return"32.0";case R["320Dup"]:return"32.0 (d)";case R["350"]:return"35.0";case R["350Dup"]:return"35.0 (d)";case R["380"]:return"38.0";case R["380Dup"]:return"38.0 (d)";case R["410"]:return"41.0";case R["410Dup"]:return"41.0 (d)";case R["440"]:return"44.0";case R["455"]:return"45.5";case R["470"]:return"47.0";case R["515"]:return"51.5";case R["515Dup"]:return"51.5 (d)";case R["575"]:return"57.5";default:return"unknown"}},$=function(e){switch(e){case Y["050"]:return"50%";case Y["075"]:return"75%";case Y["100"]:return"100%";case Y["125"]:return"125%";case Y["200"]:return"200%";case Y["300"]:return"300%";case Y["400"]:return"400%";case Y["500"]:return"500%";default:return"unknown"}},ee=function(e){switch(e){case z.on:return"on";case z.off:return"off";default:return"unknown"}},et=function(e){switch(e){case F["00v"]:return"0.0V";case F["05v"]:return"0.5V";case F["10v"]:return"1.0V";case F["15v"]:return"1.5V";case F["20v"]:return"2.0V";case F["25v"]:return"2.5V";case F["30v"]:return"3.0V";case F["35v"]:return"3.5V";default:return"unknown"}},er=function(e){switch(e){case j.disabled:return"none";case j.positive:return"positive";case j.negative:return"negative";default:return"unknown"}},en=function(e){switch(e){case U.neg992:return"-0.992mV";case U.neg960:return"-0.960mV";case U.neg928:return"-0.928mV";case U.neg896:return"-0.896mV";case U.neg864:return"-0.864mV";case U.neg832:return"-0.832mV";case U.neg800:return"-0.800mV";case U.neg768:return"-0.768mV";case U.neg736:return"-0.736mV";case U.neg704:return"-0.704mV";case U.neg672:return"-0.672mV";case U.neg640:return"-0.640mV";case U.neg608:return"-0.608mV";case U.neg576:return"-0.576mV";case U.neg544:return"-0.544mV";case U.neg512:return"-0.512mV";case U.neg480:return"-0.480mV";case U.neg448:return"-0.448mV";case U.neg416:return"-0.416mV";case U.neg384:return"-0.384mV";case U.neg352:return"-0.352mV";case U.neg320:return"-0.320mV";case U.neg288:return"-0.288mV";case U.neg256:return"-0.256mV";case U.neg224:return"-0.224mV";case U.neg192:return"-0.192mV";case U.neg160:return"-0.160mV";case U.neg128:return"-0.128mV";case U.neg096:return"-0.096mV";case U.neg064:return"-0.064mV";case U.neg032:return"-0.032mV";case U.neg000:return"-0.000mV";case U.pos000:return" 0.000mV";case U.pos032:return"0.032mV";case U.pos064:return"0.064mV";case U.pos096:return"0.096mV";case U.pos128:return"0.128mV";case U.pos160:return"0.160mV";case U.pos192:return"0.192mV";case U.pos224:return"0.224mV";case U.pos256:return"0.256mV";case U.pos288:return"0.288mV";case U.pos320:return"0.320mV";case U.pos352:return"0.352mV";case U.pos384:return"0.384mV";case U.pos416:return"0.416mV";case U.pos448:return"0.448mV";case U.pos480:return"0.480mV";case U.pos512:return"0.512mV";case U.pos544:return"0.544mV";case U.pos576:return"0.576mV";case U.pos608:return"0.608mV";case U.pos640:return"0.640mV";case U.pos672:return"0.672mV";case U.pos704:return"0.704mV";case U.pos736:return"0.736mV";case U.pos768:return"0.768mV";case U.pos800:return"0.800mV";case U.pos832:return"0.832mV";case U.pos864:return"0.864mV";case U.pos896:return"0.896mV";case U.pos928:return"0.928mV";case U.pos960:return"0.960mV";case U.pos992:return"0.992mV";default:return"unknown"}},ea=function(e){var t,r;switch(1&e){case W.setHigh:t="High";break;case W.setLow:t="Low";break;default:t="unknown"}switch(2&e){case W.on:r="On";break;case W.off:r="Off";break;default:r="unknown"}return"".concat(t,"/").concat(r)},eu=function(e){var t=[200,201,202,203,204,205,206,207,216,217,218,219,220,221,222,223,232,233,234,235,236,237,238,239,248,249,250,251,252,253,254,255];return t.map(function(t){return e[t]}).filter(function(e){return 0===e}).length===t.length?O.STOCK:t.map(function(t){return e[t]}).filter(function(e){return 255===e}).length===t.length?O.PXLR:O.PHOTO},es=function(e,t){switch(t){case O.PHOTO:r=X;break;case O.PXLR:r=Q;break;default:return null}var r,n=e[r.thumbnailByteExposureHigh],a=e[r.thumbnailByteExposureLow],u=2&e[r.thumbnailByteCapture],s=128&e[r.thumbnailByteEdgegains],i=96&e[r.thumbnailByteEdgegains],o=31&e[r.thumbnailByteEdgegains],c=112&e[r.thumbnailByteEdmovolt],l=8&e[r.thumbnailByteEdmovolt],f=7&e[r.thumbnailByteEdmovolt],m=192&e[r.thumbnailByteVoutzero],p=63&e[r.thumbnailByteVoutzero],d=e[r.thumbnailByteDitherset],h=e[r.thumbnailByteContrast];return t===O.PHOTO?{romType:t,exposure:G(n,a),captureMode:Z(u),edgeExclusive:J(s),edgeOperation:K(i),gain:q(o),edgeMode:$(c),invertOut:ee(l),voltageRef:et(f),zeroPoint:er(m),vOut:en(p)}:{romType:t,exposure:G(n,a),captureMode:Z(u),edgeExclusive:J(s),edgeOperation:K(i),gain:q(o),edgeMode:$(c),invertOut:ee(l),voltageRef:et(f),zeroPoint:er(m),vOut:en(p),ditherset:ea(d),contrast:h+1}},ei=function(e,t){var r=t?H:C;return(0,d._)(e).map(function(e){return r[e]||" "}).join("").trim()},eo=function(e){switch(28&e){case 4:return"A";case 8:return"B";case 12:return"0";case 16:return"AB";default:return"-"}},ec=function(e){if(!e)return"--";var t=T[e>>4],r=T[15&e];return"".concat(t).concat(r)},el=function(e,t){var r=(0,M._)((0,d._)(e).map(ec),4),n=r[0],a=r[1],u=r[2],s=r[3],i="--"===n&&"--"!==a?"00".concat(a):"--"!==n&&"--"===a?"".concat(n,"00"):"".concat(n).concat(a);return t?"".concat(i,"年").concat(u,"月").concat(s,"日"):"".concat(u,"/").concat(s,"/").concat(i)},ef=function(e,t){var r=(0,d._)(e).map(ec).map(function(e){return"--"===e?"00":e});return"".concat(t?"PC-":"GC-").concat(r.join(""))},em=function(e,t,r){var n=e.subarray(t+3840,t+3843+1),a=e.subarray(t+3844,t+3852+1),u=e[t+3853],s=e.subarray(t+3854,t+3857+1),i=e.subarray(t+3861,t+3887+1),o=!!e[t+3891];return{userId:ef(n,r),birthDate:el(s,r),userName:ei(a,r),gender:1&u?"m":2&u?"f":"-",bloodType:eo(u),comment:ei(i,r),isCopy:o}};let ep=function(e,t,r){var n,a=t%131072,u=Math.floor(t/131072),s=a/4096-2,i=s>=0?e[131072*u+4530+s]+30*u:-1,o=e[t+3924],c=e.slice(t+3584,t+3839+1);if(-1!==i){var l=eu(c);n={romType:l},"stock"!==l&&(n=(0,S._)({},n,es(c,l))),"stock"===l&&(n=(0,S._)({},n,em(e,t,r)))}return{cartIndex:s,albumIndex:i,baseAddress:t,frameNumber:o,meta:n}},ed=function(e,t,r){if(!t)return"";var n,a=function(e){return r.find(function(t){return t.id===e})},u=(e+1).toString(10).padStart(2,"0"),s=a("".concat(t).concat(u));if(null==s?void 0:s.hash)return s.hash;if("jp"===t){var i=a("int".concat(u));if(null==i?void 0:i.hash)return i.hash}var o=a("".concat(t,"01"));if(null==o?void 0:o.hash)return o.hash;if("jp"!==t){var c=a("int".concat(u));if(null==c?void 0:c.hash)return c.hash}return(null==(n=a("int01"))?void 0:n.hash)||""};var eh="ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff";let eg=function(e,t){var r=[],n="",a=!1;r.push.apply(r,(0,d._)((0,d._)(Array(40)).map(function(){return eh})));for(var u=0;u<3584;u+=1)u%256==0&&r.push.apply(r,(0,d._)((0,d._)([,,]).map(function(){return eh}))),n+=" ".concat(e[t+u].toString(16).padStart(2,"0")),u%16==15&&(r.push(n.trim()),a||"00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00"===n.trim()||n.trim()===eh||(a=!0),n=""),u%256==255&&r.push.apply(r,(0,d._)((0,d._)([,,]).map(function(){return eh})));return r.push.apply(r,(0,d._)((0,d._)(Array(40)).map(function(){return eh}))),a?r:null};var ev=(0,k.A)("albumIndex");let eb=function(e){var t=e.importLastSeen,r=e.savImportOrder,u=e.data,c=e.lastModified,l=e.frames,f=e.fileName,m=e.importDeleted,p=e.forceMagicCheck,h=s.A.getState().importQueueAdd;return p&&[4306,4523,4560,4597].some(function(e){return"Magic"!==(0,d._)(u.subarray(e,e+5)).map(function(e){return String.fromCharCode(e)}).join("")})?null:function(e,s){return(0,n._)(function(){var p,d,g,v,b,y;return(0,a.YH)(this,function(V){switch(V.label){case 0:return p=Array.from({length:Math.ceil(u.byteLength/4096)},function(e,t){return 4096*t}),1048576===u.byteLength&&(d=u.subarray(308,324),"PHOTO"===new TextDecoder().decode(d.filter(function(e){return 0!==e&&128!==e})).trim()&&(p=p.slice(32))),p=p.filter(function(e){return(e-4096)%131072!=0}),t||(p=p.filter(function(e){return e%131072!=0})),[4,Promise.all(p.map(function(t){return(0,n._)(function(){var r,n,i,o;return(0,a.YH)(this,function(a){switch(a.label){case 0:if(n=(r=ep(u,t,s)).frameNumber,!(i=eg(u,t)))return[3,2];return[4,(0,N.A)(i,ed(n,e,l))];case 1:return o=a.sent(),[2,(0,S._)({tiles:o},r)];case 2:return[2,null]}})})()}))];case 1:return g=V.sent().filter(Boolean),v=r===B.K.RAM_INDEX?g:ev(g),b=new(I())(1,1/0),y=0,[4,Promise.all(v.map(function(e){var t=e.albumIndex,r=e.tiles,u=e.meta;return(0,n._)(function(){return(0,a.YH)(this,function(e){return[2,b.add(function(){return(0,n._)(function(){var e,n;return(0,a.YH)(this,function(a){switch(a.label){case 0:switch(t){case -1:e="[last seen]";break;case 255:if(!m)return[2,void 0];e="[deleted]";break;default:y+=1,e=y.toString(10).padStart(2,"0")}return[4,(0,o.cg)(r)];case 1:return n=a.sent().dataHash,[2,{fileName:"function"==typeof f?f({indexText:e,albumIndex:t,displayIndex:y}):"".concat(f," ").concat(e),imageHash:n,tiles:r,lastModified:c,meta:u,tempId:(0,i.z)()}]}})})()})]})})()}))];case 2:return h(V.sent().reduce(_.N,[])),[2,!0]}})})()}},ey=function(e){if(e.blob){var t,r;if(t=new File([e.blob],e.blobName||"blob"),r=e.contentType||"application/unknown",void 0!==e.ok&&!e.ok)throw Error("Invalid file received from printer")}else r=(t=e).type;if(!t.size)throw Error("empty file");return{file:t,contentType:r}},eV=function(e){var t=function(t){return(0,n._)(function(){var r,n;return(0,a.YH)(this,function(a){switch(a.label){case 0:return[4,(0,u.A)(t,u.Z.TEXT)];case 1:r=a.sent();try{n=JSON.parse(r)}catch(e){throw Error("Not a valid .json file")}if(!(null==n?void 0:n.state))throw Error("Not a settings .json file");return e(n),[2,!0]}})})()};return function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromPrinter:!1},c=r.fromPrinter,l=r.savFrameSet;return(0,n._)(function(){return(0,a.YH)(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(e){var r,d,h,g,v=ey(e),S=v.file,D=v.contentType;if(D&&D.startsWith("image/"))return f(S,c);if(S.size>0xfffffff)throw Error("File too large");if("text/plain"===D)return(0,n._)(function(){var e,t,r;return(0,a.YH)(this,function(c){switch(c.label){case 0:return e=s.A.getState().importQueueAdd,[4,(0,u.A)(S,u.Z.TEXT)];case 1:if(-1===(t=c.sent()).indexOf('{"command"'))return[3,3];return[4,b(t,S.name)];case 2:return r=c.sent(),[3,5];case 3:return[4,p(t)];case 4:r=c.sent(),c.label=5;case 5:return[4,Promise.all(r.map(function(t,u){return(0,n._)(function(){var n,s;return(0,a.YH)(this,function(a){switch(a.label){case 0:return[4,(0,o.cg)(t)];case 1:return n=a.sent().dataHash,s=r.length<2?"":" ".concat((u+1).toString(10).padStart(2,"0")),e([{fileName:"".concat(S.name).concat(s),imageHash:n,tiles:t,lastModified:S.lastModified?S.lastModified+u:void 0,tempId:(0,i.z)()}]),[2,!0]}})})()}))];case 6:return c.sent(),[2,!0]}})})();if("application/json"===D)return t(S);if(((null==(d=S.name)?void 0:d.toLowerCase().endsWith(".gb"))||(null==(h=S.name)?void 0:h.toLowerCase().endsWith(".gbc"))||(null==(g=S.name)?void 0:g.toLowerCase().endsWith(".sav")))&&(S.size%4096==0||3584===S.size))return r={skipDialogs:131072!==S.size,frameSet:l},(0,n._)(function(){var e,t,s,i,o,c,l,f,m,p,d,h,g,v,b,D,I,B,N;return(0,a.YH)(this,function(k){switch(k.label){case 0:return t=(e=V.A.getState()).dismissDialog,s=e.setDialog,o=(i=w.h.getState()).frames,c=i.frameGroups,f=(l=E.A.getState()).savFrameTypes,m=l.setSavFrameTypes,[4,(0,u.A)(S,u.Z.UINT8_ARRAY)];case 1:if(p=k.sent(),d=r.skipDialogs||!1,h=r.frameSet||"",v=(g=E.A.getState()).importLastSeen,b=g.importDeleted,D=g.forceMagicCheck,I=g.savImportOrder,(B=(0,A.A)(o,c).map(function(e){var t=e.id;return{value:t,name:e.name,selected:f===t}})).unshift({value:"",name:"None (Black frame)"}),!(N=eb({importLastSeen:!!d||S.size<=4096||v,savImportOrder:I,data:p,lastModified:S.lastModified,frames:o,fileName:S.name,importDeleted:!!d||b,forceMagicCheck:!d&&D})))throw Error(".sav file seems to be invalid");if(!h)return[3,3];return[4,N(h,"jp"===h)];case 2:case 4:return k.sent(),[2,!0];case 3:if(!d)return[3,5];return[4,N("",!1)];case 5:return[2,new Promise(function(e){s({message:"Importing '".concat(S.name,"'"),questions:function(){return[{type:y.V.CHECKBOX,label:"Import is from a Japanese Cart (PocketCamera)",key:"cartIsJP"},B.length>1?{type:y.V.SELECT,label:"Select frame group to use with this import",key:"chosenFrameset",options:B}:void 0].reduce(_.N,[])},confirm:function(r){return(0,n._)(function(){var n,u;return(0,a.YH)(this,function(a){switch(a.label){case 0:return n=r.chosenFrameset,u=r.cartIsJP,t(0),m(n),[4,N(n||"",!!u)];case 1:return a.sent(),e(!0),[2]}})})()},deny:function(){return(0,n._)(function(){return(0,a.YH)(this,function(r){return t(0),e(!0),[2]})})()}})})]}})})();if("application/pico-printer-binary-log"===D)return(0,n._)(function(){var e,t,r;return(0,a.YH)(this,function(c){switch(c.label){case 0:return e=s.A.getState().importQueueAdd,[4,(0,u.A)(S,u.Z.UINT8_ARRAY)];case 1:return t=c.sent(),[4,(0,m.Eh)(t)];case 2:return[4,Promise.all((r=c.sent()).map(function(t,u){return(0,n._)(function(){var n,s;return(0,a.YH)(this,function(a){switch(a.label){case 0:return[4,(0,o.cg)(t)];case 1:return n=a.sent().dataHash,s=r.length<2?"":" (".concat(u+1,")"),e([{fileName:"".concat(S.name).concat(s),imageHash:n,tiles:t,lastModified:S.lastModified?S.lastModified+u:void 0,tempId:(0,i.z)()}]),[2,!0]}})})()}))];case 3:return c.sent(),[2,!0]}})})();if(D.startsWith("application/"))return(0,n._)(function(){var e,t,r,n,c,l,f;return(0,a.YH)(this,function(a){switch(a.label){case 0:return e=s.A.getState().importQueueAdd,[4,(0,u.A)(S,u.Z.UINT8_ARRAY)];case 1:var m;if(71!==(m=t=a.sent())[0]||66!==m[1]||45!==m[2]||66!==m[3]||73!==m[4]||78!==m[5]||48!==m[6]||49!==m[7])throw Error('Not a valid .bin file - is it missing the "GB-BIN01" header?');for(r=[],n=[],c=8;c<t.length;c+=1)l=t[c],n.push(l.toString(16).padStart(2,"0").toUpperCase()),16===n.length&&(r.push(n.join(" ")),n=[]);if(n.length){for(;n.length<16;)n.push("FF");r.push(n.join(" "))}return[4,(0,o.cg)(r)];case 2:return f=a.sent().dataHash,e([{fileName:S.name,imageHash:f,tiles:r,lastModified:S.lastModified,tempId:(0,i.z)()}]),[2,!0]}})})();throw Error("Not a dump")}))];case 1:return r.sent(),[2]}})})()}}},80904:(e,t,r)=>{r.d(t,{_:()=>l});var n=r(61975),a=r(71450),u=r(90148),s=r(14217),i=r(75036),o=[0,256,1,257],c=function(e){for(var t=[],r=0;r<8;r+=1){for(var n=0,a=0;a<8;a+=1)n+=o[e[8*r+a]]<<7-a;t.push((n>>8).toString(16).padStart(2,"0"),(255&n).toString(16).padStart(2,"0"))}return t.join(" ").toUpperCase()},l=function(e){var t=e.bitmapQueue,r=e.dither,o=e.contrastBaseValues,l=e.importQueueAdd;t.forEach(function(e){var t=e.imageData,f=e.height,m=e.fileName,p=e.lastModified;return(0,n._)(function(){var e,n,d,h;return(0,a.YH)(this,function(a){switch(a.label){case 0:return e=Array.from((0,u.$)({imageData:t,contrastBaseValues:o,dither:r,colors:[{r:0,g:0,b:0},{r:1,g:0,b:0},{r:2,g:0,b:0},{r:3,g:0,b:0}]}).data).filter(function(e,t){return!(t%4)}),n=20*Math.ceil(f/8),d=function(t){var r=Math.floor(t/20),n=t%20*8,a=8*r;return Array(8).fill(null).map(function(t,r){return e.slice(n+(a+r)*160).slice(0,8)}).flat(1)},h=Array(n).fill(null).map(function(e,t){return d(t)}).map(c),[4,(0,i.cg)(h)];case 1:return l([{fileName:m,imageHash:a.sent().dataHash,tiles:h,lastModified:p,tempId:(0,s.z)()}]),[2]}})})()})}},81200:(e,t,r)=>{r.d(t,{N:()=>a});var n=r(45377),a=function(e,t){return t?(0,n._)(e).concat([t]):e}},90148:(e,t,r)=>{r.d(t,{q:()=>l,$:()=>c});let n=function(e,t){var r=(t-e)/16;return Array(16).fill(null).map(function(t,n){return Math.floor(e+r*n)})},a=function(e){var t="number"==typeof e[0]?e[0]:0,r="number"==typeof e[1]?e[1]:85,a="number"==typeof e[2]?e[2]:170,u="number"==typeof e[3]?e[3]:255;return[n(t,r),n(r,a),n(a,u)]},u=function(e){for(var t=e.baseValues,r=e.orderPatterns,n=[],a=0;a<4;a+=1){var u=[];n.push(u);for(var s=0;s<4;s+=1){var i=[];u.push(i);for(var o=0;o<3;o+=1)i.push(t[o][r[o][4*a+s]])}}return n};var s=[0,12,3,15,8,4,11,7,2,14,1,13,10,6,9,5],i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0,c=function(e){for(var t=e.imageData,r=e.contrastBaseValues,n=e.dither,c=e.colors,l=new ImageData(t.width,t.height),f=u({baseValues:a(r),orderPatterns:[n?s:i,n?s:i,n?s:i]}),m=t.width,p=t.data,d=0;d<p.length;d+=4){var h=o%m%4,g=Math.ceil(o/m)%4,v=p[d],b=void 0,y=f[h][g];b=v<=y[0]?c[3]:v<=y[1]?c[2]:v<=y[2]?c[1]:c[0],l.data[d]=b.r,l.data[d+1]=b.g,l.data[d+2]=b.b,l.data[d+3]=255,o+=1}return l},l=function(e){var t=e.targetCanvas,r=e.originalCanvas,n=e.imageData,a=e.palette,u=e.dither,s=e.contrastBaseValues,i=a.map(function(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}}),o=t.getContext("2d"),l=r.getContext("2d");if(!o||!l)return void console.error("canvas context is missing");o.putImageData(c({imageData:n,contrastBaseValues:s,dither:u,colors:i}),0,0),l.putImageData(n,0,0)}}}]);