(()=>{var e={67332:(e,t,r)=>{"use strict";var n,i=r(97004),a=r(39249),s=r(7062),c=r(82666),u=r(65492),o=r(66214),l=r(78538),f=r(40662),d=r.n(f),_=r(86447),v=function(e){return e.USB="USB",e.SERIAL="SERIAL",e}({}),h=function(e){return e.UNKNOWN="unknown",e.INACTIVE="inactive",e.PACKET_CAPTURE="packet_capture",e.SUPER_PRINTER_INTERFACE="super_printer_interface",e.GBXCART="gbxcart",e}({});n={},(0,_._)(n,"unknown","Unknown Device"),(0,_._)(n,"inactive","Inactive Device"),(0,_._)(n,"packet_capture","Arduino Gameboy Printer Emulator"),(0,_._)(n,"super_printer_interface","Super Printer Interface"),(0,_._)(n,"gbxcart","Cartridge Reader (LK Firmware)");var p=r(51368).A,b=function(){function e(t,r,n){(0,u._)(this,e),this.portDeviceType=h.INACTIVE,this.bannerBytes=r,this.portType=t.portType,this.description=[t.getDescription(),n].filter(Boolean).join(" "),this.id=p()}return e.prototype.getBanner=function(){var e=this;return(0,i._)(function(){return(0,a.YH)(this,function(t){return[2,e.bannerBytes]})})()},e}(),R={NULL:48,OFW_RESET_AVR:42,OFW_CART_MODE:67,OFW_FW_VER:86,OFW_PCB_VER:104,OFW_USART_1_7M_SPEED:62,OFW_CART_PWR_ON:47,OFW_CART_PWR_OFF:46,OFW_QUERY_CART_PWR:93,OFW_DONE_LED_ON:61,OFW_ERROR_LED_ON:63,OFW_GB_CART_MODE:71,OFW_GB_FLASH_BANK_1_COMMAND_WRITES:78,OFW_LNL_QUERY:37,QUERY_FW_INFO:161,SET_MODE_AGB:162,SET_MODE_DMG:163,SET_VOLTAGE_3_3V:164,SET_VOLTAGE_5V:165,CART_PWR_ON:242,CART_PWR_OFF:243,SET_VARIABLE:166,SET_FLASH_CMD:167,SET_ADDR_AS_INPUTS:168,CLK_HIGH:169,CLK_LOW:170,DMG_CART_READ:177,DMG_CART_WRITE:178,DMG_CART_WRITE_SRAM:179,DMG_MBC_RESET:180,DMG_MBC7_READ_EEPROM:181,DMG_MBC7_WRITE_EEPROM:182,DMG_MBC6_MMSA_WRITE_FLASH:183,DMG_SET_BANK_CHANGE_CMD:184,DMG_EEPROM_WRITE:185,AGB_CART_READ:193,AGB_CART_WRITE:194,AGB_CART_READ_SRAM:195,AGB_CART_WRITE_SRAM:196,AGB_CART_READ_EEPROM:197,AGB_CART_WRITE_EEPROM:198,AGB_CART_WRITE_FLASH_DATA:199,AGB_CART_READ_3D_MEMORY:200,AGB_BOOTUP_SEQUENCE:201,DMG_FLASH_WRITE_BYTE:209,AGB_FLASH_WRITE_SHORT:210,FLASH_PROGRAM:211,CART_WRITE_FLASH_CMD:212},A={ADDRESS:{size:4,value:0},TRANSFER_SIZE:{size:2,value:0},BUFFER_SIZE:{size:2,value:1},DMG_ROM_BANK:{size:2,value:2},CART_MODE:{size:1,value:0},DMG_ACCESS_MODE:{size:1,value:1},FLASH_COMMAND_SET:{size:1,value:2},FLASH_METHOD:{size:1,value:3},FLASH_WE_PIN:{size:1,value:4},FLASH_PULSE_RESET:{size:1,value:5},FLASH_COMMANDS_BANK_1:{size:1,value:6},FLASH_SHARP_VERIFY_SR:{size:1,value:7},DMG_READ_CS_PULSE:{size:1,value:8},DMG_WRITE_CS_PULSE:{size:1,value:9},FLASH_DOUBLE_DIE:{size:1,value:10},DMG_READ_METHOD:{size:1,value:11},AGB_READ_METHOD:{size:1,value:12}},w={4:"v1.3",5:"v1.4",6:"v1.4a",101:"Mini v1.0d"},E={1:"V2",129:"V2",2:"V2C",130:"V2C",3:"V2CC",131:"V2CC/V2++"},g={12:"v1.2",13:"v1.3"},D=function(e){var t=e.filter(Boolean),r=new Uint8Array(t.reduce(function(e,t){return e+t.length},0)),n=0,i=!0,a=!1,s=void 0;try{for(var c,u=t[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var o=c.value;r.set(o,n),n+=o.length}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}return r},y=function(){function e(t){(0,u._)(this,e),this.textDecoder=new TextDecoder,this.receiving=function(){},this.data=function(){},this.longBuffer=null,this.portDeviceType=h.PACKET_CAPTURE,this.device=t,this.portType=t.portType,this.description=t.getDescription(),this.id=p(),this.readLoop()}var t=e.prototype;return t.readLoop=function(){var e=this;return(0,i._)(function(){var t,r,n,i;return(0,a.YH)(this,function(a){switch(a.label){case 0:t=0,r=function(){var t;(null==(t=e.longBuffer)?void 0:t.byteLength)&&(e.data(e.textDecoder.decode(e.longBuffer)),e.longBuffer=null)},n=e.device,a.label=1;case 1:if(!n.canRead())return[3,3];return[4,n.read({timeout:100})];case 2:return(i=a.sent()).byteLength&&(self.clearTimeout(t),t=self.setTimeout(r,1e3),e.receiving(),e.longBuffer=D([e.longBuffer,i])),[3,1];case 3:return[2]}})})()},t.setup=function(e){var t=e.receiving,r=e.data,n=this;return(0,i._)(function(){return(0,a.YH)(this,function(e){return n.receiving=t,n.data=r,[2]})})()},e}(),T=function(){var e=(0,i._)(function(e){return(0,a.YH)(this,function(t){return[2,new Promise(function(t){self.setTimeout(t,e)})]})});return function(t){return e.apply(this,arguments)}}(),C=function(){function e(t,r){(0,u._)(this,e),this.portDeviceType=h.GBXCART,this.startProgress=(n=(0,i._)(function(e){return(0,a.YH)(this,function(t){return console.log(e),[2,"#"]})}),function(e){return n.apply(this,arguments)}),this.setProgress=function(e,t){console.log("".concat(e," - ").concat(Math.round(100*t),"%"))},this.stopProgress=function(e){console.log("".concat(e," - done"))},this.device=t,this.portType=t.portType;var n,s=e.parseFwResponse(r);this.fwVer=(null==s?void 0:s.firmwareVersion)||0,this.powerControlSupport=(null==s?void 0:s.powerControlSupport)||!1,this.id=p(),this.description=[null==s?void 0:s.deviceName,null==s?void 0:s.pcbLabel,"fw:L".concat(null==s?void 0:s.firmwareVersion),t.getDescription()].filter(Boolean).join(" - ")}var t=e.prototype;return t.waitForAck=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=this;return(0,i._)(function(){var r,n;return(0,a.YH)(this,function(i){switch(i.label){case 0:if(!(t.fwVer<12))return[3,3];if(!(t.fwVer>1))return[3,2];return[4,T(e)];case 1:i.sent(),i.label=2;case 2:return[2];case 3:return r=[1,3],[4,t.device.read({length:1,timeout:e})];case 4:if(n=l._.apply(void 0,[i.sent(),1])[0],!r.includes(n))throw Error("no ack received");return[2]}})})()},t.setFwVariable=function(e,t){var r=this;return(0,i._)(function(){var n,i,s,c,u,o;return(0,a.YH)(this,function(a){switch(a.label){case 0:return i=(n=A[e]).size,s=n.value,c=R.SET_VARIABLE,(o=new DataView(u=new ArrayBuffer(10))).setUint8(0,c),o.setUint8(1,i),o.setUint32(2,s,!1),o.setUint32(6,t,!1),[4,r.device.send(new Uint8Array(u),[])];case 1:return a.sent(),[4,r.waitForAck(50)];case 2:return a.sent(),[2]}})})()},t.cartWrite=function(e,t){var r=this;return(0,i._)(function(){var n,i;return(0,a.YH)(this,function(a){switch(a.label){case 0:return(i=new DataView(n=new ArrayBuffer(6))).setUint8(0,R.DMG_CART_WRITE),i.setUint32(1,e,!1),i.setUint8(5,t),[4,r.device.send(new Uint8Array(n),[])];case 1:return a.sent(),[4,r.waitForAck()];case 2:return a.sent(),[2]}})})()},t.readRAM=function(e,t){var r=this;return(0,i._)(function(){var n,i,s,c;return(0,a.YH)(this,function(a){switch(a.label){case 0:return n=Math.min(4096,t),i=new Uint8Array([R.DMG_CART_READ]),[4,r.setFwVariable("TRANSFER_SIZE",n)];case 1:return a.sent(),[4,r.setFwVariable("ADDRESS",40960+e)];case 2:return a.sent(),[4,r.setFwVariable("DMG_ACCESS_MODE",3)];case 3:return a.sent(),[4,r.setFwVariable("DMG_READ_CS_PULSE",1)];case 4:a.sent(),s=new Uint8Array([]),a.label=5;case 5:if(!(s.byteLength<t))return[3,7];return[4,r.device.send(i,[{length:n}])];case 6:return c=l._.apply(void 0,[a.sent(),1])[0],s=D([s,c]),[3,5];case 7:return[2,s]}})})()},t.readROM=function(e,t){var r=this;return(0,i._)(function(){var n,i,s,c;return(0,a.YH)(this,function(a){switch(a.label){case 0:return n=Math.min(r.fwVer>1&&r.fwVer<12?2048:4096,t),i=new Uint8Array([R.DMG_CART_READ]),[4,r.setFwVariable("TRANSFER_SIZE",n)];case 1:return a.sent(),[4,r.setFwVariable("ADDRESS",e)];case 2:return a.sent(),[4,r.setFwVariable("DMG_ACCESS_MODE",1)];case 3:a.sent(),s=new Uint8Array([]),a.label=4;case 4:if(!(s.byteLength<t))return[3,6];return[4,r.device.send(i,[{length:n,timeout:1e3}])];case 5:return(c=l._.apply(void 0,[a.sent(),1])[0]).byteLength!==n?(console.log("Expected ".concat(n,"bytes from read, received ").concat(c.byteLength,"bytes after 1000ms")),s=D([s,new Uint8Array(n)])):s=D([s,c]),[3,4];case 6:return[2,s]}})})()},t.readROMName=function(){var e=this;return(0,i._)(function(){var t,r;return(0,a.YH)(this,function(n){switch(n.label){case 0:return[4,e.setModeVoltage()];case 1:return n.sent(),t=new TextDecoder,[4,e.readROM(308,16)];case 2:return r=n.sent(),[4,e.powerOff()];case 3:return n.sent(),[2,t.decode(r.filter(function(e){return 0!==e&&128!==e}))]}})})()},t.readRAMImage=function(){var e=this;return(0,i._)(function(){var t,r,n,i,s,c,u,o;return(0,a.YH)(this,function(a){switch(a.label){case 0:return[4,e.setModeVoltage()];case 1:return a.sent(),t=[],r=8192,i=n=16,[4,e.startProgress("Loading Camera RAM")];case 2:s=a.sent(),c=performance.now(),u=0,a.label=3;case 3:if(!(u<n))return[3,7];return[4,e.cartWrite(16384,u)];case 4:return a.sent(),e.setProgress(s,t.length/i),o=t.push,[4,e.readRAM(0,r)];case 5:o.apply(t,[a.sent()]),a.label=6;case 6:return u+=1,[3,3];case 7:return[4,e.powerOff()];case 8:return a.sent(),console.log("Reading RAM completed in ".concat(((performance.now()-c)/1e3).toFixed(2),"s")),e.stopProgress(s),[2,t]}})})()},t.readPhotoAlbums=function(){var e=this;return(0,i._)(function(){var t,r,n,i,s,c,u,o,l,f,d,_,v,h;return(0,a.YH)(this,function(a){switch(a.label){case 0:return[4,e.setModeVoltage()];case 1:return a.sent(),t=[],r=16384,n=8192,u=(s=16)+(i=64)-(c=8),[4,e.startProgress("Loading Album Rolls (ROM + Flash) from Photo!")];case 2:o=a.sent(),l=performance.now(),f=0,a.label=3;case 3:if(!(f<s))return[3,7];return[4,e.cartWrite(16384,f)];case 4:return a.sent(),e.setProgress(o,t.length/u),d=t.push,[4,e.readRAM(0,n)];case 5:d.apply(t,[a.sent()]),a.label=6;case 6:return f+=1,[3,3];case 7:_=c,a.label=8;case 8:if(!(_<i))return[3,14];return[4,e.cartWrite(8448,_)];case 9:if(a.sent(),e.setProgress(o,t.length/u),0!==_)return[3,11];return v=t.push,[4,e.readROM(0,r)];case 10:return v.apply(t,[a.sent()]),[3,13];case 11:return h=t.push,[4,e.readROM(16384,r)];case 12:h.apply(t,[a.sent()]),a.label=13;case 13:return _+=1,[3,8];case 14:return[4,e.powerOff()];case 15:return a.sent(),console.log("Reading Photo RAM+ROM completed in ".concat(((performance.now()-l)/1e3).toFixed(2),"s")),e.stopProgress(o),[2,t]}})})()},t.checkFirmware=function(){var t=this;return(0,i._)(function(){var r,n;return(0,a.YH)(this,function(i){switch(i.label){case 0:return r=new Uint8Array([R.QUERY_FW_INFO]),[4,t.device.send(r,[{timeout:100}])];case 1:return n=l._.apply(void 0,[i.sent(),1])[0],console.log(e.parseFwResponse(n)),[2]}})})()},t.setModeVoltage=function(){var e=this;return(0,i._)(function(){var t,r,n;return(0,a.YH)(this,function(i){switch(i.label){case 0:return t=new Uint8Array([R.SET_MODE_DMG]),[4,e.device.send(t,[])];case 1:case 3:return i.sent(),[4,e.waitForAck()];case 2:return i.sent(),r=new Uint8Array([R.SET_VOLTAGE_5V]),[4,e.device.send(r,[])];case 4:if(i.sent(),!e.powerControlSupport)return[3,7];return n=new Uint8Array([R[e.fwVer>=12?"CART_PWR_ON":"OFW_CART_PWR_ON"]]),[4,e.device.send(n,[])];case 5:return i.sent(),[4,e.waitForAck(250)];case 6:i.sent(),i.label=7;case 7:if(!(e.fwVer>=12))return[3,9];return[4,e.setFwVariable("DMG_READ_METHOD",1)];case 8:i.sent(),i.label=9;case 9:return[2]}})})()},t.powerOff=function(){var e=this;return(0,i._)(function(){var t;return(0,a.YH)(this,function(r){switch(r.label){case 0:if(!e.powerControlSupport)return[3,3];return t=new Uint8Array([R[e.fwVer>=12?"CART_PWR_OFF":"OFW_CART_PWR_OFF"]]),[4,e.device.send(t,[])];case 1:return r.sent(),[4,e.waitForAck(250)];case 2:r.sent(),r.label=3;case 3:return[2]}})})()},t.setup=function(e){var t=e.startProgress,r=e.setProgress,n=e.stopProgress,s=this;return(0,i._)(function(){return(0,a.YH)(this,function(e){return s.startProgress=t,s.setProgress=r,s.stopProgress=n,[2]})})()},e.parseFwResponse=function(e){var t=new TextDecoder;if(76!==e[1])return null;var r=new DataView(e.buffer,2,2).getUint16(0,!1),n=e[4],i=new DataView(e.buffer,5,4).getUint32(0,!1),a=e[9],s=new Date(1e3*i),c="GBxCart RW",u=r>1,o=!1;if(r>=12){var l=new Uint8Array(e.buffer,10,a-1);c=t.decode(l),u=!!e[a+10],o=!!e[a+11]}var f=w;return"GBFlash"===c?f=g:"Joey Jr"===c&&(f=E),{deviceName:c,powerControlSupport:u,bootloaderResetSupport:o,firmwareVersion:r,pcbVersion:n,pcbLabel:f[n]||"",firmwareTimestamp:i,firmwareDate:s}},e}(),m=r(87025),P=r(3899),M=r.n(P),O=r(52491),S=r.n(O),F=function(e){return e[e.LIGHT=0]="LIGHT",e[e.NORMAL=64]="NORMAL",e[e.DARK=127]="DARK",e}(F||{}),L=function(){function e(t){var r;(0,u._)(this,e),this.portDeviceType=h.SUPER_PRINTER_INTERFACE,this.textDecoder=new TextDecoder,this.textEncoder=new TextEncoder,this.startProgress=(r=(0,i._)(function(e){return(0,a.YH)(this,function(t){return console.log(e),[2,"#"]})}),function(e){return r.apply(this,arguments)}),this.setProgress=function(e,t){console.log("".concat(e," - ").concat(Math.round(100*t),"%"))},this.stopProgress=function(e){console.log("".concat(e," - done"))},this.setError=function(e){console.log(e)},this.device=t,this.portType=t.portType,this.description=t.getDescription(),this.id=p()}var t=e.prototype;return t.generatePrintCommand=function(e,t,r){return[80,(Math.max(0,Math.min(15,t))<<4)+Math.max(0,Math.min(15,r)),228,e,13]},t.sendCommands=function(e){var t=this;return(0,i._)(function(){var r,n,s,c;return(0,a.YH)(this,function(u){switch(u.label){case 0:if(!e.length)return[2];return r=e.length,[4,t.startProgress("Printing to Super Printer Interface")];case 1:var o;n=u.sent(),o=(0,i._)(function(){var i,c,u,o,f;return(0,a.YH)(this,function(a){switch(a.label){case 0:if(!(null==(i=e.shift())?void 0:i.byteLength))return[3,3];return t.setProgress(n,(r-e.length)/r),c=[{length:i.byteLength},{texts:[t.textEncoder.encode("Printer ready"),t.textEncoder.encode("Packet error")],timeout:2e4}],[4,t.device.send(i,c)];case 1:if(o=(u=l._.apply(void 0,[a.sent(),2]))[0],f=u[1],S()(i)!==S()(o))throw Error("Command validation failed");if(-1===t.textDecoder.decode(f).indexOf("Printer ready"))throw Error("Packet error");return[4,s()];case 2:return[2,a.sent()];case 3:return[2,!0]}})}),s=function(){return o.apply(this,arguments)},u.label=2;case 2:return u.trys.push([2,4,,5]),[4,s()];case 3:return u.sent(),[3,5];case 4:return c=u.sent(),t.setError(c.message),t.stopProgress(n),[3,5];case 5:return t.stopProgress(n),[2]}})})()},t.printImage=function(e){var t=this;return(0,i._)(function(){var r,n,i;return(0,a.YH)(this,function(a){switch(a.label){case 0:return r=e.reduce(function(e,t){var r=M()(t,2).flat();return(0,m._)(e).concat((0,m._)(r.map(function(e){return parseInt(e,16)})))},[]),n=M()(r,640).map(function(e){return new Uint8Array([68].concat((0,m._)(e),[13]))}),i=M()(n,1).map(function(e,r,n){var i=3*(r===n.length-1);return(0,m._)(e).concat([new Uint8Array(t.generatePrintCommand(127,+(0===r),i))])}).flat(),[4,t.sendCommands(i)];case 1:return a.sent(),[2]}})})()},t.setup=function(e){var t=e.startProgress,r=e.setProgress,n=e.stopProgress,s=e.setError,c=this;return(0,i._)(function(){return(0,a.YH)(this,function(e){return c.startProgress=t,c.setProgress=r,c.stopProgress=n,c.setError=s,[2]})})()},e}(),W=function(e,t){for(var r=t.length,n=e.length-r+1,i=0;i<n;i++){for(var a=!0,s=0;s<r;s++)if(e[i+s]!==t[s]){a=!1;break}if(a)return i}return -1},B="GAMEBOY PRINTER Packet Capture",H="GAMEBOY PRINTER Emulator",U="Super Printer Interface by Rapha\xebl BOICHOT",x=function(e){function t(e){var r;return(0,u._)(this,t),(r=(0,c._)(this,t)).enabled=!0,r.portType=e,r.textDecoder=new TextDecoder,r.textEncoder=new TextEncoder,r.bufferedData=null,r.readQueue=Promise.resolve(),r}(0,o._)(t,e);var r=t.prototype;return r.disable=function(){this.enabled=!1},r.startBuffering=function(e){var t=this;(0,i._)(function(){var r;return(0,a.YH)(this,function(n){switch(n.label){case 0:if(!t.canRead())return[3,8];n.label=1;case 1:return n.trys.push([1,6,,7]),[4,t.readChunk()];case 2:if(!(r=n.sent()).byteLength)return[3,3];return t.bufferedData=D([t.bufferedData,r]),[3,5];case 3:return[4,T(e)];case 4:n.sent(),n.label=5;case 5:return[3,7];case 6:return n.sent(),[3,8];case 7:return[3,0];case 8:return[2]}})})()},r.readFromBuffer=function(e){var t=e.timeout,r=e.length,n=e.texts,s=this;return(0,i._)(function(){var e,i,c,u,o;return(0,a.YH)(this,function(a){switch(a.label){case 0:if(e="number"==typeof r?r:1/0,i=!0,"number"==typeof t&&setTimeout(function(){i=!1},t),"number"!=typeof r)return[3,6];0===r&&(i=!1),a.label=1;case 1:if(!i)return[3,5];if(!(s.bufferedData&&s.bufferedData.byteLength>=r))return[3,2];return i=!1,[3,4];case 2:return[4,T(0)];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:return[3,17];case 6:if(!(n instanceof Array))return[3,15];0===n.length&&(i=!1),a.label=7;case 7:if(!i)return[3,14];if(!(s.bufferedData&&s.bufferedData.byteLength))return[3,11];if(!(u=null!=(c=n.map(function(e){return{needle:e,index:W(s.bufferedData,e)}}).filter(function(e){return -1!==e.index}).sort(function(e,t){return e.index-t.index})[0])?c:null))return[3,8];return e=u.index+u.needle.byteLength,i=!1,[3,10];case 8:return[4,T(0)];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return[4,T(0)];case 12:a.sent(),a.label=13;case 13:return[3,7];case 14:return[3,17];case 15:if(!i)return[3,17];return[4,T(0)];case 16:return a.sent(),[3,15];case 17:if(!s.bufferedData)return[2,new Uint8Array];return o=s.bufferedData.slice(0,e),s.bufferedData=s.bufferedData.slice(e),[2,o]}})})()},r.read=function(e){var t=this;return new Promise(function(r,n){t.readQueue=t.readQueue.then(function(){return t.readFromBuffer(e)}).then(r).catch(n)})},r.readReady=function(){var e=this;return new Promise(function(t,r){e.readQueue=e.readQueue.then(t).catch(r)})},r.detectActiveTypes=function(e){var t=this;return(0,i._)(function(){return(0,a.YH)(this,function(r){switch(r.label){case 0:if(-1===W(e,t.textEncoder.encode(B))&&-1===W(e,t.textEncoder.encode(H)))return[3,2];return[4,t.read({timeout:500})];case 1:return r.sent(),[2,new y(t)];case 2:if(-1!==W(e,t.textEncoder.encode(U)))return[2,new L(t)];r.label=3;case 3:return[2,null]}})})()},r.send=function(e,t){var r=this;return(0,i._)(function(){var n;return(0,a.YH)(this,function(i){switch(i.label){case 0:return r.bufferedData=null,[4,r.readReady()];case 1:return i.sent(),n=t.map(function(e){return r.read(e)}),[4,r.sendRaw(e)];case 2:return i.sent(),[2,Promise.all(n)]}})})()},r.detectGBxCart=function(){var e=this;return(0,i._)(function(){var t,r,n;return(0,a.YH)(this,function(i){switch(i.label){case 0:return[4,e.send(new Uint8Array([R.QUERY_FW_INFO]),[{timeout:100}])];case 1:if(!(t=l._.apply(void 0,[i.sent(),1])[0]).length||(console.log("firmwareInfo",r=C.parseFwResponse(t),t),!r))return[3,3];if(r.firmwareVersion>0&&""!==r.pcbLabel)return[2,new C(e,t)];return[4,e.read({timeout:500})];case 2:return n=i.sent(),e.disable(),[2,new b(e,D([t,n]),"GBXCart RW not recognized (".concat(r.pcbLabel," ").concat(r.deviceName," fw:").concat(r.firmwareVersion,")"))];case 3:return[2,null]}})})()},r.detectType=function(){var e=this;return(0,i._)(function(){var t,r,n,i,s,c,u,o;return(0,a.YH)(this,function(a){switch(a.label){case 0:return[4,e.read({timeout:4e3,texts:[e.textEncoder.encode(B),e.textEncoder.encode(H),e.textEncoder.encode(U)]})];case 1:return t=a.sent(),[4,e.detectActiveTypes(t)];case 2:if(r=a.sent())return[2,r];if(!t.byteLength)return[3,4];return[4,e.read({timeout:500})];case 3:return n=a.sent(),e.disable(),[2,new b(e,D([t,n]),"Banner not recognized")];case 4:return[4,e.detectGBxCart()];case 5:if(i=a.sent())return[2,i];return[4,e.send(new Uint8Array([85,170]),[{timeout:100}])];case 6:if(!(s=l._.apply(void 0,[a.sent(),1])[0]).byteLength||-1===e.textDecoder.decode(s).indexOf("Joey Jr FW L"))return[3,9];return[4,e.send(new Uint8Array([76,75]),[{timeout:100}])];case 7:if(!(c=l._.apply(void 0,[a.sent(),1])[0]).length||255!==c[0])throw Error("could not correctly initialize Joey Jr");return[4,e.detectGBxCart()];case 8:if(u=a.sent())return[2,u];a.label=9;case 9:return[4,e.send(new Uint8Array([13,10]),[{timeout:250}])];case 10:return o=l._.apply(void 0,[a.sent(),1])[0],e.disable(),[2,new b(e,o,"CrLf response not recognized")]}})})()},t}(d()),I=function(e){function t(e,r){var n;return(0,u._)(this,t),(n=(0,c._)(this,t,[v.SERIAL])).device=e,n.settingsCallback=r,n.baudRate=0,n.reader=null,n.writer=null,n}(0,o._)(t,e);var r=t.prototype;return r.getBaudRate=function(){return this.baudRate},r.canRead=function(){return!!(this.reader&&this.enabled)},r.getDescription=function(){return this.baudRate?"".concat(this.baudRate," baud"):""},r.readChunk=function(){var e=this;return(0,i._)(function(){var t,r;return(0,a.YH)(this,function(n){switch(n.label){case 0:return[4,null==(t=e.reader)?void 0:t.read()];case 1:return[2,null==(r=n.sent())?void 0:r.value]}})})()},r.connect=function(){var e=this;return(0,i._)(function(){var t;return(0,a.YH)(this,function(r){switch(r.label){case 0:return[4,e.settingsCallback()];case 1:if(e.baudRate=(null==(t=r.sent())?void 0:t.baudRate)||0,!e.baudRate)return[2,null];return[4,e.device.open({baudRate:e.baudRate})];case 2:return r.sent(),e.reader=e.device.readable.getReader(),e.writer=e.device.writable.getWriter(),e.startBuffering(50),[2,e.detectType()]}})})()},r.sendRaw=function(e){var t=this;return(0,i._)(function(){var r;return(0,a.YH)(this,function(n){switch(n.label){case 0:if(!(null==(r=t.device)?void 0:r.writable)||!t.writer)throw Error("device is not writable");return[4,t.writer.write(e)];case 1:return n.sent(),[2]}})})()},t}(x),G=new(function(e){function t(){var e;return(0,u._)(this,t),(e=(0,c._)(this,t)).connectedPorts=new Map,e.portsWorkerClient=null,e.enabled="undefined"!=typeof navigator&&!!navigator.serial&&!!TextDecoderStream,e}(0,o._)(t,e);var r=t.prototype;return r.registerClient=function(e){this.portsWorkerClient=e},r.initDevice=function(e){var t=this;return(0,i._)(function(){var r,n,i;return(0,a.YH)(this,function(a){switch(a.label){case 0:if(e.readable||!t.portsWorkerClient)return[2];return n=new b(r=new I(e,t.portsWorkerClient.settingsCallback),new Uint8Array,"identifying device"),t.connectedPorts.set(n.id,e),[4,t.portsWorkerClient.addDeviceApi((0,s.BX)(n))];case 1:return a.sent(),[4,r.connect()];case 2:if(!(i=a.sent()))return[3,5];return t.connectedPorts.delete(n.id),[4,t.portsWorkerClient.removeDeviceApi(n.id)];case 3:return a.sent(),t.connectedPorts.set(i.id,e),[4,t.portsWorkerClient.addDeviceApi((0,s.BX)(i))];case 4:a.sent(),a.label=5;case 5:return[2]}})})()},r.initPorts=function(){var e=this;return(0,i._)(function(){var t,r,n,s,c,u,o,f;return(0,a.YH)(this,function(d){switch(d.label){case 0:if(!e.enabled||!e.portsWorkerClient)throw Error("could not init serial ports");return console.log("initializing serial ports"),[4,navigator.serial.getPorts()];case 1:t=d.sent(),r=!0,n=!1,s=void 0,d.label=2;case 2:d.trys.push([2,7,8,9]),c=t[Symbol.iterator](),d.label=3;case 3:if(r=(u=c.next()).done)return[3,6];return o=u.value,[4,e.initDevice(o)];case 4:d.sent(),d.label=5;case 5:return r=!0,[3,3];case 6:return[3,9];case 7:return f=d.sent(),n=!0,s=f,[3,9];case 8:try{r||null==c.return||c.return()}finally{if(n)throw s}return[7];case 9:var _;return navigator.serial.addEventListener("connect",(_=(0,i._)(function(t){return(0,a.YH)(this,function(r){if(!e.portsWorkerClient)throw Error("could not init new serial port");return e.initDevice(t.target),[2]})}),function(e){return _.apply(this,arguments)})),navigator.serial.addEventListener("disconnect",function(t){if(e.portsWorkerClient){var r=(0,l._)(e.connectedPorts.entries().find(function(e){return(0,l._)(e,2)[1]===t.target})||[""],1)[0];r&&(e.connectedPorts.delete(r),e.portsWorkerClient.removeDeviceApi(r))}}),[2]}})})()},t}(d())),N=function(e){function t(e){var r;return(0,u._)(this,t),(r=(0,c._)(this,t,[v.USB])).device=e,r.productName=e.productName||"",r.interfaceNumber=2,r.endpointIn=5,r.endpointOut=4,r}(0,o._)(t,e);var r=t.prototype;return r.canRead=function(){return!!(this.device&&this.device.opened&&this.enabled)},r.getDescription=function(){return this.productName},r.readChunk=function(){var e=this;return(0,i._)(function(){var t,r;return(0,a.YH)(this,function(n){switch(n.label){case 0:return[4,e.device.transferIn(e.endpointIn,64)];case 1:return r=(null==(t=n.sent())?void 0:t.data)||new DataView(new Uint8Array([]).buffer),[2,new Uint8Array(r.buffer,r.byteOffset,r.byteLength)]}})})()},r.connect=function(){var e=this;return(0,i._)(function(){var t,r;return(0,a.YH)(this,function(n){switch(n.label){case 0:return[4,e.device.open()];case 1:return n.sent(),[4,e.device.selectConfiguration(1)];case 2:if(n.sent(),!(r=null==(t=e.device.configuration)?void 0:t.interfaces))return[2,null];return r.forEach(function(t){t.alternates.forEach(function(r){255===r.interfaceClass&&(e.interfaceNumber=t.interfaceNumber,r.endpoints.forEach(function(t){"out"===t.direction&&(e.endpointOut=t.endpointNumber),"in"===t.direction&&(e.endpointIn=t.endpointNumber)}))})}),[4,e.device.claimInterface(e.interfaceNumber)];case 3:return n.sent(),[4,e.device.selectAlternateInterface(e.interfaceNumber,0)];case 4:return n.sent(),[4,e.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:1,index:e.interfaceNumber})];case 5:return n.sent(),e.startBuffering(50),[2,e.detectType()]}})})()},r.sendRaw=function(e){var t=this;return(0,i._)(function(){return(0,a.YH)(this,function(r){switch(r.label){case 0:return[4,Promise.race([t.device.transferOut(t.endpointOut,e),new Promise(function(e,t){return setTimeout(function(){return t(Error("Device did not accept data after 10s"))},1e4)})])];case 1:return r.sent(),[2]}})})()},t}(x),V=new(function(e){function t(){var e;return(0,u._)(this,t),(e=(0,c._)(this,t)).connectedDevices=new Map,e.portsWorkerClient=null,e.enabled="undefined"!=typeof navigator&&!!navigator.usb&&!!navigator.usb.getDevices,e}(0,o._)(t,e);var r=t.prototype;return r.registerClient=function(e){this.portsWorkerClient=e},r.initDevice=function(e){var t=this;return(0,i._)(function(){var r,n,i;return(0,a.YH)(this,function(a){switch(a.label){case 0:if(e.opened||!t.portsWorkerClient)return[2];return n=new b(r=new N(e),new Uint8Array,"identifying device"),t.connectedDevices.set(n.id,e),[4,t.portsWorkerClient.addDeviceApi((0,s.BX)(n))];case 1:return a.sent(),[4,r.connect()];case 2:if(!(i=a.sent()))return[3,5];return t.connectedDevices.delete(n.id),[4,t.portsWorkerClient.removeDeviceApi(n.id)];case 3:return a.sent(),t.connectedDevices.set(i.id,e),[4,t.portsWorkerClient.addDeviceApi((0,s.BX)(i))];case 4:a.sent(),a.label=5;case 5:return[2]}})})()},r.initPorts=function(){var e=this;return(0,i._)(function(){return(0,a.YH)(this,function(t){switch(t.label){case 0:if(!e.enabled||!e.portsWorkerClient)return[2];return[4,navigator.usb.getDevices()];case 1:return t.sent().forEach(function(t){return e.initDevice(t)}),navigator.usb.addEventListener("connect",function(t){e.initDevice(t.device)}),navigator.usb.addEventListener("disconnect",function(t){if(e.portsWorkerClient){var r=(0,l._)(e.connectedDevices.entries().find(function(e){return(0,l._)(e,2)[1]===t.device})||[""],1)[0];r&&(e.connectedDevices.delete(r),e.portsWorkerClient.removeDeviceApi(r))}}),[2]}})})()},t}(d()));(0,s.p)({openSerial:function(){return(0,i._)(function(){return(0,a.YH)(this,function(e){switch(e.label){case 0:return console.log("open serial"),[4,G.initPorts()];case 1:return e.sent(),[2]}})})()},openUSB:function(){return(0,i._)(function(){return(0,a.YH)(this,function(e){switch(e.label){case 0:return[4,V.initPorts()];case 1:return e.sent(),[2]}})})()},registerClient:function(e){return(0,i._)(function(){return(0,a.YH)(this,function(t){switch(t.label){case 0:if(!G.enabled)return[3,3];return[4,G.registerClient(e)];case 1:return t.sent(),[4,G.initPorts()];case 2:t.sent(),t.label=3;case 3:if(!V.enabled)return[3,6];return[4,V.registerClient(e)];case 4:return t.sent(),[4,V.initPorts()];case 5:t.sent(),t.label=6;case 6:return e.setStatus(V.enabled,G.enabled),[2]}})})()}})}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}},s=!0;try{e[n].call(a.exports,a,a.exports,r),s=!1}finally{s&&delete t[n]}return a.exports}r.m=e,r.x=()=>{var e=r.O(void 0,[2491,8118,6926],()=>r(67332));return r.O(e)},(()=>{var e=[];r.O=(t,n,i,a)=>{if(n){a=a||0;for(var s=e.length;s>0&&e[s-1][2]>a;s--)e[s]=e[s-1];e[s]=[n,i,a];return}for(var c=1/0,s=0;s<e.length;s++){for(var[n,i,a]=e[s],u=!0,o=0;o<n.length;o++)(!1&a||c>=a)&&Object.keys(r.O).every(e=>r.O[e](n[o]))?n.splice(o--,1):(u=!1,a<c&&(c=a));if(u){e.splice(s--,1);var l=i();void 0!==l&&(t=l)}}return t}})(),r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce((t,n)=>(r.f[n](e,t),t),[])),r.u=e=>2491===e?"static/chunks/2491-7671e5eaecdf23e1.js":"static/chunks/"+e+"."+({6926:"da75d18f8b0de7e2",8118:"3e163b247373678a"})[e]+".js",r.miniCssF=e=>{},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.tt=()=>(void 0===e&&(e={createScriptURL:e=>e},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(e=trustedTypes.createPolicy("nextjs#bundler",e))),e)})(),r.tu=e=>r.tt().createScriptURL(e),r.p="/gb-printer-web/_next/",(()=>{var e={7332:1};r.f.i=(t,n)=>{e[t]||importScripts(r.tu(r.p+r.u(t)))};var t=self.webpackChunk_N_E=self.webpackChunk_N_E||[],n=t.push.bind(t);t.push=t=>{var[i,a,s]=t;for(var c in a)r.o(a,c)&&(r.m[c]=a[c]);for(s&&s(r);i.length;)e[i.pop()]=1;n(t)}})(),(()=>{var e=r.x;r.x=()=>Promise.all([2491,8118,6926].map(r.e,r)).then(e)})(),_N_E=r.x()})();