"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1575],{5672:(t,e,n)=>{n.d(e,{A:()=>o,Z:()=>a});var r=n(49641).Buffer,a=function(t){return t.UINT8_ARRAY="uint8array",t.TEXT="text",t.DATA_URL="dataURL",t.BINARY_STRING="binaryString",t}({});let o=function(t,e){return new Promise(function(n,a){var o=new FileReader;switch(o.onload=function(t){var o=t.target;if(null==o?void 0:o.result)return"uint8array"===e?void n(r.from(o.result)):void n(o.result);a(Error("Filereader has no result"))},o.onerror=function(t){a(t)},e){case"uint8array":o.readAsArrayBuffer(t);break;case"text":o.readAsText(t);break;case"binaryString":o.readAsBinaryString(t);break;case"dataURL":o.readAsDataURL(t);break;default:a(Error('readAs param missing or unknown type "'.concat(e,'"')))}})}},5847:(t,e,n)=>{n.d(e,{T:()=>i,p:()=>u});var r=n(97004),a=n(39249),o=n(55364),s=n(72623),i=function(t,e,n){var i,u=(i=(0,r._)(function(r,i,c,l){var h,f,d,p,g,m,b,v,w,_,T,y;return(0,a.YH)(this,function(a){switch(a.label){case 0:if(f=t.find(function(t){return r===t.hash}),d=("string"==typeof c?c:null==f?void 0:f.frame)||void 0,p=null==(h=e.find(function(t){return t.id===d}))?void 0:h.hash,l||!(!f||!(0,o.pl)(f)))return[3,2];return[4,(0,s.Hh)(r,p,i,n)];case 1:return[2,a.sent()||[]];case 2:if(!(g=l||f.hashes).r)return[3,4];return[4,u(g.r,i,d)];case 3:return b=a.sent(),[3,5];case 4:b=[],a.label=5;case 5:if(m=b,!g.g)return[3,7];return[4,u(g.g,i,d)];case 6:return w=a.sent(),[3,8];case 7:w=[],a.label=8;case 8:if(v=w,!g.b)return[3,10];return[4,u(g.b,i,d)];case 9:return T=a.sent(),[3,11];case 10:T=[],a.label=11;case 11:if(_=T,!g.n)return[3,13];return[4,u(g.n,i,d)];case 12:return y=a.sent(),[3,14];case 13:y=[],a.label=14;case 14:return[2,{r:m,g:v,b:_,n:y}]}})}),function(t,e,n,r){return i.apply(this,arguments)});return u},u=function(t,e){var n,o=i(t,e);return n=(0,r._)(function(t){var e,n,r,s,i;return(0,a.YH)(this,function(a){switch(a.label){case 0:return[4,o(t,!0,"")];case 1:if(e=a.sent())return[2,(null==e?void 0:e.length)||(null==(n=e.r)?void 0:n.length)||(null==(r=e.g)?void 0:r.length)||(null==(s=e.b)?void 0:s.length)||(null==(i=e.n)?void 0:i.length)||0];return[2,0]}})}),function(t){return n.apply(this,arguments)}}},6456:(t,e,n)=>{n.d(e,{PM:()=>u,YZ:()=>s,lt:()=>i});var r=n(693),a=n(60376),o=n(78538),s=function(t,e){return(0,a._)((0,r._)({},t),{sortIndex:e})},i=function(t){return(0,a._)((0,r._)({},t),{sortIndex:void 0})},u=function(t){return function(e,n){if(!t)return 0;var r=(0,o._)(t.split("_"),2),a=r[0],s=r[1],i=e[a],u=n[a],c="desc"===s?-1:1;return i&&u?i>u?c:i<u?-c:e.sortIndex<n.sortIndex?c:-c:0}}},10630:(t,e,n)=>{n.r(e),n.d(e,{gitSyncTool:()=>L,init:()=>E});var r,a,o=n(97004),s=n(39249),i=n(58617),u=n.n(i),c=n(46498),l=n(41476),h=n(52166),f=n(24463),d=n(74335),p=n(19320),g=n(17419),m=n(82666),b=n(65492),v=n(66214),w=n(87025),_=n(40662),T=n.n(_),y=n(67660),A=n(5672),S=function(t){function e(t,n,r){var a;return(0,b._)(this,e),(a=(0,m._)(this,e)).octoKit=null,a.busy=!1,a.owner="",a.repo="",a.branch="",a.throttle=10,a.token=null,a.progress=0,a.queueLength=0,a.addToQueue=r,a.getPreferredLocale=n,a.setOctokit(t||{}),a}(0,v._)(e,t);var n=e.prototype;return n.setOctokit=function(t){var e=t.use,n=t.owner,r=t.repo,a=t.branch,o=t.throttle,s=t.token;if(this.busy||!e||!n||!r||!a||!o||!s){this.octoKit=null,this.owner="",this.repo="",this.branch="",this.throttle=10,this.token=null;return}this.owner=n,this.repo=r,this.branch=a,this.throttle=Math.max(o,10)||10,this.token=s,this.octoKit=new y.E({auth:s})},n.progressStart=function(t){this.queueLength=t+7,this.emit("starting",{progress:0,queueLength:this.queueLength}),this.progressTick()},n.progressTick=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.progress=t?0:this.progress+1,this.emit("progress",{progress:this.progress,queueLength:this.queueLength}),t&&(this.queueLength=0)},n.getRepoContents=function(){var t=this;return(0,o._)(function(){var e,n,r,a,o,i,u;return(0,s.YH)(this,function(s){switch(s.label){case 0:return t.progressTick(),[4,t.addToQueue("repos.getBranch ".concat(t.branch),t.throttle,function(){var e;return null==(e=t.octoKit)?void 0:e.repos.getBranch({owner:t.owner,repo:t.repo,branch:t.branch})})];case 1:return e=s.sent().data.commit.sha,[4,t.addToQueue("git.getCommit ".concat(e),t.throttle,function(){var n;return null==(n=t.octoKit)?void 0:n.git.getCommit({owner:t.owner,repo:t.repo,commit_sha:e})})];case 2:return n=s.sent().data.tree.sha,[4,t.addToQueue("git.getTree ".concat(n),t.throttle,function(){var e;return null==(e=t.octoKit)?void 0:e.git.getTree({owner:t.owner,repo:t.repo,tree_sha:n,recursive:"1"})})];case 3:if(a=(r=s.sent().data.tree).find(function(t){return"settings.json"===t.path}),o=t.augmentFileList("images",r.filter(function(t){var e=t.path;return null==e?void 0:e.startsWith("images/")})),i=t.augmentFileList("frames",r.filter(function(t){var e=t.path;return null==e?void 0:e.startsWith("frames/")})),!(null==a?void 0:a.sha))return[3,5];return[4,t.getFileContent(a.sha,0,1)];case 4:return u=s.sent(),[3,6];case 5:u="{}",s.label=6;case 6:return[2,{images:o,frames:i,settings:JSON.parse(u)}]}})})()},n.augmentFileList=function(t,e){var n=this;return e.reduce(function(r,a,o){var s,i=a.path,u=a.sha;if(!i||!u)return r;var c=i.split("/").pop()||"";switch(t){case"images":case"frames":s=c.split(".")[0];break;default:s="-"}var l={path:i,name:c,hash:s,getFileContent:function(){return n.getFileContent(u,o,e.length)}};return(0,w._)(r).concat([l])},[])},n.getFileContent=function(t,e,n){var r=this;return(0,o._)(function(){return(0,s.YH)(this,function(a){switch(a.label){case 0:return r.progressTick(),[4,r.addToQueue("git.getBlob (".concat(e+1,"/").concat(n,") ").concat(t),r.throttle,function(){var e;return null==(e=r.octoKit)?void 0:e.git.getBlob({owner:r.owner,repo:r.repo,file_sha:t})})];case 1:var o;return[2,(o=a.sent().data.content,decodeURIComponent(Array.prototype.map.call(atob(o),function(t){return"%".concat("00".concat(t.charCodeAt(0).toString(16)).slice(-2))}).join("")))]}})})()},n.getCurrentCommit=function(){var t=this;return(0,o._)(function(){var e,n;return(0,s.YH)(this,function(r){switch(r.label){case 0:return t.progressTick(),[4,t.addToQueue("git.getRef heads/".concat(t.branch),t.throttle,function(){var e;return null==(e=t.octoKit)?void 0:e.git.getRef({owner:t.owner,repo:t.repo,ref:"heads/".concat(t.branch)})})];case 1:return e=r.sent().data.object.sha,[4,t.addToQueue("git.getCommit ".concat(e),t.throttle,function(){var n;return null==(n=t.octoKit)?void 0:n.git.getCommit({owner:t.owner,repo:t.repo,commit_sha:e})})];case 2:return n=r.sent().data,[2,{commitSha:e,treeSha:n.tree.sha}]}})})()},n.createBlobForFile=function(t,e,n){var r=t.destination,a=t.blob,i=this;return(0,o._)(function(){var t,o,u;return(0,s.YH)(this,function(s){switch(s.label){case 0:return i.progressTick(),[4,(0,A.A)(a,A.Z.DATA_URL)];case 1:return o=(t=s.sent()).indexOf(";base64,")+8,u=t.slice(o),[4,i.addToQueue("git.createBlob (".concat(e+1,"/").concat(n,") ").concat(r),i.throttle,function(){var t;return null==(t=i.octoKit)?void 0:t.git.createBlob({owner:i.owner,repo:i.repo,content:u,encoding:"base64"})})];case 2:return[2,{filename:r,blobData:s.sent().data}]}})})()},n.createNewTree=function(t,e,n){var r=this;return(0,o._)(function(){var a,o;return(0,s.YH)(this,function(s){switch(s.label){case 0:return r.progressTick(),a=t.map(function(t){return{path:t.filename,mode:"100644",type:"blob",sha:t.blobData.sha}}),o=e.map(function(t){return{path:t.path,mode:"100644",sha:null}}),[4,r.addToQueue("git.createTree ".concat(n),r.throttle,function(){var t;return null==(t=r.octoKit)?void 0:t.git.createTree({owner:r.owner,repo:r.repo,tree:(0,w._)(a).concat((0,w._)(o)),base_tree:n})})];case 1:return[2,s.sent().data.sha]}})})()},n.createNewCommit=function(t,e,n){var r=this;return(0,o._)(function(){return(0,s.YH)(this,function(a){switch(a.label){case 0:return r.progressTick(),[4,r.addToQueue("git.createCommit ".concat(t),r.throttle,function(){var a;return null==(a=r.octoKit)?void 0:a.git.createCommit({owner:r.owner,repo:r.repo,message:t,tree:e,parents:[n]})})];case 1:return[2,a.sent().data.sha]}})})()},n.setBranchToCommit=function(t){var e=this;return(0,o._)(function(){return(0,s.YH)(this,function(n){switch(n.label){case 0:return e.progressTick(),[4,e.addToQueue("git.updateRef ".concat(t),e.throttle,function(){var n;return null==(n=e.octoKit)?void 0:n.git.updateRef({owner:e.owner,repo:e.repo,ref:"heads/".concat(e.branch),sha:t})})];case 1:return n.sent(),[2]}})})()},n.uploadToRepo=function(t){var e=t.upload,n=t.del,r=this;return(0,o._)(function(){var t,a,o,i,u,c,l,h;return(0,s.YH)(this,function(s){switch(s.label){case 0:if(!r.octoKit)throw Error("OctoClient not configured");return t="Sync. ".concat(new Date().toLocaleString(r.getPreferredLocale())),a=e.length,[4,r.getCurrentCommit()];case 1:return i=(o=s.sent()).treeSha,u=o.commitSha,[4,Promise.all(e.map(function(t,e){return r.createBlobForFile(t,e,a)}))];case 2:return c=s.sent(),[4,r.createNewTree(c,n,i)];case 3:return l=s.sent(),[4,r.createNewCommit(t,l,u)];case 4:return h=s.sent(),[4,r.setBranchToCommit(h)];case 5:return s.sent(),[2]}})})()},n.updateRemoteStore=function(t){var e=t.upload,n=t.del,r=this;return(0,o._)(function(){var t;return(0,s.YH)(this,function(a){switch(a.label){case 0:if(a.trys.push([0,2,,3]),r.busy)throw Error("currently busy");if(!e.length&&!n.length)return[2,{}];return r.progressStart(e.length),r.busy=!0,[4,r.uploadToRepo({upload:e,del:n})];case 1:return a.sent(),r.busy=!1,r.progressTick(!0),[2,{uploaded:e.map(function(t){return t.destination}),deleted:n.map(function(t){return t.path}),repo:"https://github.com/".concat(r.owner,"/").concat(r.repo,"/tree/").concat(r.branch)}];case 2:throw t=a.sent(),r.busy=!1,r.emit("error",t),t;case 3:return[2]}})})()},e}(T()),E=function(){var t=f.A.getState().gitStorage,e=l.A.getState().setProgressLog,n=new(u())(1,1/0);r=new S(t,function(){return h.A.getState().preferredLocale},(a=function(t){return function(r,a,i){return n.add((0,o._)(function(){return(0,s.YH)(this,function(n){switch(n.label){case 0:return[4,(0,d.c)(a)];case 1:return n.sent(),e("git",{timestamp:new Date().getTime()/1e3,message:"".concat(t," runs ").concat(r)}),[2,i()]}})}))}})("OctoClient"))},L=function(t){var e,n,i=c.A.getState(),u=i.setSyncBusy,h=i.setSyncSelect,d=l.A.getState().setProgressLog,m=f.A.getState().syncLastUpdate,b=(e=(0,o._)(function(t){return(0,s.YH)(this,function(e){switch(e.label){case 0:return[4,r.setOctokit(t)];case 1:return e.sent(),[2]}})}),function(t){return e.apply(this,arguments)}),v=(n=(0,o._)(function(e){var n,o,i,l;return(0,s.YH)(this,function(s){switch(s.label){case 0:u(!0),h(!1),s.label=1;case 1:return s.trys.push([1,10,,11]),[4,r.getRepoContents()];case 2:switch(n=s.sent(),e){case"up":return[3,3];case"down":return[3,6]}return[3,8];case 3:return o=(null==m?void 0:m.local)||Math.floor(new Date().getTime()/1e3),[4,(0,p.A)(n,o,a("GBPrinter"))];case 4:return i=s.sent(),[4,r.updateRemoteStore(i)];case 5:return s.sent(),[3,9];case 6:return[4,(0,g.Ay)(n)];case 7:return t(s.sent()),[3,9];case 8:throw Error("github sync: wrong sync case");case 9:return d("git",{timestamp:new Date().getTime()/1e3,message:"."}),u(!1),[3,11];case 10:return console.error(l=s.sent()),c.A.getState().setError(l),[3,11];case 11:return[2]}})}),function(t){return n.apply(this,arguments)});return f.A.subscribe(function(t){return t.gitStorage},b),{startSyncData:v,updateSettings:b}}},12360:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(19864);let a=function(t){return function(e){var n=t.filter(function(t){return![r.X3.FILTER_MONOCHROME,r.X3.FILTER_NEW,r.X3.FILTER_RGB,r.X3.FILTER_UNTAGGED,r.X3.FILTER_RECENT,r.X3.FILTER_FAVOURITE,r.X3.FILTER_COMMENTS,r.X3.FILTER_USERNAME].includes(t)});return!n.length||!!e.tags.find(function(t){return n.includes(t)})}}},19320:(t,e,n)=>{n.d(e,{A:()=>_});var r=n(97004),a=n(87025),o=n(39249);let s=function(t,e,n,r){var o=t.images,s=t.frames,i=o.filter(function(t){var a=t.path;return!n.find(function(t){return a===t.destination})&&!e.find(function(t){return a===t.destination})&&!r.find(function(t){return a.indexOf(t)>=-1})}),u=s.filter(function(t){var r=t.path;return!n.find(function(t){return r===t.destination})&&!e.find(function(t){return r===t.destination})});return{upload:e.filter(function(t){var e=t.destination;return!o.find(function(t){return t.path===e})&&!s.find(function(t){return t.path===e})}),del:(0,a._)(i).concat((0,a._)(u))}};var i=n(69229),u=n(69176),c=function(t){switch(t){case"image/png":return"png";case"image/jpg":case"image/jpeg":return"jpg";case"image/webp":return"webp";case"text/plain":return"txt";case"text/markdown":return"md";case"application/json":case"text/json":return"json";default:return console.warn('unknown file extension for type "'.concat(t,'"')),"none"}};let l=function(){var t;return t=(0,r._)(function(t,e){var n,r,s,l,h;return(0,o.YH)(this,function(o){switch(o.label){case 0:return n=[],r=[],s={},t.forEach(function(t){var e,o,i=t.files,u=t.inRepo;(e=r).push.apply(e,(0,a._)(u.map(function(t){var e=t.path,n=e.split("/")[0];return s[n]=s[n]?s[n]+1:1,{destination:e}}))),(o=n).push.apply(o,(0,a._)(i.map(function(t){var e=t.blob,n=t.folder,r=t.filename,a=c(e.type),o=n||a;return s[o]=s[o]?s[o]+1:1,{destination:"".concat(o,"/").concat(r),blob:e}})))}),l=["## Files in this repo:"].concat((0,a._)(Object.keys(s).map(function(t){return" * ".concat(t,": [").concat(s[t],"](/").concat(t,")")}))).join("\n"),[4,(0,u.m)(i.m.JSON_EXPORT,{lastUpdateUTC:e})];case 1:return h=o.sent(),n.push({destination:"README.md",blob:new Blob((0,a._)(l),{type:"text/plain"})},{destination:"settings.json",blob:new Blob((0,a._)(h),{type:"application/json"})}),[2,{toUpload:n.filter(Boolean),toKeep:r.filter(Boolean)}]}})}),function(e,n){return t.apply(this,arguments)}};var h=n(693),f=n(60376),d=n(11760),p=n(53982),g=function(){var t=(0,r._)(function(t,e){var n,a,s;return(0,o.YH)(this,function(i){switch(i.label){case 0:return n=[],s=(a=d.h.getState().frames.map(function(e){return{file:e,searchHashes:[e.hash],inRepo:[t.frames.find(function(t){return t.hash===e.hash})].filter(Boolean)}})).length,[4,Promise.all(a.map(function(t,n){var a=t.file;return t.inRepo.length?(0,f._)((0,h._)({},a),{inRepo:t.inRepo,files:[]}):e("loadFrameData (".concat(n+1,"/").concat(s,") ").concat(a.id),3,(0,r._)(function(){var e;return(0,o.YH)(this,function(n){switch(n.label){case 0:return[4,(0,p.mZ)(a.hash)];case 1:return e=n.sent(),[2,(0,f._)((0,h._)({},a),{inRepo:t.inRepo,files:[{folder:"frames",filename:"".concat(a.hash,".json"),blob:new Blob(Array(JSON.stringify(e||"{}",null,2)),{type:"application/json"}),title:a.name}]})]}})}))}))];case 1:return[2,{syncFrames:i.sent().filter(Boolean),missingLocally:n}]}})});return function(e,n){return t.apply(this,arguments)}}(),m=n(2608),b=n(55364),v=n(55685),w=function(){var t=(0,r._)(function(t,e){var n,s,i;return(0,o.YH)(this,function(u){switch(u.label){case 0:var c;return n=[],i=(s=d.h.getState().images.map(function(e){var n=(0,b.pl)(e)?(0,v.A)(Object.values(e.hashes)).filter(Boolean):[e.hash];return{file:e,searchHashes:n,inRepo:t.images.reduce(function(t,e){return n.includes(e.hash)?(0,a._)(t).concat([e]):t},[])}})).length,[4,Promise.all(s.map((c=(0,r._)(function(t,n){return(0,o.YH)(this,function(a){return t.inRepo.length===t.searchHashes.length?[2,{hash:t.file.hash,inRepo:t.inRepo,files:[]}]:[2,e("loadImageTiles (".concat(n+1,"/").concat(i,") ").concat(t.file.title),3,(0,r._)(function(){var e,n,r;return(0,o.YH)(this,function(a){switch(a.label){case 0:if(!(0,b.pl)(t.file))return[3,2];return[4,Promise.all(Object.values((n=t.file).hashes).map(function(t){return(0,m.Z)(t,n.title,t)}))];case 1:return e=a.sent(),[3,4];case 2:return r=t.file,[4,(0,m.Z)(r.hash,r.title,r.hash)];case 3:e=[a.sent()],a.label=4;case 4:return[2,{hash:t.file.hash,files:e,inRepo:t.inRepo}]}})}))]})}),function(t,e){return c.apply(this,arguments)})))];case 1:return[2,{syncImages:u.sent().filter(Boolean),missingLocally:n}]}})});return function(e,n){return t.apply(this,arguments)}}();let _=function(){var t=(0,r._)(function(t,e,n){var r,i,u,c,h,f,d,p,m,b,v,_;return(0,o.YH)(this,function(o){switch(o.label){case 0:return u=l(),c=[],[4,w(t,n)];case 1:return f=(h=o.sent()).syncImages,d=h.missingLocally,(r=c).push.apply(r,(0,a._)(d)),[4,g(t,n)];case 2:return m=(p=o.sent()).syncFrames,b=p.missingLocally,(i=c).push.apply(i,(0,a._)(b)),v=(0,a._)(f).concat((0,a._)(m)),[4,u(v,e)];case 3:return[2,s(t,(_=o.sent()).toUpload,_.toKeep,c)]}})});return function(e,n,r){return t.apply(this,arguments)}}()},39630:(t,e,n)=>{n.d(e,{V:()=>r});var r=function(t){return t.CHECKBOX="checkbox",t.SELECT="select",t.TEXT="text",t.NUMBER="number",t.INFO="info",t.IMAGE="image",t.META="meta",t}({})},41476:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(86447),a=n(693),o=n(60376),s=n(87025),i=n(51368);let u=(0,n(65453).v)(function(t,e){return{progress:[],progressLog:{git:[],dropbox:[]},resetProgressLog:function(){return t({progressLog:{git:[],dropbox:[]}})},startProgress:function(e){var n={id:(0,i.A)(),label:e,value:0};return t(function(t){var e=t.progress;return{progress:(0,s._)(e).concat([n])}}),n.id},setProgress:function(e,n){t(function(t){return{progress:t.progress.map(function(t){return t.id!==e?t:(0,o._)((0,a._)({},t),{value:n})})}})},stopProgress:function(e){t(function(t){return{progress:t.progress.filter(function(t){return t.id!==e})}})},setProgressLog:function(n,i){var u=e().progressLog;t({progressLog:(0,o._)((0,a._)({},u),(0,r._)({},n,[i].concat((0,s._)(u[n]))))})}}})},66785:(t,e,n)=>{n.d(e,{S:()=>i});var r=n(87025),a=n(6456),o=n(77840),s=n(12360),i=function(t,e){var n=e.filtersActiveTags,i=e.sortBy,u=e.recentImports;return(0,r._)(t).map(a.YZ).sort((0,a.PM)(i)).map(a.lt).filter((0,o.A)(n,u)).filter((0,s.A)(n))}},74335:(t,e,n)=>{n.d(e,{c:()=>o});var r=n(97004),a=n(39249),o=function(){var t=(0,r._)(function(t){return(0,a.YH)(this,function(e){return[2,new Promise(function(e){self.setTimeout(e,t)})]})});return function(e){return t.apply(this,arguments)}}()},77840:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(87025),a=n(30832),o=n.n(a),s=n(19864),i=n(55364);let u=function(t,e){return function(n){var a,u,c=t.reduce(function(t,e){return[s.X3.FILTER_MONOCHROME,s.X3.FILTER_NEW,s.X3.FILTER_RGB,s.X3.FILTER_UNTAGGED,s.X3.FILTER_RECENT,s.X3.FILTER_FAVOURITE,s.X3.FILTER_COMMENTS,s.X3.FILTER_USERNAME].includes(e)?(0,r._)(t).concat([e]):t},[]);if(c.length&&(c.includes(s.X3.FILTER_UNTAGGED)&&0!==n.tags.length||c.includes(s.X3.FILTER_NEW)&&o()(new Date(n.created)).unix()<=o()().subtract(1,"day").unix()||c.includes(s.X3.FILTER_RECENT)&&!e.map(function(t){return t.hash}).includes(n.hash)||c.includes(s.X3.FILTER_RGB)&&!(0,i.pl)(n)||c.includes(s.X3.FILTER_MONOCHROME)&&(0,i.pl)(n)||c.includes(s.X3.FILTER_FAVOURITE)&&!n.tags.includes(s.X3.FILTER_FAVOURITE)||c.includes(s.X3.FILTER_COMMENTS)&&!(null==(a=n.meta)?void 0:a.comment)||c.includes(s.X3.FILTER_USERNAME)&&!(null==(u=n.meta)?void 0:u.userName)))return!1;return!0}}},93782:(t,e,n)=>{n.d(e,{A:()=>r});let r=function(t){return t.replace(/[^a-z0-9/\\._-]/gi,"").replace(/[\\/]+/gi,"/").replace(/^\//,"").replace(/\/$/,"")}},94979:(t,e,n)=>{n.r(e),n.d(e,{dropBoxSyncTool:()=>X});var r=n(97004),a=n(693),o=n(60376),s=n(87025),i=n(39249),u=n(58617),c=n.n(u),l=n(39630),h=n(41186),f=n(71620),d=n(46498),p=n(11760),g=n(41476),m=n(52166),b=n(24463),v=n(74335),w=n(5415),_=n(66785),T=n(19320),y=n(5847);let A=function(){var t=new URLSearchParams(window.location.search).get("code");return t?(window.history.replaceState({},"",window.location.pathname),{dropboxCode:t}):{}};var S=n(31533),E=n(17419),L=n(53982),R=n(82666),x=n(65492),C=n(66214),F=n(78538),H=n(40662),k=n(87422),I=n(93782),Y=n(5672),U=encodeURIComponent("".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname)),P=function(t){function e(t,n){(0,x._)(this,e),(r=(0,R._)(this,e)).queueCallback=n,r.throttle=30,r.rootPath=[];var r,a,o=t.accessToken,s=t.expiresAt,i=t.refreshToken,u=t.path,c=t.autoDropboxSync;r.setRootPath(u),r.dbx=new k.Dropbox({clientId:"err6neqzlljod7b",accessToken:o,accessTokenExpiresAt:new Date(s||0),refreshToken:i});var l=null==(a=r.dbx)?void 0:a.auth;if(!l)throw Error("dbx auth error");return r.auth=l,c&&r.startLongPollSettings(),r}(0,C._)(e,t);var n=e.prototype;return n.addToQueue=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var a=this;return(0,r._)(function(){return(0,i.YH)(this,function(t){if(!a.auth.getAccessToken())throw Error("not logged in");return[2,a.queueCallback.apply(a,(0,s._)(e))]})})()},n.setRootPath=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.rootPath=(0,I.A)(t).split("/")},n.toPath=function(t){var e=(0,s._)(this.rootPath).concat((0,s._)(t.split("/"))).filter(Boolean);return"/".concat(e.join("/"))},n.inSettingsPath=function(t){var e=this.toPath("settings");return(0,I.A)(t.replace(e,""))},n.checkLoginStatus=function(){var t=this;return(0,r._)(function(){var e,n,r,a;return(0,i.YH)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,t.auth.checkAndRefreshAccessToken()];case 1:return o.sent(),e=t.auth.getAccessToken(),r=(n=t.auth.getAccessTokenExpiresAt().getTime())-new Date().getTime(),t.emit("loginDataUpdate",{accessToken:e,expiresAt:n}),[2,!!e&&r>1e3];case 2:throw a=o.sent(),t.auth.setAccessTokenExpiresAt(new Date(0)),t.auth.setAccessToken(""),a;case 3:return[2]}})})()},n.startAuth=function(){var t=this;return(0,r._)(function(){var e;return(0,i.YH)(this,function(n){switch(n.label){case 0:return[4,t.auth.getAuthenticationUrl(U,void 0,"code","offline",void 0,void 0,!0)];case 1:return e=n.sent(),window.sessionStorage.setItem("dropboxCodeVerifier",t.auth.getCodeVerifier()),window.location.replace(e),[2]}})})()},n.codeAuth=function(t){var e=this;return(0,r._)(function(){var n,r,a,o,s,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(!(n=window.sessionStorage.getItem("dropboxCodeVerifier")))throw Error("no codeVerifier");return e.auth.setCodeVerifier(n),window.sessionStorage.removeItem("dropboxCodeVerifier"),[4,e.auth.getAccessTokenFromCode(U,t)];case 1:return a=(r=i.sent().result).refresh_token,o=r.access_token,s=r.expires_in,u=new Date().getTime()+1e3*s,e.auth.setAccessToken(o),e.auth.setAccessTokenExpiresAt(new Date(u)),e.emit("loginDataUpdate",{refreshToken:a,accessToken:o,expiresAt:u}),[2]}})})()},n.getRemoteContents=function(t){var e=this;return(0,r._)(function(){var n,a,o,s,u,c,l;return(0,i.YH)(this,function(h){switch(h.label){case 0:return n=["images","frames"],a="diff"===t,[4,e.checkLoginStatus()];case 1:if(!h.sent())throw Error("not logged in");h.label=2;case 2:return h.trys.push([2,5,,6]),[4,e.addToQueue("dbx.filesDownload /settings.json",e.throttle,function(){return e.dbx.filesDownload({path:e.toPath("/settings/settings.json")})},a)];case 3:return s=h.sent().result,[4,(0,Y.A)(s.fileBlob,Y.Z.TEXT)];case 4:return o=JSON.parse(h.sent()),[3,6];case 5:return h.sent(),o={state:{lastUpdateUTC:0,version:p.A}},[3,6];case 6:var f;return[4,Promise.all(n.map((f=(0,r._)(function(t){var n,r,o,s,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:o="",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.addToQueue("dbx.filesListFolder /".concat(t),e.throttle,function(){return e.dbx.filesListFolder({path:e.toPath("/settings/".concat(t)),limit:250,recursive:!0})},a)];case 2:return n=(s=i.sent()).result.entries,r=s.result.has_more,o=s.result.cursor,[3,4];case 3:return i.sent(),n=[],r=!1,[3,4];case 4:if(!r)return[3,6];return u=n.concat,[4,e.getMoreContents(o,a)];case 5:n=u.apply(n,[i.sent()]),i.label=6;case 6:return[2,n.filter(function(t){return"file"===t[".tag"]})]}})}),function(t){return f.apply(this,arguments)})))];case 7:return c=(u=F._.apply(void 0,[h.sent(),2]))[0],l=u[1],[2,{images:e.augmentFileList("images",c,a),frames:e.augmentFileList("frames",l,a),settings:o}]}})})()},n.getImageContents=function(){var t=this;return(0,r._)(function(){var e,n,r,a,o;return(0,i.YH)(this,function(i){switch(i.label){case 0:r="",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.addToQueue("dbx.filesListFolder /images",t.throttle,function(){return t.dbx.filesListFolder({path:t.toPath("/images"),limit:250,recursive:!0})})];case 2:return e=(a=i.sent()).result.entries,n=a.result.has_more,r=a.result.cursor,[3,4];case 3:return i.sent(),e=[],n=!1,[3,4];case 4:if(!n)return[3,6];return o=e.concat,[4,t.getMoreContents(r)];case 5:e=o.apply(e,[i.sent()]),i.label=6;case 6:return[2,e.reduce(function(t,e){return"file"===e[".tag"]?(0,s._)(t).concat([e]):t},[])]}})})()},n.getMoreContents=function(t,e){var n=this;return(0,r._)(function(){var r,a,o,s,u;return(0,i.YH)(this,function(i){switch(i.label){case 0:o="",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.addToQueue("dbx.filesListFolderContinue ".concat(t),n.throttle,function(){return n.dbx.filesListFolderContinue({cursor:t})},e)];case 2:return r=(s=i.sent()).result.entries,a=s.result.has_more,o=s.result.cursor,[3,4];case 3:return i.sent(),r=[],a=!1,[3,4];case 4:if(!a)return[3,6];return u=r.concat,[4,n.getMoreContents(o,e)];case 5:r=u.apply(r,[i.sent()]),i.label=6;case 6:return[2,r]}})})()},n.augmentFileList=function(t,e,n){var r=this;return e.map(function(a,o){var s,i=a.path_lower,u=a.content_hash,c=a.name,l=i?r.inSettingsPath(i):"";switch(t){case"images":case"frames":s=c.split(".")[0];break;default:s="-"}return{path:l,name:c,contentHash:u||"",hash:s,getFileContent:function(){return r.getFileContent(l,o,e.length,n)}}})},n.getFileContent=function(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this;return(0,r._)(function(){var r,s;return(0,i.YH)(this,function(i){switch(i.label){case 0:return r="dbx.filesDownload (".concat(e+1,"/").concat(n,") ").concat(t),[4,o.addToQueue(r,o.throttle,function(){return o.dbx.filesDownload({path:o.toPath("/settings/".concat(t))})},a)];case 1:return s=i.sent().result,[2,(0,Y.A)(s.fileBlob,Y.Z.TEXT)]}})})()},n.upload=function(t,e){var n=this;return(0,r._)(function(){var a,o,s,u,c,l;return(0,i.YH)(this,function(h){var f,d;switch(h.label){case 0:return a=t.upload,o=t.del,[4,Promise.all(a.map((f=(0,r._)(function(t,r){return(0,i.YH)(this,function(o){switch(o.label){case 0:return[4,n.addToQueue("dbx.filesUpload (".concat(r+1,"/").concat(a.length,") ").concat(t.destination),n.throttle,function(){return n.dbx.filesUpload({path:n.toPath("/".concat(e,"/").concat(t.destination)),contents:t.blob,mode:{".tag":"overwrite"}})})];case 1:return[2,o.sent().result]}})}),function(t,e){return f.apply(this,arguments)})))];case 1:if(s=h.sent(),!o.length)return[2,{uploaded:s,deleted:[]}];return[4,n.addToQueue("dbx.filesDeleteBatch ".concat(o.length," files"),n.throttle,function(){return n.dbx.filesDeleteBatch({entries:o.map(function(t){var e=t.path;return{path:n.toPath("/settings/".concat(e))}})})})];case 2:return u=h.sent().result.async_job_id,d=(0,r._)(function(){var t,e,r;return(0,i.YH)(this,function(a){switch(a.label){case 0:return[4,n.addToQueue("dbx.filesDeleteBatchCheck ".concat(u),2e3,function(){return n.dbx.filesDeleteBatchCheck({async_job_id:u})})];case 1:if(e=(t=a.sent().result)[".tag"],r=t.entries,"in_progress"===e)return[2,c()];return[2,r.map(function(t){return t.metadata})]}})}),[4,(c=function(){return d.apply(this,arguments)})()];case 3:return l=h.sent(),[2,{uploaded:s,deleted:l}]}})})()},n.startLongPollSettings=function(){var t=this;console.info("Start dropbox longpolling"),this.dbx.filesListFolderGetLatestCursor({path:this.toPath("/settings"),recursive:!1,include_media_info:!1,include_deleted:!1,include_has_explicit_shared_members:!1}).then(function(e){var n=e.result.cursor,r=function(){return t.dbx.filesListFolderLongpoll({cursor:n,timeout:480})};return r().then(function(e){var n=e.result.changes;return(console.info("Longpoll info. Changes: ",n),n)?(t.emit("settingsChanged"),t.addToQueue("Restart longpolling",t.throttle,function(){return t.startLongPollSettings(),Promise.resolve(null)},!0)):r()})}).catch(function(t){d.A.getState().setError(t)})},e}(H.EventEmitter),D=n(3899),B=n.n(D);function N(){return(N=(0,r._)(function(t){var e,n,a;return(0,i.YH)(this,function(o){switch(o.label){case 0:var u;return[4,Promise.all(B()(new Uint8Array(t),4194304).map((u=(0,r._)(function(t){var e;return(0,i.YH)(this,function(n){switch(n.label){case 0:return e=Uint8Array.bind,[4,crypto.subtle.digest("SHA-256",new Uint8Array(t))];case 1:return[2,s._.apply(void 0,[new(e.apply(Uint8Array,[void 0,n.sent()]))])]}})}),function(t){return u.apply(this,arguments)})))];case 1:return e=new Uint8Array(o.sent().flat()),a=Uint8Array.bind,[4,crypto.subtle.digest("SHA-256",e)];case 2:return n=new(a.apply(Uint8Array,[void 0,o.sent()])),[2,(0,s._)(n).map(function(t){return t.toString(16).padStart(2,"0")}).join("")]}})})).apply(this,arguments)}var O=[],X=function(t,e){var n,u,R,x,C=d.A.getState(),F=C.setSyncBusy,H=C.setSyncSelect,k=g.A.getState(),I=k.setProgressLog,Y=k.resetProgressLog,U=h.A.getState(),D=U.dismissDialog,B=U.setDialog,X=new(c())(1,1/0),M=function(t){return function(e,n,a,o){return X.add((0,r._)(function(){return(0,i.YH)(this,function(r){switch(r.label){case 0:return[4,(0,v.c)(n)];case 1:return r.sent(),o||I("dropbox",{timestamp:new Date().getTime()/1e3,message:"".concat(t," runs ").concat(e)}),[2,a()]}})}))}},j=new P(b.A.getState().dropboxStorage,M("Dropbox")),Q=(n=(0,r._)(function(t){return(0,i.YH)(this,function(e){switch(e.label){case 0:return[4,j.setRootPath(t.path||"/")];case 1:return e.sent(),[2]}})}),function(t){return n.apply(this,arguments)}),K=(u=(0,r._)(function(t){var n,a,o,s,u,c,h,f,d,p,g,v;return(0,i.YH)(this,function(w){switch(w.label){case 0:return F(!0),H(!1),n=m.A.getState().preferredLocale,a=b.A.getState().syncLastUpdate,[4,j.getRemoteContents(t)];case 1:switch(o=w.sent(),t){case"diff":return[3,2];case"up":return[3,3];case"down":return[3,6]}return[3,8];case 2:if((null==o||null==(u=o.settings)||null==(s=u.state)?void 0:s.lastUpdateUTC)===null)return[3,9];return h=(null==(c=o.settings.state)?void 0:c.lastUpdateUTC)===void 0?Date.now()/1e3:o.settings.state.lastUpdateUTC,b.A.getState().setSyncLastUpdate("dropbox",h),h>(null==a?void 0:a.local)&&B({message:"There is newer content in your dropbox!",questions:function(){return["Your dropbox contains changes from ".concat(new Date(1e3*h).toLocaleString(n)),"Your last local update was ".concat((null==a?void 0:a.local)?new Date(1e3*a.local).toLocaleString(n):"never","."),"Do you want to load the changes?"].map(function(t,e){return{label:t,key:"info".concat(e),type:l.V.INFO}})},confirm:(0,r._)(function(){return(0,i.YH)(this,function(t){return D(0),K("down"),[2]})}),deny:(0,r._)(function(){return(0,i.YH)(this,function(t){return[2,D(0)]})})}),[3,9];case 3:return f=(null==a?void 0:a.local)||Math.floor(new Date().getTime()/1e3),[4,(0,T.A)(o,f,M("GBPrinter"))];case 4:return d=w.sent(),[4,j.upload(d,"settings")];case 5:return w.sent(),b.A.getState().setSyncLastUpdate("dropbox",f),[3,9];case 6:return[4,(0,E.Ay)(o)];case 7:return e(w.sent()),(v=(null==(g=o.settings)||null==(p=g.state)?void 0:p.lastUpdateUTC)||0)&&b.A.getState().setSyncLastUpdate("dropbox",v),[3,9];case 8:throw Error("dropbox sync: wrong sync case");case 9:return"diff"!==t?I("dropbox",{timestamp:new Date().getTime()/1e3,message:"."}):Y(),F(!1),[2]}})}),function(t){return u.apply(this,arguments)}),G=(R=(0,r._)(function(){var t,e,n,u,c,l,h,d,g,b,v,T,A,E,R,x,C;return(0,i.YH)(this,function(k){var Y,U;switch(k.label){case 0:return F(!0),H(!1),e=(t=p.h.getState()).frames,n=t.palettes,u=t.images,l=(c=m.A.getState()).exportScaleFactors,h=c.exportFileTypes,d=c.handleExportFrame,g=c.fileNameStyle,b=f.A.getState(),v=(0,_.S)(u,b),T=(0,w.j)(l,h,d,n,g),A=(0,y.T)(u,e),[4,Promise.all(v.map((Y=(0,r._)(function(t,n){return(0,i.YH)(this,function(a){return[2,M("Generate images and hashes")("".concat(n+1,"/").concat(v.length),10,(0,r._)(function(){var n,a,o,s,u;return(0,i.YH)(this,function(c){switch(c.label){case 0:return[4,A(t.hash)];case 1:if(n=c.sent(),!(a=e.find(function(e){return e.id===t.frame})))return[3,3];return[4,(0,L.mZ)(null==a?void 0:a.hash)];case 2:return s=c.sent(),[3,4];case 3:s=null,c.label=4;case 4:if(u=(o=s)?o.upper.length/20:2,!n)throw Error("tiles missing");return[4,T(t)(n,u)];case 5:var l;return[4,Promise.all(c.sent().map((l=(0,r._)(function(t){var e;return(0,i.YH)(this,function(n){switch(n.label){case 0:return e={filename:t.filename},[4,t.blob.arrayBuffer()];case 1:return[2,(e.arrayBuffer=n.sent(),e)]}})}),function(t){return l.apply(this,arguments)})))];case 6:return[2,c.sent()]}})}))]})}),function(t,e){return Y.apply(this,arguments)})))];case 1:return E=k.sent().flat(),[4,Promise.all((0,S.A)(E).map((U=(0,r._)(function(t){var e,n;return(0,i.YH)(this,function(r){switch(r.label){case 0:return e=[(0,a._)({},t)],n={},[4,function(t){return N.apply(this,arguments)}(t.arrayBuffer)];case 1:return[2,o._.apply(void 0,e.concat([(n.dropboxContentHash=r.sent(),n)]))]}})}),function(t){return U.apply(this,arguments)})))];case 2:return R=k.sent(),[4,j.getImageContents()];case 3:return x=k.sent(),C=R.reduce(function(t,e){var n=e.arrayBuffer,r=e.dropboxContentHash,a=e.filename;return -1===x.findIndex(function(t){var e=t.content_hash,n=t.name;return e===r&&n===a})?(0,s._)(t).concat([{blob:new Blob([n]),destination:a}]):t},[]),[4,j.upload({upload:C,del:[]},"images")];case 4:return k.sent(),I("dropbox",{timestamp:new Date().getTime()/1e3,message:"."}),F(!1),[2]}})}),function(){return R.apply(this,arguments)}),V=(x=(0,r._)(function(e){var n,r;return(0,i.YH)(this,function(a){switch(a.label){case 0:if(n=t.updateImages,O.includes(e))return[3,3];return O.push(e),[4,j.getFileContent("images/".concat(e,".txt"),0,1,!0)];case 1:return r=a.sent(),[4,(0,E._K)(r)];case 2:a.sent(),n([]),a.label=3;case 3:return[2]}})}),function(t){return x.apply(this,arguments)}),q=function(){K("diff")};b.A.getState().dropboxStorage.autoDropboxSync&&(q(),j.on("settingsChanged",function(){q()})),j.on("loginDataUpdate",function(t){(0,b.A.getState().setDropboxStorage)(t)});var Z=A().dropboxCode;return Z&&j.codeAuth(Z),b.A.subscribe(function(t){return t.dropboxStorage},Q),{updateSettings:Q,startSyncData:K,startSyncImages:G,startAuth:function(){return j.startAuth()},recoverImageData:V}}}}]);