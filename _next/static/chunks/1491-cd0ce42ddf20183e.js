"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1491],{7451:(e,t,n)=>{n.d(t,{c:()=>u});var r=n(61975),s=n(71450),u=function(e){return(0,r._)(function(){return(0,s.YH)(this,function(t){return[2,new Promise(function(t){self.setTimeout(t,e)})]})})()}},20251:(e,t,n)=>{n.d(t,{GISProvider:()=>f,A:()=>h});var r=n(61975),s=n(71450),u=n(95155),a=n(12115),o=n(22043),c=n(10022),i="289013882485-8d2g0gpko2a13ns4kqdrig3mg99v0osj.apps.googleusercontent.com",l="https://www.googleapis.com/auth/spreadsheets",p=function(){var e={loadScript:(0,a.useCallback)(function(e){return new Promise(function(t,n){var r=document.createElement("script");r.src=e,r.async=!0,r.defer=!0,r.onload=function(){t()},r.onerror=n,document.head.appendChild(r)})},[])}.loadScript,t=(0,c.N$)(),n=t.setGapiSettings,u=t.gapiStorage,p=(0,o._)((0,a.useState)(null),2),d=p[0],f=p[1],h=(0,a.useMemo)(function(){return!!u.token},[u.token]),m=(0,a.useMemo)(function(){return!!d},[d]),g=(0,a.useCallback)(function(){i&&l&&f(function(e){return e||google.accounts.oauth2.initTokenClient({client_id:i,scope:l,callback:function(e){if(console.log("\uD83E\uDD16 callback"),e.error)throw Error(e.error_description);n({token:e.access_token,tokenExpiry:Date.now()+1e3*parseInt(e.expires_in||"0",10)})}})})},[n]);return(0,a.useEffect)(function(){var e=u.use,t=u.tokenExpiry,n=u.token;if(i&&e&&n){var r=(t||0)-Date.now()-6e4,s=window.setTimeout(function(){d&&d.requestAccessToken({prompt:""})},r);return function(){return window.clearTimeout(s)}}},[u,n,d]),(0,a.useEffect)(function(){if(i&&u.use){var t=setTimeout(function(){return(0,r._)(function(){return(0,s.YH)(this,function(t){switch(t.label){case 0:return[4,e("https://accounts.google.com/gsi/client")];case 1:return t.sent(),[4,e("https://apis.google.com/js/api.js")];case 2:return t.sent(),[4,g()];case 3:return t.sent(),[2]}})})()},1);return function(){return clearTimeout(t)}}},[u.use,g,e]),{handleSignIn:(0,a.useCallback)(function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){return d?d.requestAccessToken({prompt:""}):console.log("no tokenClient"),[2]})})()},[d]),handleSignOut:(0,a.useCallback)(function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){return u.token&&google.accounts.oauth2.revoke(null==u?void 0:u.token,function(){n({token:"",tokenExpiry:0})}),[2]})})()},[u.token,n]),isSignedIn:h,isReady:m}},d=(0,a.createContext)({isReady:!1,isSignedIn:!1,handleSignIn:function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){return[2]})})()},handleSignOut:function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){return[2]})})()}});function f(e){var t=e.children,n=p();return(0,u.jsx)(d.Provider,{value:n,children:t})}let h=function(){return(0,a.useContext)(d)}},48335:(e,t,n)=>{n.d(t,{K:()=>s});var r=n(65486),s=function(e){return e.reduce(function(e,t){if(t.metadataKey!==r._C)return e;var n=Number(t.metadataValue);return n>e?n:e},0)}},60300:(e,t,n)=>{n.d(t,{A:()=>E});var r=n(61975),s=n(82732),u=n(22043),a=n(45377),o=n(71450),c=n(20097),i=n(18955),l=n(12115),p=n(72879),d=n(10022),f=n(7451),h=n(94468),m=n(75036),g=function(e,t){return!!t.find(function(t){var n=t.hashes;return!!n&&Object.values(n).includes(e)})},v=function(e,t){return!!t.find(function(t){return t.hash===e})},S=function(e){var t=e.images,n=e.frames;return(0,r._)(function(){return(0,o.YH)(this,function(e){switch(e.label){case 0:return[4,(0,h.ZU)()];case 1:return e.sent(),[4,h.mU.keys()];case 2:return e.sent().forEach(function(e){g(e,t)||v(e,t)||(0,m.yH)(e)}),[4,h.Uv.keys()];case 3:return e.sent().forEach(function(e){n.find(function(t){return t.hash===e})||(0,m.t9)(e)}),[2]}})})()},w=function(e){return(0,r._)(function(){var t,n,r,s,u;return(0,o.YH)(this,function(a){switch(a.label){case 0:return[4,(0,h.ZU)()];case 1:return a.sent(),[4,h.mU.keys()];case 2:t=a.sent(),n=function(t){return!g(t,e)&&!v(t,e)},r=[],s=0,a.label=3;case 3:if(!(s<t.length))return[3,6];if(!(u=t[s]).startsWith("dummy")&&n(u)&&r.push(u),s%20!=0)return[3,5];return[4,(0,f.c)(0)];case 4:a.sent(),a.label=5;case 5:return s++,[3,3];case 6:return[2,r]}})})()},I=function(e){return(0,r._)(function(){var t,n,r,s,u;return(0,o.YH)(this,function(a){switch(a.label){case 0:return[4,(0,h.ZU)()];case 1:return a.sent(),[4,h.Uv.keys()];case 2:t=a.sent(),n=function(t){return!e.find(function(e){return e.hash===t})},r=[],s=0,a.label=3;case 3:if(!(s<t.length))return[3,6];if(!(u=t[s]).startsWith("dummy")&&n(u)&&r.push(u),s%20!=0)return[3,5];return[4,(0,f.c)(0)];case 4:a.sent(),a.label=5;case 5:return s++,[3,3];case 6:return[2,r]}})})()},y=n(17403),_=n(98050),N=n(81200),b=n(71667),P=function(e,t){return(0,r._)(function(){return(0,o.YH)(this,function(n){switch(n.label){case 0:return[4,(0,h.ZU)()];case 1:return n.sent(),[4,Promise.all(e.map(function(e){return(0,r._)(function(){var n;return(0,o.YH)(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,t.getItem(e)];case 1:if(!(n=r.sent()))return[2,null];return[4,(0,_.U)(n)];case 2:return[2,{hash:e,lines:r.sent().split("\n"),binary:n}];case 3:return r.sent(),[2,null];case 4:return[2]}})})()}))];case 2:return[2,n.sent().reduce(N.N,[])]}})})()};let E=function(){var e=(0,d.I0)(),t=e.trashCount,n=e.showTrashCount,f=(0,d.Vs)(),m=f.frames,g=f.images,v=(0,d.I0)(),_=v.updateTrashCount,E=v.setTrashBusy,T=(0,i.c)("useTrashbin"),R=(0,l.useCallback)(function(){return(0,r._)(function(){var e,t,n;return(0,o.YH)(this,function(r){switch(r.label){case 0:return[4,w(g)];case 1:return[4,P(r.sent(),h.mU)];case 2:return e=r.sent(),t={},n={state:{images:e.map(function(e){try{return t[e.hash]=e.binary,{hash:e.hash,created:(0,b.J)(),title:T("backupExportImage",{hash:e.hash}),lines:e.lines.length,tags:["backup"],palette:"bw",framePalette:"bw",invertPalette:!1,invertFramePalette:!1,frame:""}}catch(e){return null}}).reduce(y.iy,[]),lastUpdateUTC:Math.floor(new Date().getTime()/1e3),version:p.A}},(0,c.saveAs)(new Blob((0,a._)(JSON.stringify((0,s._)({},n,t),null,2))),"backup_images.json"),[2]}})})()},[g,T]),G=(0,l.useCallback)(function(){return(0,r._)(function(){var e,t,n;return(0,o.YH)(this,function(r){switch(r.label){case 0:return[4,I(m)];case 1:return[4,P(r.sent(),h.Uv)];case 2:return e=r.sent(),t={},n={state:{frames:e.map(function(e,n){try{t["frame-".concat(e.hash)]=e.binary;var r=JSON.parse(e.lines[0]),s=r.upper.length+20*r.left.length+r.lower.length;return{hash:e.hash,lines:s,name:T("backupExportFrame",{hash:e.hash}),id:"bak".concat(n.toString(10).padStart(2,"0"))}}catch(e){return null}}).reduce(N.N,[]),frameGroups:[{id:"bak",name:T("reImportedTrashFrames")}],lastUpdateUTC:Math.floor(new Date().getTime()/1e3),version:p.A}},(0,c.saveAs)(new Blob((0,a._)(JSON.stringify((0,s._)({},n,t),null,2))),"backup_frames.json"),[2]}})})()},[T,m]),U=(0,l.useCallback)(function(){return(0,r._)(function(){var e,t,n;return(0,o.YH)(this,function(r){switch(r.label){case 0:return E(!0),[4,Promise.all([I(m),w(g)])];case 1:return t=(e=u._.apply(void 0,[r.sent(),2]))[0],n=e[1],_(t.length,n.length),E(!1),[2]}})})()},[m,g,E,_]),C=(0,l.useCallback)(function(){return(0,r._)(function(){return(0,o.YH)(this,function(e){switch(e.label){case 0:return[4,S({images:g,frames:m})];case 1:return e.sent(),n(!1),window.requestAnimationFrame(function(){U()}),[2]}})})()},[U,m,g,n]);return{showTrashCount:n,purgeTrash:C,downloadImages:R,downloadFrames:G,checkUpdateTrashCount:U,trashCount:t}}},61491:(e,t,n)=>{n.d(t,{GapiSyncProvider:()=>z,A:()=>W});var r=n(61975),s=n(71450),u=n(95155),a=n(12115),o=n(82732),c=n(45849),i=n(45377),l=n(73533),p=n(65486),d=n(48335),f=function(e){return e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.JSON="json",e}({}),h=[{prop:"hash",column:"Hash",type:f.STRING},{prop:"created",column:"Created",type:f.STRING},{prop:"title",column:"Title",type:f.STRING},{prop:"frame",column:"Frame",type:f.STRING},{prop:"tags",column:"Tags",type:f.JSON},{prop:"lockFrame",column:"Lock Frame",type:f.BOOLEAN},{prop:"rotation",column:"Rotation",type:f.NUMBER},{prop:"meta",column:"Meta",type:f.JSON}],m=function(e,t){return{sheetsClient:e,sheetId:t,columns:(0,i._)(h).concat([{prop:"palette",column:"Palette",type:f.STRING},{prop:"lines",column:"Lines",type:f.NUMBER},{prop:"invertPalette",column:"Invert Palette",type:f.BOOLEAN},{prop:"framePalette",column:"Frame Palette",type:f.STRING},{prop:"invertFramePalette",column:"Invert Frame Palette",type:f.BOOLEAN}]),sheetName:p.Pu.IMAGES}},g=function(e,t){return{sheetsClient:e,sheetId:t,columns:(0,i._)(h).concat([{prop:"palette",column:"Palette",type:f.JSON},{prop:"hashes",column:"Hashes",type:f.JSON}]),sheetName:p.Pu.RGBN_IMAGES}},v=function(e,t){return{sheetsClient:e,sheetId:t,columns:[{prop:"id",column:"ID",type:f.STRING},{prop:"title",column:"Title",type:f.STRING},{prop:"slug",column:"Slug",type:f.STRING},{prop:"created",column:"Created",type:f.STRING},{prop:"coverImage",column:"Cover Image Hash",type:f.STRING},{prop:"images",column:"Images",type:f.JSON},{prop:"groups",column:"Sub-Groups",type:f.JSON}],sheetName:p.Pu.IMAGE_GROUPS}},S=function(e,t){return{sheetsClient:e,sheetId:t,columns:[{prop:"shortName",column:"ShortName",type:f.STRING},{prop:"name",column:"Name",type:f.STRING},{prop:"palette",column:"Palette",type:f.JSON},{prop:"origin",column:"Origin",type:f.STRING}],sheetName:p.Pu.PALETTES}},w=function(e,t){return{sheetsClient:e,sheetId:t,columns:[{prop:"id",column:"ID",type:f.STRING},{prop:"hash",column:"Hash",type:f.STRING},{prop:"name",column:"Name",type:f.STRING},{prop:"lines",column:"Lines",type:f.NUMBER}],sheetName:p.Pu.FRAMES}},I=function(e,t){return{sheetsClient:e,sheetId:t,columns:[{prop:"id",column:"ID",type:f.STRING},{prop:"name",column:"Name",type:f.STRING}],sheetName:p.Pu.FRAME_GROUPS}},y=function(e,t){return{sheetsClient:e,sheetId:t,columns:[{prop:"url",column:"URL",type:f.STRING},{prop:"name",column:"Name",type:f.STRING},{prop:"description",column:"Description",type:f.STRING},{prop:"config",column:"Config",type:f.JSON},{prop:"configParams",column:"Config Params",type:f.JSON}],sheetName:p.Pu.PLUGINS}},_=function(e,t){return{sheetsClient:e,sheetId:t,columns:[{prop:"hash",column:"hash",type:f.STRING},{prop:"data",column:"Data",type:f.STRING}],sheetName:p.Pu.BIN_FRAMES}},N=function(e,t){return{sheetsClient:e,sheetId:t,columns:[{prop:"hash",column:"hash",type:f.STRING},{prop:"data",column:"Data",type:f.STRING}],sheetName:p.Pu.BIN_IMAGES}},b=function(e){if(e<0)return"A:A";var t="";for(e+=1;e>0;)t=String.fromCharCode(65+(e-1)%26)+t,e=Math.floor((e-1)/26);return"".concat(t,":").concat(t)},P=function(e){return e.ALL="all",e.HASHES="hashes",e}({}),E=function(e){var t=e.sheetsClient,n=e.spreadsheetId,u=e.sheetName,a=e.columnRange;return(0,r._)(function(){var e,r,o,c,i,l,d,f,h,m,g,v,S;return(0,s.YH)(this,function(s){switch(s.label){case 0:return[4,t.spreadsheets.get({spreadsheetId:n})];case 1:if(r=null==(e=(s.sent().result.sheets||[]).find(function(e){var t=e.properties;return(null==t?void 0:t.title)===u}))?void 0:e.properties)return[3,3];return[4,t.spreadsheets.batchUpdate({spreadsheetId:n,resource:{requests:[{addSheet:{properties:{title:u}}}]}})];case 2:if(!(null==(i=(d=s.sent().result).replies)||null==(c=i[0])||null==(o=c.addSheet)?void 0:o.properties))throw Error("Could not create new sheet");r=null==(l=d.replies[0])?void 0:l.addSheet.properties,s.label=3;case 3:return[4,t.spreadsheets.developerMetadata.search({spreadsheetId:n,resource:{dataFilters:[{developerMetadataLookup:{locationType:"SHEET",metadataLocation:{sheetId:r.sheetId}}}]}})];case 4:if(f=s.sent().result.matchedDeveloperMetadata,!r)throw Error('remote sheet "'.concat(u,'" missing'));return[4,t.spreadsheets.values.get({spreadsheetId:n,range:"".concat(r.title,"!1:1")})];case 5:return g=(m=(h=s.sent().result.values)?h[0]:[]).indexOf(p.UU),v="all"===a?"A:Z":b(g),[4,t.spreadsheets.values.get({spreadsheetId:n,range:"".concat(r.title,"!").concat(v)})];case 6:return S=s.sent().result.values,[2,{sheetProperties:r,developerMetadata:(f||[]).map(function(e){return e.developerMetadata}).filter(Boolean),values:S||[[]],headers:m}]}})})()},T=n(15098),R=n(80971),G="__UNDEFINED__",U="__NULL__",C="__TRUE__",k="__FALSE__",A=function(e,t){if(null==e)return!0;switch(t){case"string":return"string"==typeof e;case"number":return"number"==typeof e;case"boolean":return"boolean"==typeof e;case"json":return(void 0===e?"undefined":(0,R._)(e))==="object";default:return!1}},M=function(e,t){switch(t){case f.STRING:return e;case f.NUMBER:var n=Number(e);if(Number.isNaN(n))throw Error();return n;case f.BOOLEAN:if(e===C)return!0;if(e===k)return!1;throw Error();case f.JSON:return JSON.parse(e)}},H=function(e,t,n){if(void 0===e)return G;if(null===e)return U;switch(A(e,t)?t:null!=n?n:t){case f.STRING:case f.NUMBER:return String(e);case f.BOOLEAN:return e?C:k;case f.JSON:default:return JSON.stringify(e)}},L=function(e,t,n){if(e!==G){if(e===U)return null;try{return M(e,t)}catch(t){if(!n)throw Error('No fallbackType for value "'.concat(e,'"'));return M(e,n)}}},O=function(e){var t=e.sheetsClient,n=e.sheetId,u=e.sheetName,a=e.columns;return(0,r._)(function(){var e,r,o,c;return(0,s.YH)(this,function(s){switch(s.label){case 0:return e=Date.now(),console.log("\uD83D\uDCCA Pulling ".concat(u)),r={columns:a},[4,t.spreadsheets.values.get({spreadsheetId:n,range:"".concat(u,"!A:Z")})];case 1:return o=s.sent().result.values,[4,E({sheetsClient:t,spreadsheetId:n,sheetName:u,columnRange:P.ALL})];case 2:var i,l,p,d,f,h;return c=s.sent(),console.log("\uD83D\uDCCA Pulled ".concat(u," in ").concat(Date.now()-e,"ms")),i=o,l=r,d=(p=(0,T._)(i))[0],f=p.slice(1),h=l.columns,[2,{items:f.map(function(e){var t={};return h.forEach(function(n){var r=d.indexOf(n.column);if(-1===r)throw Error("cannot find column ".concat(n.column," in sheet"));var s=L(e[r],n.type,n.fallbackType);void 0!==s&&(t[n.prop]=s)}),t}),sheetProperties:c}]}})})()},D=n(22043),V=function(e,t){var n=new Set;return e.filter(function(e){var r=e[t];return!n.has(r)&&(n.add(r),!0)})},Y=function(e,t){var n=e.sheetsClient,u=e.sheetId,a=e.sheetName,o=e.columns,c=e.newLastUpdateValue,l=e.sort,d=e.chunkSize;return(0,r._)(function(){var e,f,h,m,g,v,S,w,I,y,_,N,b,R,U,C,k,A,M,L;return(0,s.YH)(this,function(O){switch(O.label){case 0:return e=Date.now(),console.log("\uD83D\uDCCA Pushing ".concat(a)),[4,E({sheetsClient:n,spreadsheetId:u,sheetName:a,columnRange:P.HASHES})];case 1:var Y;return h=(f=O.sent()).sheetProperties,m=f.developerMetadata,g=f.values,v=f.headers,S=null==m?void 0:m.find(function(e){return e.metadataKey===p._C}),w=h.sheetId,I=S?{updateDeveloperMetadata:{dataFilters:[{developerMetadataLookup:{metadataId:S.metadataId}}],developerMetadata:{metadataValue:c.toString(10)},fields:"metadataValue"}}:{createDeveloperMetadata:{developerMetadata:{metadataKey:p._C,metadataValue:c.toString(10),visibility:"DOCUMENT",location:{sheetId:w}}}},[4,(Y={columns:o,remoteHashes:(0,T._)(g).slice(1).map(function(e){return(0,D._)(e,1)[0]}),remoteHeaders:v},(0,r._)(function(){var e,n,u,a,o,c,l,d,f,h,m,g,v,S,w,I,y,_,N,b,P,E,T,R,U,C,k,A,M,L,O;return(0,s.YH)(this,function(D){switch(D.label){case 0:if(e=Y.columns,u=void 0===(n=Y.remoteHashes)?[]:n,o=void 0===(a=Y.remoteHeaders)?[]:a,c=(0,i._)(o),e.forEach(function(e){var t=e.column;if(t===p.UU)throw Error("Column headers contain illegal name (".concat(p.UU,")"));c.includes(t)||c.push(t)}),c.includes(p.UU)||c.unshift(p.UU),l=new Map(c.map(function(e,t){return[e,t]})),d=new Map(e.map(function(e,t){return[e.column,t]})),f=[],h=new Set(u),m=e[0],g=l.get(m.column),!m||void 0===g)throw Error("No columns");v=!0,S=!1,w=void 0,D.label=1;case 1:D.trys.push([1,6,7,8]),I=t[Symbol.iterator](),D.label=2;case 2:if(v=(y=I.next()).done)return[3,5];if("string"!=typeof(_=y.value)[m.prop])throw Error("Key must be a string");N=Array(c.length).fill(G),b=Array(c.length).fill(G),P=!0,E=!1,T=void 0;try{for(R=e[Symbol.iterator]();!(P=(U=R.next()).done);P=!0){if(k=(C=U.value).prop in _?_[C.prop]:void 0,(A=H(k,C.type,C.fallbackType)).length>=5e4)throw Error("Cell content is too big");N[l.get(C.column)]=A,b[d.get(C.column)]=A}}catch(e){E=!0,T=e}finally{try{P||null==R.return||R.return()}finally{if(E)throw T}}return[4,(0,r._)(function(){var e,t,n,r,u;return(0,s.YH)(this,function(s){switch(s.label){case 0:return e=JSON.stringify(b),t=new TextEncoder().encode(e),[4,crypto.subtle.digest("SHA-256",t)];case 1:for(u=0,n=new Uint8Array(s.sent()),r="";u<10;u++)r+=n[u].toString(16).padStart(2,"0");return[2,r]}})})()];case 3:M=D.sent(),N[l.get(p.UU)]=M,h.has(M)||f.push(N),h.delete(M),D.label=4;case 4:return v=!0,[3,2];case 5:return[3,8];case 6:return L=D.sent(),S=!0,w=L,[3,8];case 7:try{v||null==I.return||I.return()}finally{if(S)throw w}return[7];case 8:return O=[],u.forEach(function(e,t){h.has(e)&&O.push(t)}),[2,{sheetHeaders:c,newSheetItems:V(f,g),deleteIndices:(0,i._)(new Set(O)).sort(function(e,t){return t-e}),keyIndex:g}]}})})())];case 2:if(_=(y=O.sent()).sheetHeaders,N=y.deleteIndices,b=y.newSheetItems,R=y.keyIndex,U=N.map(function(e){return{deleteDimension:{range:{sheetId:w,dimension:"ROWS",startIndex:e+1,endIndex:e+2}}}}),b.length&&U.push({insertDimension:{range:{sheetId:w,dimension:"ROWS",startIndex:1,endIndex:b.length+1},inheritFromBefore:!0}}),!N.includes(0))return[3,4];return[4,n.spreadsheets.batchUpdate({spreadsheetId:u,resource:{requests:[{updateSheetProperties:{properties:{sheetId:w,gridProperties:{frozenRowCount:0}},fields:"gridProperties.frozenRowCount"}}]}})];case 3:O.sent(),O.label=4;case 4:if(!U.length)return[3,6];return[4,n.spreadsheets.batchUpdate({spreadsheetId:u,resource:{requests:U}})];case 5:O.sent(),O.label=6;case 6:C=[_].concat((0,i._)(b)),k=0,O.label=7;case 7:if(!(k<C.length))return[3,11];return[4,n.spreadsheets.values.update({spreadsheetId:u,range:"".concat(a,"!A").concat(k+1),valueInputOption:"USER_ENTERED",resource:{values:C.slice(k,k+d)}})];case 8:return O.sent(),[4,new Promise(function(e){return window.setTimeout(e,1e3)})];case 9:O.sent(),O.label=10;case 10:return k+=d,[3,7];case 11:return A=0===t.length,M=[{updateSheetProperties:{properties:{sheetId:w,gridProperties:{frozenRowCount:+!A}},fields:"gridProperties.frozenRowCount"}},{updateSheetProperties:{properties:{sheetId:w,gridProperties:{rowCount:t.length+1}},fields:"gridProperties.rowCount"}}],L=l&&!A?[{sortRange:{range:{sheetId:w,startRowIndex:1,startColumnIndex:0},sortSpecs:[{dimensionIndex:R,sortOrder:"ASCENDING"}]}}]:[],[4,n.spreadsheets.batchUpdate({spreadsheetId:u,resource:{requests:(0,i._)(M).concat((0,i._)(L),[I])}})];case 12:return O.sent(),console.log("\uD83D\uDCCA Pushed ".concat(a,":\n    deleted: ").concat(N.length," created: ").concat(b.length,"\n    in ").concat(Date.now()-e,"ms")),[2]}})})()},F=n(60300),x=n(10022),B=n(17403),J=n(94468),q=n(37145),K=function(){var e=(0,l.A)(),t=e.gapiLastRemoteUpdates,n=e.updateSheets,u=e.enqueueSheetsClientRequest,f=e.isReady,h=e.busy,b=(0,x.Vs)().gapiLastLocalUpdates,P=(0,x.N$)(),E=P.gapiStorage,T=P.setGapiSettings,R=(0,F.A)().checkUpdateTrashCount,G=(0,a.useCallback)(function(e){var t=e.sheetName,a=e.newLastUpdateValue,i=e.sort;return(0,r._)(function(){var e;return(0,s.YH)(this,function(l){switch(l.label){case 0:if(!(e=E.sheetId))return[2];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,u(function(n){return(0,r._)(function(){var r,u,l;return(0,s.YH)(this,function(s){switch(s.label){case 0:switch(r={newLastUpdateValue:a,sort:i,chunkSize:512},t){case p.Pu.PALETTES:return[3,1];case p.Pu.IMAGES:return[3,3];case p.Pu.RGBN_IMAGES:return[3,5];case p.Pu.FRAME_GROUPS:return[3,7];case p.Pu.FRAMES:return[3,9];case p.Pu.IMAGE_GROUPS:return[3,11];case p.Pu.PLUGINS:return[3,13];case p.Pu.BIN_FRAMES:return[3,15];case p.Pu.BIN_IMAGES:return[3,18]}return[3,21];case 1:return[4,Y((0,o._)({},r,S(n,e)),x.Vs.getState().palettes.filter(function(e){return!e.isPredefined}))];case 2:case 4:case 6:case 8:case 10:case 12:case 14:case 17:case 20:return s.sent(),[3,21];case 3:return[4,Y((0,o._)({},r,m(n,e)),x.Vs.getState().images.reduce(B.iy,[]))];case 5:return[4,Y((0,o._)({},r,g(n,e)),x.Vs.getState().images.reduce(B.Mg,[]))];case 7:return[4,Y((0,o._)({},r,I(n,e)),x.Vs.getState().frameGroups)];case 9:return[4,Y((0,o._)({},r,w(n,e)),x.Vs.getState().frames)];case 11:return[4,Y((0,o._)({},r,v(n,e)),x.Vs.getState().imageGroups)];case 13:return[4,Y((0,o._)({},r,y(n,e)),x.Vs.getState().plugins)];case 15:return[4,J.Uv.getSyncItems()];case 16:return u=s.sent(),[4,Y((0,o._)((0,c._)((0,o._)({},r),{chunkSize:256}),_(n,e)),u)];case 18:return[4,J.mU.getSyncItems()];case 19:return l=s.sent(),[4,Y((0,o._)((0,c._)((0,o._)({},r),{chunkSize:256}),N(n,e)),l)];case 21:return[2]}})})()})];case 2:return l.sent(),[3,4];case 3:return l.sent(),T({autoSync:!1}),[3,4];case 4:return[4,n()];case 5:return l.sent(),[2]}})})()},[u,E.sheetId,T,n]),U=(0,a.useCallback)(function(e){var t=e.sheetName,a=e.lastRemoteUpdate,o=e.merge;return(0,r._)(function(){var e;return(0,s.YH)(this,function(c){switch(c.label){case 0:if(!(e=E.sheetId))return[2];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,u(function(n){return(0,r._)(function(){var r,u,c,l,f,h,b,P,E,T,G,U,C,k,A,M,H,L,D,V,Y,F,B,K,j,z,W,Z,$,Q,X,ee,et;return(0,s.YH)(this,function(s){switch(s.label){case 0:switch(t){case p.Pu.PALETTES:return[3,1];case p.Pu.IMAGES:case p.Pu.RGBN_IMAGES:return[3,3];case p.Pu.FRAME_GROUPS:return[3,6];case p.Pu.FRAMES:return[3,8];case p.Pu.IMAGE_GROUPS:return[3,10];case p.Pu.PLUGINS:return[3,12];case p.Pu.BIN_IMAGES:return[3,14];case p.Pu.BIN_FRAMES:return[3,18]}return[3,22];case 1:return[4,O(S(n,e))];case 2:return r=s.sent(),o?x.Vs.getState().addPalettes(r.items):(c=(u=r.sheetProperties.developerMetadata)?(0,d.K)(u):a,x.Vs.getState().setPalettes(r.items,c)),[3,22];case 3:return[4,O(m(n,e))];case 4:return l=s.sent(),[4,O(g(n,e))];case 5:return f=s.sent(),h=(0,i._)(l.items).concat((0,i._)(f.items)),o?x.Vs.getState().addImages(h):(G=(T=[(P=l.sheetProperties.developerMetadata)?(0,d.K)(P):a,(E=f.sheetProperties.developerMetadata)?(0,d.K)(E):a].filter(function(e){return void 0!==e})).length>0?(b=Math).max.apply(b,(0,i._)(T)):void 0,x.Vs.getState().setImages(h,G)),[3,22];case 6:return[4,O(I(n,e))];case 7:return U=s.sent(),o?x.Vs.getState().updateFrameGroups(U.items):(k=(C=U.sheetProperties.developerMetadata)?(0,d.K)(C):a,x.Vs.getState().setFrameGroups(U.items,k)),[3,22];case 8:return[4,O(w(n,e))];case 9:return A=s.sent(),o?x.Vs.getState().addFrames(A.items):(H=(M=A.sheetProperties.developerMetadata)?(0,d.K)(M):a,x.Vs.getState().setFrames(A.items,H)),[3,22];case 10:return[4,O(v(n,e))];case 11:return L=s.sent(),o?(D=(0,q.A)("id"),V=(0,i._)(x.Vs.getState().imageGroups).concat((0,i._)(L.items)),x.Vs.getState().setImageGroups(D(V))):(F=(Y=L.sheetProperties.developerMetadata)?(0,d.K)(Y):a,x.Vs.getState().setImageGroups(L.items,F)),[3,22];case 12:return[4,O(y(n,e))];case 13:return B=s.sent(),o?(K=(0,q.A)("url"),j=(0,i._)(x.Vs.getState().plugins).concat((0,i._)(B.items)),x.Vs.getState().setPlugins(K(j))):(W=(z=B.sheetProperties.developerMetadata)?(0,d.K)(z):a,x.Vs.getState().setPlugins(B.items,W)),[3,22];case 14:return[4,O(N(n,e))];case 15:return Q=($=(Z=s.sent()).sheetProperties.developerMetadata)?(0,d.K)($):a,[4,J.mU.setSyncItems(Z.items,o)];case 16:case 20:return s.sent(),[4,R()];case 17:return s.sent(),x.Vs.getState().setLastUpdate(t,Q),[3,22];case 18:return[4,O(_(n,e))];case 19:return et=(ee=(X=s.sent()).sheetProperties.developerMetadata)?(0,d.K)(ee):a,[4,J.Uv.setSyncItems(X.items,o)];case 21:return s.sent(),x.Vs.getState().setLastUpdate(t,et),[3,22];case 22:return[2]}})})()})];case 2:return c.sent(),[3,4];case 3:return c.sent(),T({autoSync:!1}),[3,4];case 4:if(o)return[3,6];return[4,n()];case 5:c.sent(),c.label=6;case 6:return[2]}})})()},[R,u,E.sheetId,T,n]),C=(0,a.useCallback)(function(e){var t=e.sheetName,n=e.lastRemoteUpdate,u=e.lastLocalUpdate,a=e.sort;return(0,r._)(function(){var e;return(0,s.YH)(this,function(r){switch(r.label){case 0:return[4,U({sheetName:t,lastRemoteUpdate:Math.max(n,u||0),merge:!0})];case 1:if(r.sent(),E.autoSync)return[3,6];if(e=x.Vs.getState().gapiLastLocalUpdates[t],t!==p.Pu.IMAGES&&t!==p.Pu.RGBN_IMAGES)return[3,4];return[4,G({sheetName:p.Pu.IMAGES,newLastUpdateValue:e,sort:a})];case 2:return r.sent(),[4,G({sheetName:p.Pu.RGBN_IMAGES,newLastUpdateValue:e,sort:a})];case 3:return r.sent(),[3,6];case 4:return[4,G({sheetName:t,newLastUpdateValue:e,sort:a})];case 5:r.sent(),r.label=6;case 6:return[2]}})})()},[E.autoSync,U,G]),k=(0,a.useCallback)(function(e,t,n){return(0,r._)(function(){var r,u,a,o;return(0,s.YH)(this,function(s){switch(s.label){case 0:if(r=E.use,u=E.sheetId,a=E.token,o=E.autoSync,void 0===n||!o||!f||!r||!u||!a||t===n)return[2];if(!(t>n))return[3,2];return[4,G({sheetName:e,newLastUpdateValue:t,sort:!0})];case 1:return s.sent(),[3,4];case 2:return[4,U({sheetName:e,lastRemoteUpdate:n,merge:!1})];case 3:s.sent(),s.label=4;case 4:return[2]}})})()},[E,f,U,G]);return(0,a.useEffect)(function(){var e=window.setTimeout(function(){k(p.Pu.PALETTES,b.palettes,null==t?void 0:t.palettes)},5e3);return function(){return window.clearTimeout(e)}},[b.palettes,null==t?void 0:t.palettes,k]),(0,a.useEffect)(function(){var e=window.setTimeout(function(){k(p.Pu.IMAGES,b.images,null==t?void 0:t.images)},5e3);return function(){return window.clearTimeout(e)}},[b.images,null==t?void 0:t.images,k]),(0,a.useEffect)(function(){var e=window.setTimeout(function(){k(p.Pu.RGBN_IMAGES,b.rgbnImages,null==t?void 0:t.rgbnImages)},5e3);return function(){return window.clearTimeout(e)}},[b.rgbnImages,null==t?void 0:t.rgbnImages,k]),(0,a.useEffect)(function(){var e=window.setTimeout(function(){k(p.Pu.FRAME_GROUPS,b.frameGroups,null==t?void 0:t.frameGroups)},5e3);return function(){return window.clearTimeout(e)}},[b.frameGroups,null==t?void 0:t.frameGroups,k]),(0,a.useEffect)(function(){var e=window.setTimeout(function(){k(p.Pu.FRAMES,b.frames,null==t?void 0:t.frames)},5e3);return function(){return window.clearTimeout(e)}},[b.frames,null==t?void 0:t.frames,k]),(0,a.useEffect)(function(){var e=window.setTimeout(function(){k(p.Pu.IMAGE_GROUPS,b.imageGroups,null==t?void 0:t.imageGroups)},5e3);return function(){return window.clearTimeout(e)}},[b.imageGroups,null==t?void 0:t.imageGroups,k]),(0,a.useEffect)(function(){var e=window.setTimeout(function(){k(p.Pu.PLUGINS,b.plugins,null==t?void 0:t.plugins)},5e3);return function(){return window.clearTimeout(e)}},[b.plugins,null==t?void 0:t.plugins,k]),(0,a.useEffect)(function(){var e=window.setTimeout(function(){k(p.Pu.BIN_FRAMES,b.binFrames,null==t?void 0:t.binFrames)},5e3);return function(){return window.clearTimeout(e)}},[b.binFrames,null==t?void 0:t.binFrames,k]),(0,a.useEffect)(function(){var e=window.setTimeout(function(){k(p.Pu.BIN_IMAGES,b.binImages,null==t?void 0:t.binImages)},5e3);return function(){return window.clearTimeout(e)}},[b.binImages,null==t?void 0:t.binImages,k]),{busy:h,performPush:G,performPull:U,performMerge:C}},j=(0,a.createContext)({performMerge:function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){return[2]})})()},performPull:function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){return[2]})})()},performPush:function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){return[2]})})()},busy:!1});function z(e){var t=e.children,n=K();return(0,u.jsx)(j.Provider,{value:n,children:t})}let W=function(){return(0,a.useContext)(j)}},73533:(e,t,n)=>{n.d(t,{GapiSheetStateProvider:()=>b,A:()=>P});var r=n(61975),s=n(71450),u=n(95155),a=n(12115),o=n(22043),c=n(21739),i=n(21860),l=n.n(i),p=n(65486),d=n(48335),f=function(e){var t=function(t){return e.find(function(e){var n=e.properties;return(null==n?void 0:n.title)===t})||null},n={},r=!0,s=!1,u=void 0;try{for(var a,o=p.kD[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var c,i=a.value;n[i]=(0,d.K)((null==(c=t(i))?void 0:c.developerMetadata)||[])}}catch(e){s=!0,u=e}finally{try{r||null==o.return||o.return()}finally{if(s)throw u}}return n},h=n(80971),m=n(82732),g=n(45849),v=function(e,t,n){var u=function(e,u,a){return(0,r._)(function(){return(0,s.YH)(this,function(r){switch(r.label){case 0:switch(a){case"read":return[3,1];case"write":return[3,3]}return[3,5];case 1:return[4,t()];case 2:case 4:return r.sent(),[3,6];case 3:return[4,n()];case 5:return[3,6];case 6:return[2,e(u)]}})})()};return(0,g._)((0,m._)({},e),{sheets:{spreadsheets:{get:function(t){return u(e.sheets.spreadsheets.get,t,"read")},batchUpdate:function(t){return u(e.sheets.spreadsheets.batchUpdate,t,"write")},developerMetadata:{search:function(t){return u(e.sheets.spreadsheets.developerMetadata.search,t,"read")}},values:{get:function(t){return u(e.sheets.spreadsheets.values.get,t,"read")},update:function(t){return u(e.sheets.spreadsheets.values.update,t,"write")}}}}})},S=n(20251),w=function(e,t){var n=(0,a.useRef)(0),r=(0,a.useRef)([]);return{increaseLimit:(0,a.useCallback)(function(){return new Promise(function(s){var u=function(){n.current<t?(n.current+=1,s(),setTimeout(function(){for(n.current-=1;r.current.length>0&&n.current<t;){var e=r.current.shift();null==e||e()}},e)):r.current.push(u)};u()})},[e,t]),limit:n}},I=n(10022),y=n(7451),_=function(){var e=(0,I.N$)(),t=e.gapiStorage,n=e.setGapiSettings,u=(0,I.I0)().setError,i=(0,S.A)().isReady,d=(0,o._)((0,a.useState)(!1),2),m=d[0],g=d[1],_=(0,o._)((0,a.useState)(null),2),N=_[0],b=_[1],P=(0,o._)((0,a.useState)([]),2),E=P[0],T=P[1],R=(0,o._)((0,a.useState)(null),2),G=R[0],U=R[1],C=(0,a.useRef)(0),k=w(6e4,60).increaseLimit,A=w(6e4,60).increaseLimit,M=(0,a.useRef)(null);M.current||(M.current=new(l())(1,1/0));var H=(0,a.useCallback)(function(e){var t=null==N?void 0:N.sheets;if(!M.current)throw Error("No queue available");if(!t)throw Error("No sheetsClient available");return M.current.add(function(){return(0,r._)(function(){var r,a,o;return(0,s.YH)(this,function(s){switch(s.label){case 0:g(!0),s.label=1;case 1:return s.trys.push([1,3,,12]),[4,e(t)];case 2:return s.sent(),[3,12];case 3:var c;if(!((void 0===(c=r=s.sent())?"undefined":(0,h._)(c))==="object"&&null!==c&&"status"in c&&"result"in c&&"error"in c.result))return[3,10];switch(u(Error(r.result.error.message)),r.status){case 429:return[3,4];case 404:return[3,6];case 403:return[3,7]}return[3,8];case 4:return n({autoSync:!1}),[4,(0,y.c)(3e4)];case 5:return s.sent(),[3,9];case 6:return n({sheetId:"",autoSync:!1}),[3,9];case 7:return n({token:"",tokenExpiry:0,autoSync:!1}),[3,9];case 8:return console.log("Unhandled gapi error (".concat(r.status,"): "),null==(o=r.result)||null==(a=o.error)?void 0:a.message),n({use:!1}),[3,9];case 9:return[3,11];case 10:throw u(r),r;case 11:return[3,12];case 12:return g(!1),[2]}})})()})},[null==N?void 0:N.sheets,u,n]),L=(0,a.useCallback)(function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){return i&&t.use?N||gapi.load("client",function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){switch(e.label){case 0:return[4,gapi.client.init({discoveryDocs:["https://sheets.googleapis.com/$discovery/rest?version=v4"]})];case 1:return e.sent(),b(v(gapi.client,k,A)),[2]}})})()}):b(null),[2]})})()},[N,t.use,k,A,i]),O=(0,a.useCallback)(function(){return(0,r._)(function(){var e,n;return(0,s.YH)(this,function(u){switch(u.label){case 0:if(window.clearTimeout(C.current),e=t.use,!(n=t.sheetId)||!e)return T([]),U(null),[2];u.label=1;case 1:return u.trys.push([1,,3,4]),[4,H(function(e){return(0,r._)(function(){var r,u,a,o,i;return(0,s.YH)(this,function(s){switch(s.label){case 0:if(r=t.token,u=(t.tokenExpiry||0)-Date.now()-1e4,!r||u<0)return console.log("\uD83D\uDCCA NOT updating sheet dates"),T([]),U(null),[2];return console.log("\uD83D\uDCCA Updating sheet dates"),[4,e.spreadsheets.get({spreadsheetId:n})];case 1:return o=f((a=s.sent().result.sheets)||[]),i=(a||[]).filter(function(e){var t=e.properties;return!!(null==t?void 0:t.title)&&p.kD.includes(t.title)}),U(function(e){return(0,c.tW)(o)===(0,c.tW)(e)?e:o}),T(i),[2]}})})()})];case 2:return u.sent(),[3,4];case 3:return C.current=window.setTimeout(O,6e4),[7];case 4:return[2]}})})()},[H,t]),D=(0,a.useCallback)(function(){U(null)},[]);return(0,a.useEffect)(function(){L()},[t,L]),(0,a.useEffect)(function(){var e=window.setTimeout(function(){var e,n=t.use,r=t.token;if(i&&N&&(null==(e=N.getToken())?void 0:e.access_token)!==r){if(!n||!r){null==N||N.setToken(null);return}N.setToken({access_token:r})}},1);return function(){return window.clearTimeout(e)}},[N,t,i]),(0,a.useEffect)(function(){if(i&&N){var e=setTimeout(O,1);return function(){return clearTimeout(e)}}},[N,i,O]),(0,a.useEffect)(function(){return function(){return window.clearTimeout(C.current)}},[]),{busy:m,isReady:i,enqueueSheetsClientRequest:H,sheets:E,gapiLastRemoteUpdates:G,updateSheets:O,clearGapiLastRemoteUpdates:D}},N=(0,a.createContext)({busy:!1,isReady:!1,sheets:[],gapiLastRemoteUpdates:null,updateSheets:function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){return[2]})})()},enqueueSheetsClientRequest:function(){return(0,r._)(function(){return(0,s.YH)(this,function(e){return[2]})})()},clearGapiLastRemoteUpdates:function(){}});function b(e){var t=e.children,n=_();return(0,u.jsx)(N.Provider,{value:n,children:t})}let P=function(){return(0,a.useContext)(N)}}}]);