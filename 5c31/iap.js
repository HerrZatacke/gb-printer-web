"use strict";(self.webpackChunkgb_printer_web=self.webpackChunkgb_printer_web||[]).push([[2503],{601:function(e,t,a){var r;a.d(t,{X3:function(){return r},mI:function(){return s},rx:function(){return n}}),function(e){e.FILTER_UNTAGGED="__filter:untagged__",e.FILTER_NEW="__filter:new__",e.FILTER_MONOCHROME="__filter:mono__",e.FILTER_RGB="__filter:rgb__",e.FILTER_RECENT="__filter:recent__",e.FILTER_FAVOURITE="__filter:favourite__",e.FILTER_COMMENTS="__filter:comments__",e.FILTER_USERNAME="__filter:username__"}(r||(r={}));const n=[r.FILTER_UNTAGGED,r.FILTER_NEW,r.FILTER_MONOCHROME,r.FILTER_RGB,r.FILTER_RECENT,r.FILTER_FAVOURITE,r.FILTER_COMMENTS,r.FILTER_USERNAME],s="__new:palette__"},7372:function(e,t){t.A=e=>e.filter(((t,a)=>e.findIndex((e=>e===t))===a))},10894:function(e,t,a){var r=a(58746),n=a(88222),s=a(96763);t.A=async(e,t)=>{if(360!==e.length)return e;const a=await(0,n.mZ)(t);if(!a)return e;if(14!==a.left.length||14!==a.right.length)return s.error("Invalid frameData"),e;const i=e.reduce(((e,t,a)=>(0,r.o1)(a,2,r.H.FRAMEMODE_KEEP)?e:[...e,t]),[]),F=[...a.upper];for(let e=0;e<14;e+=1)F.push(...a.left[e],...i.slice(16*e,16*(e+1)),...a.right[e]);return F.push(...a.lower),F}},17673:function(e,t,a){a.d(t,{g:function(){return i},i:function(){return F}});var r=a(42419),n=a(96763);const s=e=>Boolean(e.find((({hash:e})=>!e))),i=async e=>{if(!s(e))return e;const{default:t}=await a.e(4802).then(a.t.bind(a,74802,23));return Promise.all(e.map((async e=>{if(e.hash)return e;const a=await r.Uv.getItem(e.id);if(!a)return n.warn("could not load frame data for hashing"),e;const s=t(a);return await r.Uv.removeItem(e.id),await r.Uv.setItem(s,a),{...e,hash:s}})))},F=async e=>{const t=e;if(!t.state.frames||!s(t.state.frames))return e;const{default:r}=await a.e(4802).then(a.t.bind(a,74802,23)),i=await Promise.all(t.state.frames.map((async e=>{if(e.hash)return e;const a=`frame-${e.id}`,s=t[a];if(!s)return n.warn(`could not load ${a} from json import`),e;const i=r(s);return delete t[a],t[`frame-${i}`]=s,{...e,hash:i}})));return{...t,state:{...t.state,frames:i}}}},23299:function(e,t){t.A=e=>t=>t.filter(((a,r)=>t.findIndex((t=>t[e]===a[e]))===r))},27261:function(e,t,a){a.d(t,{iy:function(){return n},pl:function(){return r}});const r=e=>Boolean(e.hasOwnProperty("hashes")&&e.hashes),n=(e,t)=>!t||r(t)?e:[...e,t]},27673:function(e,t,a){a.d(t,{N:function(){return r}});var r,n=a(71511),s=a(87134),i=a(74353),F=a.n(i),o=a(34704),l=a(23299),m=a(27261),u=a(7372);!function(e){e.ADD="add",e.REMOVE="remove"}(r||(r={}));const c=(0,n.v)((0,s.Zr)(((e,t)=>({filtersActiveTags:[],filtersVisible:!1,imageSelection:[],lastSelectedImage:null,recentImports:[],sortBy:"created_asc",sortOptionsVisible:!1,setFiltersActiveTags:t=>e({filtersActiveTags:t,filtersVisible:!1}),setFiltersVisible:t=>e({filtersVisible:t}),setImageSelection:t=>e({imageSelection:t,lastSelectedImage:null}),setSortBy:t=>e({sortBy:t,sortOptionsVisible:!1}),setSortOptionsVisible:t=>e({sortOptionsVisible:t}),cleanRecentImports:a=>{const{recentImports:r}=t(),n=F()().subtract(6,"hour").unix();e({recentImports:r.filter((({hash:e,timestamp:t})=>a.includes(e)&&t>n))})},updateRecentImports:a=>{const r=t().recentImports,n=a.reduce(((e,t)=>(0,m.pl)(t)?e:[...e,{hash:t.hash,timestamp:F()().unix()}]),[]);e({recentImports:(0,l.A)("hash")([...r,...n])})},updateImageSelection:(a,n)=>{const s=t().imageSelection;switch(a){case r.ADD:e({imageSelection:(0,u.A)([...s,...n]),lastSelectedImage:n[0]});break;case r.REMOVE:e({imageSelection:s.filter((e=>!n.includes(e))),lastSelectedImage:null})}}})),{name:`${o.z}-filters`,storage:(0,s.KU)((()=>localStorage))}));t.A=c},30498:function(e,t,a){a.d(t,{Fv:function(){return p},R2:function(){return m},YP:function(){return c},Ys:function(){return u},dm:function(){return o},fE:function(){return i},fg:function(){return s},g0:function(){return l},i$:function(){return n}});var r=a(58746);const n="YYYY-MM-DD HH:mm:ss:SSS",s="YYYY-MM-DD HH:mm:ss",i="YYYYMMDD-HHmmss",F=[0,85,170,255],o='{"command":"INIT"}',l='{"command":"DATA", "compressed":0, "more":1}',m='{"command":"DATA","compressed":0,"more":0}',u='{"command":"PRNT","sheets":1,"margin_upper":1,"margin_lower":3,"pallet":228,"density":64 }',c={r:F.slice(),g:F.slice(),b:F.slice(),n:F.slice(),blend:r.Nx.MULTIPLY},p={shortName:"-",name:"Missing Palette",palette:["#aaaaaa","#999999","#888888","#777777"],isPredefined:!0,origin:"technical"}},32317:function(e,t,a){var r=a(74353),n=a.n(r),s=a(90521),i=a(30498);t.A=async({lines:e,filename:t,palette:a,frame:r,tags:F=[],meta:o,created:l=n()().format(i.i$)})=>({hash:await(0,s.UN)(e),created:l,title:t||"",lines:e.length,tags:F,palette:a,framePalette:a,invertFramePalette:!1,invertPalette:!1,frame:r,meta:o})},38438:function(e,t){const a="FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF";t.A=e=>{for(;e.length%20;)e.push(a);const t=new Array(20).fill(a);for(;e.length<360;)e.push(...t),e.length<360&&e.unshift(...t);return e}},42813:function(e,t,a){a.d(t,{A:function(){return h},h:function(){return P}});var r=a(71511),n=a(87134),s=a(18009),i=a.n(s),F=a(34704),o=a(601),l=a(23299),m=a(7372),u=a(60446),c=a(17673),p=a(74353),g=a.n(p),f=a(58746),d=a(30498),A=a(27261);const D=async e=>{const t=e,a={};return t.frames?.length&&(a.frames=await(0,c.g)(t.frames)),t.frameGroupNames?.length&&(a.frameGroups=t.frameGroupNames),t.palettes?.length&&(a.palettes=t.palettes),t.plugins?.length&&(a.plugins=t.plugins),t.imageGroups?.length&&(a.imageGroups=t.imageGroups),t.images?.length&&(a.images=t.images.map((e=>({...e,created:g()(e.created).format(d.i$)}))).map((e=>({...e,tags:e.tags||[]}))).map((e=>{if((0,A.pl)(e)){const t={...e};return t.palette||Object.assign(t,{palette:d.YP}),t.palette.blend||Object.assign(t.palette,{blend:f.Nx.MULTIPLY}),t.frame=e.frame||void 0,t}const t={...e};return void 0===t.framePalette&&(t.lockFrame?t.framePalette="bw":t.framePalette=t.palette),void 0===t.lockFrame&&(t.lockFrame=!1),void 0===t.invertFramePalette&&(t.invertFramePalette=t.invertPalette),t.frame=e.frame||void 0,t}))),a},h=1,w=(0,l.A)("id"),E=(0,l.A)("id"),I=(0,l.A)("id"),y=(0,l.A)("url"),b=(0,u.A)("id"),v=(0,l.A)("shortName"),_=(0,u.A)("name"),B=(0,l.A)("hash"),S=e=>b(w(e)),T=e=>_(y(e)),G=e=>v([...i().map((e=>({...e,isPredefined:!0}))),...e]);var P=(0,r.v)()((0,n.Zr)(((e,t)=>({frames:[],palettes:[],frameGroups:[],plugins:[],imageGroups:[],images:[],addFrames:t=>e((e=>({frames:S([...t,...e.frames])}))),addPalettes:a=>{const{palettes:r}=t(),{update:n,add:s}=a.reduce(((e,t)=>!!r.find((e=>e.shortName===t.shortName))?{update:[...e.update,t],add:e.add}:{update:e.update,add:[...e.add,t]}),{add:[],update:[]});e({palettes:v([...s,...r.map((e=>n.find((({shortName:t})=>t===e.shortName))||e))])})},deleteFrame:t=>e((({frames:e})=>({frames:S(e.filter((e=>t!==e.id)))}))),deletePalette:t=>e((({palettes:e})=>({palettes:e.filter((e=>t!==e.shortName))}))),deletePlugin:t=>e((({plugins:e})=>({plugins:T(e.filter((e=>t!==e.url)))}))),updateFrameGroups:t=>e((e=>({frameGroups:E([...t,...e.frameGroups])}))),updatePluginConfig:(a,r,n)=>{const{plugins:s}=t(),i=s.find((e=>e.url===a));if(!i)throw new Error(`Plugin "${a}" not found`);let F=i;const o={...F.config||{},[r]:n};return F={...F,config:o},e({plugins:s.map((e=>e.url!==a?e:F))}),o},addUpdatePluginProperties:a=>{const{plugins:r}=t(),n=[...r];r.find((({url:e})=>a.url===e))||n.push(a),e({plugins:T(n.map((e=>e.url!==a.url?e:{...e,...a})))})},addImageGroup:(a,r)=>{const{imageGroups:n}=t(),s=n.map((e=>{const t=e.images.filter((e=>!a.images.includes(e))),n=e.id===r?[...e.groups,a.id]:e.groups;return{...e,groups:n,images:t}}));e({imageGroups:I([...s,a])})},deleteImageGroup:a=>{const{imageGroups:r}=t(),n=r.find((({id:e})=>e===a));if(!n)return;const s=r.reduce(((e,t)=>t.id===a?e:t.groups.includes(a)?[...e,{...t,images:[...t.images,...n.images],groups:[...t.groups,...n.groups].filter((e=>e!==n.id))}]:[...e,t]),[]);e({imageGroups:s})},updateImageGroup:(a,r)=>{const{imageGroups:n}=t(),s=n.map((e=>{const t={...e};return t.groups=t.groups.filter((e=>e!==a.id)),r===t.id&&(t.groups=[...t.groups,a.id]),t.id===a.id?a:t}));e({imageGroups:s})},groupImagesAdd:(t,a)=>e((e=>({imageGroups:e.imageGroups.map((e=>e.id===t?{...e,images:[...e.images,...a]}:{...e,images:e.images.filter((e=>!a.includes(e)))}))}))),ungroupImages:t=>e((e=>({imageGroups:e.imageGroups.map((e=>({...e,images:e.images.filter((e=>!t.includes(e)))})))}))),setImageGroups:t=>e({imageGroups:t}),addImages:t=>e((e=>({images:B([...e.images,...t])}))),deleteImages:t=>e((e=>({images:[...e.images.filter((({hash:e})=>!t.includes(e)))]}))),updateImageHash:(t,a)=>e((e=>({images:e.images.map((e=>e.hash===t?a:e))}))),updateImageFavouriteTag:(t,a)=>e((e=>({images:e.images.map((e=>e.hash===a?{...e,tags:(0,m.A)(t?[o.X3.FILTER_FAVOURITE,...e.tags]:e.tags.filter((e=>e!==o.X3.FILTER_FAVOURITE)))}:e))}))),updateImages:t=>e((e=>({images:e.images.map((e=>t.find((t=>t.hash===e.hash))||e))}))),setFrames:t=>e({frames:w(t)}),setImages:t=>e({images:B(t)}),setPalettes:t=>e({palettes:G(t)})})),{name:`${F.z}-items`,storage:(0,n.KU)((()=>localStorage)),merge:(e,t)=>{const a={...t,...e};return{...a,palettes:G(a.palettes),plugins:a.plugins.map((e=>({...e,loading:!1})))}},partialize:e=>({frames:e.frames,frameGroups:e.frameGroups,imageGroups:e.imageGroups,images:e.images,plugins:e.plugins.map((e=>({...e,loading:void 0,error:void 0}))),palettes:e.palettes.filter((({isPredefined:e})=>!e))}),version:h,migrate:async(e,t)=>{let a;return 0===t&&(a=await D(e)),a}}))},56362:function(e,t,a){a.d(t,{A:function(){return i}});const r={"":"006666666600FFFF"," ":"FFFFFFFFFFFFFFFF",0:"FFDDAAAAAADDFFFF",1:"FFDD99DDDDDDFFFF",2:"FF99EEDDBB88FFFF",3:"FF99EE99EE99FFFF",4:"FFDDBBBB88EEFFFF",5:"FF88BB99EE99FFFF",6:"FFCCBB99AADDFFFF",7:"FF88EEDDBBBBFFFF",8:"FFDDAADDAADDFFFF",9:"FFDDAACCEE99FFFF",a:"FFDDAAAA88AAFFFF",b:"FF99AA99AA99FFFF",c:"FFCCBBBBBBCCFFFF",d:"FF99AAAAAA99FFFF",e:"FF88BB99BB88FFFF",f:"FF88BB99BBBBFFFF",g:"FFCCBBAAAACCFFFF",h:"FFAAAA88AAAAFFFF",i:"FF88DDDDDD88FFFF",j:"FF99DDDDDDBBFFFF",k:"FFAAAA99AAAAFFFF",l:"FFBBBBBBBB88FFFF",m:"FFAA888AAAAAFFFF",n:"FFAA8A888AAAFFFF",o:"FFDDAAAAAADDFFFF",p:"FF99AA99BBBBFFFF",q:"FFDDAAAAAACCFFFF",r:"FF99AA99AAAAFFFF",s:"FFCCBBDDEE99FFFF",t:"FF88DDDDDDDDFFFF",u:"FFAAAAAAAACCFFFF",v:"FFAAAAAAAADDFFFF",w:"FFAAAA8A88AAFFFF",x:"FFAAAADDAAAAFFFF",y:"FFAAAADDDDDDFFFF",z:"FF88EEDDBB88FFFF","ä":"AADDAAAA88AAFFFF","ö":"AADDAAAAAADDFFFF","ü":"AAAFAAAAAACCFFFF","ß":"FF99AA99AA99BBFF",".":"FFFFFFFFFFDDFFFF","!":"DDDDDDDDFFDDFFFF","?":"DDAAEEDDFFDDFFFF","-":"FFFFFF88FFFFFFFF",_:"FFFFFFFFFF88FFFF",":":"FFFFDDFFDDFFFFFF"};var n=e=>{const t=[...e.toString(10).toLowerCase().split("")," "," "],a=t.shift()||"",n=t.shift()||"",s=r[a]||r[""],i=r[n]||r[""];return[...Array(16)].map(((e,t)=>`${s[t]}${i[t]}`)).join("")};const s="FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF\n";var i=e=>{const t=[],a=e.split("\n").map((e=>e.match(/.{1,32}/g))).flat().map((e=>e||"")).map(((e="")=>e.padEnd(32," "))).map((e=>e.match(/.{1,2}/g)?.map((e=>n(e)))||[])).map((e=>[s,s,...e,s,s])).flat();for(t.push(...[...Array(40)].map((()=>s))),t.push(...a);t.length<360;)t.push(s);return t}},60446:function(e,t,a){var r;a.d(t,{U:function(){return r}}),function(e){e.ASC="asc",e.DESC="desc"}(r||(r={}));t.A=(e,t=r.ASC)=>a=>{const n=t===r.DESC?-1:1;return[...a].sort(((t,a)=>"string"==typeof t[e]?t[e].localeCompare(a[e]):t[e]>a[e]?n:t[e]<a[e]?-n:0))}},66750:function(e,t,a){a.d(t,{K:function(){return n},U:function(){return r}});const r=async e=>{const{default:t}=await a.e(1668).then(a.t.bind(a,51668,23));return t.inflate(e,{to:"string"})},n=async e=>{const{default:t}=await a.e(1668).then(a.t.bind(a,51668,23));return t.deflate(e,{to:"string",strategy:1,level:8})}},72625:function(e,t,a){a.d(t,{default:function(){return f}});var r=a(96540),n=a(5338),s=a(27673),i=a(42813);var F=a(74353),o=a.n(F),l=a(32317),m=a(38438),u=a(30498),c=a(96763);const p=()=>new Array(20).fill("").map((()=>Math.floor(256*Math.random()).toString(16).padStart(2,"0"))).join(" "),g=async e=>{const t=Date.now(),a=new Array(20*18).fill("").map(p);const r=await(0,l.A)({lines:(0,m.A)(a),filename:`${e.toString(10).padStart(6,"0")} - ${t.toString(16)}`,palette:"bw",frame:"int14",tags:["debug","dummy"],created:o()(t).format(u.i$),meta:{}}),n=Date.now()-t;return await new Promise((t=>{c.log(e,n),window.requestAnimationFrame(t)})),{image:r,elapsed:n}};var f=async()=>{const e=document.getElementById("app");if(!e)return;if((()=>{const e=localStorage.getItem("gbp-web-state");if(localStorage.removeItem("gbp-web-state"),e){let t;try{t=JSON.parse(e)}catch{return!1}const a={version:0,state:{frameGroupNames:t.frameGroupNames||[],frames:t.frames||[],images:t.images||[],imageGroups:t.imageGroups||[],palettes:t.palettes||[],plugins:t.plugins||[]}};localStorage.setItem("gbp-z-web-items",JSON.stringify(a));const r={version:0,state:{activePalette:t.activePalette||"bw",enableDebug:t.enableDebug||!1,enableImageGroups:t.enableImageGroups||!1,exportFileTypes:t.exportFileTypes||["png"],exportScaleFactors:t.exportScaleFactors||[4],forceMagicCheck:t.forceMagicCheck||!1,galleryView:t.galleryView||"1x",handleExportFrame:t.handleExportFrame||"keep",hideDates:t.hideDates||!1,importDeleted:"boolean"!=typeof t.importDeleted||t.importDeleted,importLastSeen:"boolean"!=typeof t.importLastSeen||t.importLastSeen,importPad:t.importPad||!1,pageSize:"number"==typeof t.pageSize?t.pageSize:60,preferredLocale:t.preferredLocale||"en-GB",printerParams:t.printerParams||"",printerUrl:t.printerUrl||"",savFrameTypes:t.savFrameTypes||"int",sortPalettes:t.sortPalettes||"default_desc",useSerials:t.useSerials||!1,videoParams:t.videoParams||{}}};localStorage.setItem("gbp-z-web-settings",JSON.stringify(r));const n={version:0,state:{filtersActiveTags:t.filtersActiveTags||[],imageSelection:t.imageSelection||[],recentImports:t.recentImports||[],sortBy:t.sortBy||"created_asc"}};localStorage.setItem("gbp-z-web-filters",JSON.stringify(n));const s={version:0,state:{dropboxStorage:t.dropboxStorage||{},gitStorage:t.gitStorage||{},syncLastUpdate:t.syncLastUpdate||{}}};return localStorage.setItem("gbp-z-web-storages",JSON.stringify(s)),!0}return!1})())return void window.location.reload();const{default:t}=await Promise.all([a.e(4802),a.e(6871),a.e(3524)]).then(a.bind(a,29818));try{const a=(0,n.H)(e),{images:F}=i.h.getState();s.A.getState().cleanRecentImports((F||[]).map((({hash:e})=>e))),a.render(r.createElement(t,null)),window.startFake=async e=>{await(async e=>{const t=[],a=Date.now();for(let a=0;a<e;a+=1)t.push(await g(a));c.log("Generate time: "+(Date.now()-a));const r=Date.now(),{images:n,setImages:s}=i.h.getState();s([...n,...t.map((({image:e})=>e))]),c.log("Dispatch time: "+(Date.now()-r))})(e)}}catch(e){const t=document.getElementById("app");t&&(t.innerHTML=`<p class="init-error">Error while initializing the app:<br>${e.message}<br><small>${e.stack}</small></p>`)}}},88222:function(e,t,a){a.d(t,{Bf:function(){return i},mZ:function(){return o},R_:function(){return F}});var r=a(42419),n=a(66750);const s=e=>e.toUpperCase(),i=async(e,t)=>{const{default:r}=await a.e(4802).then(a.t.bind(a,74802,23)),i=JSON.stringify(((e,t)=>{const a=e.slice(0,20*t).map(s),r=e.slice(20*(t+14)).map(s);return{upper:a,left:Array(14).fill(0).map(((a,r)=>{const n=20*(r+t);return e.slice(n,n+2).map(s)})),right:Array(14).fill(0).map(((a,r)=>{const n=20*(r+t);return e.slice(n+18,n+20).map(s)})),lower:r}})(e,t)),F=await(0,n.K)(i);return{dataHash:r(F),compressed:F}},F=async(e,t)=>{const{dataHash:a,compressed:n}=await i(e,t);return await r.Uv.setItem(a,n),a},o=async e=>{if(!e)return null;const t=await r.Uv.getItem(e);if(!t)return null;let a;try{a=await(0,n.U)(t)}catch(e){return null}try{return JSON.parse(a)}catch(e){}try{const e=a.split("\n");return{upper:e.slice(0,40),left:Array(14).fill(0).map(((t,a)=>e.slice(4*a+40,4*a+42))),right:Array(14).fill(0).map(((t,a)=>e.slice(4*a+42,4*a+44))),lower:e.slice(96,136)}}catch(e){return null}}},90521:function(e,t,a){a.d(t,{cg:function(){return o},yH:function(){return u},t9:function(){return c},Hh:function(){return m},UN:function(){return l}});var r=a(56362);var n=e=>{const t=`\nThe following hash is missing in\nyour indexedDb:\n${e}\n\nEither you imported a debug dump\nor your browser decided to do a\ncleanup.\n\nThis image might be able to be\nrecovered if you have set up git\nor dropbox sync.\n`.trim();return(0,r.A)(t)},s=a(10894),i=a(42419),F=a(66750);const o=async e=>{const{default:t}=await a.e(4802).then(a.t.bind(a,74802,23)),r=e.map((e=>e.replace(/ /gi,"").toUpperCase())).join("\n"),n=await(0,F.K)(r);return{dataHash:t(n),compressed:n}},l=async e=>{const{dataHash:t,compressed:a}=await o(e);return await i.mU.setItem(t,a),t},m=async(e,t,a,r)=>{if(!e)return null;try{const a=await i.mU.getItem(e);if(!a)throw new Error("missing imagedata");const r=(await(0,F.U)(a)).split("\n");return t?(0,s.A)(r,t):r}catch(t){return"function"==typeof r&&r(e),a?[]:n(e)}},u=async e=>i.mU.removeItem(e),c=async e=>i.Uv.removeItem(e)}}]);