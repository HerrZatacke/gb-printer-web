/*! License information can be found in 8aac/app.js.l.txt */
(self.webpackChunkgb_printer_web=self.webpackChunkgb_printer_web||[]).push([[3524],{1562:function(e,t){"use strict";const a=(e,t,a)=>{const n=a.find((t=>t.id===e));if(n)return n.name;switch(e){case"hk":return"Hallo Katze!";case"int":return"International Frames (GameBoy Camera)";case"jp":return"Japanese Frames (Pocket Camera)";default:return t}},n=e=>{switch(e){case"int":return"_1";case"jp":return"_2";case"hk":return"_3";default:return e}};t.A=(e,t)=>e.reduce(((e,{id:n,name:r})=>{try{const l=n.match(/^[a-z]+/g)?.[0];return l?(e.find((e=>e.id===l))||e.push({id:l,name:a(l,r,t)}),e):e}catch(t){return e}}),[]).sort((({id:e},{id:t})=>{const a=n(e),r=n(t);return a>r?1:a<r?-1:0}))},3876:function(e,t,a){"use strict";var n;a.d(t,{m:function(){return n}}),function(e){e.ALL="all",e.FRAMES="frames",e.CURRENT_FRAMEGROUP="current_framegroup",e.IMAGES="images",e.SELECTED_IMAGES="selected_images",e.PALETTES="palettes",e.PLUGINS="plugins"}(n||(n={}))},5431:function(e,t){"use strict";t.A=e=>e.replace(/[^a-z0-9/\\._-]/gi,"").replace(/[\\/]+/gi,"/").replace(/^\//,"").replace(/\/$/,"")},16521:function(e,t,a){"use strict";var n=a(74353),r=a.n(n),l=a(601),o=a(30498),F=a(27261);t.A=(e,t)=>a=>{const n=e.reduce(((e,t)=>[l.X3.FILTER_MONOCHROME,l.X3.FILTER_NEW,l.X3.FILTER_RGB,l.X3.FILTER_UNTAGGED,l.X3.FILTER_RECENT,l.X3.FILTER_FAVOURITE,l.X3.FILTER_COMMENTS,l.X3.FILTER_USERNAME].includes(t)?[...e,t]:e),[]);if(n.length){if(n.includes(l.X3.FILTER_UNTAGGED)&&0!==a.tags.length)return!1;if(n.includes(l.X3.FILTER_NEW)){if(r()(a.created,o.i$).unix()<=r()().subtract(1,"day").unix())return!1}return!(n.includes(l.X3.FILTER_RECENT)&&!t.map((({hash:e})=>e)).includes(a.hash))&&(!(n.includes(l.X3.FILTER_RGB)&&!(0,F.pl)(a))&&((!n.includes(l.X3.FILTER_MONOCHROME)||!(0,F.pl)(a))&&(!(n.includes(l.X3.FILTER_FAVOURITE)&&!a.tags.includes(l.X3.FILTER_FAVOURITE))&&(!(n.includes(l.X3.FILTER_COMMENTS)&&!a.meta?.comment)&&!(n.includes(l.X3.FILTER_USERNAME)&&!a.meta?.userName)))))}return!0}},26564:function(e,t,a){"use strict";var n;a.d(t,{V:function(){return n}}),function(e){e.CHECKBOX="checkbox",e.SELECT="select",e.TEXT="text",e.NUMBER="number",e.INFO="info",e.IMAGE="image"}(n||(n={}))},28025:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var n,r=a(48287).Buffer;!function(e){e.UINT8_ARRAY="uint8array",e.TEXT="text",e.DATA_URL="dataURL",e.BINARY_STRING="binaryString"}(n||(n={})),t.A=function(e,t){return new Promise(((a,l)=>{const o=new FileReader;switch(o.onload=({target:e})=>{if(e?.result)return t===n.UINT8_ARRAY?void a(r.from(e.result)):void a(e.result);l(new Error("Filereader has no result"))},o.onerror=e=>{l(e)},t){case n.UINT8_ARRAY:o.readAsArrayBuffer(e);break;case n.TEXT:o.readAsText(e);break;case n.BINARY_STRING:o.readAsBinaryString(e);break;case n.DATA_URL:o.readAsDataURL(e);break;default:l(new Error(`readAs param missing or unknown type "${t}"`))}}))}},29809:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var n=a(90521),r=a(30498);const l=async(e,t,a)=>{const l=(await(0,n.Hh)(e)||[]).map((e=>e.match(/.{1,2}/g)?.join(" ")||"")).reduce(((e,t,a)=>a%40?[...e,t]:[...e,r.g0,t]),[]),o=[r.dm,...l,r.R2,r.Ys].join("\n");return{folder:"images",filename:`${a}.txt`,blob:new Blob(new Array(o),{type:"text/plain"}),title:t}}},30985:function(e,t,a){"use strict";var n=a(601);t.A=e=>t=>{const a=e.filter((e=>![n.X3.FILTER_MONOCHROME,n.X3.FILTER_NEW,n.X3.FILTER_RGB,n.X3.FILTER_UNTAGGED,n.X3.FILTER_RECENT,n.X3.FILTER_FAVOURITE,n.X3.FILTER_COMMENTS,n.X3.FILTER_USERNAME].includes(e)));return!a.length||!!t.tags.find((e=>a.includes(e)))}},37482:function(e,t,a){"use strict";a.d(t,{N:function(){return n}});const n=(e,t)=>t?[...e,t]:e},39200:function(e,t,a){"use strict";a.d(t,{S:function(){return o}});var n=a(88137),r=a(16521),l=a(30985);const o=(e,{filtersActiveTags:t,sortBy:a,recentImports:o})=>[...e].map(n.YZ).sort((0,n.PM)(a)).map(n.lt).filter((0,r.A)(t,o)).filter((0,l.A)(t))},40323:function(e,t,a){"use strict";a.d(t,{default:function(){return Bu}});var n=a(96540),r=a(35580),l=a(52412),o=a(18516),F=a(53830);function i({children:e}){return n.createElement(F.A,{direction:"column",gap:1,sx:e=>({a:{color:e.palette.secondary.light,textDecorationColor:"currentColor","&:hover":{color:e.palette.secondary.main}},code:{fontFamily:"monospace"},ul:{listStyleType:"disc",paddingInlineStart:e.spacing(2)},"h1,h2,h3,h4,h5,h6,p":{marginBottom:"0.6em"}})},e)}var s=function({getMarkdown:e}){const[t,r]=(0,n.useState)((()=>()=>null)),[F,s]=(0,n.useState)("");return(0,n.useEffect)((()=>{(async()=>{const{default:t}=await a.e(4840).then(a.bind(a,24840));r((()=>t)),s(await e())})()}),[e]),n.createElement(l.A,null,n.createElement(o.A,null,n.createElement(t,{options:{wrapper:i}},F)))};var c=function(){return n.createElement(s,{getMarkdown:async()=>{const{default:e}=await a.e(3119).then(a.bind(a,81745));return e.split("\n").slice(1).join("\n")}})},u=a(27947),m=a(22535),d=a(29608),p=a(15147),g=a(32483),h=a(5076),f=a(82719),E=a(41128),A=a(47151),v=a(53356),b=a(79672),y=a(34477),w=a(48227),I=a(63518),C=a(55370),S=a(57862),x=a(25418),k=a(85916),P=a(22944);var T=({confirm:e,canConfirm:t,deny:a})=>{(0,n.useEffect)((()=>{const n=n=>{"Escape"===n.key&&a&&a(),"Enter"===n.key&&n.ctrlKey&&e&&t&&e()};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}}),[e,t,a])};const D=(e,t,a,n)=>{const r={};if(n?(r.padding="8px !important",r.overflowX="hidden",r.overflowY="hidden"):(r.scrollbarGutter="stable",r.overflowY="scroll"),a)return r;switch(typeof t){case"string":r.height=t;break;case"number":r.height=`${t}px`}switch(typeof e){case"string":r.width=e;break;case"number":r.width=`${e}px`;break;default:r.width="440px"}return r},M=document.body;var R=function({contentHeight:e,contentWidth:t,header:a,closeTitle:r,children:l,confirm:o,deny:i,canConfirm:s,headerOnly:c,fullSize:u,open:m,keepMounted:d,closeOnOverlayClick:p,headerActionButtons:h,actionButtons:f}){const E="boolean"!=typeof p||p,A="boolean"!=typeof m||m,b="boolean"!=typeof d||d;T({confirm:o,canConfirm:s||!1,deny:i});const R=(0,v.A)(),N=(0,P.A)(R.breakpoints.down("md"));return n.createElement(C.A,{container:M,fullScreen:N||u,maxWidth:"lg",open:A,onClose:i,"aria-label":"string"==typeof a?a:void 0,keepMounted:b,disableEscapeKeyDown:!E,sx:{paddingRight:"10px"}},n.createElement(k.A,null,n.createElement(F.A,{direction:"row",gap:4,justifyContent:"space-between",alignItems:"center"},n.createElement(y.A,{sx:{wordBreak:"break-word"}},a),n.createElement(y.A,{sx:{my:-.5,mr:-2}},h,i?n.createElement(g.A,{title:r||`Close ${"string"==typeof a?a:""}`,color:"inherit",onClick:i},n.createElement(I.A,null)):null))),!c&&n.createElement(x.A,{sx:D(t,e,N,u)},l),n.createElement(S.A,null,f,i?n.createElement(w.A,{onClick:i,color:"primary",variant:"outlined"},"Cancel"):null,o?n.createElement(w.A,{disabled:!1===s,color:"primary",variant:"contained",onClick:o},"Ok"):null))};const N="ROOT",B=()=>({id:N,slug:"",created:"",title:"Home",coverImage:"",images:[],groups:[],tags:[]}),L=B(),G=(0,n.createContext)({root:L,view:L,images:[],covers:[],paths:[],pathsOptions:[]}),$=()=>(0,n.useContext)(G),O=()=>{const{"*":e}=(0,r.g)(),[t,a]=(0,n.useState)(""),l=/(?<slug>.*\/)*(page\/)(?<page>\d*)/g.exec(e||""),o=l?.groups?.page,F=l?.groups?.slug||"",i=o?parseInt(o,10)-1:0;return(0,n.useEffect)((()=>{if("string"==typeof e){a(`/gallery/${F}page/${i+1}`)}}),[F,i,e]),{pageIndex:i,path:F,lastGalleryLink:t}};var _=a(39200),j=a(27673);const V=()=>{const e=(0,r.Zp)(),{paths:t,root:a}=$(),[l,o]=(0,n.useState)({}),{sortBy:F,filtersActiveTags:i,recentImports:s}=(0,j.A)(),{pageSize:c}=(0,u.A)(),{path:m}=O(),d=(0,n.useCallback)((e=>(0,_.S)(e,{filtersActiveTags:i,sortBy:F,recentImports:s})),[i,s,F]),p=(0,n.useCallback)(((e,t)=>{const a=d(t.images).findIndex((({hash:t})=>t===e));return Math.floor(a/c)+1}),[d,c]),g=(0,n.useCallback)((e=>{if(e===N)return"/gallery/page/1";return`/gallery/${t.find((({group:{id:t}})=>e===t))?.absolutePath||""}page/1`}),[t]),h=(0,n.useMemo)((()=>t.find((({absolutePath:e})=>e===m))?.group||a),[m,t,a]),f=(0,n.useCallback)((e=>{const n=t.find((({group:{images:t}})=>t.map((({hash:e})=>e)).includes(e)));return`/gallery/${n?.absolutePath||""}page/${p(e,n?.group||a)}`}),[p,t,a]);return(0,n.useEffect)((()=>{l.imageHash?(e(f(l.imageHash)),o({})):l.groupId&&(e(g(l.groupId)),o({}))}),[g,f,e,l]),{currentGroup:h,getGroupPath:g,getPagedImagePath:f,getImagePageIndexInGroup:p,navigateToGroup:e=>{o({groupId:e})},navigateToImage:e=>{o({imageHash:e})}}},U=()=>{const{path:e}=O(),{root:t,paths:a}=$(),{getImagePageIndexInGroup:r}=V();return{segments:(0,n.useMemo)((()=>{const n=["",...e.split("/").filter(Boolean)],l=n.reduce(((e,t,a)=>[...e,n.slice(1,a+1).join("/").concat("/")]),[]).map((e=>a.find((({absolutePath:t})=>t===e))||{absolutePath:"",group:t}));return l.map(((e,t)=>{const a=l[t+1];let n=1;if(a){const t=a.group.coverImage;n=r(t,e.group)}return{group:e.group,path:`${e.absolutePath}page/${n}`}}))}),[e,r,a,t])}};var z=a(7372);function W({group:e,onClick:t}){const{getGroupPath:a}=V();return n.createElement(A.y,{itemId:e.id,label:n.createElement(h.A,{component:r.N_,to:a(e.id),onClick:t,sx:{display:"block"}},e.title),sx:e=>({"& > .MuiTreeItem-content.Mui-selected":{backgroundColor:(0,b.X4)(e.palette.secondary.main,.8),color:e.palette.secondary.contrastText,"&:hover,&.Mui-focused":{backgroundColor:e.palette.secondary.main}}})},e.groups.map((e=>n.createElement(W,{key:e.id,group:e,onClick:t}))))}var H=function({open:e,onClose:t}){const{pathsOptions:a,root:r}=$(),{currentGroup:l}=V(),o=(0,v.A)(),{segments:F}=U(),[i,s]=(0,n.useState)([]);return(0,n.useEffect)((()=>{s((e=>{const t=F.map((({group:e})=>e.id));return(0,z.A)([...t,...e])}))}),[F]),a.length<2?null:n.createElement(R,{contentHeight:"60vh",contentWidth:"auto",deny:t,open:e,header:"Gallery Navigation",keepMounted:!1},n.createElement(E.G,{expansionTrigger:"iconContainer",expandedItems:i,onExpandedItemsChange:(e,t)=>s(t),selectedItems:l.id,sx:{width:o.breakpoints.values.sm,height:"60vh"}},n.createElement(W,{group:r,onClick:t})))},X=a(71511);var Y=(0,X.v)((e=>({editFrame:null,editPalette:null,pickColors:null,editImageGroup:null,editImages:null,editRGBNImages:[],setEditFrame:t=>e({editFrame:t}),setEditImageGroup:t=>e({editImageGroup:t}),setEditPalette:t=>e({editPalette:t,pickColors:null}),setEditRGBNImages:t=>e({editRGBNImages:t}),setPickColors:t=>e({pickColors:t}),setEditImages:t=>e({editImages:t}),cancelEditFrame:()=>e({editFrame:null}),cancelEditImageGroup:()=>e({editImageGroup:null}),cancelEditPalette:()=>e({editPalette:null}),cancelEditRGBNImages:()=>e({editRGBNImages:[]}),cancelPickColors:()=>e({pickColors:null}),cancelEditImages:()=>e({editImages:null})})));var Q=function(){const{pathsOptions:e}=$(),{setEditImageGroup:t}=Y(),{segments:a}=U(),[l,o]=(0,n.useState)(!1);return e.length<2?null:n.createElement(F.A,{direction:"row",gap:2,justifyContent:"space-between",alignItems:"center"},n.createElement(m.A,null,a.map((({group:e,path:a},l)=>{return n.createElement(F.A,{key:e.id,direction:"row",gap:.5,alignItems:"center"},l>0?n.createElement(h.A,{component:r.N_,title:e.title,to:`/gallery/${a}`},l?(o=e.title,i=30,o.length<i?o:`${o.slice(0,i)}…`):n.createElement(p.A,{fontSize:"small"})):n.createElement(g.A,{component:r.N_,title:e.title,to:`/gallery/${a}`,sx:{fontSize:16}},n.createElement(p.A,{fontSize:"inherit"})),l>0&&n.createElement(g.A,{onClick:()=>t({groupId:e.id}),title:`Edit group "${e.title}"`,sx:{fontSize:16}},n.createElement(d.A,{fontSize:"inherit"})));var o,i}))),n.createElement(g.A,{title:"Open Gallery Navigation",onClick:()=>o(!0)},n.createElement(f.A,null)),n.createElement(H,{open:l,onClose:()=>o(!1)}))};const K=e=>{const t=40;return e>1220?1155:e>1025?960:e>830?765:e>635?570:e>440?375:e-t},q=()=>({width:window.innerWidth,height:window.innerHeight,ddpx:window.devicePixelRatio<=2?window.devicePixelRatio:window.devicePixelRatio/2,layoutWidth:K(window.innerWidth)}),Z=()=>{const[e,t]=(0,n.useState)(q());return(0,n.useEffect)((()=>{const e=()=>{t(q())};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[t]),e};var J=a(23839);var ee=function({fixedView:e,children:t}){const{ddpx:a}=Z(),{galleryView:r}=(0,u.A)(),l=e||r,o=(0,n.useMemo)((()=>{let e="",t="";switch(l===J.j.GALLERY_VIEW_SMALL&&1===a?J.j.GALLERY_VIEW_1X:l){case J.j.GALLERY_VIEW_SMALL:e=160/a+"px",t=8/a+"px";break;case J.j.PALETTE_VIEW:e="minmax(270px, 1fr)",t="32px";break;case J.j.GALLERY_VIEW_1X:e="160px",t="16px";break;case J.j.GALLERY_VIEW_2X:e="320px",t="32px";break;case J.j.GALLERY_VIEW_MAX:e="100%",t="32px"}return{gap:t,display:"grid",justifyContent:"center",gridTemplateColumns:`repeat(auto-fill, ${e})`}}),[l,a]);return n.createElement(y.A,{component:"ul",sx:o},t)},te=a(6196),ae=a(10784),ne=a(53111),re=a(77580),le=a(96763);var oe=function({palette:e,tiles:t,imageStartLine:a,lockFrame:r,invertPalette:l,framePalette:o,invertFramePalette:F,asThumb:i=!1,rotation:s=ne.pL.DEG_0}){const c=!(e instanceof Array),u=(0,n.useRef)(null),[m,d]=(0,n.useState)("");(0,n.useEffect)((()=>{if(!e||!t)return;const n=document.createElement("canvas");n.width=160,n.height=144;try{if(c){const a=new ae.Wd;t&&a.update({canvas:n,tiles:t,palette:e,lockFrame:r})}else{const r=new ae.XM;if(t?.length){const i=(0,re.A)({palette:e,framePalette:o,invertPalette:l,invertFramePalette:F});r.update({canvas:n,tiles:t,...i,imageStartLine:a})}}u.current&&(0,ne.zP)(n,u.current,s||ne.pL.DEG_0),d("")}catch(e){e instanceof Error&&(le.error(e),d(e.message))}}),[t,e,r,l,s,c,a,o,F]);const p=(0,n.useMemo)((()=>{const e=s===ne.pL.DEG_90||s===ne.pL.DEG_270,a=(c?(0,ae.EK)(t):t.length)<=360,n=e&&a;return{display:"flex",width:"100%",height:"100%",canvas:{display:"block",imageRendering:i?"auto":"pixelated",margin:n?"0 5%":0,width:n?"90%":"100%",maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}}),[i,c,s,t]);return n.createElement(y.A,{sx:p},!m&&n.createElement("canvas",{width:160,ref:u}))},Fe=a(8861);var ie=function(){return n.createElement(y.A,{sx:{width:"100%",paddingTop:"90%",height:0,display:"block",background:"transparent",position:"relative"}},n.createElement(y.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},n.createElement(Fe.A,{color:"primary",size:40})))},se=a(42813),ce=a(96533),ue=a(30498),me=a(88222),de=a(76194);let pe;const ge=(e,t)=>{const n=async()=>{if(!pe){const{dropBoxSyncTool:n}=await Promise.all([a.e(2350),a.e(1575)]).then(a.bind(a,70584));pe=pe||n(e,t)}return pe};de.A.getState().dropboxStorage.use&&n();return{recoverImageData:async e=>(await n()).recoverImageData(e),startAuth:async()=>(await n()).startAuth(),startSyncData:async e=>(await n()).startSyncData(e),startSyncImages:async()=>(await n()).startSyncImages(),updateSettings:async e=>(await n()).updateSettings(e),subscribe:()=>de.A.subscribe((e=>e.dropboxStorage),(async e=>{(await n()).updateSettings(e)}))}};var he=a(56727);var fe=(0,X.v)(((e,t)=>({bitmapQueue:[],frameQueue:[],importQueue:[],bitmapQueueAdd:t=>e((({bitmapQueue:e})=>({bitmapQueue:[...e,...t]}))),bitmapQueueCancel:()=>e({bitmapQueue:[]}),frameQueueAdd:t=>e((({frameQueue:e})=>({frameQueue:[...e,...t]}))),frameQueueCancelOne:t=>e((({frameQueue:e})=>({frameQueue:e.filter((e=>e.tempId!==t))}))),importQueueAdd:a=>{const{bitmapQueue:n,importQueue:r}=t(),l=a.map((({fileName:e})=>e));e({bitmapQueue:n.filter((({fileName:e})=>!l.includes(e))),importQueue:[...r,...a]})},importQueueCancel:()=>{e({importQueue:[]})},importQueueCancelOne:t=>e((({importQueue:e})=>({importQueue:e.filter((e=>e.tempId!==t))})))}))),Ee=a(88231);const Ae=()=>{const{dismissDialog:e,setDialog:t}=(0,he.A)(),{cancelEditFrame:a,cancelEditImages:r,cancelEditPalette:l}=Y(),{updateRecentImports:o,updateImageSelection:F}=(0,j.A)(),{importQueueCancel:i}=fe(),{setProgress:s,setPrinterBusy:c}=(0,Ee.A)(),{addImages:u,deleteImages:m,setImageGroups:d,updateFrameGroups:p,updateImageHash:g,updateImages:h,setFrames:f,setImages:E,setPalettes:A}=(0,se.h)(),{setSyncLastUpdate:v}=(0,de.A)();return(0,n.useMemo)((()=>{const n=()=>v("local",Math.floor((new Date).getTime()/1e3)),b=()=>{s("printer",0),c(!1),i()};return{addImages:t=>{u(t),e(0),n(),b(),o(t)},deleteImages:t=>{m(t),F(j.N.REMOVE,t),e(0),n()},dismissDialog:e,globalUpdate:e=>{a(),l(),r(),e.lastUpdateUTC?v("local",e.lastUpdateUTC):n(),e.palettes&&A(e.palettes),e.images&&(E(e.images),o(e.images)),e.frames&&f(e.frames),e.frameGroups&&p(e.frameGroups),e.imageGroups&&d(e.imageGroups)},importQueueCancel:b,setDialog:t,updateImageHash:(e,t)=>{r(),n(),g(e,t)},updateImages:e=>{h(e),n()},updateLastSyncLocalNow:n}}),[u,a,r,l,m,e,i,t,f,E,A,d,c,s,v,p,g,F,h,o])};var ve=a(42002),be=a(47020),ye=a(23299);const we=e=>{const t=(0,ye.A)(e);return(a,n)=>{const r=n.map((t=>{const n=a.find((a=>a[e]===t[e]));return n?{...n,...t}:t}));return t([...r,...a])}},Ie=we("hash"),Ce=we("id"),Se=we("shortName");var xe=(e,t,a,n,r)=>{let l=e,o=a,F=t;return r?(n.frames&&n.frames.length&&(l=Ce(l,n.frames)),n.images&&n.images.length&&(o=Ie(o,n.images)),n.palettes&&n.palettes.length&&(F=Se(F,n.palettes))):(l=n.frames||e,o=n.images||a,F=n.palettes||t),{...n,images:o,frames:l,palettes:F}},ke=a(42419),Pe=a(17673);const Te=async(e,t=!1)=>{const{frames:a,palettes:n,images:r}=se.h.getState(),l=await(0,Pe.i)(e);return Object.keys(l).forEach((e=>{if("state"!==e){const t=l[e];e.match(/^[a-f0-9]{40,}$/gi)?ke.mU.setItem(`${e}`,t):e.startsWith("frame-")&&ke.Uv.setItem(`${e.split("frame-").pop()}`,t)}})),xe(a,n,r,l.state||{},t)},De=()=>{const{globalUpdate:e}=Ae();return(0,n.useMemo)((()=>{const t=(0,be.A)();return{downloadSettings:async(e,a="")=>{const n=await t(e,{selectedFrameGroup:a}),r="frames"===e?"frames":[e,a].filter(Boolean).join("_");(0,ve.R)(null)([{blob:new Blob(new Array(n)),filename:`${r}.json`}])},jsonImport:async t=>{const a=await Te(t,!0);e(a)},remoteImport:async t=>{const a=await Te(t,!1);e(a)}}}),[e])};var Me=function({hash:e,hashes:t,frameId:a,lockFrame:r,invertPalette:l,invertFramePalette:o,palette:F,framePalette:i,rotation:s}){const{gbImageProps:c}=(({hash:e,hashes:t,palette:a,invertPalette:r,framePalette:l,invertFramePalette:o,lockFrame:F,frameId:i,rotation:s})=>{const[c,u]=(0,n.useState)(null),m=Ae(),{remoteImport:d}=De(),{frames:p,palettes:g,images:h}=(0,se.h)(),f=p.find((({id:e})=>e===i))?.hash,E=(0,n.useCallback)(((e,a,n)=>(0,ce.T)(h,p,(()=>{ge(m,d).recoverImageData(e)}))(e,a,n,t)),[h,p,t,m,d]),A=(0,n.useMemo)((()=>"string"==typeof a?(g.find((({shortName:e})=>e===a))||ue.Fv).palette:a),[g,a]);return(0,n.useEffect)((()=>{let t=!1;return e||u(null),(async()=>{if(t)return;const n=await E(e,!1,i),c=f?await(0,me.mZ)(f):null,m=c?c.upper.length/20:2;t||n&&u({tiles:n,palette:A,invertPalette:r,imageStartLine:m,lockFrame:F,rotation:s,framePalette:F?l:a,invertFramePalette:F?o:r})})(),()=>{t=!0}}),[E,e,i,a,r,F,s,A,f,l,o]),{gbImageProps:c}})({hash:e,hashes:t,frameId:a,lockFrame:r,invertPalette:l,invertFramePalette:o,palette:F,framePalette:i,rotation:s});return c?n.createElement(oe,{lockFrame:c.lockFrame,invertPalette:c.invertPalette,invertFramePalette:c.invertFramePalette,tiles:c.tiles,palette:c.palette,framePalette:c.framePalette,imageStartLine:c.imageStartLine,rotation:c.rotation}):n.createElement(ie,null)},Re=a(17862),Ne=a(601);const Be=(e,t)=>e.toLowerCase().localeCompare(t.toLowerCase());var Le=function({tags:e,fromGroup:t}){let a,r=[];if(t){const t=e.sort(Be).filter((e=>!Ne.rx.includes(e)));a=t.slice(0,3),r=t.slice(3,-1)}else a=e;const l=t?"secondary":"tertiary";return n.createElement(F.A,{component:"ul",direction:"row",gap:.66,flexWrap:"wrap",sx:e=>({"& .MuiChip-root":{fontSize:"0.75rem",height:e.spacing(2.5),padding:0}})},a.sort(Be).map((e=>n.createElement(Re.A,{key:e,title:e===Ne.X3.FILTER_FAVOURITE?"Favourite":e,label:e===Ne.X3.FILTER_FAVOURITE?"❤️":e,size:"small",color:l}))),r.length>0&&n.createElement(Re.A,{variant:"outlined",title:`+${r.length} more tags:\n${r.join("\n")}`,label:`+${r.length} more`,size:"small"}))},Ge=a(43990),$e=a(37603),Oe=a(12070),_e=a(16738),je=a(82139),Ve=a(71053),Ue=a(26564),ze=a(74353),We=a.n(ze);const He=a(33829).A,Xe=(0,n.createContext)(null);function Ye({children:e}){const t=V();return n.createElement(Xe.Provider,{value:t},e)}const Qe=()=>{const e=(0,n.useContext)(Xe);if(!e)throw new Error("useNavigationToolsContext must be used within an NavigationToolsProvider");return e},Ke="NEW_GROUP",qe=e=>e.trim().replace(/[^A-Z0-9_-]+/gi,"_").toLowerCase(),Ze=(e,t)=>e.find((({group:{groups:e}})=>e.find((({id:e})=>e===t))))||null;var Je;!function(e){e.CREATE_NEW="CREATE_NEW",e.EDIT_EXISTING="EDIT_EXISTING",e.NOT_EDITING="NOT_EDITING"}(Je||(Je={}));var et=()=>{const{imageSelection:e}=(0,j.A)(),{editImageGroup:t,cancelEditImageGroup:a}=Y(),{imageGroups:r,addImageGroup:l,updateImageGroup:o,groupImagesAdd:F,ungroupImages:i}=(0,se.h)(),{navigateToGroup:s,navigateToImage:c}=Qe(),{view:u,paths:m,pathsOptions:d}=$(),{path:p}=O(),g=e.length,h=(e=>e?.groupId?e.groupId===Ke?Je.CREATE_NEW:Je.EDIT_EXISTING:Je.NOT_EDITING)(t),f=(0,n.useMemo)((()=>{switch(h){case Je.CREATE_NEW:{const e=t?.newGroupTitle||"";return{imageGroup:null,parentPathMap:m.find((({group:e})=>e.id===u.id))||null,title:e,slug:qe(e),slugTouched:!1}}case Je.EDIT_EXISTING:{const e=r.find((({id:e})=>e===t?.groupId))||null;return{imageGroup:e,parentPathMap:t?.groupId?Ze(m,t.groupId):null,title:e?.title||"",slug:e?.slug||"",slugTouched:!0}}case Je.NOT_EDITING:default:return{imageGroup:null,parentPathMap:null,title:"",slug:"",slugTouched:!1}}}),[t,h,r,m,u]),[E,A]=(0,n.useState)(f.title),[v,b]=(0,n.useState)(f.slug),[y,w]=(0,n.useState)(f.slugTouched),[I,C]=(0,n.useState)(f.parentPathMap?.absolutePath||""),S=(0,n.useMemo)((()=>{if(!t?.groupId)return"";if(t?.groupId===Ke)return`${p}${v}/`;const e=Ze(m,t.groupId);return`${e?.absolutePath||""}${v}/`}),[t,m,p,v]),x=(0,n.useMemo)((()=>!!m.find((({absolutePath:e})=>e===S))),[S,m]),k=(0,n.useMemo)((()=>v!==f.imageGroup?.slug),[f,v]),P=(0,n.useMemo)((()=>!!v&&(h===Je.CREATE_NEW?!x:h===Je.EDIT_EXISTING&&(!k||!x))),[h,v,x,k]),T=(0,n.useMemo)((()=>{const e=m.find((({absolutePath:e})=>e===I))?.group.id||"";return(f.parentPathMap?.group.id||"")!==e}),[f,I,m]),D=(0,n.useMemo)((()=>{switch(h){case Je.EDIT_EXISTING:{const e=m.find((({group:e})=>e.id===t?.groupId))?.absolutePath||"";return d.filter((({value:t})=>!t.startsWith(S)&&t!==e))}case Je.CREATE_NEW:return d;case Je.NOT_EDITING:default:return[]}}),[S,t,h,m,d]);return{editId:t?.groupId||null,absoluteSlug:S,possibleParents:D,slug:v,title:E,canConfirm:P,canMove:T,slugIsInUse:x,slugWasChanged:k,parentSlug:I,selectionCount:g,setSlug:e=>{b(e),w(!0)},setTitle:e=>{A(e),(e.length<2||!y)&&(w(!1),b(qe(e)))},setParentSlug:C,confirm:()=>{if(a(),!P||!t)return;const n=m.find((({absolutePath:e})=>e===I))?.group.id||"";if(t.groupId===Ke){if(!t.newGroupCover)return;const a=He();l({id:a,slug:v,title:E,created:We()(Date.now()).format(ue.i$),coverImage:t.newGroupCover,images:e,groups:[]},n),s(a)}else{if(!f.imageGroup)return;o({...f.imageGroup,slug:v,title:E},n),s(t.groupId)}},move:async()=>{if(a(),!T)return;const t=m.find((({absolutePath:e})=>e===I))?.group.id||"";t?F(t,e):i(e),c(e[0])},cancelEditImageGroup:a}};const tt=()=>{const{view:e}=$(),{dismissDialog:t,setDialog:a}=(0,he.A)(),{setEditImageGroup:r}=Y(),{deleteImageGroup:l,setImageGroups:o,images:F}=(0,se.h)(),{imageSelection:i}=(0,j.A)(),s=(0,n.useMemo)((()=>{if(!i.length)return"";const e=F.filter((({hash:e})=>i.includes(e))).map((({title:e})=>e)).filter((e=>e.length>3)),t=(0,Ve.Hg)(e),a=t.filter((e=>e.length>3))[0]?.trim();return a?a.replace(/[_-]/g," ").replace(/^\s*\d+\s+|\s+\d+\s*$/g,"").trim():"New Group"}),[i,F]);return{resetGroups:()=>{a({message:"Reset image groups?",questions:()=>[{key:"info",type:Ue.V.INFO,label:"This will remove ALL your created groups and all existing images will be moved to the top level."}],confirm:async()=>{t(0),o([])},deny:async()=>{t(0)}})},createGroup:e=>{r({groupId:Ke,newGroupCover:e,newGroupTitle:s})},editGroup:e=>{r({groupId:e})},deleteGroup:n=>{const r=e.groups.find((e=>e.id===n));r&&a({message:"Delete image group?",questions:()=>[{key:"info",type:Ue.V.INFO,label:`This will delete this group "${r.title||r.slug}" and move all children (images & groups) to the current level.`}],confirm:async()=>{t(0),l(n)},deny:async()=>{t(0)}})}}};var at=function({groupId:e,menuAnchor:t,onClose:a}){const{deleteGroup:r,editGroup:l}=tt();return t?n.createElement(Ge.A,{open:!!t,anchorEl:t,onClose:a,onClick:e=>{e.stopPropagation(),a()}},n.createElement($e.A,{onClick:()=>l(e),title:"Edit"},n.createElement(Oe.A,null,n.createElement(d.A,null)),n.createElement(_e.A,null,"Edit")),n.createElement($e.A,{onClick:()=>r(e),title:"Delete"},n.createElement(Oe.A,null,n.createElement(je.A,null)),n.createElement(_e.A,null,"Delete"))):null},nt=a(75665),rt=a(62208),lt=a(34818),ot=a(75710);var Ft=function({selectionText:e,title:t,titleIcon:a,subheader:r,wrapperProps:i,media:s,content:c,contextMenuComponent:u,contextMenuProps:m}){const d=(0,v.A)(),[p,h]=(0,n.useState)(null),f=(0,n.useMemo)((()=>{const t={"@media (any-hover: hover)":{"&:hover":{backgroundColor:(0,b.au)(d.palette.tertiary.main,d.palette.background.paper,.33)}},transition:"background-color 0.15s ease-in-out"};return e?{...t,backgroundColor:(0,b.au)(d.palette.info.main,d.palette.background.paper,.75)}:t}),[e,d]),E=[t,r].filter(Boolean).join("\n");return n.createElement(F.A,{component:"li",direction:"column",justifyContent:"stretch",sx:{position:"relative","& > *":{flexGrow:1}}},e&&n.createElement(y.A,{sx:{position:"absolute",display:"block",width:"1.8em",height:"1.8em",top:"-0.53em",left:"-0.53em",zIndex:25,fontSize:"0.85rem",lineHeight:"1.8em",textAlign:"center",backgroundColor:d.palette.info.main,color:d.palette.info.contrastText,borderRadius:"50%",pointerEvents:"none"}},e),n.createElement(l.A,{sx:f},n.createElement(nt.A,{...i,component:i.component||"span",tabIndex:i.component?void 0:-1},n.createElement(rt.A,{title:a?n.createElement(F.A,{direction:"row",gap:.5,alignItems:"center"},a,t):t,subheader:r,action:n.createElement(g.A,{onClick:e=>{e.preventDefault(),e.stopPropagation(),h(e.target)}},n.createElement(ot.A,null)),slotProps:{title:{title:E,variant:"body1",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},subheader:{title:E,variant:"caption",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}},sx:{gap:1,backgroundColor:(0,b.X4)(d.palette.fgtext.main,.1),p:1,".MuiCardHeader-content":{minWidth:0}}}),n.createElement(lt.A,null,s),c&&n.createElement(o.A,{sx:{p:1,flexGrow:1,justifyContent:"space-between",display:"flex",flexDirection:"column",padding:1,"&:last-child":{padding:1}}},c)),n.createElement(u,{menuAnchor:p,onClose:()=>h(null),...m})))};var it,st=a(27261),ct=a(60318),ut=a(44949);!function(e){e.ADD="add",e.REMOVE="remove"}(it||(it={}));const mt=e=>{const{setEditImages:t}=Y(),{pageSize:a}=(0,u.A)(),{filtersActiveTags:r,sortBy:l,recentImports:o,imageSelection:F,updateImageSelection:i,lastSelectedImage:s,setImageSelection:c}=(0,j.A)(),{palettes:m,images:d}=(0,se.h)(),p=F.indexOf(e),g=(0,n.useMemo)((()=>{const t=d.find((t=>t.hash===e));let a,n=[];if(!t)return;const{palette:r,framePalette:l}=(0,ct.s)(m,t),{invertPalette:o,invertFramePalette:i}=(0,ut.f)(t);if(!r)throw new Error("Palette missing?");return(0,st.pl)(t)?a=r:(a=(r||ue.Fv).palette,n=(l||ue.Fv).palette),{title:t.title,created:t.created,frame:t.frame,hashes:t.hashes||void 0,tags:t.tags,palette:a,framePalette:n,lockFrame:t.lockFrame,invertPalette:o,invertFramePalette:i,rotation:t.rotation,selectionIndex:p,selectionActive:F.length>0}}),[e,p,F,m,d]),{images:h}=$();return{galleryImageData:g,updateImageSelection:(t,n,F)=>{if(n){const t=(0,_.S)(h,{filtersActiveTags:r,sortBy:l,recentImports:o}),n=t.findIndex((t=>t.hash===e));let i=t.findIndex((e=>e.hash===s));-1===i&&(i=F*a);const u=Math.min(i,n),m=Math.max(i,n);c(t.slice(u,m+1).map((e=>e.hash)))}else i(t,[e])},editImage:a=>{t({tags:a,batch:[e]})}}};var dt=function({hash:e}){const{group:t,path:a}=(e=>{const{paths:t,view:a}=$(),n=a.groups.find((({coverImage:t})=>t===e))||null,r=t.find((({group:{id:e}})=>e===n?.id))?.absolutePath||null;return{group:n,path:r}})(e),{galleryImageData:l}=mt(e),{galleryView:o}=(0,u.A)(),F=(0,n.useMemo)((()=>{switch(o){case J.j.GALLERY_VIEW_SMALL:case J.j.GALLERY_VIEW_1X:return{transform:"scale(0.5)",imageRendering:"auto !important"};default:return{transform:"scale(0.5)"}}}),[o]);if(!l||!t)return null;const{hashes:i,palette:s,invertPalette:c,framePalette:m,frame:d,lockFrame:p,rotation:g}=l;return n.createElement(Ft,{selectionText:"",title:t.title,subheader:`${t.images.length} items`,wrapperProps:{component:r.N_,to:`/gallery/${a}page/1`,sx:{textDecoration:"none"}},contextMenuComponent:at,contextMenuProps:{groupId:t.id},media:n.createElement(y.A,{sx:{position:"relative",margin:"0 auto","& > .MuiBox-root":{position:"absolute",top:0,canvas:F}}},n.createElement(te.A,{viewBox:"0 0 24 21",color:"secondary",sx:e=>({width:"100%",height:"100%",fill:(0,b.au)(e.palette.secondary.main,e.palette.fgtext.main,.25)})},n.createElement("path",{d:"M 10,2 H 4 C 2.9,2 2.01,2.9 2.01,4 L 2,16 c 0,1.1 0.9,2 2,2 h 16 c 1.1,0 2,-0.9 2,-2 V 6 C 22,4.9 21.1,4 20,4 h -8 z"})),n.createElement(Me,{lockFrame:p,invertPalette:c,framePalette:m,palette:s,frameId:d,hash:e,hashes:i,rotation:g})),content:t.tags.length>0&&n.createElement(Le,{tags:t.tags,fromGroup:!0})})},pt=a(15279),gt=a(78377),ht=a(61736),ft=a(29308),Et=a(13407),At=a(71246);const vt=e=>{switch(e){case J.j.GALLERY_VIEW_SMALL:return"Smallest";case J.j.GALLERY_VIEW_1X:return"Original Size";case J.j.GALLERY_VIEW_2X:return"Double Size";case J.j.GALLERY_VIEW_MAX:return"Maximum Size";default:return""}};var bt=function(){const{galleryView:e,setGalleryView:t}=(0,u.A)(),{ddpx:a}=Z(),r=a>1?[J.j.GALLERY_VIEW_SMALL,J.j.GALLERY_VIEW_1X,J.j.GALLERY_VIEW_2X,J.j.GALLERY_VIEW_MAX]:[J.j.GALLERY_VIEW_1X,J.j.GALLERY_VIEW_2X,J.j.GALLERY_VIEW_MAX];return n.createElement(gt.A,{value:e,exclusive:!0,onChange:(e,a)=>{a&&t(a)},sx:{"& .MuiToggleButton-root":{width:40,height:40}}},r.map((e=>n.createElement(pt.A,{key:e,value:e,title:vt(e)},(e=>{switch(e){case J.j.GALLERY_VIEW_SMALL:return n.createElement(ft.A,null);case J.j.GALLERY_VIEW_1X:return n.createElement(ht.A,null);case J.j.GALLERY_VIEW_2X:return n.createElement(At.A,null);case J.j.GALLERY_VIEW_MAX:default:return n.createElement(Et.A,null)}})(e)))))},yt=a(72569),wt=a(58760),It=a(77953),Ct=a(29184),St=a(87639),xt=a(36727),kt=a(41756),Pt=a(75961),Tt=a(76584),Dt=a(70802);const Mt=(0,n.createContext)({runWithImage:async()=>{},runWithImages:async()=>{},validateAndAddPlugin:async()=>!1}),Rt=()=>(0,n.useContext)(Mt);var Nt,Bt,Lt,Gt=function({pluginAnchor:e,hash:t,onClose:a}){const{plugins:r}=(0,se.h)(),{imageSelection:l}=(0,j.A)(),{runWithImage:o,runWithImages:F}=Rt();return n.createElement(Ge.A,{open:!!e,anchorEl:e,onClose:a},r.map((({url:e,name:r,description:i,loading:s,error:c})=>n.createElement($e.A,{key:e,disabled:Boolean(s||c),title:`${c||i||""}\n${e}`,onClick:()=>{a(),(e=>{t?o(e,t):F(e,l)})(e)}},c&&n.createElement(Dt.A,{color:"warning"}),s&&n.createElement(Fe.A,{color:"secondary",size:22}),r||e))))};!function(e){e.DELETE="delete",e.ANIMATE="animate",e.DOWNLOAD="download",e.EDIT="edit",e.RGB="rgb"}(Nt||(Nt={})),function(e){e.LOCK_FRAME="lockFrame",e.FRAME="frame",e.PALETTE="palette",e.TITLE="title",e.TAGS="tags",e.CREATED="created",e.ROTATION="rotation"}(Bt||(Bt={})),function(e){e.INVERT_PALETTE="invertPalette",e.FRAME_PALETTE="framePalette",e.INVERT_FRAME_PALETTE="invertFramePalette"}(Lt||(Lt={}));const $t=[Bt.LOCK_FRAME,Bt.FRAME,Bt.TITLE,Bt.TAGS,Bt.CREATED,Bt.ROTATION,Bt.PALETTE,Lt.INVERT_PALETTE,Lt.FRAME_PALETTE,Lt.INVERT_FRAME_PALETTE];var Ot=a(99905);var _t=()=>{const{exportScaleFactors:e,exportFileTypes:t,handleExportFrame:a,fileNameStyle:r}=(0,u.A)(),{frames:l,palettes:o,images:F}=(0,se.h)(),i=(0,ve.j)(e,t,a,o,r);return{downloadSingleImage:(0,n.useCallback)((async e=>{const t=F.find((({hash:t})=>t===e));if(!t)throw new Error("image not found");const a=l.find((({id:e})=>e===t.frame)),{palette:n}=(0,ct.s)(o,t);if(!n)throw new Error("imagePalette not found");const s=(0,Ot.A)({image:t,palette:n,fileNameStyle:r}),c=await(0,ce.T)(F,l)(t.hash),u=a?await(0,me.mZ)(a?.hash):null,m=u?u.upper.length/20:2;if(!c)throw new Error("no tiles");const d=await i(t)(c,m);return(0,ve.R)(s)(d)}),[r,l,F,o,i]),downloadImageCollection:(0,n.useCallback)((async e=>{const t=(0,Ot.A)({altTitle:"gameboy-printer-gallery",useCurrentDate:!0,fileNameStyle:r}),a=await Promise.all(e.map((async e=>{const t=F.find((({hash:t})=>t===e));if(!t)throw new Error("image not found");const a=l.find((({id:e})=>e===t.frame)),n=await(0,ce.T)(F,l)(t.hash),r=a?await(0,me.mZ)(a?.hash):null,o=r?r.upper.length/20:2;return i(t)(n||[],o)})));(0,ve.R)(t)(a.flat())}),[r,l,F,i])}};const jt=e=>(0,z.A)(e.map((({tags:e})=>e)).flat());var Vt=e=>{const{imageSelection:t,sortBy:a,filtersActiveTags:r,recentImports:l,setFiltersVisible:o,setSortOptionsVisible:F,setImageSelection:i}=(0,j.A)(),{plugins:s,images:c}=(0,se.h)(),{pageSize:m}=(0,u.A)(),{setEditImages:d,setEditRGBNImages:p}=Y(),{dismissDialog:g,setDialog:h}=(0,he.A)(),{setVideoSelection:f}=(0,Ee.A)(),{downloadImageCollection:E}=_t(),{deleteImages:A}=Ae(),{view:v,covers:b}=$(),y=e*m,w=(0,_.S)(v.images,{sortBy:a,filtersActiveTags:r,recentImports:l}).splice(y,m||1/0).filter((e=>!b.includes(e.hash))).filter((({hash:e})=>t.includes(e))),I=w.reduce(st.iy,[]),C=(0,n.useMemo)((()=>t.reduce(((e,t)=>{const a=c.find((({hash:e})=>e===t));return a?[a,...e]:e}),[])),[t,c]),S=t.length,x=w.length>0;return{hasPlugins:!!s.length,batchEnabled:!!t.length,monochromeBatchEnabled:w.length>1&&I.length===w.length,activeFilters:r.length||0,selectedImageCount:S,hasSelected:x,batchTask:e=>{if(t.length)switch(e){case Nt.DELETE:h({message:`Delete ${t.length} images?`,confirm:async()=>{A(t)},deny:async()=>g(0)});break;case Nt.ANIMATE:f(t);break;case Nt.DOWNLOAD:E(t);break;case Nt.EDIT:d({tags:jt(C),batch:C.map((({hash:e})=>e))});break;case Nt.RGB:p(C.reduce(st.iy,[]).map((({hash:e})=>e)))}},checkAll:()=>{i((0,_.S)(v.images,{filtersActiveTags:r,sortBy:a,recentImports:l}).slice(e*m,(e+1)*m||void 0).map((({hash:e})=>e)))},unCheckAll:()=>i([]),filter:()=>o(!0),showSortOptions:()=>F(!0)}};const Ut=[Nt.DOWNLOAD,Nt.DELETE,Nt.EDIT,Nt.ANIMATE],zt=[Nt.RGB],Wt=e=>{switch(e){case Nt.DELETE:return"Delete";case Nt.ANIMATE:return"Animate";case Nt.DOWNLOAD:return"Download";case Nt.EDIT:return"Edit";case Nt.RGB:return"Create RGB Images";default:return""}},Ht=e=>{switch(e){case Nt.DELETE:return n.createElement(je.A,null);case Nt.ANIMATE:return n.createElement(kt.A,null);case Nt.DOWNLOAD:return n.createElement(Ct.A,null);case Nt.EDIT:return n.createElement(d.A,null);case Nt.RGB:return n.createElement(Pt.A,null);default:return null}};var Xt=function({page:e}){const{hasPlugins:t,batchEnabled:a,monochromeBatchEnabled:r,activeFilters:l,selectedImageCount:o,hasSelected:F,batchTask:i,checkAll:s,unCheckAll:c,filter:u,showSortOptions:m}=Vt(e),[d,p]=(0,n.useState)(null);return n.createElement(n.Fragment,null,n.createElement(wt.A,{color:"tertiary",variant:"contained",sx:{"& .MuiButton-root":{width:40,height:40}},disableElevation:!0},n.createElement(w.A,{onClick:m,title:"Manage Sorting"},n.createElement(Tt.A,null)),n.createElement(w.A,{onClick:u,title:"Manage Filters"},n.createElement(yt.A,{badgeContent:l,color:"info",anchorOrigin:{vertical:"bottom",horizontal:"right"}},n.createElement(xt.A,null))),n.createElement(w.A,{onClick:F?c:s,title:F?"Uncheck All":"Check All"},n.createElement(yt.A,{badgeContent:o,color:"info",anchorOrigin:{vertical:"bottom",horizontal:"right"}},n.createElement(It.A,null))),Ut.map((e=>n.createElement(w.A,{key:e,disabled:!a,onClick:()=>i(e),title:Wt(e)},Ht(e)))),zt.map((e=>n.createElement(w.A,{key:e,disabled:!r,onClick:()=>i(e),title:Wt(e)},Ht(e)))),t?n.createElement(w.A,{onClick:e=>{p(e.target)},title:"Use Plugin"},n.createElement(St.A,null)):null),n.createElement(Gt,{pluginAnchor:d,onClose:()=>p(null)}))};var Yt=function({isBottom:e,page:t,isSticky:a}){return n.createElement(F.A,{direction:{xs:"column",md:"row"},alignItems:"center",gap:2,justifyContent:"space-between",sx:t=>({zIndex:20,backgroundColor:t.palette.background.default,...a?{position:"sticky",top:"var(--navigation-height)",py:2,my:-2}:{},...e?{"@media (max-height: 900px)":{display:"none"}}:{}})},n.createElement(bt,null),n.createElement(Xt,{page:t}))},Qt=a(54669),Kt=a(90445),qt=a.n(Kt),Zt=a(24057),Jt=a(9033),ea=a(18672),ta=a(50412),aa=a(42106),na=a(12898),ra=a(93577);var la=()=>{const{exportScaleFactors:e,exportFileTypes:t,handleExportFrame:a,fileNameStyle:r}=(0,u.A)(),{frames:l,palettes:o,images:F}=(0,se.h)();return{shareImage:(0,n.useCallback)((async n=>{const i=F.find((({hash:e})=>n===e));if(!i)throw new Error("image not found");const s=l.find((({id:e})=>e===i.frame)),c=[...e].pop()||4,u=[...t].pop()||"png",m=(0,ve.j)([c],[u],a,o,r),d=await(0,ce.T)(F,l)(i.hash),p=s?await(0,me.mZ)(s?.hash):null,g=p?p.upper.length/20:2,h=await m(i)(d||[],g),{blob:f,filename:E,title:A}=h[0];window.navigator.share&&window.navigator.share({files:[new File([f],E,{type:"image/png",lastModified:Date.now()})],title:A}).catch((()=>"¯\\_(ツ)_/¯"))}),[t,e,r,l,a,F,o])}};let oa=null;const Fa=()=>{if(null===oa)try{oa=window.navigator.canShare({files:[new File([new Blob(["t","e","s","t"])],"test.txt",{type:"text/plain",lastModified:Date.now()})]})}catch(e){oa=!1}return oa||!1};var ia;!function(e){e.EDIT="edit",e.DOWNLOAD="download",e.DELETE="delete",e.SHARE="share",e.SELECT="select",e.VIEW="view",e.FAVOURITE="favourite",e.PLUGINS="plugins"}(ia||(ia={}));const sa=e=>{const{imageSelection:t,updateImageSelection:a,filtersActiveTags:r,sortBy:l,recentImports:o}=(0,j.A)(),{setLightboxImage:F}=(0,Ee.A)(),{plugins:i,updateImageFavouriteTag:s}=(0,se.h)(),{view:c,covers:u}=$(),{setEditImages:m}=Y(),{dismissDialog:d,setDialog:p}=(0,he.A)(),{updateLastSyncLocalNow:g,deleteImages:h}=Ae(),{downloadSingleImage:f}=_t(),{shareImage:E}=la(),{images:A}=(0,se.h)(),v=(0,n.useMemo)((()=>A.find((t=>t.hash===e))),[e,A]),b=t.includes(e);return{hasPlugins:!!i.length,isSelected:b,isFavourite:v?.tags.includes(Ne.X3.FILTER_FAVOURITE)||!1,hasMeta:!!v?.meta,canShare:Fa(),startDownload:()=>f(e),deleteImage:()=>{p({message:v?.title?`Delete image "${v.title}"?`:"Delete this image?",confirm:async()=>{h([e])},deny:async()=>d(0)})},shareImage:()=>E(e),showMetadata:()=>{p({message:v?.title?`Meta-Info for "${v.title}"`:"Meta-Info",questions:()=>[{type:Ue.V.INFO,label:JSON.stringify(v?.meta),key:"meta"}],confirm:async()=>d(0)})},updateImageToSelection:t=>{a(t,[e])},setLightboxImage:()=>{F((0,_.S)(c.images,{filtersActiveTags:r,sortBy:l,recentImports:o}).filter((e=>!u.includes(e.hash))).findIndex((t=>e===t.hash)))},updateFavouriteTag:t=>{s(t,e),g()},editImage:()=>{m({tags:v?.tags||[],batch:[e]})}}};We().extend(qt());var ca=function({hash:e,menuAnchor:t,onClose:a}){const[r,l]=(0,n.useState)(null),{enableImageGroups:o}=(0,u.A)(),{canShare:F,isSelected:i,hasPlugins:s,isFavourite:c,hasMeta:m,deleteImage:p,setLightboxImage:g,shareImage:h,startDownload:f,showMetadata:E,updateImageToSelection:A,updateFavouriteTag:v,editImage:b}=sa(e),{createGroup:y}=tt();return t?n.createElement(Ge.A,{open:!!t,anchorEl:t,onClose:a,onClick:e=>{e.stopPropagation()}},n.createElement($e.A,{onClick:()=>{A(i?j.N.REMOVE:j.N.ADD),a()},title:i?"Remove from selection":"Add to selection"},n.createElement(Oe.A,null,i?n.createElement(Zt.A,null):n.createElement(It.A,null)),n.createElement(_e.A,null,i?"Remove from selection":"Add to selection")),n.createElement($e.A,{onClick:()=>{b(),a()},title:"Edit"},n.createElement(Oe.A,null,n.createElement(d.A,null)),n.createElement(_e.A,null,"Edit")),n.createElement($e.A,{onClick:()=>{f(),a()},title:"Download"},n.createElement(Oe.A,null,n.createElement(Ct.A,null)),n.createElement(_e.A,null,"Download")),n.createElement($e.A,{onClick:()=>{p(),a()},title:"Delete"},n.createElement(Oe.A,null,n.createElement(je.A,null)),n.createElement(_e.A,null,"Delete")),n.createElement($e.A,{onClick:()=>{g(),a()},title:"View in Lightbox"},n.createElement(Oe.A,null,n.createElement(na.A,null)),n.createElement(_e.A,null,"View in Lightbox")),s?n.createElement(n.Fragment,null,n.createElement(Gt,{pluginAnchor:r,hash:e,onClose:()=>{l(null),a()}}),n.createElement($e.A,{onClick:e=>{l(e.target)},title:"Use Plugin"},n.createElement(Oe.A,null,n.createElement(St.A,null)),n.createElement(_e.A,null,"Use Plugin"))):null,F?n.createElement($e.A,{onClick:()=>{h(),a()},title:"Share"},n.createElement(Oe.A,null,n.createElement(ra.A,null)),n.createElement(_e.A,null,"Share")):null,n.createElement($e.A,{onClick:()=>{v(!c),a()},title:c?"Remove from favourites":"Add to favourites"},n.createElement(Oe.A,null,c?n.createElement(aa.A,null):n.createElement(ta.A,null)),n.createElement(_e.A,null,c?"Remove from favourites":"Add to favourites")),m&&n.createElement($e.A,{onClick:()=>{E(),a()},title:"Show Metadata"},n.createElement(Oe.A,null,n.createElement(Jt.A,null)),n.createElement(_e.A,null,"Show Metadata")),i&&o&&n.createElement($e.A,{onClick:()=>{y(e),a()},title:"Create Group"},n.createElement(Oe.A,null,n.createElement(ea.A,null)),n.createElement(_e.A,null,"Create Group"))):null},ua=a(35124);const ma=(e,t)=>({flexGrow:0,flexShrink:1,wordBreak:"break-all",whiteSpace:"no-wrap",overflow:"hidden",width:"100%",borderRadius:"3px",...t});var da=function({text:e}){const{enableDebug:t}=(0,u.A)();return t?n.createElement(ua.A,{title:e,variant:"caption",fontFamily:"monospace",component:"pre",sx:e=>ma(0,{px:.5,py:0,mt:1,mb:0,backgroundColor:e.palette.warning[e.palette.mode]})},e):null},pa=a(55534);var ga=()=>{try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}};We().extend(qt());var ha=function({page:e,hash:t}){const{enableDebug:a}=(0,u.A)(),{galleryImageData:r,updateImageSelection:l,editImage:o}=mt(t),{formatter:F}=(()=>{const{hideDates:e,preferredLocale:t}=(0,u.A)();return{formatter:(0,n.useCallback)((a=>e||!a?null:(0,pa.A)(We()(a,ue.i$),t)),[e,t])}})(),i=(0,Qt.HZ)((()=>{ga()&&l(-1!==r?.selectionIndex?j.N.REMOVE:j.N.ADD,!1,e)})),s=(0,n.useMemo)((()=>[t,...r?.hashes?Object.keys(r.hashes).map((e=>`${e.toUpperCase()}: ${r.hashes?.[e]}`)):[]].filter(Boolean).join("\n")),[r,t]),c=(0,n.useCallback)((t=>{l(-1!==r?.selectionIndex?j.N.REMOVE:j.N.ADD,t,e)}),[r,e,l]);if(!r)return null;const{created:m,hashes:d,palette:p,invertPalette:g,invertFramePalette:h,framePalette:f,frame:E,lockFrame:A,title:v,tags:b,selectionIndex:y,selectionActive:w,rotation:I}=r;return n.createElement(Ft,{selectionText:-1!==y?(y+1).toString(10):"",title:v,subheader:F(m),wrapperProps:{...i(),onClick:e=>{e.preventDefault(),e.ctrlKey||e.shiftKey?c(e.shiftKey):ga()&&w?c(!1):o(b)},disableRipple:!0,sx:{display:"block",width:"100%",textAlign:"left"}},contextMenuComponent:ca,contextMenuProps:{hash:t},media:n.createElement(Me,{lockFrame:A,invertPalette:g,palette:p,framePalette:f,invertFramePalette:h,frameId:E,hash:t,hashes:d,rotation:I}),content:(b.length>0||s&&a)&&n.createElement(n.Fragment,null,n.createElement(Le,{tags:b}),n.createElement(da,{text:s}))})};var fa=function(e){return n.createElement(ua.A,{component:"h2",variant:"caption"},`${e.imageCount} images`,e.filteredCount?` / ${e.filteredCount} filtered`:null,e.selectedCount?` / ${e.selectedCount} selected`:null)},Ea=a(25508),Aa=a.n(Ea),va=a(67221),ba=a(60446);const ya=(0,ba.A)("percentage",ba.U.DESC),wa=()=>{const[e,t]=(0,n.useState)([]);return(0,n.useEffect)((()=>{window.setTimeout((async()=>{const e=await(navigator.storage?.estimate())||null,a=(()=>{let e=0;for(const t in localStorage)if(localStorage.hasOwnProperty(t)){const a=localStorage.getItem(t);null!==a&&(e+=t.length+a.length)}return e})(),n=a+(()=>{const e="__test_localStorage_limit__";let t=0,a=15728640,n=0;try{for(;t<=a;){const r=Math.floor((t+a)/2),l="A".repeat(r);try{localStorage.setItem(e,l),n=r,t=r+1}catch{a=r-1}}}finally{localStorage.removeItem(e)}return n})();t([{type:"indexedDB",total:n,used:a,percentage:Math.ceil(a/n*100)},{type:"localStorage",total:e?.quota||0,used:e?.usage||0,percentage:Math.ceil(n?(e?.usage||0)/(e?.quota||1)*100:100)}])}),10)}),[]),{storageEstimate:ya(e.filter((({percentage:e})=>e>75)))[0]||null}};var Ia=function(){const{storageEstimate:e}=wa();return e?n.createElement(y.A,{title:`Using ${Aa()(e.used)} of ${Aa()(e.total)}`,sx:{position:"relative"}},n.createElement(va.A,{variant:"determinate",value:e.percentage,sx:{width:"100%",height:"34px"},color:"error"}),n.createElement(ua.A,{variant:"body2",color:"bg",sx:{position:"absolute",p:1,top:0}},`You are using ${e.percentage}% of your browser's ${(e=>{switch(e){case"indexedDB":return"indexed DB";case"localStorage":return"local storage";default:return e}})(e.type)}. Be aware for now saving images will not be possible once you hit the limit.`)):null},Ca=a(60527),Sa=a(66277),xa=a(4676),ka=a(93746),Pa=a(7797),Ta=a(74035);var Da=function(e){const{path:t}=O();return n.createElement(w.A,{component:e.disabled?"span":r.N_,disabled:e.disabled,to:`/gallery/${t}page/${e.page+1}`,title:`To page ${e.page+1}`},e.children)},Ma=a(30985),Ra=a(16521);var Na=(e,t,a)=>[...e].filter((0,Ra.A)(t,a)).filter((0,Ma.A)(t)).length;var Ba=function({page:e}){const{view:t}=$(),{pageSize:a}=(0,u.A)(),{filtersActiveTags:r,recentImports:l}=(0,j.A)(),o=(0,n.useMemo)((()=>a?Math.ceil(Na(t.images,r,l)/a)-1:0),[r,a,l,t]);if(0===o)return null;const i=[{icon:n.createElement(Sa.A,null),pageIndex:e-1,disabled:e<1},null,{icon:n.createElement(xa.A,null),pageIndex:e+1,disabled:o<e+1}];return o>5&&(i.unshift({icon:n.createElement(ka.A,null),pageIndex:e-5,disabled:e<5}),i.push({icon:n.createElement(Pa.A,null),pageIndex:e+5,disabled:o<e+5})),o>1&&(i.unshift({icon:n.createElement(Ca.A,null),pageIndex:0,disabled:0===e}),i.push({icon:n.createElement(Ta.A,null),pageIndex:o,disabled:e===o})),n.createElement(F.A,{direction:"row",justifyContent:"space-around"},n.createElement(wt.A,{color:"tertiary",variant:"contained",disableElevation:!0,sx:{"& .MuiButton-root":{width:40,height:40}}},i.map((t=>{if(!t)return n.createElement(ua.A,{key:"current",component:"span",variant:"body1",sx:{px:2,display:"flex",alignItems:"center"}},`${e+1}/${o+1}`);const{icon:a,pageIndex:r,disabled:l}=t;return n.createElement(Da,{key:r,page:r,disabled:l},a)}))))};var La=function(){const{imageCount:e,selectedCount:t,filteredCount:a,page:l,images:o,covers:i}=(()=>{const{view:e,covers:t}=$(),{pageSize:a}=(0,u.A)(),{imageSelection:n,filtersActiveTags:l,recentImports:o,sortBy:F}=(0,j.A)(),{images:i}=(0,se.h)(),s=i.length,c=Na(e.images,l,o),{pageIndex:m,path:d}=O(),p=(0,r.Zp)(),g=a?Math.ceil(s/a):1,h=Math.max(0,g-1),f=Math.max(0,Math.min(m,h));f!==m&&p(`/gallery/${d}page/${f+1}`);const E=f*a,A=a;return{imageCount:s,selectedCount:n.length,filteredCount:c,page:f,images:(0,_.S)(e.images,{filtersActiveTags:l,recentImports:o,sortBy:F}).splice(E,A||1/0),covers:t}})(),{enableImageGroups:s}=(0,u.A)();return n.createElement(F.A,{direction:"column",gap:2},n.createElement(Ia,null),n.createElement(fa,{imageCount:e,selectedCount:t,filteredCount:a}),s?n.createElement(Q,null):null,n.createElement(Yt,{page:l,isSticky:!0}),n.createElement(Ba,{page:l}),n.createElement(ee,null,o.map((e=>i.includes(e.hash)?n.createElement(dt,{key:e.hash,hash:e.hash}):n.createElement(ha,{key:e.hash,hash:e.hash,page:l})))),o.length<3?null:n.createElement(n.Fragment,null,n.createElement(Ba,{page:l}),n.createElement(Yt,{page:l,isBottom:!0})))},Ga=a(14776);var $a=e=>{const{printerUrl:t,printerParams:a}=(0,u.A)(),r=a?`#${encodeURI(a)}`:"",l=t?`${t}remote.html${r}`:void 0,{printerFunctions:o}=(0,Ee.A)(),F=o.length>0,[i,s]=(0,n.useState)(!1),[c,m]=(0,n.useState)(!1),d=(0,n.useRef)();return(0,n.useEffect)((()=>(i||c||d.current||(d.current=window.setTimeout((()=>{m(!0)}),e)),()=>{window.clearTimeout(d.current)})),[c,i,e]),!i&&F&&(window.clearTimeout(d.current),s(!0)),{failed:c,loaded:i,printerUrl:l,printerConnected:F}};var Oa=function(){const{printerUrl:e,failed:t,loaded:a,printerConnected:r}=$a(5e3);return(e=>{if(!e)return!1;if(e.startsWith("/"))return!0;const{protocol:t}=new URL(e),{protocol:a}=new URL(window.location.href);return"http:"===a||a===t})(e)&&!t?n.createElement(y.A,{sx:{display:"flex",justifyContent:"center"}},n.createElement("iframe",{style:{position:"absolute",top:"80px",left:"-200vw",width:"480px",height:"90px"},title:"Transfer window",src:e}),!a&&n.createElement(Fe.A,{color:"secondary"})):(!r||t)&&n.createElement(wt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{onClick:()=>{window.open(e,"remoteprinter","width=480,height=400")}},"Open printer page"))},_a=a(31965),ja=a.n(_a),Va=a(88943),Ua=a(49565),za=a(54026),Wa=a(51361),Ha=a(94963),Xa=a(96120),Ya=a(86700),Qa=a(78828);const Ka=(0,n.createContext)({callRemoteFunction:async()=>{}}),qa=()=>{const{printerData:e,printerFunctions:t,printerBusy:a}=(0,Ee.A)(),{callRemoteFunction:r}=(0,n.useContext)(Ka);return{printerData:e,printerFunctions:t,printerBusy:a,printerConnected:t.length>0,callRemoteFunction:r}};var Za;!function(e){e.TESTFILE="testFile",e.CHECKPRINTER="checkPrinter",e.FETCHIMAGES="fetchImages",e.CLEARPRINTER="clearPrinter",e.TEAR="tear"}(Za||(Za={}));const Ja={testFile:"Print test image",checkPrinter:"Check Printer",fetchImages:"",clearPrinter:"Clear Printer",tear:"Tear"};var en=function(){const{printerData:e,printerFunctions:t,printerConnected:a,callRemoteFunction:r,printerBusy:l}=qa();return a?n.createElement(F.A,{direction:"column",gap:2},n.createElement(wt.A,{variant:"contained",fullWidth:!0},t.map((a=>n.createElement(w.A,{key:a,disabled:l||[Za.FETCHIMAGES,Za.CLEARPRINTER,Za.TEAR].includes(a)&&!e?.dumps?.length,onClick:()=>r(a)},a===Za.FETCHIMAGES?((e,t)=>e.includes(Za.TEAR)||!t?"Fetch images":`Fetch ${t||0} images`)(t,e?.dumps?.length||0):Ja[a])))),e?.message?n.createElement(Va.A,{severity:"info"},e?.message):null,e?.fs&&e?.dumps?n.createElement(Xa.A,{component:Ua.A},n.createElement(za.A,{sx:{minWidth:650},size:"small","aria-label":"a dense table"},n.createElement(Ya.A,null,n.createElement(Qa.A,null,n.createElement(Ha.A,{align:"right"},"Printer Filesystem"),n.createElement(Ha.A,{align:"left"}))),n.createElement(Wa.A,null,n.createElement(Qa.A,null,n.createElement(Ha.A,{align:"right"},"Total"),n.createElement(Ha.A,{align:"left"},ja()(e?.fs.total))),n.createElement(Qa.A,null,n.createElement(Ha.A,{align:"right"},"Used"),n.createElement(Ha.A,{align:"left"},ja()(e?.fs.used))),n.createElement(Qa.A,null,n.createElement(Ha.A,{align:"right"},"Free"),n.createElement(Ha.A,{align:"left"},`${Math.max(0,(e?.fs.maximages||0)-(e?.dumps.length||0))} images`)),n.createElement(Qa.A,null,n.createElement(Ha.A,{align:"right"},"Images"),n.createElement(Ha.A,{align:"left"},e?.dumps.length))))):null):null},tn=a(28025);var an=a(90521);const nn=e=>{e.fillStyle="#000",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.filter="grayscale(1)",e.imageSmoothingEnabled=!1};var rn=(e,t=!1)=>new Promise(((a,n)=>{const r=document.createElement("img"),l=document.createElement("canvas");l.width=160;const o=l.getContext("2d");o?(r.onerror=n,r.onload=()=>{let n;const F=r.naturalWidth,i=r.naturalHeight;.875===i/F?(l.height=144,n=r.naturalWidth/128,t||nn(o),o.drawImage(r,0,0,F,i,16,16,l.width-32,l.height-32)):(l.height=l.width*i/F,n=F/160,t||nn(o),o.drawImage(r,0,0,F,i,0,0,l.width,l.height));const s=o.getImageData(0,0,l.width,l.height);a({imageData:s,scaleFactor:n,width:l.width,height:l.height,fileName:e.name,lastModified:e.lastModified||null})},(0,tn.A)(e,tn.Z.DATA_URL).then((e=>{r.src=e}))):n(new Error("No canvas context"))}));var ln=({baseValues:e,orderPatterns:t})=>{const a=[];for(let n=0;n<4;n+=1){const r=[];a.push(r);for(let a=0;a<4;a+=1){const l=[];r.push(l);for(let r=0;r<3;r+=1)l.push(e[r][t[r][4*n+a]])}}return a};const on=[0,12,3,15,8,4,11,7,2,14,1,13,10,6,9,5],Fn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var sn=(e,t)=>{const a=(t-e)/16;return new Array(16).fill(null).map(((t,n)=>Math.floor(e+a*n)))};var cn=e=>{const t="number"==typeof e[0]?e[0]:0,a="number"==typeof e[1]?e[1]:85,n="number"==typeof e[2]?e[2]:170,r="number"==typeof e[3]?e[3]:255;return[sn(t,a),sn(a,n),sn(n,r)]},un=a(96763);let mn=0;const dn=({imageData:e,contrastBaseValues:t,dither:a,colors:n})=>{const r=new ImageData(e.width,e.height),l=ln({baseValues:cn(t),orderPatterns:[a?on:Fn,a?on:Fn,a?on:Fn]}),o=e.width,F=e.data;for(let e=0;e<F.length;e+=4){const t=mn%o%4,a=Math.ceil(mn/o)%4,i=F[e];let s;const c=l[t][a];s=i<=c[0]?n[3]:i<=c[1]?n[2]:i<=c[2]?n[1]:n[0],r.data[e]=s.r,r.data[e+1]=s.g,r.data[e+2]=s.b,r.data[e+3]=255,mn+=1}return r},pn=[0,256,1,257],gn=e=>{const t=[];for(let a=0;a<8;a+=1){let n=0;for(let t=0;t<8;t+=1){n+=pn[e[8*a+t]]<<7-t}t.push((n>>8).toString(16).padStart(2,"0"),(255&n).toString(16).padStart(2,"0"))}return t.join(" ").toUpperCase()},hn=({bitmapQueue:e,dither:t,contrastBaseValues:a})=>{const{importQueueAdd:n}=fe.getState();e.forEach((async({imageData:e,height:r,fileName:l,lastModified:o})=>{const{data:F}=dn({imageData:e,contrastBaseValues:a,dither:t,colors:[{r:0,g:0,b:0},{r:1,g:0,b:0},{r:2,g:0,b:0},{r:3,g:0,b:0}]}),i=Array.from(F).filter(((e,t)=>!(t%4))),s=20*Math.ceil(r/8),c=(e=>t=>{const a=t%20,n=Math.floor(t/20),r=8*a,l=8*n;return new Array(8).fill(null).map(((t,a)=>e.slice(r+160*(l+a)).slice(0,8))).flat(1)})(i),u=new Array(s).fill(null).map(((e,t)=>c(t))).map(gn),{dataHash:m}=await(0,an.cg)(u);n([{fileName:l,imageHash:m,tiles:u,lastModified:o,tempId:He()}])}))};var fn=a(41851);var En,An=e=>{const t=e.split("\n").map((e=>e.trim())).filter((e=>e.length&&0!==e.indexOf("//")&&0!==e.indexOf("/*"))).map((e=>e.split(" "))).flat().map((e=>parseInt(e,16))).filter((e=>!isNaN(e)));return(0,fn.gV)(t)};!function(e){e.NEW_LINES="NEW_LINES",e.IMAGE_COMPLETE="IMAGE_COMPLETE",e.PARSE_ERROR="PARSE_ERROR"}(En||(En={}));var vn=e=>{if("#"===e.charAt(0)||"/"===e.charAt(0))return null;if("!"===e.charAt(0)||"{"===e.charAt(0)){try{const{command:t,margin_lower:a}=JSON.parse(e.slice(e.indexOf("{")).trim());if("PRNT"===t&&a>0)return{type:En.IMAGE_COMPLETE}}catch(e){return{type:En.PARSE_ERROR,payload:"Error while trying to parse JSON data command block"}}return null}const t=e.replace(/[^0-9A-F]/gi,"");return t.length?{type:En.NEW_LINES,payload:[t]}:null},bn=a(96763);var yn=(e,t)=>{const a=`${e}\n${ue.Ys}`.split("\n").map(vn).reduce(((e,t)=>{switch(t?.type){case En.NEW_LINES:return e[e.length-1].push(...t.payload),e;case En.IMAGE_COMPLETE:return[...e,[]];default:return e}}),[[]]).filter((e=>e.length>0));return a.length||bn.warn(`File ${t} did not contain images`),a};var wn=a(57402),In=a.n(wn),Cn=a(86344),Sn=a.n(Cn),xn=a(10894);var kn=(e,t,a)=>{if(!t)return"";const n=e=>a.find((({id:t})=>t===e)),r=(e+1).toString(10).padStart(2,"0"),l=n(`${t}${r}`);if(l?.hash)return l.hash;if("jp"===t){const e=n(`int${r}`);if(e?.hash)return e.hash}const o=n(`${t}01`);if(o?.hash)return o.hash;if("jp"!==t){const e=n(`int${r}`);if(e?.hash)return e.hash}return n("int01")?.hash||""};const Pn={86:"A",87:"B",88:"C",89:"D",90:"E",91:"F",92:"G",93:"H",94:"I",95:"J",96:"K",97:"L",98:"M",99:"N",100:"O",101:"P",102:"Q",103:"R",104:"S",105:"T",106:"U",107:"V",108:"W",109:"X",110:"Y",111:"Z",112:"_",113:"'",114:",",115:".",116:"Á",117:"Â",118:"À",119:"Ä",120:"É",121:"Ê",122:"È",123:"Ë",124:"Í",125:"Ï",126:"Ó",127:"Ö",128:"Ú",129:"Ü",130:"Ñ",131:"-",132:"&",133:"!",134:"?",135:" ",136:"a",137:"b",138:"c",139:"d",140:"e",141:"f",142:"g",143:"h",144:"i",145:"j",146:"k",147:"l",148:"m",149:"n",150:"o",151:"p",152:"q",153:"r",154:"s",155:"t",156:"u",157:"v",158:"w",159:"x",160:"y",161:"z",162:"•",163:"~",164:"📱",165:" ",166:"á",167:"â",168:"à",169:"ä",170:"é",171:"ê",172:"è",173:"ë",174:"í",175:"ï",176:"ó",177:"ö",178:"ú",179:"ü",180:"ñ",181:"ḉ",182:"ß",183:"😄",184:"😟",185:"😅",186:"0",187:"1",188:"2",189:"3",190:"4",191:"5",192:"6",193:"7",194:"8",195:"9",196:"/",197:":",198:"~",199:'"',200:"@"},Tn={1:"あ",2:"い",3:"う",4:"え",5:"お",6:"か",7:"き",8:"く",9:"け",10:"こ",11:"さ",12:"し",13:"す",14:"せ",15:"そ",16:"た",17:"ち",18:"つ",19:"て",20:"と",21:"な",22:"に",23:"ぬ",24:"ね",25:"の",26:"は",27:"ひ",28:"ふ",29:"へ",30:"ほ",31:"ま",32:"み",33:"む",34:"め",35:"も",36:"や",37:"ゆ",38:"よ",39:"、",40:"。",41:"ら",42:"り",43:"る",44:"れ",45:"ろ",46:"わ",47:"を",48:"ん",49:"〜",50:"♥",51:"が",52:"ぎ",53:"ぐ",54:"げ",55:"ご",56:"ざ",57:"じ",58:"ず",59:"ぜ",60:"ぞ",61:"だ",62:"ぢ",63:"づ",64:"で",65:"ど",66:"ば",67:"び",68:"ぶ",69:"べ",70:"ぼ",71:"ぱ",72:"ぴ",73:"ぷ",74:"ぺ",75:"ぽ",76:"っ",77:"ゃ",78:"ゅ",79:"ょ",80:"・",81:"ぁ",82:"ぃ",83:"ぅ",84:"ぇ",85:"ぉ",86:"ア",87:"イ",88:"ウ",89:"エ",90:"オ",91:"カ",92:"キ",93:"ク",94:"ケ",95:"コ",96:"サ",97:"シ",98:"ス",99:"セ",100:"ソ",101:"タ",102:"チ",103:"ツ",104:"テ",105:"ト",106:"ナ",107:"ニ",108:"ヌ",109:"ネ",110:"ノ",111:"ハ",112:"ヒ",113:"フ",114:"ヘ",115:"ホ",116:"マ",117:"ミ",118:"ム",119:"メ",120:"モ",121:"ヤ",122:"ユ",123:"ヨ",124:"!",125:"?",126:"ラ",127:"リ",128:"ル",129:"レ",130:"ロ",131:"ワ",132:"ヲ",133:"ン",134:"ヴ",135:" ",136:"ガ",137:"ギ",138:"グ",139:"ゲ",140:"ゴ",141:"ザ",142:"ジ",143:"ズ",144:"ゼ",145:"ゾ",146:"ダ",147:"ヂ",148:"ヅ",149:"デ",150:"ド",151:"バ",152:"ビ",153:"ブ",154:"ベ",155:"ボ",156:"パ",157:"ピ",158:"プ",159:"ペ",160:"ポ",161:"ッ",162:"ャ",163:"ュ",164:"ョ",165:"ー",166:"ァ",167:"ィ",168:"ゥ",169:"ェ",170:"ォ",171:"A",172:"B",173:"C",174:"D",175:"E",176:"F",177:"G",178:"H",179:"I",180:"J",181:"K",182:"L",183:"M",184:"N",185:"O",186:"P",187:"Q",188:"R",189:"S",190:"T",191:"U",192:"V",193:"W",194:"X",195:"Y",196:"Z",197:"_",198:"'",199:",",200:".",201:"a",202:"b",203:"c",204:"d",205:"e",206:"f",207:"g",208:"h",209:"i",210:"j",211:"k",212:"l",213:"m",214:"n",215:"o",216:"p",217:"q",218:"r",219:"s",220:"t",221:"u",222:"v",223:"w",224:"x",225:"y",226:"z",227:"📱",228:"😅",229:"😄",230:"_",231:"0",232:"1",233:"2",234:"3",235:"4",236:"5",237:"6",238:"7",239:"8",240:"9",241:"/",242:":",243:"~",244:'"',245:"@"},Dn="00123456789?????";var Mn;!function(e){e.PHOTO="photo",e.STOCK="stock",e.PXLR="pxlr"}(Mn||(Mn={}));const Rn=2,Nn=0,Bn=0,Ln=1,Gn=2,$n=3,On=4,_n=16,jn=5,Vn=17,Un=6,zn=18,Wn=7,Hn=19,Xn=8,Yn=20,Qn=21,Kn=9,qn=22,Zn=23,Jn=10,er=24,tr=11,ar=25,nr=12,rr=26,lr=13,or=27,Fr=28,ir=14,sr=29,cr=15,ur=30,mr=31,dr=0,pr=32,gr=64,hr=96,fr=128,Er=0,Ar=0,vr=16,br=32,yr=48,wr=64,Ir=80,Cr=96,Sr=112,xr=8,kr=0,Pr=0,Tr=1,Dr=2,Mr=3,Rr=4,Nr=5,Br=6,Lr=7,Gr=0,$r=128,Or=64,_r=31,jr=30,Vr=29,Ur=28,zr=27,Wr=26,Hr=25,Xr=24,Yr=23,Qr=22,Kr=21,qr=20,Zr=19,Jr=18,el=17,tl=16,al=15,nl=14,rl=13,ll=12,ol=11,Fl=10,il=9,sl=8,cl=7,ul=6,ml=5,dl=4,pl=3,gl=2,hl=1,fl=0,El=32,Al=33,vl=34,bl=35,yl=36,wl=37,Il=38,Cl=39,Sl=40,xl=41,kl=42,Pl=43,Tl=44,Dl=45,Ml=46,Rl=47,Nl=48,Bl=49,Ll=50,Gl=51,$l=52,Ol=53,_l=54,jl=55,Vl=56,Ul=57,zl=58,Wl=59,Hl=60,Xl=61,Yl=62,Ql=63,Kl=0,ql=1,Zl=0,Jl=16,eo={thumbnailByteCapture:0,thumbnailByteEdgegains:16,thumbnailByteExposureHigh:32,thumbnailByteExposureLow:48,thumbnailByteEdmovolt:198,thumbnailByteVoutzero:214,thumbnailByteDitherset:230,thumbnailByteContrast:246},to={thumbnailByteCapture:200,thumbnailByteEdgegains:201,thumbnailByteExposureHigh:203,thumbnailByteExposureLow:202,thumbnailByteEdmovolt:204,thumbnailByteVoutzero:205,thumbnailByteDitherset:200,thumbnailByteContrast:200},ao=(e,t)=>{const a=.016*e+4.096*t;return a<10?`${a.toFixed(1)}ms`:`${Math.floor(a)}ms`},no=e=>{switch(e){case Rn:return"positive";case Nn:return"negative";default:return"unknown"}},ro=e=>{switch(e){case fr:return"on";case Er:return"off";default:return"unknown"}},lo=e=>{switch(e){case dr:return"none";case pr:return"horizontal";case gr:return"vertical";case hr:return"2d";default:return"unknown"}},oo=e=>{switch(e){case Bn:return"14.0";case Ln:return"15.5";case Gn:return"17.0";case $n:return"18.5";case On:return"20.0";case _n:return"20.0 (d)";case jn:return"21.5";case Vn:return"21.5 (d)";case Un:return"23.0";case zn:return"23.0 (d)";case Wn:return"24.5";case Hn:return"24.5 (d)";case Xn:return"26.0";case Yn:return"26.0 (d)";case Qn:return"27.5";case Kn:return"29.0";case qn:return"29.0 (d)";case Zn:return"30.5";case Jn:return"32.0";case er:return"32.0 (d)";case tr:return"35.0";case ar:return"35.0 (d)";case nr:return"38.0";case rr:return"38.0 (d)";case lr:return"41.0";case or:return"41.0 (d)";case Fr:return"44.0";case ir:return"45.5";case sr:return"47.0";case cr:return"51.5";case ur:return"51.5 (d)";case mr:return"57.5";default:return"unknown"}},Fo=e=>{switch(e){case Ar:return"50%";case vr:return"75%";case br:return"100%";case yr:return"125%";case wr:return"200%";case Ir:return"300%";case Cr:return"400%";case Sr:return"500%";default:return"unknown"}},io=e=>{switch(e){case xr:return"on";case kr:return"off";default:return"unknown"}},so=e=>{switch(e){case Pr:return"0.0V";case Tr:return"0.5V";case Dr:return"1.0V";case Mr:return"1.5V";case Rr:return"2.0V";case Nr:return"2.5V";case Br:return"3.0V";case Lr:return"3.5V";default:return"unknown"}},co=e=>{switch(e){case Gr:return"none";case $r:return"positive";case Or:return"negative";default:return"unknown"}},uo=e=>{switch(e){case _r:return"-0.992mV";case jr:return"-0.960mV";case Vr:return"-0.928mV";case Ur:return"-0.896mV";case zr:return"-0.864mV";case Wr:return"-0.832mV";case Hr:return"-0.800mV";case Xr:return"-0.768mV";case Yr:return"-0.736mV";case Qr:return"-0.704mV";case Kr:return"-0.672mV";case qr:return"-0.640mV";case Zr:return"-0.608mV";case Jr:return"-0.576mV";case el:return"-0.544mV";case tl:return"-0.512mV";case al:return"-0.480mV";case nl:return"-0.448mV";case rl:return"-0.416mV";case ll:return"-0.384mV";case ol:return"-0.352mV";case Fl:return"-0.320mV";case il:return"-0.288mV";case sl:return"-0.256mV";case cl:return"-0.224mV";case ul:return"-0.192mV";case ml:return"-0.160mV";case dl:return"-0.128mV";case pl:return"-0.096mV";case gl:return"-0.064mV";case hl:return"-0.032mV";case fl:return"-0.000mV";case El:return" 0.000mV";case Al:return"0.032mV";case vl:return"0.064mV";case bl:return"0.096mV";case yl:return"0.128mV";case wl:return"0.160mV";case Il:return"0.192mV";case Cl:return"0.224mV";case Sl:return"0.256mV";case xl:return"0.288mV";case kl:return"0.320mV";case Pl:return"0.352mV";case Tl:return"0.384mV";case Dl:return"0.416mV";case Ml:return"0.448mV";case Rl:return"0.480mV";case Nl:return"0.512mV";case Bl:return"0.544mV";case Ll:return"0.576mV";case Gl:return"0.608mV";case $l:return"0.640mV";case Ol:return"0.672mV";case _l:return"0.704mV";case jl:return"0.736mV";case Vl:return"0.768mV";case Ul:return"0.800mV";case zl:return"0.832mV";case Wl:return"0.864mV";case Hl:return"0.896mV";case Xl:return"0.928mV";case Yl:return"0.960mV";case Ql:return"0.992mV";default:return"unknown"}},mo=e=>{let t,a;switch(1&e){case Kl:t="High";break;case ql:t="Low";break;default:t="unknown"}switch(2&e){case Zl:a="On";break;case Jl:a="Off";break;default:a="unknown"}return`${t}/${a}`},po=(e,t)=>{let a;switch(t){case Mn.PHOTO:a=to;break;case Mn.PXLR:a=eo;break;default:return null}const n=e[a.thumbnailByteExposureHigh],r=e[a.thumbnailByteExposureLow],l=2&e[a.thumbnailByteCapture],o=128&e[a.thumbnailByteEdgegains],F=96&e[a.thumbnailByteEdgegains],i=31&e[a.thumbnailByteEdgegains],s=112&e[a.thumbnailByteEdmovolt],c=8&e[a.thumbnailByteEdmovolt],u=7&e[a.thumbnailByteEdmovolt],m=192&e[a.thumbnailByteVoutzero],d=63&e[a.thumbnailByteVoutzero],p=e[a.thumbnailByteDitherset],g=e[a.thumbnailByteContrast];return t===Mn.PHOTO?{romType:t,exposure:ao(n,r),captureMode:no(l),edgeExclusive:ro(o),edgeOperation:lo(F),gain:oo(i),edgeMode:Fo(s),invertOut:io(c),voltageRef:so(u),zeroPoint:co(m),vOut:uo(d)}:{romType:t,exposure:ao(n,r),captureMode:no(l),edgeExclusive:ro(o),edgeOperation:lo(F),gain:oo(i),edgeMode:Fo(s),invertOut:io(c),voltageRef:so(u),zeroPoint:co(m),vOut:uo(d),ditherset:mo(p),contrast:g+1}},go=(e,t)=>{const a=t?Tn:Pn;return[...e].map((e=>a[e]||" ")).join("").trim()},ho=e=>{switch(28&e){case 4:return"A";case 8:return"B";case 12:return"0";case 16:return"AB";default:return"-"}},fo=e=>{if(!e)return"--";return`${Dn[e>>4]}${Dn[15&e]}`},Eo=(e,t)=>{const[a,n,r,l]=[...e].map(fo),o=((e,t)=>"--"===e&&"--"!==t?`00${t}`:"--"!==e&&"--"===t?`${e}00`:`${e}${t}`)(a,n);return t?`${o}年${r}月${l}日`:`${r}/${l}/${o}`},Ao=(e,t)=>`${t?"PC-":"GC-"}${[...e].map(fo).map((e=>"--"===e?"00":e)).join("")}`,vo=(e,t,a)=>{const n=e.subarray(t+3840,t+3843+1),r=e.subarray(t+3844,t+3852+1),l=e[t+3853],o=e.subarray(t+3854,t+3857+1),F=e.subarray(t+3861,t+3887+1),i=Boolean(e[t+3891]);return{userId:Ao(n,a),birthDate:Eo(o,a),userName:go(r,a),gender:(s=l,1&s?"m":2&s?"f":"-"),bloodType:ho(l),comment:go(F,a),isCopy:i};var s};var bo=(e,t,a)=>{const n=t/4096-2,r=n>=0?e[4530+n]:64,l=e[t+3924],o=e.slice(t+3584,t+3839+1);let F;if(r<64){const n=(e=>{const t=[200,201,202,203,204,205,206,207,216,217,218,219,220,221,222,223,232,233,234,235,236,237,238,239,248,249,250,251,252,253,254,255];return t.map((t=>e[t])).filter((e=>0===e)).length===t.length?Mn.STOCK:t.map((t=>e[t])).filter((e=>255===e)).length===t.length?Mn.PXLR:Mn.PHOTO})(o);F={romType:n},"stock"!==n&&(F={...F,...po(o,n)}),"stock"===n&&(F={...F,...vo(e,t,a)})}return{cartIndex:n,albumIndex:r,baseAddress:t,frameNumber:l,meta:F}};const yo="FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF";var wo=(e,t)=>{const a=[];let n="",r=!1;a.push(...[...Array(40)].map((()=>yo)));for(let l=0;l<3584;l+=1)l%256==0&&a.push(...[...Array(2)].map((()=>yo))),n+=` ${e[t+l].toString(16).padStart(2,"0")}`,l%16==15&&(a.push(n.trim()),r||"00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00"===n.trim()||(r=!0),n=""),l%256==255&&a.push(...[...Array(2)].map((()=>yo)));return a.push(...[...Array(40)].map((()=>yo))),r?a:null},Io=a(37482);const Co=(0,ba.A)("albumIndex");var So=({importLastSeen:e,data:t,lastModified:a,frames:n,fileName:r,importDeleted:l,forceMagicCheck:o})=>{const{importQueueAdd:F}=fe.getState();if(o){if([4306,4523,4560,4597].some((e=>"Magic"!==[...t.subarray(e,e+5)].map((e=>String.fromCharCode(e))).join(""))))return null}return async(o,i)=>{const s=new Array(30).fill(null).map(((e,t)=>4096*(t+2))).filter((e=>e<t.length));e&&s.unshift(0);const c=await Promise.all(s.map((async e=>{const a=bo(t,e,i),{frameNumber:r}=a,l=wo(t,e);if(l){return{tiles:await(0,xn.A)(l,kn(r,o,n)),...a}}return null}))),u=Co(c.filter(Boolean)),m=new(Sn())(1,1/0);let d=0;const p=await Promise.all(u.map((async({albumIndex:e,tiles:t,meta:n})=>m.add((async()=>{let o;switch(e){case 64:o="[last seen]";break;case 255:if(!l)return;o="[deleted]";break;default:d+=1,o=d.toString(10).padStart(2,"0")}const{dataHash:F}=await(0,an.cg)(t);return{fileName:"function"==typeof r?r({indexText:o,albumIndex:e,displayIndex:d}):`${r} ${o}`,imageHash:F,tiles:t,lastModified:a,meta:n,tempId:He()}})))));return F(p.reduce(Io.N,[])),!0}};const xo=e=>e.toString(10).padStart(2,"0");var ko=a(1562);var Po=e=>{let t,a;if(e.blob){const n=e;if(t=new File([n.blob],n.blobName||"blob"),a=n.contentType||"application/unknown",void 0!==n.ok&&!n.ok)throw new Error("Invalid file received from printer")}else t=e,a=t.type;if(!t.size)throw new Error("empty file");return{file:t,contentType:a}};var To=e=>{const t=(e=>async t=>{const a=await(0,tn.A)(t,tn.Z.TEXT);let n;try{n=JSON.parse(a)}catch(e){throw new Error("Not a valid .json file")}if(!n?.state)throw new Error("Not a settings .json file");return e(n),!0})(e);return async(e,{fromPrinter:n}={fromPrinter:!1})=>{await Promise.all(e.map((e=>{const{file:r,contentType:l}=Po(e);if(l&&l.startsWith("image/"))return(async(e,t=!1)=>{const a=await rn(e);return t?hn({bitmapQueue:[a],dither:!1,contrastBaseValues:[0,85,170,255]}):fe.getState().bitmapQueueAdd([a]),!0})(r,n);if(r.size>268435455)throw new Error("File too large");if("text/plain"===l)return(async e=>{const{importQueueAdd:t}=fe.getState(),a=await(0,tn.A)(e,tn.Z.TEXT);let n;return n=-1!==a.indexOf('{"command"')?await yn(a,e.name):await An(a),await Promise.all(n.map((async(a,r)=>{const{dataHash:l}=await(0,an.cg)(a),o=n.length<2?"":` ${(r+1).toString(10).padStart(2,"0")}`;return t([{fileName:`${e.name}${o}`,imageHash:l,tiles:a,lastModified:e.lastModified?e.lastModified+r:void 0,tempId:He()}]),!0}))),!0})(r);if("application/json"===l)return t(r);if(r.name?.toLowerCase().endsWith(".sav")&&(r.size%4096==0||3584===r.size))return(async(e,t)=>{const{dismissDialog:a,setDialog:n}=he.A.getState(),{frames:r,frameGroups:l}=se.h.getState(),{savFrameTypes:o,setSavFrameTypes:F}=u.A.getState(),i=await(0,tn.A)(e,tn.Z.UINT8_ARRAY),{importLastSeen:s,importDeleted:c,forceMagicCheck:m}=u.A.getState(),d=(0,ko.A)(r,l).map((({id:e,name:t})=>({value:e,name:t,selected:o===e})));d.unshift({value:"",name:"None (Black frame)"});const p=So({importLastSeen:!!t||s,data:i,lastModified:e.lastModified,frames:r,fileName:e.name,importDeleted:!!t||c,forceMagicCheck:!t&&m});if(!p)throw new Error(".sav file seems to be invalid");return t?(await p("",!1),!0):new Promise((t=>{n({message:`Importing '${e.name}'`,questions:()=>[{type:Ue.V.CHECKBOX,label:"Import is from a Japanese Cart (PocketCamera)",key:"cartIsJP"},d.length>1?{type:Ue.V.SELECT,label:"Select frame group to use with this import",key:"chosenFrameset",options:d}:void 0].reduce(Io.N,[]),confirm:async e=>{const{chosenFrameset:n,cartIsJP:r}=e;a(0),F(n),await p(n||"",Boolean(r)),t(!0)},deny:async()=>{a(0),t(!0)}})}))})(r,3584===r.size);if((r.name?.toLowerCase().endsWith(".gb")||r.name?.toLowerCase().endsWith(".gbc"))&&r.size%1048576==0)return(async e=>{const{default:t}=await Promise.resolve().then(a.t.bind(a,74802,23)),n=await(0,tn.A)(e,tn.Z.UINT8_ARRAY),{importLastSeen:r,importDeleted:l,forceMagicCheck:o}=u.A.getState(),F=In()(n,131072).reduce(((e,a,n)=>{const r=t(a);return-1!==e.findIndex((({hash:e})=>e===r))?e:[...e,{bankData:a,bankIndex:n,hash:r}]}),[]),i=await F.reduce((async(t,{bankData:a,bankIndex:n})=>{const F=await t;if(0===n)return[...F,!1];const i=So({importLastSeen:r,data:a,lastModified:e.lastModified,frames:[],fileName:({albumIndex:t})=>64===t?`${e.name} - bank ${xo(n)} [last seen]`:255===t?`${e.name} - bank ${xo(n)} [deleted]`:`${e.name} - bank ${xo(n)} - image ${xo(t+1)}`,importDeleted:l,forceMagicCheck:o});return i?[...F,await i("",!1)]:[...F,!1]}),Promise.resolve([]));if(!i.filter(Boolean).length)throw new Error("File does not contain any recognizable images");return i})(r);if("application/pico-printer-binary-log"===l)return(async e=>{const{importQueueAdd:t}=fe.getState(),a=await(0,tn.A)(e,tn.Z.UINT8_ARRAY),n=await(0,fn.Eh)(a);return await Promise.all(n.map((async(a,r)=>{const{dataHash:l}=await(0,an.cg)(a),o=n.length<2?"":` (${r+1})`;return t([{fileName:`${e.name}${o}`,imageHash:l,tiles:a,lastModified:e.lastModified?e.lastModified+r:void 0,tempId:He()}]),!0}))),!0})(r);if(l.startsWith("application/"))return(async e=>{const{importQueueAdd:t}=fe.getState(),a=await(0,tn.A)(e,tn.Z.UINT8_ARRAY);if(71!==(n=a)[0]||66!==n[1]||45!==n[2]||66!==n[3]||73!==n[4]||78!==n[5]||48!==n[6]||49!==n[7])throw new Error('Not a valid .bin file - is it missing the "GB-BIN01" header?');var n;const r=[];let l=[];for(let e=8;e<a.length;e+=1){const t=a[e];l.push(t.toString(16).padStart(2,"0").toUpperCase()),16===l.length&&(r.push(l.join(" ")),l=[])}if(l.length){for(;l.length<16;)l.push("FF");r.push(l.join(" "))}const{dataHash:o}=await(0,an.cg)(r);return t([{fileName:e.name,imageHash:o,tiles:r,lastModified:e.lastModified,tempId:He()}]),!0})(r);throw new Error("Not a dump")})))}};var Do=()=>{const{setError:e}=Ee.A.getState(),{jsonImport:t}=De(),a=(0,n.useMemo)((()=>To(t)),[t]);return{handleFileImport:async(t,n)=>{try{await a(t,n)}catch(t){e(t)}}}};const Mo=()=>{const{printerUrl:e}=(0,u.A)(),{printerFunctions:t}=(0,Ee.A)(),{downloadSettings:a}=De(),n=e?`${e}remote.html`:void 0,r=t.length>0,{handleFileImport:l}=Do();return{printerUrl:n,printerConnected:r,importPlainText:e=>{const t=new File([...e],"Text input.txt",{type:"text/plain"});l([t])},importFiles:l,exportJson:e=>a(e)}};var Ro=a(3876);var No=function(){const[e,t]=(0,n.useState)(""),{importPlainText:r,importFiles:l,printerUrl:o,exportJson:i}=Mo();return(0,n.useEffect)((()=>{a.e(7963).then(a.bind(a,24553)).then((({default:e})=>{t(e.join("\n"))}))}),[]),n.createElement(F.A,{direction:"column",gap:6},o&&n.createElement(en,null),o&&n.createElement(Oa,null),n.createElement(w.A,{component:"label",variant:"contained"},"Select file(s) to import",n.createElement("input",{type:"file",tabIndex:-1,hidden:!0,multiple:!0,onChange:e=>{const{target:t}=e,{files:a}=t;a&&a.length&&l([...a]),t.value=""}})),n.createElement(F.A,{flexDirection:"column",gap:1,justifyContent:"flex-end",justifyItems:"end"},n.createElement(Ga.A,{id:"import-plaintext",label:"Enter data received through your serial monitor",multiline:!0,rows:20,value:e,onChange:({target:e})=>{t(e.value)}}),n.createElement(F.A,{direction:"row",justifyContent:"flex-end"},n.createElement(w.A,{variant:"contained",onClick:()=>{r(e)}},"Import"))),n.createElement(wt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{onClick:()=>i(Ro.m.IMAGES)},"Export images"),n.createElement(w.A,{onClick:()=>i(Ro.m.SELECTED_IMAGES)},"Export selected images"),n.createElement(w.A,{onClick:()=>i(Ro.m.PALETTES)},"Export palettes")))},Bo=a(64951),Lo=a(23903),Go=a(73748),$o=a(835),Oo=a(97938),_o=a(31694);const jo=e=>["#",Math.ceil(Math.random()*e).toString(16).padStart(2,"0"),Math.ceil(Math.random()*e).toString(16).padStart(2,"0"),Math.ceil(Math.random()*e).toString(16).padStart(2,"0")].join(""),Vo=()=>({name:"",shortName:Ne.mI,palette:[jo(255),jo(170),jo(102),jo(34)],origin:"",isPredefined:!1});var Uo=()=>{const{palettes:e}=(0,se.h)(),{setEditPalette:t}=Y(),a=(0,n.useCallback)(((a,n)=>{const r=a===Ne.mI?Vo():e.find((e=>a===e.shortName))||Vo();t({...r,name:n?`Copy of ${r.name}`:r.name,shortName:n?Ne.mI:a})}),[e,t]);return{editPalette:e=>a(e,!1),clonePalette:e=>a(e,!0)}};var zo=a(94895);var Wo=function({isPredefined:e,clonePalette:t,editPalette:a,deletePalette:r,setActive:l,menuAnchor:o,onClose:F}){return o?n.createElement(Ge.A,{open:!!o,anchorEl:o,onClose:F,onClick:e=>{e.stopPropagation(),F()}},n.createElement($e.A,{onClick:l,title:"Set Active"},n.createElement(Oe.A,null,n.createElement(_o.A,null)),n.createElement(_e.A,null,"Set Active")),n.createElement($e.A,{onClick:t,title:"Clone"},n.createElement(Oe.A,null,n.createElement(zo.A,null)),n.createElement(_e.A,null,"Clone")),!e&&n.createElement(n.Fragment,null,n.createElement($e.A,{onClick:a,title:"Edit"},n.createElement(Oe.A,null,n.createElement(d.A,null)),n.createElement(_e.A,null,"Edit")),n.createElement($e.A,{onClick:r,title:"Delete"},n.createElement(Oe.A,null,n.createElement(je.A,null)),n.createElement(_e.A,null,"Delete")))):null};const Ho=e=>{const t=e.replace("#","");if(!/^([0-9a-fA-F]{6})$/.test(t))throw new Error("Invalid hex color");return`${parseInt(t.slice(0,2),16)}, ${parseInt(t.slice(2,4),16)}, ${parseInt(t.slice(4,6),16)}`};var Xo;!function(e){e.HARD="HARD",e.SMOOTH="SMOOTH",e.CONIC="CONIC"}(Xo||(Xo={}));const Yo=(e,t)=>{const a=Ho(e[0]||"#000000"),n=Ho(e[1]||"#000000"),r=Ho(e[2]||"#000000"),l=Ho(e[3]||"#000000");switch(t){case Xo.SMOOTH:return{backgroundImage:`linear-gradient(to right,\n          rgba(${a}, 0.25) 0%,\n          rgba(${n}, 0.25) 33.3%,\n          rgba(${r}, 0.25) 66.6%,\n          rgba(${l}, 0.25) 100%\n      )`};case Xo.HARD:return{backgroundImage:`linear-gradient(to right,\n          rgb(${a}) 0% 25%,\n          rgb(${n}) 25% 50%,\n          rgb(${r}) 50% 75%,\n          rgb(${l}) 75% 100%\n        )`};case Xo.CONIC:return{background:`conic-gradient(\n          rgb(${a}) 0% 25%,\n          rgb(${n}) 25% 50%,\n          rgb(${r}) 50% 75%,\n          rgb(${l}) 75% 100%\n        )`};default:return{}}};var Qo=function({shortName:e,name:t,isPredefined:a,palette:r,usage:l}){const{isActive:o,setActive:F,deletePalette:i,editPalette:s,clonePalette:c}=((e,t)=>{const{activePalette:a,setActivePalette:n}=(0,u.A)(),{dismissDialog:r,setDialog:l}=(0,he.A)(),{updateLastSyncLocalNow:o}=Ae(),{deletePalette:F}=(0,se.h)(),{editPalette:i,clonePalette:s}=Uo(),c=a===e;return{isActive:c,setActive:()=>n(e),deletePalette:()=>{l({message:`Delete palette "${t||"no name"}"?`,confirm:async()=>{c&&n("dsh"),o(),F(e),r(0)},deny:async()=>r(0)})},editPalette:()=>i(e),clonePalette:()=>s(e)}})(e,t),m=(0,v.A)(),d=(0,n.useMemo)((()=>({...Yo(r,Xo.SMOOTH),display:"block",width:"100%",textAlign:"left",".MuiTypography-body1":{fontWeight:o?"bold":"normal"}})),[r,o]),p=(0,n.useMemo)((()=>({...Yo(r,Xo.HARD),display:"block",width:"100%",height:m.spacing(8)})),[r,m]);return 4!==r?.length?n.createElement("li",{className:"palette palette--broken"}):n.createElement(Ft,{selectionText:"",title:t,subheader:`(${e}) ${l?`Used ${l} times`:"Not used"}`,titleIcon:o?n.createElement(_o.A,null):void 0,wrapperProps:{sx:d,onClick:s,disableRipple:!0},contextMenuComponent:Wo,contextMenuProps:{isPredefined:a,setActive:F,clonePalette:c,deletePalette:i,editPalette:s},media:n.createElement(y.A,{sx:p}),content:null})},Ko=a(91785),qo=a(73371),Zo=a.n(qo);const Jo=(e,t)=>{const a=.299*e[0]+.587*e[1]+.114*e[2],n=.299*t[0]+.587*t[1]+.114*t[2];return a>n?-1:a<n?1:0};var eF=()=>{const[e,t]=(0,n.useState)(!1),{setError:a}=(0,Ee.A)(),{setPickColors:r}=Y();return{onInputChange:async({target:e})=>{if(e.files?.[0]){t(!0);const{imageData:n,fileName:l}=await rn(e.files[0],!0),o=In()(n.data,4).map((([e,t,a])=>[e,t,a]));Ko.clusterize(o,{k:6},((e,n)=>{if(e)a(e);else{const e=Zo()(o,4),t=[...e?e.palette():[],...n?n.map((({centroid:[e,t,a]})=>[Math.round(e),Math.round(t),Math.round(a)])):[]].filter(((e,t,a)=>a.findIndex((t=>t.join(",")===e.join(",")))===t)).sort(Jo);r({colors:t,fileName:l})}t(!1)}))}e.value=""},busy:e}},tF=a(17402);var aF=()=>{const{sortPalettes:e,setSortPalettes:t}=(0,u.A)(),{images:a}=(0,se.h)(),r=[{label:"Default (ascending)",value:tF.V.DEFAULT_ASC},{label:"Default (descending)",value:tF.V.DEFAULT_DESC},{label:"Usage (ascending)",value:tF.V.USAGE_ASC},{label:"Usage (descending)",value:tF.V.USAGE_DESC},{label:"Name (ascending)",value:tF.V.NAME_ASC},{label:"Name (descending)",value:tF.V.NAME_DESC}],l=(0,n.useMemo)((()=>a.reduce(((e,t)=>(0,st.pl)(t)?e:{...e,[t.palette]:(e[t.palette]||0)+1}),{})),[a]),o=(0,n.useCallback)(((t,a)=>{const[n,r]=e.split("_"),o="asc"===r?1:-1;switch(n){case"usage":{const e=l[t.shortName]||0,n=l[a.shortName]||0;return e<n?-1*o:e>n?o:0}case"name":return t.name.localeCompare(a.name)*o;default:return o}}),[l,e]);return{sortPalettes:e,setSortPalettes:t,paletteSortOptions:r,paletteUsages:l,sortFn:o}};const nF=[{id:"own",headline:"Own palettes",filter:({isPredefined:e})=>!e},{id:"predefined",headline:"Predefined palettes",filter:({isPredefined:e})=>e},{id:"all",headline:"All palettes",filter:Boolean}];var rF=function(){const{palettes:e}=(0,se.h)(),{onInputChange:t,busy:a}=eF(),{editPalette:r}=Uo(),{exportJson:l}=Mo(),[o,i]=(0,n.useState)(0),[s,c]=(0,n.useState)(null),u=(0,v.A)(),m=(0,P.A)(u.breakpoints.up("sm")),d=(0,n.useMemo)((()=>nF[o]),[o]),{sortFn:p,sortPalettes:g,setSortPalettes:h,paletteSortOptions:f,paletteUsages:E}=aF(),A=(0,n.useMemo)((()=>[...e].filter(d.filter).sort(p)),[d,e,p]);return n.createElement(F.A,{direction:"column",gap:4},n.createElement(Lo.A,{value:o},nF.map((({id:e,headline:t},a)=>n.createElement(Bo.A,{label:t,key:e,onClick:()=>i(a),value:a})))),n.createElement(F.A,{direction:"row",justifyContent:"end"},n.createElement(wt.A,{color:"tertiary",variant:"contained",size:"small",orientation:m?"horizontal":"vertical",fullWidth:!m,disableElevation:!0},"own"===d.id&&n.createElement(n.Fragment,null,n.createElement(w.A,{disabled:a,title:"New palette",onClick:()=>r(Ne.mI),startIcon:n.createElement(Go.A,null)},"New palette"),n.createElement(w.A,{component:"label",disabled:a,startIcon:n.createElement($o.A,null),title:"New palette from image"},"New palette from image",n.createElement("input",{disabled:a,type:"file",hidden:!0,onChange:t}))),n.createElement(w.A,{title:"Sort Palettes",onClick:e=>c(e.target),endIcon:n.createElement(Oo.A,null)},"Sort Palettes"))),n.createElement(Ge.A,{open:!!s,anchorEl:s,onClose:()=>c(null),onClick:e=>{e.stopPropagation(),c(null)}},f.map((({label:e,value:t})=>n.createElement($e.A,{key:t,selected:g===t,onClick:()=>h(t)},e)))),n.createElement(ee,{fixedView:J.j.PALETTE_VIEW},A.map((e=>n.createElement(Qo,{key:e.shortName,name:e.name,isPredefined:e.isPredefined||!1,shortName:e.shortName,palette:e.palette,usage:E[e.shortName]||0})))),n.createElement(wt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{onClick:()=>l(Ro.m.PALETTES)},"Export palettes")))},lF=a(98714);const oF=(e,t)=>e.reduce(((e,a)=>{const n=/^(?<group>[a-z]+)(?<id>[0-9]+)/g.exec(a.id)?.groups?.group;return t===n?[...e,a]:e}),[]);var FF=()=>{const{enableDebug:e,savFrameTypes:t,activePalette:a}=(0,u.A)(),{frames:r,palettes:l,frameGroups:o,addFrames:F,updateFrameGroups:i}=(0,se.h)(),{updateLastSyncLocalNow:s}=Ae(),{downloadSettings:c}=De(),m=l.find((({shortName:e})=>e===a))||l[0],d=(0,ko.A)(r,o),[p,g]=(0,n.useState)([]),[h,f]=(0,n.useState)(((e,t)=>{const a=e.find((({id:e})=>e===t));return a?a.id:e[0]?.id||""})(d,t));(0,n.useEffect)((()=>{g(h?oF(r,h):[])}),[r,h]);const E=d.find((({id:e})=>e===h))||d[0];return{selectedFrameGroup:h,groupFrames:p,setSelectedFrameGroup:f,frameGroups:d,exportJson:e=>c(e,h),palette:m?.palette,setActiveFrameGroupName:e=>{i([{...E,name:e}]),s()},activeFrameGroup:E,convertFormat:async()=>{const e=await Promise.all(r.map((async e=>{const t=await(0,me.mZ)(e.hash);if(!t)return e;const a=t.upper.length/20,n=(0,lF.L2)(t),{dataHash:r}=await(0,me.Bf)(n,a);if(e.hash===r)return e;const l=await(0,me.R_)(n,a);return{...e,hash:l}})));F(e)},enableDebug:e}},iF=a(56362);var sF=({frameId:e,name:t})=>{const[a,r]=(0,n.useState)([]),[l,o]=(0,n.useState)(2),{setEditFrame:F}=Y(),{dismissDialog:i,setDialog:s}=(0,he.A)(),{frames:c,deleteFrame:u,images:m}=(0,se.h)(),{updateLastSyncLocalNow:d}=Ae(),p=c.find((({id:t})=>t===e))?.hash||"",g=m.filter((({frame:t})=>t===e)).length;return(0,n.useEffect)((()=>{o(2),r([]);(async()=>{if(!p)return;const a=await(0,me.mZ)(p),n=await(({frameId:e,frameHash:t,name:a})=>{const n=`\n  frameId: ${e}\n\n  ${a}\n\n${t}`;return(0,xn.A)((0,iF.A)(n),t)})({frameId:e,frameHash:p,name:t});o(a?a.upper.length/20:2),r(n)})()}),[e,p,t]),{frameHash:p,tiles:a,imageStartLine:l,usage:g,setTiles:r,deleteFrame:()=>{s({message:`Delete frame "${t}" (${e})?`,confirm:async()=>{i(0),d(),u(e)},deny:async()=>i(0)})},editFrame:()=>F(e)}};var cF=function({deleteFrame:e,editFrame:t,menuAnchor:a,onClose:r}){return a?n.createElement(Ge.A,{open:!!a,anchorEl:a,onClose:r,onClick:e=>{e.stopPropagation(),r()}},n.createElement($e.A,{onClick:t,title:"Edit"},n.createElement(Oe.A,null,n.createElement(d.A,null)),n.createElement(_e.A,null,"Edit")),n.createElement($e.A,{onClick:e,title:"Delete"},n.createElement(Oe.A,null,n.createElement(je.A,null)),n.createElement(_e.A,null,"Delete"))):null};var uF=function({frameId:e,name:t,palette:a}){const{enableDebug:r}=(0,u.A)(),{tiles:l,deleteFrame:o,editFrame:F,frameHash:i,imageStartLine:s,usage:c}=sF({frameId:e,name:t});if(!l)return null;const m=c?`Used ${c} times`:"Not used";return n.createElement(Ft,{selectionText:"",title:t,subheader:`(${e}) ${m}`,wrapperProps:{onClick:F,disableRipple:!0,sx:{display:"block",width:"100%",textAlign:"left"}},contextMenuComponent:cF,contextMenuProps:{deleteFrame:o,editFrame:F},media:l.length?n.createElement(oe,{lockFrame:!1,invertPalette:!1,palette:a,imageStartLine:s,tiles:l}):n.createElement(ie,null),content:r&&n.createElement(da,{text:i})})};var mF,dF=function(){const{frameGroups:e,selectedFrameGroup:t,setSelectedFrameGroup:a,palette:r,groupFrames:l,exportJson:o,setActiveFrameGroupName:i,activeFrameGroup:s,convertFormat:c,enableDebug:u}=FF();return n.createElement(F.A,{direction:"column",gap:4},n.createElement(Ga.A,{label:"Edit Framegroup",size:"small",select:!0,value:t,onChange:e=>{a(e.target.value)}},e.map((({id:e,name:t})=>n.createElement($e.A,{key:e,value:e},t)))),s&&n.createElement(Ga.A,{label:"Rename Framegroup",size:"small",type:"text",onChange:e=>i(e.target.value),value:s.name||""}),n.createElement(F.A,{direction:"column",gap:2},n.createElement(bt,null),n.createElement(ee,null,l?.map((e=>n.createElement(uF,{frameId:e.id,key:`frame-${e.id}`,name:e.name,palette:r}))))),n.createElement(wt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{onClick:()=>o(Ro.m.FRAMES)},"Export frames"),n.createElement(w.A,{onClick:()=>o(Ro.m.CURRENT_FRAMEGROUP)},`Export current framegroup (${t})`),u?n.createElement(w.A,{onClick:c},"Convert frames to new format"):null))};!function(e){e.PERSISTED="persisted",e.NOT_PERSISTED="not-persisted",e.FAILED="failed",e.NO_API="no_api"}(mF||(mF={}));const pF=!(!navigator.storage||!navigator.storage.persist);var gF=()=>{const[e,t]=(0,n.useState)(mF.NOT_PERSISTED);(0,n.useEffect)((()=>{(async e=>{e(pF?await navigator.storage.persisted()?mF.PERSISTED:mF.NOT_PERSISTED:mF.NO_API)})(t)}),[]);return{persistAPIAvailable:pF,persisted:e,requestPersist:async()=>{(async e=>{e(pF?await navigator.storage.persist()?mF.PERSISTED:mF.FAILED:mF.NO_API)})(t)}}},hF=a(96763);const fF=async(e,t,a)=>{const n=await(0,ce.T)(e,t)(a,!1);if(!n)return null;const{dataHash:r}=await(0,an.cg)(n);return r!==a?(0,an.UN)(n):null};var EF=()=>{const{frames:e,images:t}=(0,se.h)(),{updateImageHash:r}=Ae(),[l,o]=(0,n.useState)(!0);return window.enableHashCleanup=()=>o(!1),{cleanupBusy:l,hashCleanup:async()=>{o(!0);let n=0,l=0;const{default:F}=await Promise.resolve().then(a.t.bind(a,74802,23));await Promise.all(t.map((async a=>{const{hash:o}=a;if((0,st.pl)(a)){const{hashes:l}=a,i=Object.keys(l),s=await Promise.all(i.map((async a=>{const n=l[a];let r=null;return n&&(r=await fF(t,e,n)),{[a]:r||n}}))),c=s.reduce(((e,t)=>({...e,...t})),{}),u=F(c);u!==o&&(n+=1,r(o,{...a,hash:u,hashes:c}))}else{const n=await fF(t,e,o);n&&(l+=1,r(o,{...a,hash:n}))}}))),o(!1),hF.info({iCounterRGBN:n,iCounterMono:l})}}};var AF=function(){const{hashCleanup:e,cleanupBusy:t}=EF(),{downloadSettings:a}=De(),{resetGroups:r}=tt(),l=e=>a(e),{persisted:o,requestPersist:F}=gF();return n.createElement(wt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{disabled:o!==mF.NOT_PERSISTED,onClick:F},(e=>{switch(e){case mF.PERSISTED:return"Storage is persistent";case mF.NOT_PERSISTED:return"Request storage persistence";case mF.NO_API:return"Persistance API not available";case mF.FAILED:default:return"Failed to persist storage"}})(o)),n.createElement(w.A,{onClick:r},"Reset image groups"),n.createElement(w.A,{onClick:()=>l(Ro.m.ALL)},"Export Everything"),n.createElement(w.A,{onClick:()=>l(Ro.m.PLUGINS)},"Export Plugins"),n.createElement(w.A,{disabled:t,onClick:e},"Hash Cleanup"))},vF=a(23920);const bF=(0,vF._)(),yF=["Web-App version: 1.45.0","Web-App branch: master",`Printer version: ${bF?.version}`,`Max Images: ${bF?.maximages}`,`Localforage driver: ${bF?.localforage}`,`Environment type: ${bF?.env}`,`Compiled Filesystem: ${bF?.fstype}`,`Compiled Bootmode: ${bF?.bootmode}`,"Compiled for OLED: "+(bF?.oled?"yes":"no")],wF=[{path:"/settings/generic",headline:"Generic Settings"},{path:"/settings/git",headline:"Git Settings"},{path:"/settings/plugins",headline:"Plugin Settings"}];wF.push({path:"/settings/dropbox",headline:"Dropbox Settings"}),"esp8266"!==(0,vF._)()?.env&&"webpack-dev"!==(0,vF._)()?.env||wF.push({path:"/settings/wifi",headline:"WiFi Settings"});var IF=function(){const e=(0,r.FE)(),t=e[2]?.pathname;return wF.find((({path:e})=>e===t))?n.createElement(F.A,{direction:"column",gap:4,justifyContent:"space-between",sx:{flexGrow:1}},n.createElement(F.A,{direction:"column",gap:6},n.createElement(Lo.A,{value:t},wF.map((({headline:e,path:t})=>n.createElement(Bo.A,{label:e,key:t,component:r.k2,to:t,value:t})))),n.createElement(y.A,null,n.createElement(r.sv,null)),n.createElement(AF,null)),n.createElement(F.A,{component:"ul",direction:"column"},yF.map((e=>n.createElement(ua.A,{key:e,component:"li",variant:"caption",color:"textDisabled",align:"right"},e))))):n.createElement(r.C5,{to:wF[0].path,replace:!0})},CF=a(37007),SF=a.n(CF);class xF extends(SF()){device;manufacturerName;productName;serialNumber;interfaceNumber;endpointIn;endpointOut;textDecoder;constructor(e){super(),this.device=e,this.manufacturerName=e.manufacturerName||"",this.productName=e.productName||"",this.serialNumber=e.serialNumber||"",this.interfaceNumber=2,this.endpointIn=5,this.endpointOut=4,this.textDecoder=new TextDecoder}connect(){const e=()=>{this.device.transferIn(this.endpointIn,64).then((t=>{this.emit("data",this.textDecoder.decode(t.data)),e()})).catch((e=>{this.emit("error",e)}))};return this.device.open().then((()=>this.device?.selectConfiguration?.(1))).then((()=>{const e=this.device.configuration?.interfaces;e&&e.forEach((e=>{e.alternates.forEach((t=>{255===t.interfaceClass&&(this.interfaceNumber=e.interfaceNumber,t.endpoints.forEach((e=>{"out"===e.direction&&(this.endpointOut=e.endpointNumber),"in"===e.direction&&(this.endpointIn=e.endpointNumber)})))}))}))})).then((()=>this.device.claimInterface(this.interfaceNumber))).then((()=>this.device.selectAlternateInterface(this.interfaceNumber,0))).then((()=>this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:1,index:this.interfaceNumber}))).then((()=>{e()}))}disconnect(){return this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:0,index:this.interfaceNumber}).then((()=>this.device.close()))}send(e){return this.device.transferOut(this.endpointOut,e)}}var kF=xF,PF=a(96763);class TF extends(SF()){enabled;activePorts;constructor(){super(),this.enabled=!!navigator.usb&&!!navigator.usb.getDevices,this.activePorts=[],this.watchPorts()}getPorts(){return this.enabled?navigator.usb.getDevices().then((e=>e.filter((({opened:e})=>!e)).map((e=>new kF(e))))):Promise.resolve([])}getActivePorts(){return this.activePorts}watchPorts(){window.setInterval((()=>{this.getPorts().then((e=>{e.forEach((e=>{e.addListener("error",(t=>{PF.warn(t),this.activePorts=this.activePorts.filter((t=>t!==e)),this.emit("activePortsChange",[...this.activePorts])})),e.addListener("data",(e=>{this.emit("data",e)})),e.connect().then((()=>{this.activePorts.push(e),this.emit("activePortsChange",[...this.activePorts])}))}))}))}),1e3)}requestPort(){if(!this.enabled)return;navigator.usb.requestDevice({filters:[{vendorId:9025,productId:32822},{vendorId:9025,productId:32823},{vendorId:9025,productId:32845},{vendorId:9025,productId:32846},{vendorId:9025,productId:32847},{vendorId:9025,productId:32848},{vendorId:9025,productId:32850},{vendorId:9025,productId:32851},{vendorId:9025,productId:32852},{vendorId:9025,productId:32853},{vendorId:9025,productId:32854},{vendorId:9025,productId:32855},{vendorId:9114}]}).then((e=>{if(e.opened)throw new Error("device already opened");return new kF(e)})).catch((()=>null)).then((e=>{e&&e.connect().then((()=>{this.activePorts.push(e),this.emit("activePortsChange",[...this.activePorts])}))}))}}var DF=new TF;var MF=()=>{const{handleFileImport:e}=Do();return(0,n.useCallback)((t=>{const a=new File([...t],"Text input.txt",{type:"text/plain"});e([a])}),[e])};var RF=e=>{const t=DF.enabled,a=MF(),[r,l]=(0,n.useState)([]),[o,F]=(0,n.useState)(!1),i=(0,n.useRef)(""),s=(0,n.useRef)();(0,n.useEffect)((()=>{if(!DF.enabled)return()=>{};const t=e=>{window.clearTimeout(s.current),s.current=window.setTimeout((()=>{F(!1),a(i.current),i.current=""}),1e3),F(!0),i.current=`${i.current}${e}`};return l(DF.getActivePorts()),DF.addListener("activePortsChange",l),e||DF.addListener("data",t),()=>{DF.removeListener("activePortsChange",l),DF.removeListener("data",t)}}),[a,e]);return{activePorts:r,webUSBEnabled:t,openWebUSBSerial:()=>{DF.enabled&&DF.requestPort()},isReceiving:o}};class NF extends(SF()){device;baudRate;usbProductId;usbVendorId;reader;constructor({device:e,baudRate:t}){super(),this.device=e,this.baudRate=t;const{usbProductId:a,usbVendorId:n}=e.getInfo();this.usbProductId=a,this.usbVendorId=n,this.reader=null}connect(){const e=()=>{this.reader?.read().then((({value:t})=>{this.emit("data",t),e()})).catch((e=>{this.emit("error",e)}))};return this.device.open({baudRate:this.baudRate}).then((()=>{const t=new window.TextDecoderStream;this.device.readable.pipeTo(t.writable),this.reader=t.readable.getReader(),e()}))}}var BF=NF,LF=a(96763);class GF extends(SF()){enabled;activePorts;baudRate;constructor(){super(),this.enabled=!!navigator.serial&&!!window.TextDecoderStream,this.activePorts=[],this.baudRate=115200,this.watchPorts()}getPorts(){return this.enabled?navigator.serial.getPorts().then((e=>e.filter((({readable:e})=>!e)).map((e=>new BF({device:e,baudRate:this.baudRate}))))):Promise.resolve([])}getActivePorts(){return this.activePorts}watchPorts(){window.setInterval((()=>{this.getPorts().then((e=>{e.forEach((e=>{e.addListener("error",(t=>{LF.warn(t),this.activePorts=this.activePorts.filter((t=>t!==e)),this.emit("activePortsChange",[...this.activePorts])})),e.addListener("data",(e=>{this.emit("data",e)})),e.connect().then((()=>{this.activePorts.push(e),this.emit("activePortsChange",[...this.activePorts])})).catch((()=>{}))}))}))}),1e3)}requestPort(){this.enabled&&navigator.serial.requestPort().then((e=>{if(e.readable)throw new Error("device already opened");return new BF({device:e,baudRate:this.baudRate})})).catch((()=>null)).then((e=>{e&&e.connect().then((()=>{this.activePorts.push(e),this.emit("activePortsChange",[...this.activePorts])}))}))}}var $F=new GF;var OF=e=>{const t=$F.enabled,a=MF(),[r,l]=(0,n.useState)([]),[o,F]=(0,n.useState)(!1),i=(0,n.useRef)(""),s=(0,n.useRef)();(0,n.useEffect)((()=>{if(!$F.enabled)return()=>{};const t=e=>{window.clearTimeout(s.current),s.current=window.setTimeout((()=>{F(!1),a(i.current),i.current=""}),1e3),F(!0),i.current=`${i.current}${e}`};return l($F.getActivePorts()),$F.addListener("activePortsChange",l),e||$F.addListener("data",t),()=>{$F.removeListener("activePortsChange",l),$F.removeListener("data",t)}}),[a,e]);return{activePorts:r,webSerialEnabled:t,openWebSerial:()=>{$F.enabled&&$F.requestPort()},isReceiving:o}};var _F=()=>{const{useSerials:e}=(0,u.A)(),{showSerials:t,setShowSerials:a}=(0,Ee.A)();return{lightBoxOpen:t&&e,hideSerials:()=>a(!1)}};var jF=function({inline:e,passive:t}){const{activePorts:a,isReceiving:r,webUSBEnabled:l,openWebUSBSerial:o}=RF(t||!1),{activePorts:i,isReceiving:s,webSerialEnabled:c,openWebSerial:u}=OF(t||!1),{lightBoxOpen:m,hideSerials:d}=_F(),p=n.createElement(F.A,{direction:{xs:"column",md:e?"row":"column"},gap:4,sx:{"& > *":{flex:1}}},n.createElement(F.A,{direction:"column",gap:1},n.createElement(w.A,{title:"Open WebUSB device",onClick:o,disabled:!l,loading:r,loadingPosition:"start",variant:"contained",color:"secondary"},"Open WebUSB device",r?" (receiving)":null),n.createElement(ua.A,{variant:"body2"},`Connected devices (${a.length}):`),n.createElement("ul",null,a.map((({productName:e},t)=>n.createElement("li",{key:t},e))))),n.createElement(F.A,{direction:"column",gap:1},n.createElement(w.A,{title:"Open Web Serial device",onClick:u,disabled:!c,loading:s,loadingPosition:"start",variant:"contained",color:"secondary"},"Open Web Serial device",s?" (receiving)":null),n.createElement(ua.A,{variant:"body2"},`${i.length} devices connected`)));return e?p:m||r||s?n.createElement(R,{header:"WebUSB / Serial devices",confirm:d,canConfirm:!r&&!s},p):null},VF=a(87788),UF=a(76320);var zF=function(){const{useSerials:e,setUseSerials:t}=(0,u.A)();return n.createElement(VF.A,{label:"Enable WebUSB / Serial ports",control:n.createElement(UF.A,{checked:e,onChange:({target:e})=>{t(e.checked)}})})};var WF=function(){const{useSerials:e}=(0,u.A)();return n.createElement(F.A,{direction:"column",gap:4},n.createElement(zF,null),e?n.createElement(n.Fragment,null,n.createElement(jF,{inline:!0,passive:!0}),n.createElement(s,{getMarkdown:async()=>{const{default:e}=await a.e(3119).then(a.bind(a,70525));return e}}),n.createElement(F.A,{direction:{xs:"column",md:"row"},gap:4,sx:{"& > *":{flex:1}}},n.createElement(Va.A,{severity:$F.enabled?"success":"warning",variant:"filled"},$F.enabled?"Your current browser/device does support Web Serial":"Your current browser/device does not support Web Serial"),n.createElement(Va.A,{severity:DF.enabled?"success":"warning",variant:"filled"},DF.enabled?"Your current browser/device does support WebUSB":"Your current browser/device does not support WebUSB"))):null)},HF=a(94852);const XF=["https://herrzatacke.github.io","https://localhost:5000","https://127.0.01:5000","http://localhost:5000","http://127.0.01:5000"];var YF=function(){const{url:e,source:t,isTrusted:a,pending:l,pluginExists:o,addPlugin:i}=(()=>{const e=(0,r.g)().pluginUrl||"",[t,a]=(0,n.useState)(!1),l=(0,HF.vx)(e),{plugins:o}=(0,se.h)(),{setError:F}=(0,Ee.A)(),{validateAndAddPlugin:i}=Rt(),s=(0,r.Zp)(),c=XF.some((e=>{const t=(0,HF.vx)(e);return t.protocol===l.protocol&&t.host===l.host})),u=o.some((t=>t.url===e)),m=(0,n.useCallback)((async()=>{a(!0),s("/settings/plugins",{replace:!0}),await i({url:e})||F(new Error("Could not install plugin."))}),[s,F,e,i]);return{url:e,pending:t,pluginExists:u,source:`${l.protocol}//${l.host}`,isTrusted:c,addPlugin:m}})();return e?l?null:n.createElement(F.A,{direction:"column",gap:4},a?null:n.createElement(Va.A,{severity:"error",variant:"filled"},`The source "${t}" of this plugin is not trusted!!`),o?n.createElement(n.Fragment,null,n.createElement(Va.A,{severity:"warning",variant:"filled"},`The plugin "${e}" is already installed`),n.createElement(h.A,{component:r.N_,to:"/settings/plugins"},"Go to plugins")):n.createElement(n.Fragment,null,n.createElement(Va.A,{severity:a?"success":"warning",variant:"filled"},`This will add ${e} to your plugins.`),n.createElement(y.A,null,n.createElement(w.A,{color:a?"success":"warning",variant:"contained",sx:{fontSize:20,px:8,py:2,mx:"auto",display:"block"},disabled:o,onClick:i},"Add")))):n.createElement(r.C5,{to:"/settings/plugins",replace:!0})},QF=a(66423),KF=a(88868),qF=a(46446),ZF=a(5744),JF=a(62143),ei=a(15548),ti=a(30433),ai=a(13129),ni=a(30073),ri=a(7527),li=a(95884),oi=a(42215),Fi=a(17095),ii=a(96224),si=a(44212);var ci=()=>{const{gitStorage:e,dropboxStorage:t}=(0,de.A)(),a=t.autoDropboxSync||!1,n=!!(t.use||e.use&&e.owner&&e.repo&&e.branch&&e.throttle&&e.token),{syncBusy:r,setSyncSelect:l,setShowSerials:o}=(0,Ee.A)(),{useSerials:F}=(0,u.A)(),{syncLastUpdate:i}=(0,de.A)();return{disableSerials:!DF.enabled&&!$F.enabled,syncBusy:r,useSync:n,useSerials:F,syncLastUpdate:i,autoDropboxSync:a,selectSync:()=>l(!0),setShowSerials:()=>o(!0)}},ui=a(98254),mi=a(1642);const di={htmlInput:{autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1},inputLabel:{shrink:!0},fullWidth:!0,size:"small"},pi=e=>({root:{fontSize:"13px",textTransform:"none",minHeight:"40px",variants:[...["primary","secondary","tertiary"].map((t=>({props:{color:t},style:{"&.MuiButton-outlined":{color:e.palette[t].light,borderColor:e.palette[t].light}}})))]}}),gi=e=>({grouped:{variants:[...["primary","secondary","tertiary"].map((t=>({props:{color:t},style:{"&.Mui-selected":{background:e.palette[t].main,color:e.palette[t].contrastText,"&:hover":{backgroundColor:(0,b.X4)(e.palette[t].main,.7)}},"&:hover":{backgroundColor:(0,b.X4)(e.palette[t].main,.4)}}})))]}}),hi=e=>({root:{background:"dark"===e.palette.mode?"#000000":"#ffffff",color:"dark"===e.palette.mode?"#ffffff":"#000000",".MuiInputBase-inputMultiline":{fontSize:"13px",lineHeight:"16px",fontFamily:"monospace"},".MuiOutlinedInput-notchedOutline legend span":{display:"none"}}}),fi=e=>({root:{fontSize:16,textTransform:"none",minHeight:60,"&.Mui-selected":{backgroundColor:(0,b.X4)(e.palette.primary.main,.2),color:"inherit"},"&:hover":{backgroundColor:(0,b.X4)(e.palette.secondary.main,.35)}}}),Ei=e=>({root:{variants:[...["primary","secondary","tertiary"].map((t=>({props:{color:t},style:{"--AppBar-background":e.palette[t].dark,"--AppBar-color":e.palette[t].contrastText,"& .MuiButton-root.active":{backgroundColor:e.palette["primary"===t?"secondary":"primary"].main},"& .MuiButton-root:hover":{backgroundColor:e.palette[t].light,color:e.palette[t].contrastText},"& .MuiIconButton-root:hover":{backgroundColor:e.palette[t].light,color:e.palette[t].contrastText}}})))]}}),Ai=e=>({root:{[e.breakpoints.up("xs")]:{minHeight:"var(--navigation-height)"},justifyContent:"end","& .MuiButton-root":{height:"var(--navigation-height)",padding:"0 20px",fontSize:e.typography.body1.fontSize},"& .MuiButtonGroup-horizontal":{paddingRight:"8px"},"& .MuiSvgIcon-root":{fontSize:"1.8rem"}}}),vi=e=>({root:{backgroundColor:e.palette.primary[e.palette.mode],color:e.palette.primary.contrastText,"&& + .MuiDialogContent-root":{padding:e.spacing(2)}}}),bi=e=>({root:{"&~.MuiTabPanel-root":{padding:0,marginTop:e.spacing(2)},"& .MuiTabScrollButton-root.Mui-disabled":{opacity:.25}}}),yi=e=>({root:{"&.Mui-selected":{backgroundColor:(0,b.X4)(e.palette.secondary.main,.8),color:e.palette.secondary.contrastText,"&:hover,&.Mui-focusVisible":{backgroundColor:e.palette.secondary.main}}}}),wi=e=>({MuiButton:{styleOverrides:pi(e)},MuiToggleButtonGroup:{styleOverrides:gi(e),defaultProps:{color:"tertiary"}},MuiOutlinedInput:{styleOverrides:hi(e)},MuiPaper:{styleOverrides:{root:{backgroundImage:"none"}}},MuiTab:{styleOverrides:fi(e)},MuiTabs:{styleOverrides:bi(e),defaultProps:{scrollButtons:"auto",indicatorColor:"secondary",variant:"scrollable"}},MuiInputLabel:{styleOverrides:{root:{transform:"translate(14px, 25px) scale(1)","&.MuiInputLabel-shrink":{transform:"translate(2px, -12px) scale(1)"}}}},MuiFormControl:{styleOverrides:{root:{paddingTop:16,".MuiStack-root &:first-of-type":{marginTop:12}}}},MuiCardContent:{styleOverrides:{root:{padding:"24px 16px"}}},MuiAppBar:{styleOverrides:Ei(e)},MuiToolbar:{styleOverrides:Ai(e)},MuiLink:{styleOverrides:{root:{color:"inherit"}}},MuiDialogTitle:{styleOverrides:vi(e)},MuiSwitch:{defaultProps:{color:"tertiary"}},MuiTextField:{defaultProps:{color:"tertiary",slotProps:di}},MuiSelect:{styleOverrides:{select:{display:"flex",".MuiListItemIcon-root":{minWidth:32,flexDirection:"column",justifyContent:"center"}}},defaultProps:{displayEmpty:!0}},MuiList:{styleOverrides:{root:{".MuiListSubheader-root":{display:"flex",".MuiListItemIcon-root":{minWidth:32,flexDirection:"column",justifyContent:"center"}}}}},MuiMenuItem:{styleOverrides:yi(e)},MuiCardActionArea:{styleOverrides:{root:{height:"100%",".MuiCardActionArea-focusHighlight":{background:"transparent"}}}}}),Ii=({mode:e,colorPrimary:t,colorSecondary:a,colorTertiary:n,colorSuccess:r,colorWarn:l,colorError:o,colorPageBackground:F,colorText:i})=>{const s=(0,mi.A)({shape:{borderRadius:0},breakpoints:{values:{xs:0,sm:570,md:768,lg:1024,xl:1264}},typography:{fontFamily:'"Trebuchet MS", Helvetica, sans-serif',body1:{fontSize:16},body2:{fontSize:13},h1:{fontSize:30,fontWeight:"bold"},h2:{fontSize:24,fontWeight:"bold"},h3:{fontSize:20,fontWeight:"bold"},h4:{fontSize:18,fontWeight:"bold"}},palette:{mode:e,primary:{main:t},secondary:{main:a},success:{main:r},warning:{main:l},error:{main:o},background:{default:F,paper:(0,b.a)(F,"light"===e?.6:.02)}}}),c=(0,mi.A)(s,{palette:{tertiary:s.palette.augmentColor({color:{main:n},name:"tertiary"}),fgtext:s.palette.augmentColor({color:{main:i},name:"fgtext"}),bg:s.palette.augmentColor({color:{main:F},name:"bg"}),text:{primary:i,secondary:i}}}),u=(0,b.au)(c.palette.primary.main,i,.7);return(0,mi.A)(c,{typography:{fontFamily:'"Trebuchet MS", Helvetica, sans-serif',body1:{color:i},body2:{color:i},h1:{color:u},h2:{color:u},h3:{color:u},h4:{color:u}},components:wi(c)})},Ci={colorInfo:"#3f769e",colorSuccess:"#3f9e7c",colorWarn:"#8b7b2c",colorError:"#cb0003",colorPrimary:"#503281",colorSecondary:"#455c63",colorTertiary:"#4a6959"},Si=Ii({mode:"dark",colorPageBackground:"#2a292b",colorText:"#b2b2b2",...Ci}),xi=Ii({mode:"light",colorPageBackground:"#d6d3dc",colorText:"#333333",...Ci}),ki=document.body;var Pi=function(){const[e,t]=(0,n.useState)(!1),{lastGalleryLink:a}=O(),{pathname:l}=(0,r.zy)(),{themeName:o,setThemeName:F}=(0,u.A)(),{disableSerials:i,syncBusy:s,useSync:c,useSerials:m,syncLastUpdate:d,autoDropboxSync:p,selectSync:h,setShowSerials:f}=ci(),{showTrashCount:E,trashCount:A}=(0,Ee.A)(),v=(0,n.useMemo)((()=>A.frames+A.images),[A]),y=(0,n.useMemo)((()=>p&&d.local!==d.dropbox),[p,d]),C=(0,n.useMemo)((()=>d.local>d.dropbox?"There are local changes not synched to dropbox yet":"There are remote changes not synched yet"),[d]),S=(0,n.useMemo)((()=>[{label:"Home",route:"/home"},{label:"Gallery",route:a&&l!==a?a:"/gallery/page/1"},{label:"Import",route:"/import"},{label:"Palettes",route:"/palettes"},{label:"Frames",route:"/frames"},{label:"Settings",route:"/settings"}].reduce(Io.N,[])),[a,l]),x=(0,n.useMemo)((()=>[{title:"Trash",icon:n.createElement(je.A,null),badgeContent:v>0?v.toString(10):null,disabled:!1,onClick:()=>E(!0)},c?{title:C,icon:n.createElement(Fi.A,null),badgeContent:y?"!":null,disabled:s,onClick:h}:null,{title:o===ui.V.BRIGHT?"Switch to dark mode":"Switch to bright mode",icon:o===ui.V.BRIGHT?n.createElement(ai.A,null):n.createElement(JF.A,null),badgeContent:null,disabled:!1,onClick:()=>F(o===ui.V.BRIGHT?ui.V.DARK:ui.V.BRIGHT)},m?{title:i?"USB devices are disabled":"WebUSB Serial devices",icon:n.createElement(si.A,null),badgeContent:null,disabled:i,onClick:f}:null].reduce(Io.N,[])),[i,h,f,F,E,s,y,C,o,v,m,c]);return n.createElement(n.Fragment,null,n.createElement(qF.A,{theme:xi},n.createElement(ZF.A,{color:"primary",enableColorOnDark:!0,position:"sticky"},n.createElement(QF.A,{maxWidth:"xl",disableGutters:!0},n.createElement(ii.A,{disableGutters:!0},n.createElement(wt.A,{variant:"text",component:"nav",role:"navigation","aria-label":"Main Navigation",sx:{display:{xs:"none",md:"inline-flex"},width:"100%"}},S.map((({route:e,label:a})=>n.createElement(w.A,{key:e,to:e,component:r.k2,color:"inherit",onClick:()=>t(!1)},a)))),n.createElement(wt.A,{variant:"text",role:"navigation","aria-label":"Utility Navigation"},x.map((({title:e,icon:t,onClick:a,badgeContent:r})=>n.createElement(g.A,{key:e,color:"inherit",title:e,onClick:a},n.createElement(yt.A,{badgeContent:r,color:"error",anchorOrigin:{vertical:"bottom",horizontal:"right"}},t)))),n.createElement(g.A,{color:"inherit",title:"Open Main Navigation",onClick:()=>t(!0),sx:{display:{md:"none"}}},n.createElement(oi.A,null))))))),n.createElement(ti.Ay,{container:ki,variant:"temporary",open:e,onClose:()=>t(!1),ModalProps:{keepMounted:!0},sx:e=>({display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{width:{xs:"100%",sm:e.breakpoints.values.sm}}})},n.createElement(ii.A,{disableGutters:!0},n.createElement(wt.A,{variant:"text",sx:{display:{md:"none"}}},n.createElement(g.A,{color:"inherit",title:"Close Main Navigation",onClick:()=>t(!1)},n.createElement(I.A,null)))),n.createElement(ei.A,null),n.createElement(ni.A,null,S.map((({route:e,label:a})=>n.createElement(ri.Ay,{key:e,disablePadding:!0},n.createElement(li.A,{to:e,component:r.k2,onClick:()=>t(!1),sx:e=>({"&.active":{background:e.palette.secondary.light,color:e.palette.secondary.contrastText},"&:hover":{background:(0,b.X4)(e.palette.primary.main,.3)}})},n.createElement(_e.A,{primary:a}))))))))},Ti=a(43522),Di=a.n(Ti),Mi=a(72051),Ri=a(88225),Ni=a(1812);We().extend(Di());var Bi=function(){const{git:{messages:e,repoUrl:t,repo:a,branch:r},dropbox:{messages:l,path:o},confirm:i}=(()=>{const{progressLog:e,resetProgressLog:t}=(0,Ee.A)(),{gitStorage:a,dropboxStorage:n}=(0,de.A)();return{git:{messages:e.git||[],repoUrl:`https://github.com/${a.owner}/${a.repo}/tree/${a.branch}`,repo:a.repo,branch:a.branch},dropbox:{messages:e.dropbox||[],path:n.path||""},confirm:t}})(),[s,c]=(0,n.useState)(!0),u=e.length>0,m=l.length>0,{timestamp:d}=e[e.length-1]||{},{timestamp:p,message:g}=e[0]||{},{timestamp:h}=l[l.length-1]||{},{timestamp:f,message:E}=l[0]||{},A="."===g||"."===E,v=u?d:h,b=u?p:f,I=(0,n.useMemo)((()=>[...e,...l].filter((({message:e})=>"."!==e))),[l,e]),C=(0,n.useMemo)((()=>I.filter(((e,t)=>!s||t<15))),[s,I]);return e.length||l.length?n.createElement(R,{header:`${A?"✔️ Update done":"⏳ Updating..."} ${u?` - "${a}/${r}"`:""}`,confirm:A?i:void 0},n.createElement(F.A,{direction:"column",gap:2},n.createElement(y.A,{component:"ul",sx:{overflowX:"hidden",overflowY:"auto",maxHeight:"30vh","& > .MuiTypography-root":{whiteSpace:"nowrap"}}},C.map((({message:e,timestamp:t},a)=>n.createElement(ua.A,{key:a,variant:"caption",component:"li",title:We().unix(t).format("HH:mm:ss")},e)))),I.length>15&&n.createElement(w.A,{variant:"outlined",color:"secondary",onClick:()=>c(!s),endIcon:s?n.createElement(Ni.A,null):n.createElement(Ri.A,null)},s?`Show all ${I.length} messages`:"Reduce messages"),n.createElement(F.A,{direction:"column",gap:0},n.createElement(ua.A,{variant:"caption"},`Started at: ${We().unix(v).format("HH:mm:ss")}`),n.createElement(ua.A,{variant:"caption"},`${A?"Finished after":"Running for"}: ${We().duration(b-v,"seconds").format("HH:mm:ss")}`)),u&&n.createElement(w.A,{variant:"outlined",component:"a",color:"secondary",startIcon:n.createElement(Mi.A,null),title:t,href:t,target:"_blank",rel:"noreferrer"},"Open GitHub Repository"),m&&n.createElement(w.A,{variant:"outlined",component:"a",color:"secondary",title:`Open Dropbox folder:\nhttps://www.dropbox.com/home/Apps/GameBoyPrinter/${o}`,href:`https://www.dropbox.com/home/Apps/GameBoyPrinter/${o}`,target:"_blank",rel:"noreferrer"},"Open Dropbox folder"))):null};var Li=function(){const{message:e,progress:t}=(()=>{const{progress:e}=(0,Ee.A)();return e.gif?{progress:e.gif,message:"Creating GIF animation..."}:e.plugin?{progress:e.plugin,message:"Executing plugin..."}:e.printer?{progress:e.printer,message:"Fetching images from printer..."}:{progress:0,message:""}})();return t>0&&n.createElement(R,{header:e},n.createElement(va.A,{variant:"determinate",value:100*t,color:"secondary"}))};var Gi=()=>{const{dialogs:e}=(0,he.A)(),t=e[0],{questions:a}=t,[r,l]=(0,n.useState)((e=>e?e({}).reduce(((e,t)=>{const{key:a}=t;let n;switch(t.type){case Ue.V.SELECT:{const e={...t};n=e.options?.find((({selected:e})=>e))?.value||"";break}case Ue.V.CHECKBOX:n=!1;break;case Ue.V.TEXT:n=t.initialValue||"";break;case Ue.V.NUMBER:n=0;break;case Ue.V.INFO:default:return e}return{...e,[a]:n}}),{}):{})(a));return{message:t.message,confirm:()=>t.confirm(r),deny:t.deny,questions:a?a(r):[],values:r,setSelected:e=>{l({...r,...e})}}};var $i=function(){const{message:e,questions:t,values:a,setSelected:r,confirm:l,deny:o}=Gi();return n.createElement(R,{confirm:l,deny:o,header:e,headerOnly:!t.length},n.createElement(F.A,{direction:"column",gap:2},t.map((e=>{switch(e.type){case Ue.V.SELECT:{const{label:t,key:l,options:o,disabled:F=!1}=e;return n.createElement(Ga.A,{key:l,select:!0,disabled:F,size:"small",value:a[l]||"",label:t,onChange:e=>r({[l]:e.target.value})},o.map((({value:e,name:t})=>n.createElement($e.A,{value:e,key:e},t))))}case Ue.V.TEXT:{const{label:t,key:l,disabled:o=!1}=e;return n.createElement(Ga.A,{key:l,disabled:o,size:"small",value:a[l]||"",label:t,onChange:e=>r({[l]:e.target.value})})}case Ue.V.NUMBER:{const{label:t,key:l,min:o,max:F,disabled:i=!1}=e;return n.createElement(Ga.A,{key:l,disabled:i,size:"small",value:a[l]||"",type:"number",label:t,slotProps:{htmlInput:{min:o,max:F}},onChange:e=>r({[l]:e.target.value})})}case Ue.V.CHECKBOX:{const{label:t,key:l,disabled:o=!1}=e;return n.createElement(VF.A,{key:l,disabled:o,label:t,control:n.createElement(UF.A,{checked:a[l],onChange:({target:e})=>{r({[l]:e.checked})}})})}case Ue.V.INFO:{const{label:t,key:a,severity:r}=e;return r?n.createElement(Va.A,{severity:r,key:a,variant:"filled"},t):n.createElement(ua.A,{key:a},t)}case Ue.V.IMAGE:{const{label:t,key:a,src:r}=e;return n.createElement(y.A,{component:"img",key:a,src:r,alt:t,title:t,sx:{imageRendering:"pixelated"}})}default:return null}}))))},Oi=a(92454),_i=a(65836),ji=a(82586),Vi=a(6481),Ui=a(85268),zi=a(22730);var Wi=function({frame:e,updateFrame:t,noFrameOption:a,updateFrameLock:r,lockFrame:l,selectLabel:o}){const{frames:i,frameGroups:s}=(0,se.h)(),c=(0,n.useMemo)((()=>s.map((e=>{const t=oF(i,e.id);return 0===t.length?[]:[{id:e.id,name:e.name,isGroup:!0},...t.map((({id:e,name:t})=>({id:e,name:t,isGroup:!1})))]})).flat()),[s,i]);return n.createElement(F.A,{direction:"column",gap:2},n.createElement(Ga.A,{label:o||"Frame",select:!0,size:"small",value:e,onChange:e=>{t(e.target.value)}},n.createElement($e.A,{value:""},a||"As imported / No frame"),c.map((({id:e,name:t,isGroup:a})=>a?n.createElement(zi.A,{key:e},n.createElement(Oe.A,null,n.createElement(Ui.A,null)),n.createElement(_e.A,null,`${t} (${e})`)):n.createElement($e.A,{key:e,value:e},t)))),"function"==typeof r?n.createElement(VF.A,{label:"Use separate color settings for frame",control:n.createElement(UF.A,{checked:l,onChange:({target:e})=>{r(e.checked)}})}):null)},Hi=a(10777);const Xi=[{id:ae.Nx.NORMAL,label:"Normal (ignore neutral layer)"},{id:ae.Nx.NORMAL_S,label:"Normal ⇵ (only neutral layer)"},{id:ae.Nx.LIGHTEN,label:"Lighten"},{id:ae.Nx.SCREEN,label:"Screen"},{id:ae.Nx.DODGE,label:"Dodge"},{id:ae.Nx.ADDITION,label:"Addition"},{id:ae.Nx.DARKEN,label:"Darken"},{id:ae.Nx.MULTIPLY,label:"Multiply"},{id:ae.Nx.BURN,label:"Burn"},{id:ae.Nx.OVERLAY,label:"Overlay"},{id:ae.Nx.SOFTLIGHT,label:"Soft light"},{id:ae.Nx.HARDLIGHT,label:"Hard light"},{id:ae.Nx.DIFFERENCE,label:"Difference"},{id:ae.Nx.EXCLUSION,label:"Exclusion"}];var Yi=a(23668),Qi=a(13271);var Ki=function({color:e,onChange:t,values:a}){const r=(0,n.useMemo)((()=>{switch(e){case"r":return"#ff0000";case"g":return"#00dd00";case"b":return"#0000ff";default:return"#888888"}}),[e]);return n.createElement(F.A,{direction:"row",gap:2,alignItems:"center",sx:{pr:2}},n.createElement(g.A,{title:"Reset",onClick:()=>{t([0,85,170,255])}},n.createElement(Yi.A,null)),n.createElement(Qi.Ay,{min:0,max:255,value:a,sx:{color:r},defaultValue:[0,85,170,255],onChange:(e,a)=>{t(a)},disableSwap:!0}))};var qi=function(e){const[t,a]=(0,n.useState)(e.values),r=(0,Hi.A)((t=>{e.onChange(t,!0)}),150,{leading:!0,trailing:!0}),l=(e,n)=>{const l={...t,[e]:n};a(l),r.callback(l)},o=["r","g","b","n"].reduce(((t,a)=>e.useChannels[a]?[...t,a]:t),[]);return n.createElement(F.A,{direction:"column",gap:3},o.map((e=>n.createElement(F.A,{key:`slider-${e}`,direction:"column",gap:0},"n"===e?n.createElement(Ga.A,{value:t.blend,label:"Neutral Layer Blendmode",select:!0,size:"small",onChange:e=>{l("blend",e.target.value)}},Xi.map((({id:e,label:t})=>n.createElement($e.A,{key:e,value:e},t)))):null,n.createElement(Ki,{color:e,values:t[e],onChange:t=>{l(e,t)}})))))};var Zi=function({palette:e,fontSize:t}){return n.createElement(y.A,{sx:{display:"inline-block",fontSize:t||"2rem",width:"1em",height:"1em",lineHeight:"1em",verticalAlign:"middle",borderRadius:"50%",...Yo(e,Xo.CONIC),"&:hover":{animation:"spin 800ms infinite linear"}}})};var Ji=function({value:e,allowEmpty:t,invertPalette:a,noFancy:r,onChange:l,updateInvertPalette:o}){const[i,s]=(0,n.useState)(e),{palettes:c}=(0,se.h)(),u=(0,v.A)(),{sortFn:m}=aF(),d=[...c].sort(m);return t&&d.unshift({shortName:"",name:"As selected per image",palette:[],isPredefined:!1,origin:""}),n.createElement(F.A,{direction:"column",gap:2},n.createElement(Ga.A,{value:e,label:"Palette",size:"small",select:!0,onChange:e=>{l(e.target.value,!0),s(e.target.value)}},d.map((({shortName:e,name:t,palette:a})=>n.createElement($e.A,{key:e,value:e},n.createElement(Oe.A,null,n.createElement(Zi,{palette:a,fontSize:"1.5rem"})),n.createElement(_e.A,null,t))))),o?n.createElement(VF.A,{label:"Invert Palette",control:n.createElement(UF.A,{checked:a,onChange:({target:e})=>{o(e.checked)}})}):null,r?null:n.createElement(y.A,{component:"ul",sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, 2.5rem)",justifyContent:"center",gap:.25,button:{padding:0,cursor:"pointer",width:"2.5rem",height:"2.5rem",border:"none",borderRadius:"50%"}}},d.map((({shortName:e,name:t,palette:a})=>n.createElement(y.A,{component:"li",key:e},n.createElement("button",{type:"button",title:t,style:{background:e===i?u.palette.tertiary.main:"transparent"},onMouseEnter:()=>{l(e,!1)},onMouseLeave:()=>{l(i,!1)},onClick:()=>{l(e,!0),s(e)}},n.createElement(Zi,{palette:a})))))))},es=a(82077),ts=a(42149),as=a(88824),ns=a(78670),rs=a(16014);var ls=function({children:e}){const t=(0,v.A)(),a=(0,n.useMemo)((()=>{if(!t.components?.MuiTextField)return t;const e={...t.components.MuiTextField};return e.defaultProps?.slotProps?.htmlInput&&delete e.defaultProps.slotProps.htmlInput,{...t,components:{...t.components,MuiTextField:e}}}),[t]);return n.createElement(qF.A,{theme:a},e)};const os=e=>(0,z.A)(e.map((({tags:e})=>e)).flat()).filter((e=>e!==Ne.X3.FILTER_FAVOURITE)).sort(((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase()))),Fs=()=>{const{images:e}=(0,se.h)(),[t,a]=(0,n.useState)(os(e));return(0,n.useEffect)((()=>{a(os(e))}),[e]),{availableTags:t}};var is;!function(e){e.ADD="add",e.REMOVE="remove"}(is||(is={}));var ss=(e,{mode:t,tag:a})=>{switch(t){case"add":return{add:[...e.add,a],remove:[...e.remove.filter((e=>e!==a))]};case"remove":return{remove:[...e.remove,a],add:[...e.add.filter((e=>e!==a))]};default:return e}};var cs=function({updateTags:e,selectedTags:t}){const{availableTags:a}=Fs(),r=a.filter((e=>!t.includes(e))),[l,o]=(0,n.useState)("");return n.createElement(ls,null,n.createElement(rs.A,{options:r,fullWidth:!0,size:"small",inputValue:l,renderInput:e=>n.createElement(Ga.A,{...e,label:"Tags"}),clearOnBlur:!0,clearOnEscape:!0,freeSolo:!0,onInputChange:(e,t,a)=>{switch(a){case"input":o(t||"");break;case"reset":case"clear":case"blur":o("")}},onChange:(t,a,n)=>{const r=a||"";switch(n){case"createOption":case"selectOption":e(is.ADD,r.trim())}}}))};var us=function({tags:e,updateTags:t,resetTags:a}){const r=(0,z.A)([...e.initial,...e.add]);return n.createElement(F.A,{direction:"column",gap:2},n.createElement(cs,{updateTags:t,selectedTags:r}),r.length>0&&n.createElement(F.A,{direction:"row",gap:1,flexWrap:"wrap",alignItems:"center",sx:{".MuiChip-root":{my:"1px"}}},r.map((a=>{const r=e.add.includes(a),l=e.remove.includes(a);let o;return o=r?"success":l?"error":"default",n.createElement(Re.A,{key:a,label:n.createElement(F.A,{direction:"row",gap:1,alignItems:"center"},a===Ne.X3.FILTER_FAVOURITE?"❤️":a,n.createElement(F.A,{direction:"row",gap:0,sx:{mr:-1,".MuiButtonBase-root":{opacity:.4,borderRadius:"50%","&:hover":{opacity:1},"&:focus-visible":{opacity:1,background:"color-mix(in srgb, currentColor 20%, transparent)"}}}},n.createElement(ts.A,{onClick:()=>t(is.ADD,a)},n.createElement(es.A,null)),n.createElement(ts.A,{onClick:()=>t(is.REMOVE,a)},n.createElement(as.A,null)))),color:o,variant:"filled"})})),e.add.length+e.remove.length>0&&n.createElement(g.A,{onClick:a,title:"Reset tags",size:"small"},n.createElement(ns.A,null))))},ms=a(22982),ds=a(75737),ps=a(44843),gs=a(91799),hs=a(80688);const fs=[ne.pL.DEG_0,ne.pL.DEG_90,ne.pL.DEG_180,ne.pL.DEG_270];var Es,As=function({created:e,hash:t,hashes:r,updateCreated:l,meta:o,rotation:i,updateRotation:s}){const c={...o,hash:t},m=Object.keys(c).reduce(((e,t)=>{let a;a="number"!=typeof c[t]&&"string"!=typeof c[t]?JSON.stringify(c[t]):c[t];return[...e,{key:t,value:a}]}),[]);if(r){const e=Object.keys(r).reduce(((e,t)=>[...e,{key:`hash ${t}`,value:r[t]}]),[]);m.push(...e)}const{preferredLocale:d}=(0,u.A)(),[p,g]=(0,n.useState)(void 0);return(0,n.useEffect)((()=>{(async()=>{const e=d.toLowerCase();try{await a(76776)(`./${e}.js`),g(e)}catch{try{const t=e.split("-")[0];await a(76776)(`./${t}.js`),g(t)}catch{g(void 0)}}})()}),[d]),n.createElement(F.A,{direction:"column",gap:4},n.createElement(ls,null,n.createElement(ds.$,{dateAdapter:ms.R,adapterLocale:p},n.createElement(ps.K,{label:"Date / Time",closeOnSelect:!1,views:["year","month","day","hours","minutes","seconds"],value:We()(e),onAccept:e=>{e&&l(e.format(ue.i$))}}))),n.createElement(gs.A,null,n.createElement(hs.A,{shrink:!0},"Edit Rotation"),n.createElement(gt.A,{exclusive:!0,fullWidth:!0,value:i||ne.pL.DEG_0,onChange:(e,t)=>{s(t)}},fs.map((e=>n.createElement(pt.A,{key:e,value:e},90*e+"°"))))),n.createElement(Xa.A,null,n.createElement(za.A,{padding:"none",sx:{fontFamily:"monospace"}},n.createElement(Wa.A,null,m.map((({key:e,value:t})=>n.createElement(Qa.A,{key:e},n.createElement(Ha.A,{component:"th",scope:"row"},e),n.createElement(Ha.A,{align:"right"},t))))))))};!function(e){e.PALETTE="pal",e.FRAME="frame",e.TAGS="tags",e.MISC="misc"}(Es||(Es={}));const vs=(e,t)=>{switch(e){case Es.FRAME:return"Frame";case Es.MISC:return"Misc";case Es.PALETTE:return t?"Colors":"Palette";case Es.TAGS:return"Tags";default:return""}};var bs=function(e){const t=(0,n.useMemo)((()=>{const t=[];return e.mixedTypes||t.push(Es.PALETTE),e.regularImage&&t.push(Es.FRAME),t.push(Es.TAGS,Es.MISC),t}),[e.mixedTypes,e.regularImage]),[a,r]=(0,n.useState)(null);return(0,n.useEffect)((()=>{r(t[0])}),[t]),n.createElement(F.A,{direction:"column",spacing:1},n.createElement(_i.Ay,{value:a||t[0]},n.createElement(ji.A,{variant:"fullWidth",indicatorColor:"secondary",allowScrollButtonsMobile:!1},t.map((t=>n.createElement(Bo.A,{label:vs(t,!!e.paletteRGBN),key:t,value:t,onClick:()=>r(t)})))),n.createElement(Vi.A,{value:Es.PALETTE},e.paletteRGBN?n.createElement(qi,{values:e.paletteRGBN,onChange:e.updatePalette,useChannels:{r:!!e.hashes?.r,g:!!e.hashes?.g,b:!!e.hashes?.b,n:!!e.hashes?.n}}):n.createElement(Ji,{value:e.paletteShort||"",invertPalette:e.invertPalette,onChange:e.updatePalette,updateInvertPalette:e.updateInvertPalette})),n.createElement(Vi.A,{value:Es.FRAME},n.createElement(Wi,{updateFrame:e.updateFrame,updateFrameLock:e.updateFrameLock,frame:e.frame||"",lockFrame:e.lockFrame}),e.lockFrame&&!e.paletteRGBN?n.createElement(Ji,{value:e.framePaletteShort||"",invertPalette:e.invertFramePalette,onChange:e.updateFramePalette,updateInvertPalette:e.updateInvertFramePalette}):null),n.createElement(Vi.A,{value:Es.TAGS},n.createElement(us,{updateTags:e.updateTags,resetTags:e.resetTags,tags:e.tags})),n.createElement(Vi.A,{value:Es.MISC},n.createElement(As,{created:e.created,hash:e.hash,hashes:e.hashes,updateCreated:e.updateCreated,meta:e.meta,rotation:e.rotation,updateRotation:e.updateRotation}))))},ys=a(88137);var ws=({initial:e,add:t,remove:a})=>(0,z.A)([...e,...t]).filter((e=>!a.includes(e)));var Is=()=>{const{editImages:e,cancelEditImages:t}=Y(),{sortBy:a}=(0,j.A)(),{images:r}=(0,se.h)(),{updateImages:l}=Ae();return{batchUpdateImages:(0,n.useCallback)((({shouldUpdate:n,updates:o,tagChanges:F})=>{const i=(0,ys.PM)(a),s=e?.batch||[];if(n&&s?.length){const e=s.reduce(((e,t)=>{const a=r.find((({hash:e})=>e===t));return a?[...e,a]:e}),[]).map(ys.YZ).sort(i).map(ys.lt).map(((e,t)=>$t.reduce(((e,a)=>{if(!n[a])return e;switch(a){case Bt.TITLE:return{...e,title:o.title.replace(/%(n+)/gi,((e,a)=>(t+1).toString(10).padStart(a.length,"0")))};case Bt.TAGS:{const t=ws({...F,initial:e.tags});return{...e,tags:t}}case Bt.ROTATION:case Bt.LOCK_FRAME:case Bt.FRAME:case Bt.CREATED:return{...e,[a]:o[a]}}if((0,st.pl)(e)){const t=e;return a===Bt.PALETTE?{...t,palette:o.palette}:t}{const t=e;switch(a){case Bt.PALETTE:case Lt.FRAME_PALETTE:case Lt.INVERT_FRAME_PALETTE:case Lt.INVERT_PALETTE:return{...t,[a]:o[a]};default:return t}}}),e)));l(e)}t()}),[t,e?.batch,r,a,l])}};var Cs=a(96763);var Ss=function(){const{toEdit:e,form:t,isRegularImage:a,willUpdateBatch:r,tagChanges:l,usedPalette:o,usedFramePalette:i,updateForm:s,updatePalette:c,updateFramePalette:u,updateTags:m,resetTags:d,save:p,cancel:g}=(()=>{const{editImages:e,cancelEditImages:t}=Y(),{palettes:a,frames:r,images:l}=(0,se.h)(),{batchUpdateImages:o}=Is(),F=e=>a.find((t=>e===t.shortName))||ue.Fv,i=(0,ce.p)(l,r),{windowDimensions:s}=(0,Ee.A)(),c=(0,n.useMemo)((()=>{if(!e)return;const t=e.batch||[],a=e.tags||[];if(!t[0])return;const n=l.find((({hash:e})=>e===t[0]));if(!n)return;const r=s.width<=600?s.height:Math.min(900,s.height),o=t.reduce(((e,t)=>{const a=l.find((({hash:e})=>e===t));if(!a)return e;const n=(0,st.pl)(a);return{mono:e.mono||!n,rgb:e.rgb||n}}),{mono:!1,rgb:!1}),F=o.mono&&o.rgb,i=(0,st.pl)(n)?n.palette:void 0,c=(0,st.pl)(n)?void 0:n.palette,u=(0,st.pl)(n)?void 0:n.framePalette;return{created:n.created,hash:n.hash,height:r,imageCount:t?.length||0,invertPalette:n.invertPalette||!1,invertFramePalette:n.invertFramePalette||!1,lockFrame:n.lockFrame||!1,mixedTypes:F,tags:a,title:n.title,frame:n.frame,hashes:(0,st.pl)(n)?n.hashes:void 0,meta:n.meta,paletteRGBN:i,paletteShort:c,framePaletteShort:u,rotation:n.rotation}}),[e,l,s]),[u,m]=(0,n.useState)(c?.title||""),[d,p]=(0,n.useState)(c?.created||""),[g,h]=(0,n.useState)(c?.frame||""),[f,E]=(0,n.useState)(c?.lockFrame),[A,v]=(0,n.useState)(c?.rotation),[b,y]=(0,n.useState)(c?.invertPalette),[w,I]=(0,n.useState)(c?.invertFramePalette),[C,S]=(0,n.useState)(c?.paletteShort||""),[x,k]=(0,n.useState)(c?.framePaletteShort||""),[P,T]=(0,n.useState)(c?.paletteRGBN),[D,M]=(0,n.useState)(!1),R={title:u,created:d,frame:g,lockFrame:f,rotation:A,invertPalette:b,paletteShort:C,framePaletteShort:x,invertFramePalette:w,paletteRGBN:P},N=P||F(C).palette,B=F(x).palette,L=c?.hash;(0,n.useEffect)((()=>{(async()=>{if(!L)return;const e=await i(L);M(360===e)})()}),[i,L]);const[G,$]=(0,n.useState)({initial:c?.tags||[],add:[],remove:[]}),[O,_]=(0,n.useState)({created:!1,title:!1,frame:!1,lockFrame:!1,tags:!1,rotation:!1,palette:!1,invertPalette:!1,framePalette:!1,invertFramePalette:!1});return{toEdit:c,form:R,isRegularImage:D,shouldUpdate:O,willUpdateBatch:(j=O,[j.created?"Update date":"",j.title?"Update title":"",j.palette?"Update image palette colors":"",j.invertPalette?"Update invert image palette setting":"",j.frame?"Update frame":"",j.lockFrame?"Update separate frame settings":"",j.framePalette?"Update frame palette colors":"",j.invertFramePalette?"Update invert frame palette setting":"",j.tags?"Update tags":"",j.rotation?"Update rotation":""].filter(Boolean)),tagChanges:G,usedPalette:N,usedFramePalette:B,updateForm:e=>t=>{switch(_({...O,[e]:!0}),e){case"title":m(t);break;case"created":p(t);break;case"invertPalette":y(t);break;case"invertFramePalette":I(t);break;case"framePalette":k(t);break;case"frame":h(t);break;case"lockFrame":E(t);break;case"rotation":v(t)}},updatePalette:(e,t)=>{e&&(t&&_({...O,palette:!0}),"string"==typeof e?S(e):T(e))},updateFramePalette:(e,t)=>{t&&_({...O,framePalette:!0}),k(e)},updateTags:(e,t)=>{_({...O,tags:!0}),$({...G,...ss(G,{mode:e,tag:t})})},resetTags:()=>{_({...O,tags:!1}),$((({initial:e})=>({initial:e,add:[],remove:[]})))},save:()=>{o({shouldUpdate:O,updates:{title:u,created:d,frame:g,lockFrame:f,rotation:A,palette:P||C,invertPalette:b||!1,framePalette:x,invertFramePalette:w||!1},tagChanges:G})},cancel:()=>t()};var j})();if(!e)return Cs.warn('Editform should be open, but "toEdit" is undefined',e),null;const{title:h,created:f,frame:E,lockFrame:A,rotation:v,invertPalette:b,invertFramePalette:w,framePaletteShort:I,paletteShort:C,paletteRGBN:S}=t;return n.createElement(R,{contentHeight:e.height,header:`Editing ${e.imageCount} image(s)`,open:!0,confirm:p,deny:g},n.createElement(F.A,{direction:"column",gap:4},n.createElement(y.A,{sx:e=>({mx:e.spacing(-2),mt:e.spacing(-2),position:"relative"})},n.createElement(Me,{lockFrame:A,invertPalette:b,palette:o,invertFramePalette:w,framePalette:i,frameId:E,hash:e.hash,hashes:e.hashes,rotation:v}),e.imageCount>1?n.createElement(Va.A,{severity:"info",sx:{position:"absolute",width:"75%",top:"21%",left:"50%",transform:"translate(-50%, -50%)"}},n.createElement(Oi.A,null,`You are editing ${e.imageCount} images`),r.length?n.createElement(y.A,{component:"ul"},r.map((e=>n.createElement(ua.A,{key:e,component:"li",variant:"caption"},e)))):null):null),n.createElement(Ga.A,{helperText:e.imageCount>1?"Use %n (or %nn, %nnn, ...) to add an index to the image titles":void 0,type:"text",label:"Edit title",value:h,onChange:({target:{value:e}})=>{s("title")(e)}}),n.createElement(bs,{created:f,updateCreated:s("created"),regularImage:a,mixedTypes:e.mixedTypes,lockFrame:A,hash:e.hash,hashes:e.hashes,paletteShort:C,framePaletteShort:I,paletteRGBN:S,invertPalette:b,invertFramePalette:w,frame:E,tags:l,meta:e.meta,rotation:v,updatePalette:c,updateInvertPalette:s("invertPalette"),updateFramePalette:u,updateInvertFramePalette:s("invertFramePalette"),updateFrame:s("frame"),updateFrameLock:s("lockFrame"),updateRotation:s("rotation"),updateTags:m,resetTags:d})))};var xs=function(){const{editId:e,absoluteSlug:t,possibleParents:a,slug:r,title:l,canConfirm:o,canMove:i,slugIsInUse:s,slugWasChanged:c,parentSlug:u,selectionCount:m,setSlug:d,setTitle:p,setParentSlug:g,confirm:h,move:f,cancelEditImageGroup:E}=et();return n.createElement(R,{confirm:h,canConfirm:o,header:e!==Ke?"Editing group "+(l?`"${l}"`:""):`Create new group with ${m} images`,deny:E,contentWidth:"auto",actionButtons:a.length>1&&e===Ke&&n.createElement(w.A,{disabled:!i,onClick:f,variant:"contained",color:"secondary"},`Move ${m} selected images`)},n.createElement(F.A,{direction:"column",gap:4},e&&n.createElement(n.Fragment,null,n.createElement(Ga.A,{label:"Title",size:"small",type:"text",value:l,onChange:e=>p(e.target.value)}),n.createElement(Ga.A,{label:"Pathsegment (identifier)",size:"small",type:"text",value:r,onChange:e=>d(e.target.value),helperText:s?`Path${c?" is already in use":""}: "${t}"`:`Path: "${t}"`,error:!o}),a.length>1&&n.createElement(Ga.A,{label:"Parent group",size:"small",select:!0,onChange:e=>g(e.target.value),value:u},a.map((({value:e,name:t})=>n.createElement($e.A,{key:e,value:e},t)))),n.createElement(da,{text:JSON.stringify({slug:r,parentSlug:u,canConfirm:o,slugIsInUse:s},null,2)}))))};var ks=e=>{const t=e?.id||"",{cancelEditFrame:a}=Y(),{frames:r}=(0,se.h)(),{frameGroups:l,addFrames:o}=(0,se.h)(),{updateLastSyncLocalNow:F}=Ae(),i=(0,ko.A)(r,l),s=/^(?<groupName>[a-z]+)(?<id>[0-9]+)/g.exec(t),c=s?.groups?.groupName||"",u=s?.groups?.id||"0",[m,d]=(0,n.useState)(c),[p,g]=(0,n.useState)(parseInt(u,10)),[h,f]=(0,n.useState)(e?.name||""),E=`${m}${p.toString(10).padStart(2,"0")}`,A=E===t||!r.find((e=>E===e.id)),v=Boolean(m.match(/^[a-z]{2,}$/g)),b=p>0;return{groups:i,updateId:t,fullId:E,frameIndex:p,frameGroup:m,frameName:h,idValid:A,formValid:A&&v&&b,groupIdValid:v,frameIndexValid:b,setFrameIndex:g,setFrameGroup:d,setFrameName:f,saveFrame:()=>{a(),F(),o([{hash:e?.hash||"",id:E,name:h}])},cancelEdit:a}};var Ps=function({frameIndex:e,frameName:t,idValid:a,groupIdValid:r,frameIndexValid:l,frameGroup:o,groups:i,fullId:s,frameGroupName:c,extraFields:u,setFrameGroupName:m,setFrameIndex:d,setFrameGroup:p,setFrameName:g}){const h=Boolean(i.find((({id:e})=>o===e)));return n.createElement(F.A,{direction:"column",gap:4},u,n.createElement(Ga.A,{label:"Frame group",select:!0,size:"small",type:"text",value:o,onChange:e=>{p(e.target.value)},slotProps:{inputLabel:{shrink:!0},select:{renderValue:e=>h?i.find((({id:t})=>t===e))?.name||"Unknown":""===e?"Select frame group":"New frame group"}}},n.createElement($e.A,{value:""},h?"Select frame group":"New frame group"),i.map((({id:e,name:t})=>n.createElement($e.A,{value:e,key:e},t)))),n.createElement(Ga.A,{label:h?"Frame group id":"New frame group id",size:"small",type:"text",value:o,onChange:e=>{p(e.target.value)},helperText:r?void 0:"Must have at least two characters, only lowercase"}),m?n.createElement(Ga.A,{label:"New frame group name",size:"small",type:"text",onChange:e=>{m(e.target.value)},value:h?"":c,disabled:h}):null,n.createElement(Ga.A,{label:"Frame Index",size:"small",type:"number",slotProps:{htmlInput:{min:1,max:99}},value:e,onChange:e=>{d(parseInt(e.target.value,10))},helperText:l?null:"Integer, must be greater than 0"}),n.createElement(Ga.A,{label:"Frame name",size:"small",type:"text",value:t,onChange:e=>{g(e.target.value)}}),!a&&n.createElement(Va.A,{severity:"warning",variant:"filled"},`Specified frame index/identifier "${s}" is already in use, please try another one.`))};var Ts=()=>{const{editFrame:e}=Y(),{frames:t}=(0,se.h)(),a=t.find((({id:t})=>t===e)),{cancelEdit:r,saveFrame:l,updateId:o,fullId:F,formValid:i,groups:s,frameGroup:c,frameIndex:u,setFrameIndex:m,frameName:d,setFrameGroup:p,setFrameName:g,idValid:h,groupIdValid:f,frameIndexValid:E}=ks(a),A=o!==F?` -> "${F}"`:"";return n.createElement(R,{confirm:l,canConfirm:i,header:a?`Editing frame "${o}"${A}`:`Error editing '${e}'`,deny:r},a?n.createElement(Ps,{groups:s,fullId:F,frameIndex:u,frameGroup:c,frameName:d,idValid:h,groupIdValid:f,frameIndexValid:E,setFrameIndex:m,setFrameGroup:p,setFrameName:g}):n.createElement(Va.A,{severity:"error",variant:"filled"},`A frame with the ID '${e}' does not exist!`))},Ds=a(47195);const Ms=e=>/^#[0-9a-fA-F]{6}$/.test(e);var Rs=function({value:e,onChange:t,label:a}){const[r,l]=(0,n.useState)(e),[o]=(0,n.useState)(`id-${Math.random().toString(16).split(".")[1]}`);(0,n.useEffect)((()=>{l(e)}),[e]);const i=(0,n.useRef)(t);return(0,n.useEffect)((()=>{i.current=t}),[t]),(0,n.useEffect)((()=>{const e=setTimeout((()=>{Ms(r)&&i.current(r)}),125);return()=>{clearTimeout(e)}}),[r]),n.createElement(gs.A,{variant:"outlined",fullWidth:!0,size:"small",color:"tertiary",sx:{"--palette-color":Ms(r)?r:"#000000",".MuiOutlinedInput-notchedOutline":{inset:0},"[type=color]":{height:"100%",width:"100%",opacity:"0",cursor:"pointer"}}},n.createElement(hs.A,{shrink:!0,htmlFor:o},a),n.createElement(F.A,{direction:"row",gap:1,sx:{"& > *":{flexBasis:"auto",flexShrink:0,flexGrow:1},"& > *:first-of-type":{flexBasis:"40px",flexShrink:0,flexGrow:0,backgroundColor:"var(--palette-color)"}}},n.createElement(Ua.A,{variant:"outlined"},n.createElement("input",{type:"color",value:r,onChange:e=>l(e.target.value),tabIndex:-1})),n.createElement(Ds.A,{id:o,type:"text",value:r,onChange:e=>l(e.target.value),onBlur:e=>l(e.target.value.toLowerCase())})))};const Ns=(0,ye.A)("hash");var Bs=()=>{const{images:e}=(0,se.h)(),{imageSelection:t,sortBy:a,filtersActiveTags:r,recentImports:l}=(0,j.A)(),o=(0,n.useMemo)((()=>({sortBy:a,filtersActiveTags:r,recentImports:l})),[r,l,a]);return(0,n.useMemo)((()=>{const a=t.map((t=>e.find((({hash:e})=>e===t)))).reduce(st.iy,[]),n=a.length>1?[]:(0,_.S)(e,o).reduce(st.iy,[]),r=a.length+n.length>1?[]:[...e].map(ys.YZ).sort((0,ys.PM)(o.sortBy)).map(ys.lt).reduce(st.iy,[]),l=Ns([a.shift(),n.shift(),r.shift(),r.pop(),n.pop(),a.pop()].reduce(st.iy,[]));return[l.shift(),l.pop()].reduce(st.iy,[])}),[o,t,e])};var Ls=function(){const{canConfirm:e,canEditShortName:t,newName:a,newShortName:r,palette:l,previewImages:o,shortName:i,setNewName:s,setNewShortName:c,setPalette:u,save:m,cancelEditPalette:d}=(()=>{const{editPalette:e,cancelEditPalette:t}=Y(),{palettes:a,addPalettes:r}=(0,se.h)(),{updateLastSyncLocalNow:l}=Ae(),o=e?.shortName||"",F=e?.palette||[],i=e?.name||"",s=(0,n.useCallback)((e=>!!e.match(/^[a-z]+[a-z0-9]*$/gi)&&-1===a.findIndex((t=>t.shortName===e))),[a]),c=o===Ne.mI,[u,m]=(0,n.useState)(i),[d,p]=(0,n.useState)(F),[g,h]=(0,n.useState)(c?"":o),f=(0,n.useMemo)((()=>(!c||s(g))&&u.length>0),[u,c,g,s]),E=Bs(),A=(0,n.useCallback)((()=>{r([{shortName:c?g:o,name:u,palette:d,origin:"Made with the webapp",isPredefined:!1}]),l(),t()}),[r,c,t,u,g,d,o,l]);return(0,n.useEffect)((()=>{const e=e=>{"Enter"===e.key&&e.ctrlKey&&f&&A()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)})),{canConfirm:f,canEditShortName:c,newName:u,newShortName:g,palette:d,previewImages:E,shortName:o,setNewName:m,setNewShortName:h,setPalette:p,save:A,cancelEditPalette:t}})(),p=(0,n.useCallback)((e=>{s(e.target.value)}),[s]),g=(0,n.useCallback)((e=>{c(e.target.value)}),[c]),h=(0,n.useCallback)((e=>{c(e.target.value.toLowerCase())}),[c]),f=(0,n.useCallback)(((e,t)=>{const a=[...l];a[e]=t,u(a)}),[l,u]);return i?n.createElement(R,{confirm:m,canConfirm:e,deny:d,header:"Editing palette "+(a?`"${a}"`:""),closeOnOverlayClick:!1},n.createElement(F.A,{direction:"column",gap:4},n.createElement(Ga.A,{label:"Edit Title",size:"small",type:"text",placeholder:"Add a title",value:a,onChange:p}),n.createElement(Ga.A,{label:"ID/Short name",size:"small",type:"text",value:r,disabled:!t,onChange:g,onBlur:h,required:!0}),n.createElement(F.A,{direction:"row",gap:2,component:"ul",justifyContent:"space-around"},o.map((e=>n.createElement(y.A,{key:e.hash,component:"li"},n.createElement(Me,{hash:e.hash,invertPalette:!1,invertFramePalette:!1,lockFrame:!1,palette:l,framePalette:l}))))),l.map(((e,t)=>n.createElement(Rs,{key:`color-${t}`,label:`Color ${t+1}`,value:e,onChange:e=>f(t,e)}))))):null},Gs=a(20700),$s=a(74802),Os=a.n($s);var _s,js=()=>{const{setImageSelection:e}=(0,j.A)(),{addImages:t}=Ae();return{saveRGBNImage:(0,n.useCallback)((async n=>{const{default:r}=await Promise.resolve().then(a.t.bind(a,74802,23)),l=We()(),o=n.map(((e,t)=>({palette:ue.YP,hashes:e,hash:r(e),created:l.add(t,"milliseconds").format(ue.i$),title:"",tags:[]})));t(o),e(o.map((e=>e.hash)))}),[t,e])}};!function(e){e.BY_COLOR="BY_COLOR",e.BY_IMAGE="BY_IMAGE",e.MANUAL="MANUAL"}(_s||(_s={}));var Vs=a(736),Us=a(58381);const zs=e=>{switch(e){case"r":return"#ff0000";case"g":return"#00aa00";case"b":return"#0000ff";default:return"#444444"}};var Ws=function({isR:e,isG:t,isB:a,isN:r,toggleChannel:l}){const o=(0,n.useMemo)((()=>[{value:e,updateKey:"r"},{value:t,updateKey:"g"},{value:a,updateKey:"b"},{value:r,updateKey:"n"}]),[a,t,r,e]);return n.createElement(gt.A,{onChange:(e,t)=>l(t),fullWidth:!0,sx:{".MuiToggleButton-root":{padding:"1px",border:"none"}}},o.map((({value:e,updateKey:t})=>n.createElement(pt.A,{value:t,key:t,sx:{"& svg":{color:zs(t)}}},e?n.createElement(Vs.A,null):n.createElement(Us.A,null)))))};var Hs=function(){const{canConfirm:e,order:t,grouping:a,lengthWarning:r,rgbnHashes:i,sortedImages:s,createGroup:c,updateOrder:u,toggleSingleChannel:m,setGrouping:d,setCreateGroup:p,save:g,cancelEditRGBNImages:h}=(()=>{const{navigateToGroup:e}=Qe(),{view:t}=$(),{saveRGBNImage:a}=js(),{sortBy:r}=(0,j.A)(),{editRGBNImages:l,cancelEditRGBNImages:o,cancelEditImageGroup:F}=Y(),{addImageGroup:i,images:s}=(0,se.h)(),[c,u]=(0,n.useState)(l.length>5),m=r.split("_")[1],d=(0,n.useMemo)((()=>{const e=(0,_.S)(s,{filtersActiveTags:[],sortBy:r,recentImports:[]});return"desc"===m&&e.reverse(),e.reduce(st.iy,[]).reduce(((e,t)=>l.includes(t.hash)?[...e,t]:e),[])}),[l,m,s,r]),[p,g]=(0,n.useState)(["r","g","b","s","n"]),[h,f]=(0,n.useState)(d.length<=4?_s.MANUAL:_s.BY_COLOR),[E,A]=(0,n.useState)({r:d[0]?.hash||void 0,g:d[Math.floor(d.length/3)]?.hash||void 0,b:d[2*Math.floor(d.length/3)]?.hash||void 0}),v=p.findIndex((e=>"s"===e)),b=Math.ceil(l.length/v),y=v*b!==l.length,w=(0,n.useMemo)((()=>{switch(h){case _s.MANUAL:return Object.keys(E).length?[E]:[];case _s.BY_COLOR:case _s.BY_IMAGE:default:{const e=p.slice(0,v),t=Array(b).fill("").map(((t,a)=>e.reduce(((e,t,n)=>{const r=h===_s.BY_COLOR?a+b*n:n+v*a,l=d[r]?.hash;return l?{...e,[t]:l}:e}),{})));return"desc"===m&&t.reverse(),t}}}),[b,m,h,E,p,d,v]),I=h===_s.MANUAL;return{order:p,grouping:h,canConfirm:I?w.length>0:p.length>1,lengthWarning:!I&&y,rgbnHashes:w,sortedImages:d,createGroup:c,updateOrder:(e,t)=>{if(t<0||t>p.length)return;const a=p.filter((t=>t!==e));a.splice(t,0,e).filter(Boolean),g(a)},toggleSingleChannel:(e,t)=>{const a={...E};a[e]===t?delete a[e]:a[e]=t,A(a)},setGrouping:f,save:async()=>{if(o(),await a(w),c){const a=`RGB ${We()().format(ue.fg)}`,n=qe(a),r=w.map((e=>Os()(e)));F();const l=He();i({id:l,slug:n,title:a,created:We()(Date.now()).format(ue.i$),coverImage:r[0],images:r,groups:[]},t.id),e(l)}},setCreateGroup:u,cancelEditRGBNImages:o}})(),f=(0,v.A)(),E=(0,P.A)(f.breakpoints.up("sm"));return n.createElement(R,{confirm:g,deny:h,closeOnOverlayClick:!1,canConfirm:e&&!r,header:"Create RGBN images",contentWidth:"576px"},n.createElement(F.A,{direction:"column",gap:4},n.createElement(Ga.A,{label:"Grouping of your selection",select:!0,size:"small",value:a,onChange:e=>d(e.target.value)},n.createElement($e.A,{value:_s.BY_COLOR},"Selection is grouped by colors (RRR GGG BBB)"),n.createElement($e.A,{value:_s.BY_IMAGE},"Selection is grouped by image (RGB RGB RGB)"),n.createElement($e.A,{value:_s.MANUAL},"Manual channel selection for a single image")),a===_s.MANUAL?n.createElement(F.A,{direction:"column",gap:1},n.createElement(ua.A,{variant:"body2"},"Manually select the channels to create a single RGBN image"),n.createElement(F.A,{direction:"row",gap:2,component:"ul",justifyContent:"center",alignItems:"center",flexWrap:"wrap",sx:{"& .MuiCardContent-root":{padding:1}}},s.map((({hash:e})=>{const t=i[0]?.r===e,a=i[0]?.g===e,r=i[0]?.b===e,F=i[0]?.n===e,s=function(e,t,a,n){const r=e?255:0,l=t?255:0,o=a?255:0,F=(e,t,a,n)=>{const r=(e,t)=>Math.floor(e*t).toString(16).padStart(2,"0");return`#${r(e,n)}${r(t,n)}${r(a,n)}`};return e||t||a?[F(r,l,o,1),F(r,l,o,.66),F(r,l,o,.33),"#000000"]:n?["#ffffff","#aaaaaa","#555555","#000000"]:["#b2b2b2","#949494","#737373","#606060"]}(t,a,r,F);return n.createElement(l.A,{key:e,className:"edit-rgbn__single-image-list-entry",variant:"outlined"},n.createElement(o.A,{sx:{".gameboy-image":{width:"80px",margin:"0 auto",imageRendering:"auto"}}},n.createElement(Me,{lockFrame:!1,invertPalette:!1,invertFramePalette:!1,palette:s,framePalette:s,hash:e})),n.createElement(Gs.A,null,n.createElement(Ws,{isR:t,isG:a,isB:r,isN:F,toggleChannel:t=>m(t,e)})))})))):n.createElement(F.A,{direction:"column",gap:1},n.createElement(ua.A,{variant:"body2"},"Select the order of channels to be applied (in the order of images taken). Channels to the right of the separator will not be used."),n.createElement(F.A,{direction:{xs:"column",sm:"row"},gap:{xs:1,sm:2},component:"ul",justifyContent:"center",alignItems:"center"},t.map(((e,t)=>"s"===e?n.createElement(ei.A,{key:e,orientation:E?"vertical":"horizontal",variant:"middle",flexItem:!0}):n.createElement(wt.A,{key:e,component:"li",size:"small",sx:{backgroundColor:zs(e)}},n.createElement(w.A,{onClick:()=>u(e,t-1),sx:{svg:{color:"#ffffff"}}},E?n.createElement(Sa.A,null):n.createElement(Ri.A,null)),n.createElement(w.A,{onClick:()=>u(e,t+1),sx:{svg:{color:"#ffffff"}}},E?n.createElement(xa.A,null):n.createElement(Ni.A,null)))))),r?n.createElement(Va.A,{variant:"filled",severity:"error"},"Your distribution of channels and number of selected images does not add up!"):null),n.createElement(F.A,{direction:"column",gap:1},n.createElement(ua.A,{variant:"body2"},"Image preview"),n.createElement(F.A,{direction:"row",component:"ul",sx:{overflowX:"auto","& > *":{flex:"160px 0 0",margin:"0 auto"}},gap:1},i.map(((e,t)=>n.createElement(y.A,{key:t,component:"li"},n.createElement(Me,{lockFrame:!1,invertPalette:!1,invertFramePalette:!1,palette:ue.YP,framePalette:[],hash:"newRGBN",hashes:e})))))),n.createElement(VF.A,{label:"Create group from created images at current location",control:n.createElement(UF.A,{checked:c,onChange:({target:e})=>{p(e.checked)}})})))};var Xs=[{id:ae.H.FRAMEMODE_KEEP,name:"Keep frame"},{id:ae.H.FRAMEMODE_CROP,name:"Crop frame"},{id:ae.H.FRAMEMODE_SQUARE_BLACK,name:"Make image squared (add black)"},{id:ae.H.FRAMEMODE_SQUARE_WHITE,name:"Make image squared (add white)"}],Ys=a(34399),Qs=a(4213);const Ks=e=>({scaleFactor:e.scaleFactor||4,frameRate:e.frameRate||12,yoyo:e.yoyo||!1,reverse:e.reverse||!1,frame:e.frame||"",lockFrame:e.lockFrame||!1,invertPalette:e.invertPalette||!1,palette:e.palette||"",exportFrameMode:e.exportFrameMode||ae.H.FRAMEMODE_KEEP}),qs=async()=>{const{setProgress:e,setError:t,videoSelection:a}=Ee.A.getState(),{frames:n,palettes:r,images:l}=se.h.getState(),{videoParams:o,fileNameStyle:F}=u.A.getState();e("gif",.01);const{scaleFactor:i,frameRate:s,yoyo:c,reverse:m,frame:d,lockFrame:p,invertPalette:g,palette:h,exportFrameMode:f}=Ks(o);if(!a.length)return;const E=a.map((e=>l.find((({hash:t})=>t===e)))).reduce(Io.N,[]),A=E.reduce(((e,t)=>{if(!t)return e;const a=(0,st.pl)(t)?{...t,frame:d||t.frame}:{...t,palette:h||t.palette};return[...e,a]}),[]),v=(0,ce.T)(E,n),b=await Promise.all(A.map((async e=>{const t=await v(e.hash),a=p||e.lockFrame||!1,l=e.rotation||0,{palette:o,framePalette:F}=(0,ct.s)(r,{...e,lockFrame:a}),s=n.find((({id:t})=>t===e.frame)),c=s?await(0,me.mZ)(s.hash):null,u=c?c.upper.length/20:2;if(!t||!o)throw new Error("missing tiles or palette");let m;if((0,st.pl)(e))m=new ae.Wd,m.update({canvas:null,tiles:t,palette:o,lockFrame:a});else{m=new ae.XM;const n=o?.palette||ae.CU,r=F?.palette||ae.CU,{invertPalette:l,invertFramePalette:i}=(0,ut.f)(e),s=(0,re.A)({palette:n,invertPalette:g||l,framePalette:a?r:n,invertFramePalette:g||i});m.update({canvas:null,tiles:t,...s,imageStartLine:u})}return(0,ne.Ej)(m.getScaledCanvas(i||1,f),l)})));if(1!==(0,z.A)(b.map((e=>`${e.width}*${e.height}`))).length)return e("gif",0),void t(new Error("All images need to have same dimensions"));const y=[],w=new(Sn())(1,1/0),I=new Ys.e(y,b[0].width,b[0].height,{loop:65535});if(c){const e=[...b].reverse();e.shift(),e.pop(),b.push(...e)}m&&b.reverse();const C=((e,t,a,n)=>(r,l)=>t.add((()=>new Promise(((t,o)=>{const F=r.getContext("2d");if(!F)throw new Error("missing context");const{data:i}=F.getImageData(0,0,r.width,r.height),{palette:s,pixels:c}=In()(i,4).reduce(((e,[t,a,n])=>{const r=(t<<16)+(a<<8)+n;let l=e.palette.findIndex((e=>e===r));return-1===l&&(l=e.palette.length,e.palette.push(r)),e.pixels.push(l),e}),{pixels:[],palette:[]});for(;s.length<256;)s.push(0);try{Ee.A.getState().setProgress("gif",(l+1)/n),window.requestAnimationFrame((()=>{e.addFrame(0,0,r.width,r.height,c,{delay:Math.round(100/a),palette:s}),t(null)}))}catch(e){o(e)}})))))(I,w,s,b.length);await Promise.all(b.map(C));const S=(0,Ot.A)({useCurrentDate:!0,exportScaleFactor:i,frameRate:s,altTitle:"animated",frameName:d,paletteShort:h,fileNameStyle:F}),x=I.end();let k;try{k=new File([new Uint8Array(y.slice(0,x)).buffer],`${S}.gif`,{type:"image/gif"})}catch(e){k=new Blob([new Uint8Array(y.slice(0,x)).buffer])}(0,Qs.saveAs)(k,`${S}.gif`),e("gif",0)};var Zs=function(){const{update:e,cancel:t,imageCount:a,animate:r,videoParams:l}=(()=>{const{videoParams:e,setVideoParams:t}=(0,u.A)(),{videoSelection:a,setVideoSelection:n}=(0,Ee.A)(),r=Ks(e);return{imageCount:a.length||0,videoParams:r,update:t,cancel:()=>{n([])},animate:()=>{qs(),n([])}}})();return a?n.createElement(R,{confirm:r,deny:t,header:`Create an animated GIF with ${a} frames`},n.createElement(F.A,{direction:"column",gap:4},n.createElement(Ga.A,{label:"Framerate",size:"small",type:"number",slotProps:{htmlInput:{min:1,max:120}},value:l.frameRate,onChange:t=>{e({frameRate:parseInt(t.target.value,10)})}}),n.createElement(Ga.A,{label:"Scale GIF",size:"small",type:"number",slotProps:{htmlInput:{min:1,max:12}},value:l.scaleFactor,onChange:t=>{e({scaleFactor:parseInt(t.target.value,10)})}}),n.createElement(VF.A,{label:"Enable Yoyo-Effect (loop back to the beginning)",control:n.createElement(UF.A,{checked:l.yoyo,onChange:t=>{e({yoyo:t.target.checked})}})}),n.createElement(VF.A,{label:"Reverse animation direction",control:n.createElement(UF.A,{checked:l.reverse,onChange:t=>{e({reverse:t.target.checked})}})}),n.createElement(Ji,{noFancy:!0,allowEmpty:!0,value:l.palette||"",invertPalette:l.invertPalette,onChange:t=>{e({palette:t})},updateInvertPalette:t=>{e({invertPalette:t})}}),n.createElement(Ga.A,{label:"How to handle frames when exporting images",size:"small",select:!0,value:l.exportFrameMode,onChange:t=>{e({exportFrameMode:t.target.value})}},Xs.map((({id:e,name:t})=>n.createElement($e.A,{value:e,key:e},t)))),"crop"===l.exportFrameMode?null:n.createElement(Wi,{frame:l.frame||"",lockFrame:l.lockFrame,noFrameOption:"As selected per image",updateFrame:t=>{e({frame:t})},updateFrameLock:t=>{e({lockFrame:t})}}))):null},Js=a(28849),ec=a(67241),tc=a(51916),ac=a.n(tc);const nc=()=>{const e=(0,j.A)(),{view:t,covers:a}=$(),{isFullscreen:r,setLightboxImage:l,setLightboxImagePrev:o,setLightboxImageNext:F,setIsFullscreen:i,lightboxImage:s}=(0,Ee.A)(),{preferredLocale:c}=(0,u.A)(),{palettes:m}=(0,se.h)(),d=(0,_.S)(t.images,e),p=(0,n.useMemo)((()=>d.filter((({hash:e})=>!a.includes(e)))),[a,d]),g=null!==s?((e,t)=>{let a,n=[];if(!e?.hash)return null;const{palette:r,framePalette:l}=(0,ct.s)(t,e);if(!r)throw new Error("Palette missing?");const{invertPalette:o,invertFramePalette:F}=(0,ut.f)(e);return(0,st.pl)(e)?a=r:(a=(r||ue.Fv).palette,n=(l||ue.Fv).palette),{title:e?.title||"",created:e?.created||"",frame:e.frame,hash:e.hash,hashes:e.hashes||void 0,tags:e.tags,palette:a,framePalette:n,lockFrame:e.lockFrame,invertPalette:o,invertFramePalette:F,rotation:e.rotation}})(p[s],m):null;return(0,n.useEffect)((()=>{const e=()=>{i(!!ac().element)},t=e=>{switch(e.key){case"Esc":case"Escape":close(),e.preventDefault();break;case"Right":case"ArrowRight":case"d":F(p.length),e.preventDefault();break;case"Left":case"ArrowLeft":case"a":o(),e.preventDefault();break;case"Home":l(0),e.preventDefault();break;case"End":l(p.length-1),e.preventDefault()}};return document.addEventListener("keydown",t),ac().isEnabled&&ac().on("change",e),()=>{document.removeEventListener("keydown",t),ac().off("change",e)}})),{image:g,isFullscreen:r,currentIndex:s||0,size:p.length,canPrev:null!==s&&s>0,canNext:null!==s&&s<p.length-1,preferredLocale:c,close:()=>l(null),prev:()=>o(),next:()=>F(p.length),fullscreen:()=>{ac().isEnabled&&(ac().element?ac().exit():ac().request(document.body))}}};var rc=function(){const{image:e,isFullscreen:t,currentIndex:a,size:r,preferredLocale:l,canPrev:o,canNext:i,prev:s,next:c,fullscreen:u,close:m}=nc();return n.createElement(R,{header:e?.title,deny:m,contentWidth:"100%",contentHeight:"100%",fullSize:!0,headerActionButtons:n.createElement(g.A,{color:"inherit",onClick:u,title:t?"Leave fullscreen":"Enter fullscreen"},t?n.createElement(ec.A,null):n.createElement(Js.A,null))},n.createElement(F.A,{direction:"column",gap:2,sx:{width:"100%",height:"100%"}},n.createElement(F.A,{direction:"row",gap:1,alignItems:"center",justifyContent:"center",sx:{height:"100%",overflow:"hidden",position:"relative","& > .MuiBox-root":{flexGrow:1}}},n.createElement(g.A,{size:"large",onClick:s,disabled:!o},n.createElement(Sa.A,null)),e&&n.createElement(y.A,{sx:{width:"100%",height:"100%",flexBasis:"100%",flexGrow:1}},n.createElement(Me,{lockFrame:e.lockFrame,invertPalette:e.invertPalette,invertFramePalette:e.invertFramePalette,palette:e.palette,framePalette:e.framePalette,frameId:e.frame,hash:e.hash,hashes:e.hashes,rotation:e.rotation})),n.createElement(g.A,{size:"large",onClick:c,disabled:!i},n.createElement(xa.A,null))),n.createElement(F.A,{direction:"row",gap:{xs:4,md:12},alignItems:"center",justifyContent:"center"},n.createElement(ua.A,{variant:"body2"},`Image ${a+1}/${r}`),n.createElement(ua.A,{variant:"body2"},(0,pa.A)(We()(e?.created,ue.i$),l)))))},lc=a(45614);var oc,Fc=function(){const e=(0,v.A)();return n.createElement(F.A,{justifyContent:"center",alignItems:"center",sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:30,background:(0,b.X4)(e.palette.background.paper,.6),backdropFilter:"blur(6px)"}},n.createElement(Ua.A,{elevation:12,sx:{px:{xs:6,md:10},py:{xs:4,md:9}}},n.createElement(F.A,{direction:"column",gap:4,alignItems:"center",color:e.palette.tertiary.main},n.createElement(lc.A,{sx:{fontSize:64}}),n.createElement(ua.A,{variant:"h5",fontWeight:"bold"},"Drop your files here"),n.createElement(ua.A,{variant:"body2",sx:{maxWidth:"70vw"},textAlign:"center"},"Printer hex-dumps, .sav savestates, JSON exports or even plain bitmaps."))))};!function(e){e.ADD="add",e.REMOVE="remove"}(oc||(oc={}));var ic=function({tagActive:e,toggleTag:t,title:a}){return n.createElement(Re.A,{label:a,title:`${e?"Remove":"Select"} "${a}"-tag`,size:"small",onClick:()=>t(e?oc.REMOVE:oc.ADD),color:e?"tertiary":"default"})};var sc=function(){const{visible:e,availableTags:t,activeTags:a,updateActiveTags:r,clearTags:l,applyClearTags:o,confirm:i,cancel:s}=(()=>{const{filtersActiveTags:e,filtersVisible:t,setFiltersVisible:a,setFiltersActiveTags:r}=(0,j.A)(),[l,o]=(0,n.useState)(e),{availableTags:F}=Fs();return(0,n.useEffect)((()=>{o(e)}),[e]),{visible:t,availableTags:F,activeTags:l,updateActiveTags:(e,t)=>{o("add"===t?(0,z.A)([...l,e]):l.filter((t=>t!==e)))},clearTags:()=>o([]),applyClearTags:()=>r([]),confirm:()=>r(l),cancel:()=>a(!1)}})();return e?n.createElement(R,{confirm:i,deny:s,header:"Select Filters",contentWidth:"auto",actionButtons:n.createElement(n.Fragment,null,n.createElement(w.A,{disabled:!a.length,title:"Clear Filters",color:"secondary",variant:"outlined",onClick:l},"Clear"),n.createElement(w.A,{disabled:!a.length,title:"Clear Filters and apply",color:"secondary",variant:"contained",onClick:o},"Clear and apply"))},n.createElement(F.A,{direction:"column",gap:4},n.createElement(F.A,{direction:"column",gap:1},n.createElement(ua.A,{component:"span",variant:"body2"},"If set, all must be met"),n.createElement(F.A,{direction:"row",gap:1,flexWrap:"wrap",alignItems:"center",sx:{".MuiChip-root":{my:"1px"}}},n.createElement(ic,{title:"Untagged",tagActive:a.includes(Ne.X3.FILTER_UNTAGGED),toggleTag:e=>r(Ne.X3.FILTER_UNTAGGED,e)}),n.createElement(ic,{title:"❤️ Favourite",tagActive:a.includes(Ne.X3.FILTER_FAVOURITE),toggleTag:e=>r(Ne.X3.FILTER_FAVOURITE,e)}),n.createElement(ic,{title:"New",tagActive:a.includes(Ne.X3.FILTER_NEW),toggleTag:e=>r(Ne.X3.FILTER_NEW,e)}),n.createElement(ic,{title:"Monochrome",tagActive:a.includes(Ne.X3.FILTER_MONOCHROME),toggleTag:e=>r(Ne.X3.FILTER_MONOCHROME,e)}),n.createElement(ic,{title:"RGB",tagActive:a.includes(Ne.X3.FILTER_RGB),toggleTag:e=>r(Ne.X3.FILTER_RGB,e)}),n.createElement(ic,{title:"Recent Imports",tagActive:a.includes(Ne.X3.FILTER_RECENT),toggleTag:e=>r(Ne.X3.FILTER_RECENT,e)}),n.createElement(ic,{title:"Image has comments",tagActive:a.includes(Ne.X3.FILTER_COMMENTS),toggleTag:e=>r(Ne.X3.FILTER_COMMENTS,e)}),n.createElement(ic,{title:"Image has username",tagActive:a.includes(Ne.X3.FILTER_USERNAME),toggleTag:e=>r(Ne.X3.FILTER_USERNAME,e)}))),n.createElement(F.A,{direction:"column",gap:1},n.createElement(ua.A,{component:"span",variant:"body2"},"If set, one must be met"),n.createElement(F.A,{direction:"row",gap:1,flexWrap:"wrap",alignItems:"center",sx:{".MuiChip-root":{my:"1px"}}},t.map((e=>n.createElement(ic,{key:e,title:e,tagActive:a.includes(e),toggleTag:t=>r(e,t)}))))))):null};const cc=[{title:"Title",key:"title"},{title:"Date",key:"created"},{title:"Palette",key:"palette"}];var uc=function(){const{visible:e,sortBy:t,sortOrder:a,setSortBy:r,hideSortForm:l}=(()=>{const{setSortBy:e,setSortOptionsVisible:t,sortOptionsVisible:a,sortBy:n}=(0,j.A)(),[r="",l=""]=n.split("_");return{visible:a,sortBy:r,sortOrder:l,setSortBy:e,hideSortForm:()=>t(!1)}})(),[o,i]=(0,n.useState)(t),[s,c]=(0,n.useState)(a);if((0,n.useEffect)((()=>{i(t),c(a)}),[i,c,e,t,a]),!e)return null;const u=cc.find((({key:e})=>e===o))||cc[0],m=s===ba.U.ASC?"Ascending":"Descending";return n.createElement(R,{header:`Sort by: ${u.title}/${m}`,confirm:()=>r(`${o}_${s}`),deny:l},n.createElement(F.A,{direction:"column",gap:4},n.createElement(Ga.A,{label:"Sort by",size:"small",select:!0,value:o,onChange:e=>i(e.target.value)},cc.map((({key:e,title:t})=>n.createElement($e.A,{key:e,value:e},t)))),n.createElement(Ga.A,{label:"Sort direction",size:"small",select:!0,value:s,onChange:e=>c(e.target.value)},n.createElement($e.A,{value:ba.U.ASC},"Ascending"),n.createElement($e.A,{value:ba.U.DESC},"Descending"))))},mc=a(40547);let dc;const pc=e=>{const t=async()=>{if(!dc){const{init:t,gitSyncTool:n}=await Promise.all([a.e(2350),a.e(1575)]).then(a.bind(a,55927));t(),dc=dc||n(e)}return dc};return(()=>{const{gitStorage:{use:e,owner:t,repo:a,branch:n,token:r}}=de.A.getState();return!!(e&&t&&a&&n&&r)})()&&t(),{startSyncData:async e=>(await t()).startSyncData(e),updateSettings:async e=>(await t()).updateSettings(e)}},gc=(e,t)=>e&&t?"error":"secondary";var hc=function(){const{repoUrl:e,dropboxActive:t,gitActive:a,syncLastUpdate:r,autoDropboxSync:l,startSync:o,cancelSync:i}=(()=>{const e=Ae(),{remoteImport:t}=De(),{setSyncSelect:a}=(0,Ee.A)(),{gitStorage:n,dropboxStorage:r,syncLastUpdate:l}=(0,de.A)();return{repoUrl:`https://github.com/${n.owner}/${n.repo}/tree/${n.branch}`,dropboxActive:!(!r.use||!r.accessToken),gitActive:!!(n.use&&n.owner&&n.repo&&n.branch&&n.throttle&&n.token),autoDropboxSync:r.autoDropboxSync||!1,syncLastUpdate:l,startSync:(a,n)=>{if("dropbox"===a)ge(e,t).startSyncData(n);else if("dropboximages"===a)ge(e,t).startSyncImages();else{if("diff"===n)throw new Error("diff is invalid direction for github sync");pc(t).startSyncData(n)}},cancelSync:()=>a(!1)}})(),s=l&&r.local!==r.dropbox;return n.createElement(R,{deny:i,header:"Synchronize"},n.createElement(F.A,{direction:"column",gap:4,sx:{"& .MuiButton-endIcon svg":{fontSize:32}}},a&&n.createElement(F.A,{direction:"column",gap:2},n.createElement(w.A,{variant:"contained",color:"secondary",startIcon:n.createElement(Mi.A,null),endIcon:n.createElement(lc.A,null),title:`Synchronize to GitHub\n${e}`,onClick:()=>{o("git","up")}},"Synchronize to GitHub"),n.createElement(w.A,{variant:"contained",color:"secondary",startIcon:n.createElement(Mi.A,null),endIcon:n.createElement(mc.A,null),title:`Synchronize from GitHub\n${e}`,onClick:()=>{o("git","down")}},"Synchronize from GitHub")),t&&n.createElement(F.A,{direction:"column",gap:2},n.createElement(F.A,{direction:"column",gap:1},n.createElement(w.A,{variant:"contained",color:gc(s,r.local<r.dropbox),endIcon:n.createElement(lc.A,null),title:"Synchronize to Dropbox",onClick:()=>{o("dropbox","up")}},"Synchronize to Dropbox"),s&&r.local<r.dropbox&&n.createElement(ua.A,{variant:"caption"},"There are pending remote changes. If you synchronize to dropbox now, these will be lost.")),n.createElement(F.A,{direction:"column",gap:1},n.createElement(w.A,{variant:"contained",color:gc(s,r.local>r.dropbox),endIcon:n.createElement(mc.A,null),title:"Synchronize from Dropbox",onClick:()=>{o("dropbox","down")}},"Synchronize from Dropbox"),s&&r.local>r.dropbox&&n.createElement(ua.A,{variant:"caption"},"There are local changes not synched to dropbox yet. If you synchronize from dropbox now, these will be lost.")),n.createElement(w.A,{variant:"contained",color:"secondary",endIcon:n.createElement(lc.A,null),title:"Synchronize images to Dropbox",onClick:()=>{o("dropboximages","up")}},"Synchronize images to Dropbox"))))},fc=a(31604);var Ec=e=>{return Math.floor(e)===e&&(t=e,Boolean(t&&!(t&t-1)));var t};var Ac=function({imageData:e,scaleFactor:t,width:a,height:r,fileName:l,palette:o,dither:i,contrastBaseValues:s}){const c=(0,n.useRef)(null),u=(0,n.useRef)(null);return(0,n.useEffect)((()=>{c.current&&u.current&&s?.length&&(({targetCanvas:e,originalCanvas:t,imageData:a,palette:n,dither:r,contrastBaseValues:l})=>{const o=n.map((e=>({r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}))),F=e.getContext("2d"),i=t.getContext("2d");F&&i?(F.putImageData(dn({imageData:a,contrastBaseValues:l,dither:r,colors:o}),0,0),i.putImageData(a,0,0)):un.error("canvas context is missing")})({targetCanvas:c.current,originalCanvas:u.current,imageData:e,palette:o,dither:i,contrastBaseValues:s})})),n.createElement(F.A,{direction:"column",gap:1},n.createElement(F.A,{title:`${l} - ${t}x`,direction:"row",gap:1,justifyContent:"space-between",alignItems:"center"},n.createElement("canvas",{width:a,height:r,ref:u}),n.createElement(fc.A,{fontSize:"large"}),n.createElement("canvas",{width:a,height:r,ref:c})),Ec(t)?null:n.createElement(Va.A,{severity:"warning",variant:"filled"},`The scale factor of your image is ${t.toPrecision(3)}. To get a clean result without artifacts, try to import only images with it's dimensions being scaled by powers of two. (1, 2, 4, 8 ...)`))};const vc=[{name:"Wider",baseValues:[0,68,187,255],value:"wider"},{name:"Wide",baseValues:[0,85,170,255],value:"wide"},{name:"Normal",baseValues:[51,102,153,204],value:"normal"},{name:"Narrow",baseValues:[69,115,162,208],value:"narrow"},{name:"Narrower",baseValues:[85,113,141,170],value:"narrower"},{name:"From Emulator",baseValues:[64,144,224,255],value:"emulator"}];var bc=function(){const{bitmapQueue:e,bitmapQueueCancel:t}=fe(),[a,r]=(0,n.useState)(!0),[l,o]=(0,n.useState)("wide"),i=(vc.find((({value:e})=>e===l))||vc[1]).baseValues;return n.createElement(R,{header:"Prepare Bitmaps for import",confirm:()=>{hn({bitmapQueue:e,dither:a,contrastBaseValues:i})},deny:t},n.createElement(F.A,{direction:"column",gap:4},e.map(((e,t)=>n.createElement(Ac,{key:t,imageData:e.imageData,scaleFactor:e.scaleFactor,width:e.width,height:e.height,fileName:e.fileName,dither:a,contrastBaseValues:i,palette:["#ffffff","#aaaaaa","#555555","#000000"]}))),n.createElement(VF.A,{label:"Enable Dither",control:n.createElement(UF.A,{checked:a,onChange:({target:e})=>{r(e.checked)}})}),n.createElement(Ga.A,{value:l,label:"Contrast preset",select:!0,size:"small",onChange:e=>{o(e.target.value)}},vc.map((({value:e,name:t})=>n.createElement($e.A,{key:e,value:e},t))))))},yc=a(40936);var wc=function({importItem:e,paletteShort:t}){const{tiles:a,fileName:r,lastModified:l,imageHash:o,tempId:i}=e,{palettes:s,images:c}=(0,se.h)(),m=s.find((({shortName:e})=>e===t)),d=c.find((({hash:e})=>e===o)),{importQueue:p}=fe(),h=p.filter((e=>e.imageHash===o)).length,{preferredLocale:f}=(0,u.A)(),{frameQueueAdd:E,importQueueCancelOne:A}=fe(),v=(0,n.useMemo)((()=>h>1?{color:"error",title:"This image exists multiple times within this queue",badgeContent:"D"}:d?{color:"warning",title:"This image has already been imported"+(d.title?` as "${d.title}"`:""),badgeContent:"I"}:{}),[h,d]);return n.createElement(F.A,{direction:"row",gap:2,alignItems:"center",justifyContent:"space-between",component:"li",sx:{"--zoom-image-top":0,"--zoom-image-left":0,"--zoom-image-width":"60px","--zoom-image-z-index":"initial","& > *":{flexGrow:1}}},n.createElement(F.A,{direction:"row",gap:2,alignItems:"center",justifyContent:"left"},n.createElement(y.A,{sx:{height:a.length/2.5/2.66+"px",flex:"60px 0 0",position:"relative","& > *":{top:"var(--zoom-image-top)",left:"var(--zoom-image-left)",width:"var(--zoom-image-width)",zIndex:"var(--zoom-image-z-index)",transition:"width 150ms ease-in-out, left 150ms ease-in-out, top 150ms ease-in-out",position:"absolute",outline:"none","@media (any-hover: none)":{"&:focus":{"--zoom-image-top":-12,"--zoom-image-left":-12,"--zoom-image-width":"160px","--zoom-image-z-index":2}}},"@media (any-hover: hover)":{"& > *":{pointerEvents:"none"},"&:hover":{"--zoom-image-top":-12,"--zoom-image-left":-12,"--zoom-image-width":"160px","--zoom-image-z-index":2}}}},n.createElement(y.A,{tabIndex:window.matchMedia("(any-hover: none)").matches?0:void 0},n.createElement(oe,{tiles:a,invertPalette:!1,lockFrame:!1,palette:m?.palette,imageStartLine:2,asThumb:!0}))),n.createElement(y.A,null,n.createElement(ua.A,{variant:"caption",component:"p"},r),l&&l>0&&n.createElement(ua.A,{variant:"caption",component:"p"},(0,pa.A)(We()(l),f)))),n.createElement(F.A,{direction:"row",gap:2,alignItems:"center",justifyContent:"right"},n.createElement(y.A,null,n.createElement(wt.A,null,n.createElement(g.A,{title:"Import image as frame",disabled:a.length/20<14,onClick:()=>E([e])},n.createElement(yc.A,null)),n.createElement(yt.A,{...v,anchorOrigin:{vertical:"bottom",horizontal:"right"},overlap:"circular"},n.createElement(g.A,{title:"Remove image from queue",onClick:()=>A(i)},n.createElement(je.A,null)))))))},Ic=a(32317),Cc=a(38438);const Sc=(0,ba.A)("fileName");var xc=()=>{const{importPad:e,setActivePalette:t,activePalette:a}=(0,u.A)(),{cancelEditImageGroup:r}=Y(),{addImageGroup:l}=(0,se.h)(),{setImageSelection:o}=(0,j.A)(),{addImages:F,importQueueCancel:i}=Ae(),s=new(Sn())(1,1/0),{view:c}=$(),{navigateToGroup:m}=Qe(),{importQueue:d}=fe(),[p,g]=(0,n.useState)(""),[h,f]=(0,n.useState)(d.length>3),[E,A]=(0,n.useState)({initial:[],add:[],remove:[]});return{importQueue:d,importPad:e,palette:a,frame:p,tagChanges:E,createGroup:h,updateTagChanges:A,resetTagChanges:()=>{A((({initial:e})=>({initial:e,add:[],remove:[]})))},setFrame:g,setCreateGroup:f,runImport:async()=>{const t=await Promise.all(Sc(d).map(((t,n)=>{const{tiles:r,fileName:l,meta:o,lastModified:F}=t;return s.add((()=>(0,Ic.A)({lines:e?(0,Cc.A)(r):r,filename:l,palette:a,frame:p,tags:E.add,created:We()((F||Date.now())+n).format(ue.i$),meta:o})))}))),n=t.map((({hash:e})=>e));if(F(t),h){const e=`Import ${We()().format(ue.fg)}`,a=qe(e);r();const o=He();l({id:o,slug:a,title:e,created:We()(Date.now()).format(ue.i$),coverImage:t[0].hash,images:n,groups:[]},c.id),m(o)}o(n)},cancelImport:i,setActivePalette:t}};var kc=function(){const{frame:e,palette:t,importQueue:a,tagChanges:r,createGroup:l,setFrame:o,setActivePalette:i,setCreateGroup:s,updateTagChanges:c,resetTagChanges:u,runImport:m,cancelImport:d}=xc();return n.createElement(R,{header:`Image Import (${a.length} images)`,confirm:m,deny:d},n.createElement(F.A,{direction:"column",gap:4},n.createElement(F.A,{direction:"column",component:"ul",gap:1},a.map((e=>n.createElement(wc,{key:e.tempId,paletteShort:t,importItem:e})))),n.createElement(Ji,{noFancy:!0,value:t,onChange:i}),n.createElement(Wi,{selectLabel:"Modify Frame",frame:e,lockFrame:!1,noFrameOption:"No frame / import as is",updateFrame:o}),n.createElement(us,{tags:r,resetTags:u,updateTags:(e,t)=>{c({...r,...ss(r,{mode:e,tag:t})})}}),n.createElement(VF.A,{label:"Create group from images at current location",control:n.createElement(UF.A,{checked:l,onChange:({target:e})=>{s(e.checked)}})})))};const Pc=["FFFF8080BFBFA0A0A0A0A0A0A0A0A0A0","FFFF0000FFFF00000000010103030707","FFFF0000FFFF7F7FFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFEFEFFFFFFFFFFFFFFFF","FFFF0000FFFF000000008080C0C0E0E0","FFFF0101FDFD05050505050505050505","A0A0A0A0A0A0A0A0A0A0A1A1A3A3A7A7","070703030101000000008080C0C0E0E0","FFFFFFFFFFFFFFFF7F7F3F3F1F1F0F0F","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFEFEFCFCF8F8F0F0","E0E0C0C0808000000000010103030707","050505050505050505058585C5C5E5E5","AFAFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","F0F0F8F8FCFCFEFEFFFFFFFFFFFFFFFF","070703030101000001018383C7C7EFEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","E0E0C0C0808000008080C1C1E3E3F7F7","0F0F1F1F3F3F7F7FFFFFFFFFFFFFFFFF","F5F5FDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFF0F0F0F0F0F0F0F0","FFFFFFFFFFFFFFFF3F3F3F3F3F3F3F3F","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0","30303030303030303030303030303030","42214000000040206020602060206020","85C3800101000140C140C140C140C140","FCF0D0E0E0C080C181C1C181C181FEFC","1F0F0307070382038003800380030003","C4828000000004020602060206020602","0F070F070F060E060C060C060C060C06","A1C08000000008040804080400000000","FF7F5F3F3F1F0F1F1F0F1F0F1F0F1F0F","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0","30303030303030303030303030303030","60206020602060206020602060206020","C140C140C140C140C140C140C140C140","E8F0E0C081C080C1C181C18180C180C0","00030003800380038003810381030103","0602060206020602060000008000C482","0C060C060C060C060C060C060E060F06","00000F070C040C040C040C0408040000","1F0FFFFF1F0F1F0F1F0F1F0F0F1F3F1F","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","F0F0F0F0FFFFFFFFFFFFFFFFFFFFFFFF","30303030FFFFFFFFFFFFFFFFFFFFFFFF","60206020FFFFFFFFFFFFFFFFFFFFFFFF","C140C140FFFFFFFFFFFFFFFFFFFFFFFF","C0C0D1E0FFFFFFFFFFFFFFFFFFFFFFFF","01030083FFFFFFFFFFFFFFFFFFFFFFFF","FEFE040200008000A0C0FFFFFFFFFFFF","0F070F07070F0F1F5F3FFFFFFFFFFFFF","8000A0C0FFFFFFFFFFFFFFFFFFFFFFFF","1F3FFF7FFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFAFAF","FFFFFFFFFFFFFFFFFEFEFCFCF8F8F0F0","EFEFC7C7838301010000010103030707","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","F7F7E3E3C1C1808000008080C0C0E0E0","FFFFFFFFFFFFFFFF7F7F3F3F1F1F0F0F","FDFDFDFDFDFDFDFDFDFDFDFDFDFDF5F5","A7A7A3A3A1A1A0A0A0A0A0A0A0A0A0A0","E0E0C0C0808000000000010103030707","0F0F1F1F3F3F7F7FFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","F0F0F8F8FCFCFEFEFFFFFFFFFFFFFFFF","070703030101000000008080C0C0E0E0","E5E5C5C5858505050505050505050505","A0A0A0A0A0A0A0A0A0A0BFBF8080FFFF","07070303010100000000FFFF0000FFFF","FFFFFFFFFFFFFFFF7F7FFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFEFEFFFF0000FFFF","E0E0C0C0808000000000FFFF0000FFFF","05050505050505050505FDFD0101FFFF"];var Tc=function({tiles:e,startLine:t,setStartLine:a}){const{activePalette:r}=(0,u.A)(),{palettes:l}=(0,se.h)(),o=l.find((({shortName:e})=>e===r))?.palette,i=(0,n.useMemo)((()=>{const a=[];a.push(...e.slice(0,20*t));for(let n=0;n<14;n+=1){const r=20*(n+t),l=r+18,o=16*n;a.push(...e.slice(r,r+2),...Pc.slice(o,o+16),...e.slice(l,l+2))}return a.push(...e.slice(20*(t+14))),a}),[e,t]);return n.createElement(F.A,{direction:"row",gap:3,justifyContent:"center"},n.createElement(oe,{tiles:i,palette:o,imageStartLine:t}),n.createElement(F.A,{direction:"column",justifyContent:"center"},n.createElement(wt.A,{orientation:"vertical",variant:"contained",size:"large",color:"tertiary",fullWidth:!0},n.createElement(w.A,{onClick:()=>a(t-1),disabled:t<=0,endIcon:n.createElement(Ri.A,null)},"Move image up"),n.createElement(w.A,{onClick:()=>a(t+1),disabled:t>=e.length/20-14,endIcon:n.createElement(Ni.A,null)},"Move image down"))))};var Dc=function(){const{dismissDialog:e}=(0,he.A)(),{frameQueue:t,frameQueueCancelOne:a,importQueueCancelOne:r}=fe(),{updateLastSyncLocalNow:l}=Ae(),{addFrames:o,updateFrameGroups:F}=(0,se.h)(),i=t[0],[s,c]=(0,n.useState)(""),[u,m]=(0,n.useState)(Math.floor((i.tiles.length-280)/40)),{fullId:d,formValid:p,groups:g,frameGroup:h,frameIndex:f,setFrameIndex:E,frameName:A,setFrameGroup:v,setFrameName:b,idValid:y,groupIdValid:w,frameIndexValid:I}=ks({id:"",hash:"",name:i.fileName});return n.createElement(R,{header:`Import new Frame as "${d}"`,canConfirm:p,confirm:async()=>{const t=await(0,me.R_)(i.tiles,u);e(0),i.tempId&&(r(i.tempId),a(i.tempId)),o([{id:d,name:A,hash:t}]),s?.trim()&&F([{id:h,name:s}]),l()},deny:()=>a(i.tempId)},n.createElement(Ps,{frameIndex:f,setFrameGroup:v,frameName:A,frameGroup:h,setFrameName:b,groupIdValid:w,idValid:y,frameIndexValid:I,setFrameIndex:E,groups:g,fullId:d,frameGroupName:s,setFrameGroupName:c,extraFields:n.createElement(Tc,{tiles:i.tiles,startLine:u,setStartLine:m})}))};const Mc=(e,t)=>!!t.find((({hashes:t})=>!!t&&Object.values(t).includes(e))),Rc=(e,t)=>!!t.find((t=>t.hash===e)),Nc=async({images:e,frames:t})=>{await(0,ke.ZU)();(await ke.mU.keys()).forEach((e=>t=>{Mc(t,e)||Rc(t,e)||(0,an.yH)(t)})(e));(await ke.Uv.keys()).forEach((e=>t=>{((e,t)=>!!t.find((t=>t.hash===e)))(t,e)||(0,an.t9)(t)})(t))},Bc=async e=>{await(0,ke.ZU)();return(await ke.mU.keys()).filter((e=>!e.startsWith("dummy"))).filter((e=>t=>!Mc(t,e)&&!Rc(t,e))(e))},Lc=async e=>{await(0,ke.ZU)();return(await ke.Uv.keys()).filter((e=>!e.startsWith("dummy"))).filter((e=>t=>!e.find((e=>e.hash===t)))(e))};var Gc=a(66750);const $c=async(e,t)=>{await(0,ke.ZU)();return(await Promise.all(e.map((async e=>{try{const a=await t.getItem(e);if(!a)return null;return{hash:e,lines:(await(0,Gc.U)(a)).split("\n"),binary:a}}catch(e){return null}})))).reduce(Io.N,[])};var Oc=()=>{const{trashCount:e,showTrashCount:t}=(0,Ee.A)(),{frames:a,images:r}=(0,se.h)(),{updateTrashCount:l}=(0,Ee.A)(),o=(0,n.useCallback)((async()=>{const e=await Lc(a),t=await $c(e,ke.Uv),n={},r={state:{frames:t.map(((e,t)=>{try{return n[`frame-${e.hash}`]=e.binary,{hash:e.hash,name:`Backup export ${e.hash}`,id:`bak${t.toString(10).padStart(2,"0")}`}}catch(e){return null}})).reduce(Io.N,[]),frameGroups:[{id:"bak",name:"Re-imported trash frames"}],lastUpdateUTC:Math.floor((new Date).getTime()/1e3),version:se.A}};(0,Qs.saveAs)(new Blob([...JSON.stringify({...r,...n},null,2)]),"backup_frames.json")}),[a]),F=(0,n.useCallback)((async()=>{const e=(await Lc(a)).length,t=(await Bc(r)).length;l(e,t)}),[a,r,l]),i=(0,n.useCallback)((async()=>{await Nc({images:r,frames:a}),t(!1),window.requestAnimationFrame((()=>{F()}))}),[F,a,r,t]);return{showTrashCount:t,purgeTrash:i,downloadImages:async()=>{const e=await Bc(r),t=await $c(e,ke.mU),a={},n={state:{images:t.map((e=>{try{return a[e.hash]=e.binary,{hash:e.hash,created:We()().format(ue.i$),title:`Backup export ${e.hash}`,lines:e.lines.length,tags:["backup"],palette:"bw",framePalette:"bw",invertPalette:!1,invertFramePalette:!1,frame:""}}catch(e){return null}})).reduce(st.iy,[]),lastUpdateUTC:Math.floor((new Date).getTime()/1e3),version:se.A}};(0,Qs.saveAs)(new Blob([...JSON.stringify({...n,...a},null,2)]),"backup_images.json")},downloadFrames:o,checkUpdateTrashCount:F,trashCount:e}};var _c=function(){const{showTrashCount:e,purgeTrash:t,downloadImages:a,downloadFrames:r,trashCount:l}=Oc(),o=l.frames+l.images;return n.createElement(R,{deny:()=>{e(!1)},header:`Trash (${o} items)`,contentWidth:"auto",actionButtons:n.createElement(n.Fragment,null,n.createElement(w.A,{variant:"contained",color:"secondary",title:"Download deleted frames",disabled:0===l.frames,onClick:r},"Download frames"),n.createElement(w.A,{variant:"contained",color:"secondary",title:"Download deleted images",disabled:0===l.images,onClick:a},"Download images"),n.createElement(w.A,{variant:"contained",color:"error",title:"Purge all",disabled:0===o,onClick:t},`Purge all (${o})`))},n.createElement(F.A,{direction:"column",gap:2},n.createElement(ua.A,{variant:"body2"},`Deleted frames: ${l.frames}`),n.createElement(ua.A,{variant:"body2"},`Deleted images: ${l.images}`)))},jc=a(86860);var Vc=function(){const{pickColors:e,setEditPalette:t,cancelEditPalette:a,cancelPickColors:r}=Y(),[l,o]=(0,n.useState)([0,3,6,9]),i=Bs(),s=(0,n.useMemo)((()=>e?Array(4).fill(null).map(((t,a)=>{const n=l[a],r=e.colors[n];return r?(([e,t,a])=>["#",Math.min(255,Math.max(0,e)).toString(16).padStart(2,"0"),Math.min(255,Math.max(0,t)).toString(16).padStart(2,"0"),Math.min(255,Math.max(0,a)).toString(16).padStart(2,"0")].join(""))(r):"#000000"})):[]),[e,l]);return e?n.createElement(R,{confirm:()=>{t({name:`From file ${e.fileName}`,shortName:Ne.mI,palette:s,origin:"generated from file",isPredefined:!1})},canConfirm:4===l.length,deny:()=>{r(),a()},header:`Pick colors from "${e.fileName}"`,contentWidth:"auto"},n.createElement(F.A,{direction:"column",gap:4},n.createElement(F.A,{direction:"row",gap:2,component:"ul",justifyContent:"space-around"},i.map((e=>n.createElement(y.A,{key:e.hash,component:"li"},n.createElement(Me,{hash:e.hash,invertPalette:!1,invertFramePalette:!1,lockFrame:!1,palette:s,framePalette:s}))))),n.createElement(gt.A,{value:l,onChange:(e,t)=>o([...t].sort()),sx:{display:"flex",justifyContent:"space-around",gap:0}},e.colors.map(((e,t)=>n.createElement(pt.A,{key:t,value:t,sx:{"--palette-color":`rgb(${e.join(",")})`,color:"var(--palette-color)",borderRadius:0,width:48,height:48,padding:0,border:"none","&&.Mui-selected":{border:"none",background:"none",color:"var(--palette-color)"},"& > svg":{width:"inherit",height:"inherit"}}},l.includes(t)?n.createElement(_o.A,null):n.createElement(jc.A,null))))),n.createElement(F.A,{direction:"row",gap:0,sx:{"& > .MuiBox-root":{height:"32px",flexGrow:1}}},s.map(((e,t)=>n.createElement(y.A,{key:t,title:e,sx:{backgroundColor:e}})))))):null};var Uc=function(){const{enableImageGroups:e}=(0,u.A)(),{dialogs:t}=(0,he.A)(),a=!!t.length,{editFrame:r,editImageGroup:l,editImages:o,editPalette:F,editRGBNImages:i,pickColors:s}=Y(),c=!!o?.batch?.length,m=!!r,d=!!l&&e,p=!!F,g=i.length>0,h=!!s,{filtersVisible:f,sortOptionsVisible:E}=(0,j.A)(),{bitmapQueue:A,importQueue:v,frameQueue:b}=fe(),y=!!A.length,w=!!v.length,I=!!b.length,{lightboxImage:C,dragover:S,trashCount:{show:x},progress:k,progressLog:P,syncSelect:T,videoSelection:D}=(0,Ee.A)(),M=!!P.git.length||!!P.dropbox.length,R=!!k.gif||!!k.printer||!!k.plugin;switch(!0){case a:return n.createElement($i,null);case I:return n.createElement(Dc,null);case y:return n.createElement(bc,null);case w:return n.createElement(kc,null);case c:return n.createElement(Ss,null);case d:return n.createElement(xs,null);case m:return n.createElement(Ts,null);case p:return n.createElement(Ls,null);case g:return n.createElement(Hs,null);case!!D?.length:return n.createElement(Zs,null);case h:return n.createElement(Vc,null);case null!==C:return n.createElement(rc,null);case f:return n.createElement(sc,null);case E:return n.createElement(uc,null);case T:return n.createElement(hc,null);case x:return n.createElement(_c,null);case S:return n.createElement(Fc,null);case M:return n.createElement(Bi,null);case R:return n.createElement(Li,null);default:return n.createElement(jF,null)}},zc=a(88629);var Wc=function({dismiss:e,errorMessage:t}){const[a,r]=(0,n.useState)(!1);return n.createElement(Va.A,{severity:"error",variant:"filled",sx:{minWidth:300},action:n.createElement(n.Fragment,null,t.error.stack&&!a&&n.createElement(g.A,{size:"small",title:"Show error stack","aria-label":"close",color:"inherit",onClick:()=>r(!0)},n.createElement(zc.A,{fontSize:"small"})),n.createElement(g.A,{size:"small","aria-label":"close",color:"inherit",onClick:(t,a)=>{"clickaway"!==a&&e()}},n.createElement(I.A,{fontSize:"small"})))},n.createElement(Oi.A,{sx:{color:"inherit"}},t.error.message),a&&n.createElement(ua.A,{variant:"caption",fontFamily:"monospace",component:"pre",sx:e=>ma(0,{backgroundColor:"#FFFFFF22",maxHeight:"200px",overflow:"auto",p:1})},t.error.stack))};var Hc=function(){const{errors:e,dismissError:t}=(0,Ee.A)();return n.createElement(F.A,{direction:"column",gap:4,sx:e=>({position:"fixed",top:e.spacing(10),right:e.spacing(2),zIndex:10})},e.map(((e,a)=>n.createElement(Wc,{key:e.id,dismiss:()=>t(a),errorMessage:e}))))};const Xc=(e,t)=>e.filter((e=>!t.includes(e))),Yc=(e,t)=>t.reduce(((t,a)=>{const n=a.slug.replace(/[^A-Z0-9_-]+/gi,"_");let r=0,l=`${e}${n}/`;const o=e=>-1!==t.findIndex((({absolutePath:t})=>t===e));for(;o(l);)r+=1,l=`${e}${n}_${r}/`;return[...t,{absolutePath:l,group:a},...Yc(l,a.groups)]}),[]),Qc=(e,t)=>t.groups.length+t.images.length?[...e,t]:e,Kc=(e,t)=>(a,n)=>{const r=!!e.find((e=>n.hash===e)),l=t.find((({coverImage:e})=>n.hash===e)),o=!!l,F={...n};return l?.tags.length&&(F.tags=(0,z.A)([...F.tags,...l.tags])),r||o?[...a,F]:a},qc=()=>{const{enableImageGroups:e}=(0,u.A)(),{setError:t}=(0,Ee.A)(),{imageGroups:a,images:r,setImageGroups:l}=(0,se.h)(),o=(0,n.useMemo)((()=>e?a:[]),[e,a]),{path:F}=O(),i=(0,n.useMemo)((()=>(e=>{let t=[],a=[];return{groups:e.map((e=>{const n=(0,z.A)(Xc(e?.images,t)),r=(0,z.A)(Xc(e?.groups,a));return t=(0,z.A)([...t,...e.images]),a=(0,z.A)([...a,...e.groups]),{...e,images:n,groups:r}})),usedImageHashes:t,usedGroupIDs:a}})(o)),[o]),s=(0,n.useMemo)((()=>{const e=a=>n=>{const l=(e,t)=>{const a=i.groups.find((({id:e})=>e===t));return a?[...e,a]:e};let o;if(a>20)t(new Error(`Reached maximum inflate depth at group "${n.title||n.slug}" (${n.id})`)),o=[];else try{o=n.groups.reduce(l,[]).map(e(a+1)).reduce(Qc,[])}catch(e){o=[]}const F=r.reduce(Kc(n.images,o),[]),s=F.find((({hash:e})=>e===n.coverImage))||F[0],c=s?.hash||n.coverImage,u=(0,z.A)(F.map((e=>e.tags)).flat(1));return{id:n.id,slug:n.slug,created:n.created,title:n.title,coverImage:c,groups:o,images:F,tags:u}},a=i.groups.map(e(0)).reduce(Qc,[]).filter((({id:e})=>!i.usedGroupIDs.includes(e))),n=r.reduce(((e,{hash:t})=>i.usedImageHashes.includes(t)?e:[...e,t]),[]);return{...B(),groups:a,images:r.reduce(Kc(n,a),[])}}),[i,r,t]),c=(0,n.useMemo)((()=>Yc("",s.groups)),[s]);(0,n.useEffect)((()=>{if(e&&a.length>c.length){const e=c.map((({group:e})=>e.id)),t=a.filter((({id:t})=>e.includes(t)));l(t)}}),[e,c,l,a]);const m=(0,n.useMemo)((()=>c.reduce(((e,{group:t,absolutePath:a})=>{const n=a.split("/").length-1;return[...e,{value:a,name:`${Array(n).fill(" ").join("")}${t.title} (/${a.replace(/\/$/,"")})`}]}),[{value:"",name:"/"}])),[c]);return(0,n.useMemo)((()=>{const e=c.find((({absolutePath:e})=>e===F))?.group||s,t=e.groups.map((({coverImage:e})=>e)),a=e.images.filter((e=>!t.includes(e.hash)));return{view:e,covers:t,paths:c,images:a,pathsOptions:m,root:s}}),[F,c,m,s])};var Zc=function({children:e}){const t=qc();return n.createElement(G.Provider,{value:t},e)};const Jc=e=>t=>{const{frames:a,palettes:n}=se.h.getState(),{handleExportFrame:r}=u.A.getState(),l=e.find((e=>e.hash===t));if(!l)throw new Error("image not found");const{palette:o,framePalette:F}=(0,ct.s)(n,l);if(!o)throw new Error("selectedPalette not found");const i=()=>(0,ce.T)(e,a)(l.hash),s=(0,st.pl)(l);return{getMeta:async()=>({...l,isRGBN:s}),getPalette:async()=>o,getTiles:i,getCanvas:async(e={})=>{const{scaleFactor:t=1,palette:n=o,framePalette:c=F,lockFrame:u,invertPalette:m,invertFramePalette:d,handleExportFrame:p=r}=e,g=await i();let h;const f=a.find((({id:e})=>e===l.frame)),E=f?await(0,me.mZ)(f.hash):null,A=E?E.upper.length/20:2;if(s)h=new ae.Wd,h.update({canvas:null,tiles:g,palette:n,lockFrame:void 0!==u?u:l.lockFrame});else{h=new ae.XM;const e=n?.palette||ae.CU,t=c?.palette||ae.CU,{invertPalette:a,invertFramePalette:r}=(0,ut.f)(l),o=(0,re.A)({palette:e,framePalette:t,invertPalette:void 0!==m?m:a,invertFramePalette:void 0!==d?d:r});h.update({canvas:null,tiles:g,...o,imageStartLine:A})}return(0,ne.Ej)(h.getScaledCanvas(t,p),l.rotation||0)}}};var eu;!function(e){e.CONFIRM_ASK="CONFIRM_ASK",e.CONFIRM_ANSWERED="CONFIRM_ANSWERED",e.ADD_IMAGES="ADD_IMAGES",e.IMPORT_FILES="IMPORT_FILES"}(eu||(eu={}));var tu=a(96763);const au=({addImages:e,setDialog:t,dismissDialog:a},n)=>({importFiles:To(n),setDialog:t,alert:(e,n)=>t({message:`Plugin: ${e}`,questions:()=>[{label:n,key:"info",type:Ue.V.INFO}],confirm:async()=>a(0)}),dismissDialog:()=>a(0),addImages:e}),nu=(e,t)=>{const{setDialog:a,dismissDialog:n,importFiles:r,addImages:l,alert:o}=au(e,t);return{dispatch:e=>{switch(tu.warn(`You are using a legacy method: "dispatch(${e.type})". Please refer to "env.functions" from your plugin to switch to up-to-date methods`),e.type){case eu.CONFIRM_ASK:a(e.payload);break;case eu.CONFIRM_ANSWERED:n();break;case eu.IMPORT_FILES:r(e.payload.files);break;case eu.ADD_IMAGES:l(e.payload);break;default:o("Plugin error:",`Unhandled Compatibility Action (type:"${e.type}")`)}}}},ru=({setProgress:e,addUpdatePluginProperties:t,collectImageData:a,stores:n,importFn:r},l)=>{const{url:o,config:F={}}=l,i=t=>{e("plugin",t%1)};return new Promise((e=>{window.gbpwRegisterPlugin=l=>{if(window.gbpwRegisterPlugin=()=>{},l)try{const s=new l({saveAs:Qs.saveAs,progress:i,store:nu(n,r),functions:au(n,r),collectImageData:a},F),{name:c,description:u="",configParams:m={},config:d={}}=s;t({url:o,name:c,description:u,configParams:m,config:d,loading:!1,error:!1}),e(s)}catch(a){t({url:o,loading:!1,error:a?.message}),e(null)}else e(null)};const l=document.createElement("script");document.head.appendChild(l),l.addEventListener("error",(()=>{window.gbpwRegisterPlugin=()=>{},t({url:o,loading:!1,error:"Loading error"}),e(null)})),l.src=o}))};var lu=function({children:e}){const{plugins:t,images:a,addUpdatePluginProperties:r}=(0,se.h)(),l=Ae(),{setProgress:o}=(0,Ee.A)(),{jsonImport:F}=De(),i=(0,n.useMemo)((()=>({collectImageData:Jc(a),addUpdatePluginProperties:r,setProgress:o,stores:l,importFn:F})),[a,r,o,l,F]),s=(0,n.useMemo)((()=>async e=>{const a=t.find((t=>t.url===e))||{url:""};return ru(i,a)}),[i,t]),c=(0,n.useCallback)((async e=>!!await ru(i,e)),[i]),u=(0,n.useMemo)((()=>({runWithImage:async(e,t)=>{const n=Jc(a)(t);(await s(e))?.withImage(n)},runWithImages:async(e,t)=>{const n=t.map(Jc(a));(await s(e))?.withSelection(n)},validateAndAddPlugin:c})),[s,a,c]);return n.createElement(Mt.Provider,{value:u},e)};let ou,Fu;var iu=function({children:e}){const{setProgress:t,setPrinterFunctions:r,setPrinterBusy:l,setPrinterData:o}=Ee.A.getState(),{dismissDialog:F,setDialog:i}=he.A.getState(),{handleFileImport:s}=Do();(0,n.useEffect)((()=>{const e=e=>{const{printerUrl:a}=u.A.getState();let n;try{n=new URL(a).origin}catch(e){n=new URL(window.location.href).origin}if(e.origin!==n)return;const{fromRemotePrinter:{lines:c,progress:m,blob:d,blobsdone:p,commands:g,printerData:h}={}}=e.data,f=e.source;if(g&&(ou&&JSON.stringify(g)===JSON.stringify(Ee.A.getState().printerFunctions)||(r(g),l(!1),o(null)),Fu=f,window.clearTimeout(ou),ou=window.setTimeout((()=>{ou=null,Fu=null,l(!0),o(null),r([])}),1500)),c){const e=new File([c.join("\n")],"Text input.txt",{type:"text/plain"});s([e])}if(void 0!==m&&t("printer",m),d){const e=new File([d],"blob.unknown");s([e])}if(p){if("string"==typeof p[0])return void window.setTimeout((()=>{alert("You should update the web-app to a version > 1.16.0 on your printer for an optimized import experience :-)")}),200);const e=p.reduce(((e,t)=>{if(!t.blob||!t.ok)return e;const a=p.length>1?(e.length+1).toString(10).padStart(2,"0"):"";return[...e,new File([t.blob],`Printer ${a}`.trim(),{type:t.contentType})]}),[]);e.length?s(e,{fromPrinter:!0}):i({message:"No valid files received from WiFi-Printer",confirm:async()=>{F(0),l(!1),o(null)}})}h&&(o(h),l(!1))};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}),[F,s,i,l,o,r,t]);const c=(0,n.useMemo)((()=>({callRemoteFunction:async e=>{const{printerData:t}=Ee.A.getState();let n;if(l(!0),e===Za.FETCHIMAGES&&t&&(n={dumps:t?.dumps}),await Promise.resolve().then(a.t.bind(a,74802,23)),await a.e(1668).then(a.t.bind(a,51668,23)),!Fu)throw new Error("remote printer window object is missing");Fu.postMessage({toRemotePrinter:{command:e,params:n}},"*")}})),[l]);return n.createElement(Ka.Provider,{value:c},e)};var su=function(){const e=(0,r.FE)(),t=Z(),{themeName:a}=(0,u.A)();(0,n.useEffect)((()=>{const e=document.querySelector("html")?.classList;e&&[ui.V.BRIGHT,ui.V.DARK].forEach((t=>{t===a?e.add(a):e.remove(t)}))}),[a]);const l=(0,n.useMemo)((()=>a===ui.V.DARK?Si:xi),[a]),o=(0,P.A)(l.breakpoints.down("md"));if(!e[1])return n.createElement(r.C5,{to:"/gallery/page/1",replace:!0});const i=e[1]?.handle?.headline,s={"--ddpx":t.ddpx};return n.createElement(lu,null,n.createElement(Zc,null,n.createElement(Ye,null,n.createElement(iu,null,n.createElement(qF.A,{theme:l},n.createElement(KF.Ay,null),n.createElement(Pi,null),n.createElement(QF.A,{maxWidth:"xl",sx:{...s,p:o?2:3,minHeight:"calc(100dvh - var(--navigation-height))",display:"flex",flexDirection:"column"}},n.createElement(F.A,{direction:"column",gap:2,sx:{flexGrow:1}},i&&n.createElement(ua.A,{component:"h1",variant:"h1"},i),n.createElement(r.sv,null))),n.createElement(Uc,null),n.createElement(Hc,null))))))},cu=a(96763);var uu=function(){const e=(0,r.r5)();return cu.error(e),n.createElement(F.A,{direction:"column",gap:4},n.createElement(ua.A,{variant:"h4",component:"h1"},e?.statusText||e.message),n.createElement(da,{text:e.stack||""}))};const mu={};var du=()=>["jpeg","jpg","png","webp","bmp","gif"].filter((e=>(e=>{if(void 0!==mu[e])return mu[e];const t=document.createElement("canvas");t.width=2,t.height=2;const a=t.toDataURL(`image/${e}`);return mu[e]=0===a.indexOf(`data:image/${e};base64`),mu[e]})(e))),pu=a(37769),gu=a(38004);var hu=function(){const{enableDebug:e,enableImageGroups:t,exportFileTypes:l,exportScaleFactors:o,fileNameStyle:i,forceMagicCheck:s,handleExportFrame:c,hideDates:m,importDeleted:d,importLastSeen:p,importPad:g,pageSize:f,preferredLocale:E,printerParams:A,printerUrl:v,savFrameTypes:b,setExportFileTypes:y,setExportScaleFactors:w,setEnableDebug:I,setEnableImageGroups:C,setFileNameStyle:S,setForceMagicCheck:x,setHandleExportFrame:k,setHideDates:P,setImportDeleted:T,setImportLastSeen:D,setImportPad:M,setPageSize:R,setPreferredLocale:N,setSavFrameTypes:B,setPrinterParams:L,setPrinterUrl:G}=(0,u.A)(),{frames:$,frameGroups:O}=(0,se.h)(),_=(0,ko.A)($,O),[j,V]=(0,n.useState)(f.toString(10)),[U,z]=(0,n.useState)(v),[W,H]=(0,n.useState)(A),[X,Y]=(0,n.useState)([]),[Q]=(0,n.useState)(We()()),{sortPalettes:K,setSortPalettes:q,paletteSortOptions:Z}=aF();return(0,n.useEffect)((()=>{(async()=>{const{default:e}=await a.e(2416).then(a.t.bind(a,52416,23)),t=e.all.filter((({tag:e})=>{try{return(0,pa.A)(We()(),e),!0}catch(e){return!1}}));Y(t)})()}),[]),n.createElement(F.A,{direction:"column",gap:6},n.createElement(Ga.A,{id:"settings-pagesize",label:"Page size",type:"text",helperText:"Set to 0 to disable pagination - might cause performance issues on large sets of images",value:j,onChange:e=>V(e.target.value),onBlur:()=>{const e=Math.abs(parseInt(j,10)||0);R(e),V(e.toString(10))}}),n.createElement(gs.A,null,n.createElement(hs.A,{shrink:!0},"Image export dimensions"),n.createElement(gt.A,{fullWidth:!0,value:o,onChange:(e,t)=>{w(t)}},[1,2,3,4,5,6,8,10].map((e=>n.createElement(pt.A,{key:e,value:e,title:`${160*e}×${144*e}`},`${e}×`))))),n.createElement(gs.A,null,n.createElement(hs.A,{shrink:!0},"Image export filetypes"),n.createElement(gt.A,{fullWidth:!0,value:l,onChange:(e,t)=>{y(t)}},[...du(),"txt","pgm"].map((e=>n.createElement(pt.A,{key:e,value:e,title:e},e))))),n.createElement(Ga.A,{id:"settings-handle-export-frames",value:c,label:"How to handle frames when exporting images",select:!0,onChange:e=>{k(e.target.value)}},Xs.map((({id:e,name:t})=>n.createElement($e.A,{key:e,value:e},t)))),n.createElement(Ga.A,{id:"settings-filename-style",value:i,label:"Filename style",select:!0,onChange:e=>{S(e.target.value)}},gu.y.map((({id:e,name:t})=>n.createElement($e.A,{key:e,value:e},t)))),n.createElement(Ga.A,{id:"settings-sav-frames",value:b,disabled:!_.length,label:"Frames to be applied when importing Cartridge dumps",select:!0,slotProps:{inputLabel:{shrink:!0},select:{renderValue:e=>""===e?"None":_.find((({id:t})=>t===e))?.name||"Unknown"}},onChange:e=>{B(e.target.value)},placeholder:"None"},n.createElement($e.A,{value:"",selected:!b},"None"),_.map((({id:e,name:t})=>n.createElement($e.A,{key:e,value:e},t)))),n.createElement(VF.A,{label:"Import ‘last seen’ image when importing Cartridge dumps",control:n.createElement(UF.A,{checked:p,onChange:({target:e})=>{D(e.checked)}})}),n.createElement(VF.A,{label:"Import deleted images when importing Cartridge dumps",control:n.createElement(UF.A,{checked:d,onChange:({target:e})=>{T(e.checked)}})}),n.createElement(VF.A,{label:"Force valid .sav file when importing",control:n.createElement(UF.A,{checked:s,onChange:({target:e})=>{x(e.checked)}})}),n.createElement(VF.A,{label:"Pad images up to 144px height on import",control:n.createElement(UF.A,{checked:g,onChange:({target:e})=>{M(e.checked)}})}),n.createElement(VF.A,{label:"Hide dates in gallery",control:n.createElement(UF.A,{checked:m,onChange:({target:e})=>{P(e.checked)}})}),n.createElement(Ga.A,{id:"settings-filename-style",value:K,label:"Sort Palettes",select:!0,onChange:e=>{q(e.target.value)}},Z.map((({value:e,label:t})=>n.createElement($e.A,{key:e,value:e},t)))),n.createElement(Ga.A,{id:"settings-filename-style",value:X.length?E:"",label:"Preferred locale",helperText:`Example date format: ${(0,pa.A)(Q,E)}`,select:!0,onChange:e=>{N(e.target.value)}},X.map((({name:e,local:t,location:a,tag:r})=>n.createElement($e.A,{key:r,value:r},`${t||e}${a?` - ${a}`:""} (${r})`)))),n.createElement(zF,null),"esp8266"===(0,vF._)()?.env?null:n.createElement(Ga.A,{id:"settings-printer-url",label:"Printer URL",type:"text",helperText:n.createElement(n.Fragment,null,"If you own a physical wifi-printer, you can add it's URL here and check the ",n.createElement(h.A,{component:r.N_,to:"/import"},"Import-tab")),value:U,onChange:e=>z(e.target.value),onBlur:()=>{const e=(0,pu.A)(U,"http");z(e),G(e)},onKeyUp:e=>{switch(e.key){case"Enter":{const e=(0,pu.A)(U,"http");z(e),G(e);break}case"Escape":z(v)}}}),"esp8266"===(0,vF._)()?.env||v?n.createElement(Ga.A,{id:"settings-printer-settings",label:"Additional printer settings",type:"text",value:W,onChange:e=>H(e.target.value),onBlur:()=>{L(W)},onKeyUp:e=>{switch(e.key){case"Enter":L(W);break;case"Escape":H(A)}}}):null,n.createElement(VF.A,{label:"Show debug info",control:n.createElement(UF.A,{checked:e,onChange:({target:e})=>{I(e.checked)}})}),n.createElement(VF.A,{label:"Enable Image Groups",control:n.createElement(UF.A,{checked:t,onChange:({target:e})=>{C(e.checked)}})}))},fu=a(70791),Eu=a(31600);const Au=()=>{const[e,t]=(0,n.useState)(!1),a=(0,n.useMemo)((()=>n.createElement(g.A,{title:e?"Hide Password":"Show Password","aria-label":e?"hide the password":"display the password",color:"primary",onClick:()=>{t(!e)}},e?n.createElement(fu.A,null):n.createElement(Eu.A,null))),[e]);return{type:(0,n.useMemo)((()=>e?"text":"password"),[e]),button:a,setShowPassword:t}};var vu,bu=function(){const{gitStorage:e,setGitStorage:t}=(0,de.A)(),[a,r]=(0,n.useState)(e.use||!1),[l,o]=(0,n.useState)(e.owner||""),[i,s]=(0,n.useState)(e.repo||""),[c,u]=(0,n.useState)(e.branch||""),[m,d]=(0,n.useState)(e.throttle?.toString(10)||"10"),[p,g]=(0,n.useState)(e.token||""),{type:f,button:E}=Au(),A=(0,n.useCallback)((a=>{t({...e,...a})}),[e,t]);return n.createElement(F.A,{direction:"column",gap:6},n.createElement(VF.A,{label:"Use github as storage",control:n.createElement(UF.A,{checked:a,onChange:({target:e})=>{r(e.checked),A({use:e.checked})}})}),a?n.createElement(n.Fragment,null,n.createElement(Ga.A,{id:"settings-git-owner",label:"Owner",type:"text",value:l,onChange:e=>{o(e.target.value)},onBlur:()=>{A({owner:l})}}),n.createElement(Ga.A,{id:"settings-git-repo",label:"Repository name",type:"text",value:i,onChange:e=>{s(e.target.value)},onBlur:()=>{A({repo:i})}}),n.createElement(Ga.A,{id:"settings-git-branch",label:"Branch",type:"text",value:c,onChange:e=>{u(e.target.value)},onBlur:()=>{A({branch:c})}}),n.createElement(Ga.A,{id:"settings-git-throttle",label:"Throttle (in ms)",type:"text",value:m,onChange:e=>{d(e.target.value)},onBlur:()=>{const e=Math.min(10,Math.max(5e3,parseInt(m,10)));d(e.toString(10)),A({throttle:e})}}),n.createElement(Ga.A,{id:"settings-git-token",label:"Token",helperText:n.createElement(n.Fragment,null,"Go to GitHub to create a ",n.createElement(h.A,{href:"https://github.com/settings/personal-access-tokens/new",target:"_blank",rel:"noreferrer"},"new fine-grained personal access token"),", select the repository you want to use for synching and allow read/write for ",n.createElement(ua.A,{component:"code",variant:"caption",sx:{fontFamily:"monospace",padding:"0 2px"}},'"Repositoty Permissions > Contents"')),type:f,value:p,slotProps:{input:{endAdornment:E},...di},onChange:e=>{g(e.target.value)},onBlur:()=>{A({token:p})}})):null)};!function(e){e.NUMBER="number",e.STRING="string",e.MULTILINE="multiline"}(vu||(vu={}));const yu=(e,t)=>{switch(e){case vu.NUMBER:{const e=parseFloat(t);return isNaN(e)?0:e}case vu.STRING:case vu.MULTILINE:return t||"";default:return t}},wu=e=>{switch(typeof e){case"string":return e;case"number":return e.toString(10)||"0";default:return""}};var Iu=function({id:e,label:t,type:a,value:r,onChange:l}){const[o,F]=(0,n.useState)(wu(r));return n.createElement(Ga.A,{id:e,label:t,type:"text",multiline:a===vu.MULTILINE,value:o,onChange:e=>{F(e.target.value)},onBlur:()=>{F(wu(yu(a,o))),l(yu(a,o))}})};var Cu=function(e){const{deletePlugin:t,updatePluginConfig:a}=(0,se.h)(),{url:r,name:i,description:s,configParams:c={},config:u={},error:m,loading:d,pluginIndex:p}=e;return n.createElement(l.A,{raised:!0,component:"li"},n.createElement(rt.A,{title:n.createElement(F.A,{direction:"row",gap:2},n.createElement(ua.A,{variant:"h3",component:"h3"},i),d&&n.createElement(Fe.A,{color:"secondary",size:22})),subheader:n.createElement(n.Fragment,null,n.createElement(ua.A,{variant:"body2",component:"div"},s),n.createElement(ua.A,{variant:"caption",component:"div"},r)),action:n.createElement(g.A,{title:`Delete Plugin "${i}"`,onClick:()=>t(r)},n.createElement(je.A,null))}),n.createElement(o.A,null,n.createElement(F.A,{direction:"column",gap:4},m&&n.createElement(Va.A,{severity:"warning",icon:n.createElement(Dt.A,{fontSize:"inherit",color:"warning"})},m),Object.keys(c).map((e=>n.createElement(Iu,{key:`${e}-${p}`,id:`${e}-${p}`,label:c[e].label,type:c[e].type,value:u[e],onChange:t=>{a(r,e,t)}}))))))};var Su=function(){const{plugins:e}=(0,se.h)(),{setError:t}=(0,Ee.A)(),{validateAndAddPlugin:a}=Rt(),[r,l]=(0,n.useState)(""),[o,i]=(0,n.useState)(!1);return n.createElement(F.A,{direction:"column",gap:6},n.createElement(Ga.A,{id:"plugin-settings-add-plugin",label:"Add Plugin",helperText:n.createElement(h.A,{rel:"noreferrer noopener nofollow",href:"https://herrzatacke.github.io/gb-printer-web-plugins/",target:"_blank"},"🔗 A selection plugins can be found here"),type:"text",disabled:o,value:r,slotProps:{input:{endAdornment:n.createElement(g.A,{disabled:!r||o,onClick:async()=>{i(!0),await a({url:r})?l(""):t(new Error("Could not install plugin.")),i(!1)}},n.createElement(Go.A,null))},...di},onChange:e=>{l(e.target.value)}}),n.createElement(F.A,{direction:"column",gap:1},n.createElement(ua.A,{component:"h3",variant:"h3"},"Installed Plugins"),n.createElement(F.A,{direction:"column",gap:2,component:"ul"},e.map(((e,t)=>n.createElement(Cu,{key:e.url,pluginIndex:t,...e}))))))},xu=a(5431);var ku=function(){const{use:e,loggedIn:t,logout:a,startAuth:r,setDropboxStorage:l,path:o,autoDropboxSync:i}=(()=>{const e=Ae(),{remoteImport:t}=De(),{dropboxStorage:a,dropboxLogout:n,setDropboxStorage:r}=(0,de.A)();return{use:!!a.use,loggedIn:!!a.refreshToken,path:a.path||"",autoDropboxSync:a?.autoDropboxSync||!1,logout:n,setDropboxStorage:r,startAuth:()=>ge(e,t).startAuth()}})(),[s,c]=(0,n.useState)(o);return n.createElement(F.A,{direction:"column",gap:6},n.createElement(VF.A,{label:"Use Dropbox as storage",control:n.createElement(UF.A,{checked:e,onChange:({target:e})=>{l({use:e.checked})}})}),e?n.createElement(n.Fragment,null,n.createElement(Ga.A,{id:"dropbox-settings-path",label:"Subfolder",helperText:n.createElement(h.A,{title:`Open Dropbox folder:\nhttps://www.dropbox.com/home/Apps/GameBoyPrinter/${s}`,href:`https://www.dropbox.com/home/Apps/GameBoyPrinter/${s}`,target:"_blank",rel:"noreferrer"},"open folder"),type:"text",value:s,onChange:e=>{c(e.target.value)},onBlur:()=>{c((0,xu.A)(s)),l({path:(0,xu.A)(s)})}}),n.createElement(VF.A,{label:n.createElement(n.Fragment,null,"Enable enhanced dropbox sync",n.createElement(ua.A,{variant:"caption",component:"p",color:"error"},"This is an experimental feature.")),control:n.createElement(UF.A,{checked:i,onChange:({target:e})=>{l({autoDropboxSync:e.checked}),window.setTimeout((()=>{window.location.reload()}),300)}})}),n.createElement(wt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{disabled:t,onClick:r},"Authenticate"),n.createElement(w.A,{disabled:!t,onClick:a},"Logout"))):null)};var Pu=function(e){const{type:t,button:a}=Au();return n.createElement(l.A,{raised:!0,component:"li"},n.createElement(o.A,null,n.createElement(F.A,{direction:"column",gap:4},n.createElement(Ga.A,{id:`${e.id}-settings-ap-ssid`,label:"Network SSID",type:"text",value:e.ssid,slotProps:{...di,input:{endAdornment:n.createElement(g.A,{title:"Delete Network",color:"primary",onClick:()=>{e.update({delete:!e.delete})}},n.createElement(je.A,null))}},disabled:!e.isNew||e.disabled,onChange:t=>{const a=t.target.value;e.update({ssid:a})}}),n.createElement(Ga.A,{id:`${e.id}-settings-ap-psk`,label:"Network Password",type:t,slotProps:{...di,input:{endAdornment:a}},value:e.psk,disabled:e.disabled,onChange:t=>{const a=t.target.value;e.update({psk:a})}}),e.delete&&n.createElement(Va.A,{severity:"error",icon:n.createElement(je.A,{fontSize:"inherit"})},"Network will be deleted"))))};const Tu=(e,t)=>{t("loading");const a=new AbortController,n=a.signal;return(async()=>{try{const a=await fetch("/wificonfig/get",{signal:n}),r=await a.json();r.mdns=r.mdns||"",r.ap=r.ap||{ssid:"",psk:""},r.networks=r.networks||[],t(""),e(r)}catch(a){n.aborted||(t("error"),e(void 0))}})(),()=>{a.abort("Navigated while getting wifi settings")}};var Du=function(){const[e,t]=(0,n.useState)(),[a,r]=(0,n.useState)("loading"),{type:i,button:s}=Au();if((0,n.useEffect)((()=>Tu(t,r)),[t,r]),"loading"===a||!e)return n.createElement(y.A,{sx:{display:"flex",justifyContent:"center"}},n.createElement(Fe.A,{color:"secondary"}));const c=""!==a&&"updated"!==a;return n.createElement(F.A,{direction:"column",gap:6},n.createElement(F.A,{direction:"column",gap:1},n.createElement(ua.A,{component:"h3",variant:"h3"},"Host Settings"),n.createElement(l.A,{raised:!0},n.createElement(o.A,null,n.createElement(F.A,{direction:"column",gap:4},n.createElement(Ga.A,{id:"settings-mdns",label:"mDNS Name (Bonjour/Avahi)",type:"text",disabled:c,value:e.mdns||"",onChange:a=>{const n=a.target.value;r("updated"),t({...e,mdns:n.trim()})}}),n.createElement(Ga.A,{id:"settings-ap-ssid",label:"Accesspoint SSID",type:"text",disabled:c,value:e.ap.ssid||"",onChange:a=>{const n=a.target.value;r("updated"),t({...e,ap:{...e.ap,ssid:n.trim()}})}}),n.createElement(Ga.A,{id:"settings-ap-psk",label:"Accesspoint Password",type:i,slotProps:{...di,input:{endAdornment:s}},disabled:c,value:e.ap.psk||"",onChange:a=>{const n=a.target.value;r("updated"),t({...e,ap:{...e.ap,psk:n.trim()}})}}))))),n.createElement(F.A,{direction:"column",gap:1},n.createElement(ua.A,{component:"h3",variant:"h3"},"Networks"),n.createElement(F.A,{direction:"column",gap:2,component:"ul"},e.networks.map(((a,l)=>{const{ssid:o,psk:F="",delete:i=!1,isNew:s=!1}=a;return n.createElement(Pu,{key:`apconf-${l}`,id:`apconf-${l}`,ssid:o,psk:F,disabled:c,isNew:s,delete:i,update:n=>{const{networks:o}=e;o[l]={...a,...n},r("updated"),t({...e,networks:o})}})})),n.createElement(F.A,{component:"li",direction:"row",justifyContent:"flex-end"},n.createElement(w.A,{disabled:c,title:"Add Network",color:"primary",variant:"contained",startIcon:n.createElement(Go.A,null),onClick:()=>{t({...e,networks:[...e?.networks||[],{ssid:"",psk:"",delete:!1,isNew:!0}]})}},"Add Network")))),n.createElement(wt.A,{fullWidth:!0,variant:"contained"},n.createElement(w.A,{disabled:"updated"!==a,onClick:()=>(async(e,t,a)=>{const n={...a,networks:a.networks.filter((e=>!0===e.delete||e.psk)).filter((e=>e.ssid)).filter((e=>!(e.delete&&e.isNew))).map((({ssid:e,psk:t,delete:a})=>({delete:a,ssid:e,psk:t})))};t("loading");try{const e=await fetch("/wificonfig/set",{method:"post",body:JSON.stringify(n)}),t=await e.json();if(t.error)throw new Error(t.error)}catch(a){alert(a),t("error"),e(void 0)}Tu(e,t)})(t,r,e)},"Save WiFi-Settings")))};let Mu,Ru=!1;var Nu=()=>{const{setDragover:e,setError:t}=(0,Ee.A)(),{jsonImport:a}=De(),r=(0,n.useMemo)((()=>To(a)),[a]),l=(0,n.useCallback)((()=>{const a=t=>{t.preventDefault(),Ru||e(!0),window.clearTimeout(Mu),Ru=!0,Mu=window.setTimeout((()=>{Ru=!1,e(!1)}),250)},n=async e=>{let a;e.preventDefault();const n=e.dataTransfer.items;if(n)a=[...n].reduce(((e,t)=>{if("file"===t.kind){const a=t.getAsFile();return a?[...e,a]:e}return e}),[]);else{a=[...e.dataTransfer.files]}try{await r(a)}catch(e){t(e)}},l=document.querySelector("body");if(!l)throw new Error("dafuq?");return l.addEventListener("dragover",a),l.addEventListener("drop",n),()=>{l.removeEventListener("dragover",a),l.removeEventListener("drop",n)}}),[r,e,t]);(0,n.useEffect)(l,[l])};var Bu=function(){Nu();const e=Ae(),{remoteImport:t}=De();(0,n.useEffect)((()=>{const{subscribe:a}=ge(e,t);return pc(t),a()}),[t,e]);const{checkUpdateTrashCount:a}=Oc();(0,n.useEffect)((()=>{a()}),[a]);const l=(0,r.Ge)([{path:"/",element:n.createElement(su,null),errorElement:n.createElement(uu,null),children:[{path:"/home",handle:{headline:"Game Boy Camera Gallery"},element:n.createElement(c,null)},{path:"/gallery/*",element:n.createElement(La,null),handle:{headline:"Gallery"}},{path:"/import",element:n.createElement(No,null),handle:{headline:"Import"}},{path:"/palettes",element:n.createElement(rF,null),handle:{headline:"Palettes"}},{path:"/frames",element:n.createElement(dF,null),handle:{headline:"Frames"}},{path:"/settings",element:n.createElement(IF,null),handle:{headline:"Settings"},children:[{path:"generic",element:n.createElement(hu,null),handle:{headline:"Generic Settings"}},{path:"git",element:n.createElement(bu,null),handle:{headline:"Git Settings"}},{path:"plugins",element:n.createElement(Su,null),handle:{headline:"Plugin Settings"}},{path:"dropbox",element:n.createElement(ku,null),handle:{headline:"Dropbox Settings"}},"esp8266"===(0,vF._)()?.env||"webpack-dev"===(0,vF._)()?.env?{path:"wifi",element:n.createElement(Du,null),handle:{headline:"WiFi Settings"}}:null].reduce(Io.N,[])},{path:"/webusb",element:n.createElement(WF,null)},{path:"/add-plugin/:pluginUrl?",element:n.createElement(YF,null),handle:{headline:"Add Plugin"}}]}]);return n.createElement(r.pg,{router:l})}},42002:function(e,t,a){"use strict";a.d(t,{R:function(){return o},j:function(){return g}});var n=a(4213);var r=e=>"function"==typeof e.arrayBuffer?e.arrayBuffer():new Promise((t=>{const a=new FileReader;a.onload=e=>{if(!e.target)throw new Error("no file");const a=e.target.result;if("string"==typeof a||null===a)throw new Error("unexpected filereader result");t(a)},a.readAsArrayBuffer(e)})),l=a(73052);var o=e=>async t=>{if(1===t.length){const e=t[0];return(0,n.saveAs)(e.blob,e.filename)}const{default:o}=await a.e(1710).then(a.t.bind(a,71710,23)),F=new o,i=await Promise.all(t.map((({filename:e,blob:t})=>r(t).then((t=>({filename:e,arrayBuffer:t}))))));(0,l.A)(i).forEach((({filename:e,arrayBuffer:t})=>{F.file(e,t)}));const s=await F.generateAsync({type:"blob",compression:"DEFLATE"});if(!e)throw new Error("missing filename");return(0,n.saveAs)(s,`${e}.zip`)},F=a(10784),i=a(99905),s=a(29809),c=a(53111),u=a(27261),m=a(77580),d=a(60318),p=a(44949);var g=(e,t,a,n,r)=>l=>async(o,g)=>{let h;const f=(0,u.pl)(l),E=l.lockFrame||!1,A=l.rotation||0,{palette:v,framePalette:b}=(0,d.s)(n,l);if(!v)throw new Error("Palette missing?");if(f)h=new F.Wd,h.update({canvas:null,tiles:o,palette:v,lockFrame:E});else{h=new F.XM;const{invertPalette:e,invertFramePalette:t}=(0,p.f)(l),a=(0,m.A)({palette:v?.palette||F.CU,framePalette:b?.palette||F.CU,invertPalette:e,invertFramePalette:t});h.update({canvas:null,tiles:o,...a,imageStartLine:g})}const y=[...e].filter((e=>"number"==typeof e)),w=[...t];y.length||y.push(4),w.length||w.push("png");const I=y.map((e=>w.map((t=>new Promise((n=>{const o=(0,i.A)({image:l,palette:v,exportScaleFactor:e,fileNameStyle:r});switch(t){case"txt":if(f)return void n(null);(0,s.Z)(l.hash,l.title,o).then(n);break;case"pgm":{if(f)return void n(null);const e=(0,c.Ej)(h.getScaledCanvas(1,a),A),r=["P2","#",`# Exported from ${window.location.origin}`,"#",`# hash: ${l.hash}`,`# created: ${l.created}`,`# title: ${l.title}`,`# tags: ${l.tags.join(", ")}`,`# dimension: ${e.width}*${e.height} pixels`,"#",`${e.width} ${e.height}`,"3","#"],i=e.getContext("2d");if(!i){n(null);break}for(let t=0;t<e.height;t+=1){const a=[];for(let n=0;n<e.width;n+=1){const e=i.getImageData(n,t,1,1).data,r=["#",e[0].toString(16).padStart(2,"0"),e[1].toString(16).padStart(2,"0"),e[2].toString(16).padStart(2,"0")].join("");let l=v.palette?.indexOf(r)||-1;-1===l&&(l=F.eJ.indexOf(parseInt(r.slice(1),16))),a.push(3-l)}r.push(a.join(" "))}n({filename:`${o}.${t}`,blob:new Blob([r.join("\n")],{type:"text/plain"}),title:l.title});break}default:{const r=e=>{n(e?{filename:`${o}.${t}`,blob:e,title:l.title}:null)};(0,c.Ej)(h.getScaledCanvas(e,a),A).toBlob(r,`image/${t}`,1);break}}}))))));return(await Promise.all(I.flat())).reduce(((e,t)=>t?[...e,t]:e),[])}},44949:function(e,t,a){"use strict";a.d(t,{f:function(){return n}});const n=e=>{const t=e.invertPalette||!1;if(!e.lockFrame)return{invertPalette:t,invertFramePalette:t};const a=e.invertFramePalette;return{invertPalette:t,invertFramePalette:void 0===a?t:a}}},47020:function(e,t,a){"use strict";a.d(t,{A:function(){return g}});var n=a(42813),r=a(27673),l=a(3876),o=a(42419),F=a(27261),i=a(7372);var s=async e=>{const t=e.reduce(((e,t)=>[...e,...(0,F.pl)(t)?(0,i.A)(Object.values(t.hashes)):[t.hash]]),[]),a=await Promise.all(t.map((async e=>({hash:e,data:await o.mU.getItem(e)})))),n={};return a.forEach((({hash:e,data:t})=>{t&&(n[e]=t)})),n};var c=async e=>{const t=await Promise.all(e.map((async e=>({hash:e,data:await o.Uv.getItem(e)})))),a={};return t.forEach((({hash:e,data:t})=>{t&&(a[`frame-${e}`]=t)})),a};var u=(e,t,a)=>{switch(e){case"images":return t.map((({hash:e})=>e));case"selected_images":return a;default:return[]}};var m=(e,t,a="")=>{switch(e){case"frames":return t;case"current_framegroup":return t.filter((({id:e})=>e.startsWith(a)));default:return[]}},d=a(1562);const p=e=>{switch(e){case l.m.ALL:return["frameGroups","frames","imageGroups","images","palettes","plugins"];case l.m.SELECTED_IMAGES:return["images"];case l.m.IMAGES:return["images","imageGroups"];case l.m.PALETTES:return["palettes"];case l.m.FRAMES:case l.m.CURRENT_FRAMEGROUP:return["frames","frameGroups"];case l.m.PLUGINS:return["plugins"];default:return[]}};var g=()=>async(e,{lastUpdateUTC:t,selectedFrameGroup:a}={})=>{const{frames:o,images:F,palettes:i,imageGroups:g,frameGroups:h,plugins:f}=n.h.getState(),{imageSelection:E}=r.A.getState(),A={...p(e).reduce(((t,n)=>{switch(n){case"frameGroups":return{...t,frameGroups:e===l.m.CURRENT_FRAMEGROUP?h.filter((e=>e.id===a)):(0,d.A)(o,h)};case"frames":{const n=e===l.m.FRAMES?l.m.FRAMES:l.m.CURRENT_FRAMEGROUP;return{...t,frames:m(n,o,a)}}case"imageGroups":return{...t,imageGroups:g};case"images":{const a=e===l.m.SELECTED_IMAGES?"selected_images":"images",n=u(a,F,E);return{...t,images:F.filter((({hash:e})=>n.includes(e)))}}case"palettes":return{...t,palettes:i.filter((({isPredefined:e})=>!e))};case"plugins":return{...t,plugins:f};default:return t}}),{}),lastUpdateUTC:t||Math.floor((new Date).getTime()/1e3),version:n.A};let v={};if(A.images?.length&&[l.m.IMAGES,l.m.SELECTED_IMAGES,l.m.ALL].includes(e)&&(v={...v,...await s(A.images)}),A.frames?.length&&[l.m.FRAMES,l.m.CURRENT_FRAMEGROUP,l.m.ALL].includes(e)){const t=e===l.m.CURRENT_FRAMEGROUP?l.m.CURRENT_FRAMEGROUP:l.m.FRAMES;v={...v,...await c(m(t,o,a).map((({hash:e})=>e)))}}const b={state:A,...v};return JSON.stringify(b,null,2)}},53111:function(e,t,a){"use strict";var n;a.d(t,{Ej:function(){return l},pL:function(){return n},zP:function(){return r}}),function(e){e[e.DEG_0=0]="DEG_0",e[e.DEG_90=1]="DEG_90",e[e.DEG_180=2]="DEG_180",e[e.DEG_270=3]="DEG_270"}(n||(n={}));const r=(e,t,a)=>{const n=t.getContext("2d");if(!n)throw new Error("No canvas context");switch(n.resetTransform(),a%2?(t.height=e.width,t.width=e.height):(t.width=e.width,t.height=e.height),a){case 1:n.translate(e.height,0);break;case 2:n.translate(e.width,e.height);break;case 3:n.translate(0,e.width)}n.rotate(90*a*Math.PI/180),n.drawImage(e,0,0),n.resetTransform()},l=(e,t)=>{const a=document.createElement("canvas");return r(e,a,t),a}},56727:function(e,t,a){"use strict";const n=(0,a(71511).v)((e=>({dialogs:[],dismissDialog:t=>e((({dialogs:e})=>({dialogs:e.filter(((e,a)=>t!==a))}))),setDialog:t=>e((({dialogs:e})=>({dialogs:[t,...e]})))})));t.A=n},60318:function(e,t,a){"use strict";a.d(t,{s:function(){return l}});var n=a(27261),r=a(30498);const l=(e,t)=>{if((0,n.pl)(t)){const{palette:e}=t;return{palette:e}}const a=t,l=e.find((({shortName:e})=>e===a.palette))||r.Fv,o=e.find((({shortName:e})=>e===a.framePalette))||r.Fv;return{palette:l,framePalette:a.lockFrame?o:l}}},73052:function(e,t){"use strict";t.A=e=>{const t=[];return e.map((e=>{const{filename:a}=e,n=a.split("."),r=n.pop();if(!r)throw new Error("unknown file type");const l=n.join(".");let o=a,F=0;for(;t.includes(o);)F+=1,o=`${l}_(${F}).${r}`;return t.includes(o)||t.push(o),{...e,filename:o}}))}},76194:function(e,t,a){"use strict";var n=a(71511),r=a(87134),l=a(34704);const o=(0,n.v)((0,r.eh)((0,r.Zr)((e=>({dropboxStorage:{},gitStorage:{},syncLastUpdate:{dropbox:0,local:0},dropboxLogout:()=>e((({dropboxStorage:e})=>({dropboxStorage:{use:e.use}}))),setDropboxStorage:t=>e((({dropboxStorage:e})=>({dropboxStorage:{...e,...t}}))),setGitStorage:t=>e((({gitStorage:e})=>({gitStorage:{...e,...t}}))),setSyncLastUpdate:(t,a)=>e((({syncLastUpdate:e})=>({syncLastUpdate:{...e,[t]:a}})))})),{name:`${l.z}-storages`,storage:(0,r.KU)((()=>localStorage))})));t.A=o},76776:function(e,t,a){var n={"./af.js":[65662,5662],"./am.js":[82355,2355],"./ar-dz.js":[48361,8361],"./ar-iq.js":[13309,3309],"./ar-kw.js":[79865,9865],"./ar-ly.js":[85592,5592],"./ar-ma.js":[81289,1289],"./ar-sa.js":[40539,539],"./ar-tn.js":[76786,4405],"./ar.js":[2338,2338],"./az.js":[51130,1130],"./be.js":[51532,1532],"./bg.js":[39990,9990],"./bi.js":[95944,5944],"./bm.js":[71092,1092],"./bn-bd.js":[64608,4608],"./bn.js":[92509,2509],"./bo.js":[59294,9294],"./br.js":[72745,2745],"./bs.js":[25530,5530],"./ca.js":[25993,5993],"./cs.js":[9751,9751],"./cv.js":[4780,4780],"./cy.js":[95681,5681],"./da.js":[42706,2706],"./de-at.js":[32878,2878],"./de-ch.js":[13672,3672],"./de.js":[50494,494],"./dv.js":[82187,2187],"./el.js":[54072,4072],"./en-au.js":[59881,9881],"./en-ca.js":[21995,1995],"./en-gb.js":[72026,2026],"./en-ie.js":[17329,7329],"./en-il.js":[97690,7690],"./en-in.js":[60912,912],"./en-nz.js":[35571,5571],"./en-sg.js":[12673,2673],"./en-tt.js":[2619,2619],"./en.js":[65826,5826],"./eo.js":[33713,3713],"./es-do.js":[61219,1219],"./es-mx.js":[64719,4719],"./es-pr.js":[3532,3532],"./es-us.js":[32498,2498],"./es.js":[47317,7317],"./et.js":[4288,4288],"./eu.js":[94007,4007],"./fa.js":[90292,292],"./fi.js":[89964,9964],"./fo.js":[17674,7674],"./fr-ca.js":[86290,6290],"./fr-ch.js":[73433,3433],"./fr.js":[813,813],"./fy.js":[59836,9836],"./ga.js":[54061,4061],"./gd.js":[68418,8418],"./gl.js":[33562,3562],"./gom-latn.js":[78660,8660],"./gu.js":[57409,7409],"./he.js":[92010,2010],"./hi.js":[52830,2830],"./hr.js":[15811,5811],"./ht.js":[8809,8809],"./hu.js":[38298,8298],"./hy-am.js":[94309,4309],"./id.js":[87420,7420],"./is.js":[15513,5513],"./it-ch.js":[19286,9286],"./it.js":[33900,3900],"./ja.js":[50952,952],"./jv.js":[77741,7741],"./ka.js":[46481,6481],"./kk.js":[11335,1335],"./km.js":[36101,6101],"./kn.js":[6364,6364],"./ko.js":[88003,8003],"./ku.js":[16605,6605],"./ky.js":[34457,4457],"./lb.js":[88615,8615],"./lo.js":[73860,3860],"./lt.js":[34485,4485],"./lv.js":[76467,6467],"./me.js":[80623,623],"./mi.js":[32739,2739],"./mk.js":[75877,5877],"./ml.js":[75376,5376],"./mn.js":[12698,2698],"./mr.js":[46462,6462],"./ms-my.js":[26400,6400],"./ms.js":[79677,9677],"./mt.js":[99464,9464],"./my.js":[46803,6803],"./nb.js":[7205,7205],"./ne.js":[40880,880],"./nl-be.js":[60465,465],"./nl.js":[69423,9423],"./nn.js":[23473,3473],"./oc-lnc.js":[70225,225],"./pa-in.js":[39252,9252],"./pl.js":[63225,3225],"./pt-br.js":[92218,2218],"./pt.js":[72369,2369],"./rn.js":[34509,4509],"./ro.js":[24334,4334],"./ru.js":[62796,2796],"./rw.js":[35414,5414],"./sd.js":[63222,3222],"./se.js":[55285,5285],"./si.js":[65665,5665],"./sk.js":[46847,6847],"./sl.js":[39998,9998],"./sq.js":[95977,5977],"./sr-cyrl.js":[27439,7439],"./sr.js":[45616,5616],"./ss.js":[52487,2487],"./sv-fi.js":[9160,9160],"./sv.js":[21340,1340],"./sw.js":[2979,2979],"./ta.js":[77250,7250],"./te.js":[87406,7406],"./tet.js":[18928,8928],"./tg.js":[15012,5012],"./th.js":[47081,7081],"./tk.js":[62544,2544],"./tl-ph.js":[78142,8142],"./tlh.js":[60321,321],"./tr.js":[4895,4895],"./tzl.js":[3187,3187],"./tzm-latn.js":[58804,8804],"./tzm.js":[95084,5084],"./ug-cn.js":[79911,9911],"./uk.js":[34173,4173],"./ur.js":[51750,1750],"./uz-latn.js":[80950,950],"./uz.js":[54734,4734],"./vi.js":[40860,860],"./x-pseudo.js":[5760,5760],"./yo.js":[87933,7933],"./zh-cn.js":[16033,6033],"./zh-hk.js":[87741,122],"./zh-tw.js":[31349,1349],"./zh.js":[56007,6007]};function r(e){if(!a.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],r=t[0];return a.e(t[1]).then((function(){return a.t(r,23)}))}r.keys=function(){return Object.keys(n)},r.id=76776,e.exports=r},77580:function(e,t,a){"use strict";a.d(t,{A:function(){return r}});var n=a(10784);const r=({palette:e,framePalette:t,invertPalette:a=!1,invertFramePalette:r=!1})=>{const l=e||n.CU,o=t||l;return{palette:a?[...l].reverse():[...l],framePalette:r?[...o].reverse():[...o]}}},88137:function(e,t,a){"use strict";a.d(t,{PM:function(){return l},YZ:function(){return n},lt:function(){return r}});const n=(e,t)=>({...e,sortIndex:t}),r=e=>({...e,sortIndex:void 0}),l=e=>(t,a)=>{if(!e)return 0;const[n,r]=e.split("_"),l=t[n],o=a[n],F="desc"===r?-1:1;return l&&o?l>o?F:l<o?-F:t.sortIndex<a.sortIndex?F:-F:0}},88231:function(e,t,a){"use strict";var n=a(71511),r=a(51916),l=a.n(r),o=a(74353),F=a.n(o),i=a(33829);const s=(0,n.v)(((e,t)=>({dragover:!1,errors:[],isFullscreen:!1,lightboxImage:null,printerBusy:!1,printerData:null,printerFunctions:[],progress:{gif:0,printer:0,plugin:0},progressLog:{git:[],dropbox:[]},showSerials:!1,syncBusy:!1,syncSelect:!1,trashCount:{frames:0,images:0,show:!1},windowDimensions:{width:window.innerWidth,height:window.innerHeight},videoSelection:[],dismissError:a=>e({errors:t().errors.filter(((e,t)=>t!==a))}),resetProgressLog:()=>e({progressLog:{git:[],dropbox:[]}}),setDragover:t=>e({dragover:t}),setError:a=>e({errors:[...t().errors,{error:a,timestamp:F()().unix(),id:(0,i.A)()}]}),setIsFullscreen:t=>e({isFullscreen:t}),setPrinterBusy:t=>e({printerBusy:t}),setPrinterData:t=>e({printerData:t}),setPrinterFunctions:t=>e({printerFunctions:t}),setProgress:(a,n)=>e({progress:{...t().progress,[a]:n}}),setShowSerials:t=>e({showSerials:t}),setSyncBusy:t=>e({syncBusy:t}),setSyncSelect:t=>e({syncSelect:t}),setWindowDimensions:()=>e({windowDimensions:{width:window.innerWidth,height:window.innerHeight}}),showTrashCount:a=>e({trashCount:{...t().trashCount,show:a}}),updateTrashCount:(a,n)=>e({trashCount:{...t().trashCount,frames:a,images:n}}),setVideoSelection:t=>e({videoSelection:t}),setProgressLog:(a,n)=>{const{progressLog:r}=t();e({progressLog:{...r,[a]:[n,...r[a]]}})},setLightboxImage:t=>{null===t&&l().exit(),e({lightboxImage:t})},setLightboxImageNext:a=>{const n=t().lightboxImage;null!==n&&e({lightboxImage:Math.min(n+1,a-1)})},setLightboxImagePrev:()=>{const a=t().lightboxImage;null!==a&&e({lightboxImage:Math.max(a-1,0)})}})));window.se=s.getState().setError,t.A=s},96533:function(e,t,a){"use strict";a.d(t,{T:function(){return l},p:function(){return o}});var n=a(90521),r=a(27261);const l=(e,t,a)=>{const l=async(o,F,i,s)=>{const c=e.find((e=>o===e.hash)),u=("string"==typeof i?i:c?.frame)||void 0,m=t.find((({id:e})=>e===u))?.hash;if(!(s||c&&(0,r.pl)(c))){return await(0,n.Hh)(o,m,F,a)||[]}const d=s||c.hashes;return{r:d.r?await l(d.r,F,u):[],g:d.g?await l(d.g,F,u):[],b:d.b?await l(d.b,F,u):[],n:d.n?await l(d.n,F,u):[]}};return l},o=(e,t)=>{const a=l(e,t);return async e=>{const t=await a(e,!0,"");return t&&(t?.length||t.r?.length||t.g?.length||t.b?.length||t.n?.length)||0}}},98714:function(e,t,a){"use strict";a.d(t,{L2:function(){return i},_K:function(){return F}});var n=a(90521),r=a(88222),l=a(37482),o=a(27261);const F=async e=>{const t=e.split("\n").filter((e=>e.match(/^[0-9a-f ]+$/gi)));return(0,n.UN)(t)},i=e=>{const t=Array(32).fill("f").join(""),a=Array(16).fill(t);return[...e.upper,...Array(14).fill("").map(((t,n)=>[...e.left[n],...a,...e.right[n]])).flat(),...e.lower]};t.Ay=async({images:e,frames:t,settings:a})=>{const s=a.state.images||[],c=a.state.frames||[],u=(await Promise.all(e.map((async e=>{const t=await(0,n.Hh)(e.hash,void 0,!0);if(t?.length)return;const a=await e.getFileContent(),r=await F(a);return e.hash!==r?{oldHash:e.hash,newHash:r}:void 0})))).reduce(l.N,[]),m=(await Promise.all(t.map((async e=>{if(await(0,r.mZ)(e.hash))return;const t=await e.getFileContent(),a=await(async e=>{const t=JSON.parse(e),a=t.upper.length/20,n=i(t);return(0,r.R_)(n,a)})(t);return e.hash!==a?{oldHash:e.hash,newHash:a}:void 0})))).reduce(l.N,[]),d=s.map((e=>{if((0,o.pl)(e)){const t=e,a=u.find((({oldHash:e})=>e===t.hashes.r)),n=u.find((({oldHash:e})=>e===t.hashes.g)),r=u.find((({oldHash:e})=>e===t.hashes.b)),l=u.find((({oldHash:e})=>e===t.hashes.n));return{...t,hashes:{r:a?.newHash||t.hashes.r,g:n?.newHash||t.hashes.g,b:r?.newHash||t.hashes.b,n:l?.newHash||t.hashes.n}}}const t=u.find((({oldHash:t})=>t===e.hash));return{...e,hash:t?.newHash||e.hash}})),p=c.map((e=>{const t=m.find((({oldHash:t})=>t===e.hash));return t?{...e,hash:t.newHash}:e}));return{...a,state:{...a.state,images:d,frames:p}}}},99905:function(e,t,a){"use strict";var n=a(74353),r=a.n(n),l=a(73460),o=a(90445),F=a.n(o),i=a(30498),s=a(38004);r().extend(F());const c=(e,t="-")=>e.reduce(((e,a)=>a?`${e}${e?t:""}${a}`:e),"");t.A=e=>{const t=e.image||null,a=e.palette||null,n=e.exportScaleFactor||null,o=e.useCurrentDate||null,F=e.frameRate?.toString(10)||"",u=e.altTitle||"",m=e.frameName||"",d=e.paletteShort||"",{fileNameStyle:p}=e,g=o||!t?r()():r()(t.created,i.i$),h=g.isValid()?g.format(i.fE):"",f=d||(a?a.shortName||(({r:e,g:t,b:a,n:n})=>{const r=e=>e.toString(16).padStart(2,"0");return c([e?.map(r).join("")||"",t?.map(r).join("")||"",a?.map(r).join("")||"",n?.map(r).join("")||""],".")})(a):""),E=t&&t.title?t.title:u,A=n?`${n}x`:"",v=F?`${F}fps`:"";let b;switch(p){case s.B.TITLE_ONLY:b=[E];break;case s.B.DATE_TITLE:b=[h,E];break;case s.B.FULL:default:b=[h,E,A,v,m,f]}const y=c(b);return(0,l.A)(y,{replacement:""})}}}]);