/*! License information can be found in 0ef4/app.js.l.txt */
(self.webpackChunkgb_printer_web=self.webpackChunkgb_printer_web||[]).push([[3524],{1562:function(e,t){"use strict";const a=(e,t,a)=>{const n=a.find((t=>t.id===e));if(n)return n.name;switch(e){case"hk":return"Hallo Katze!";case"int":return"International Frames (GameBoy Camera)";case"jp":return"Japanese Frames (Pocket Camera)";default:return t}},n=e=>{switch(e){case"int":return"_1";case"jp":return"_2";case"hk":return"_3";default:return e}};t.A=(e,t)=>e.reduce(((e,{id:n,name:r})=>{try{const l=n.match(/^[a-z]+/g)?.[0];return l?(e.find((e=>e.id===l))||e.push({id:l,name:a(l,r,t)}),e):e}catch(t){return e}}),[]).sort((({id:e},{id:t})=>{const a=n(e),r=n(t);return a>r?1:a<r?-1:0}))},3876:function(e,t,a){"use strict";var n;a.d(t,{m:function(){return n}}),function(e){e.ALL="all",e.FRAMES="frames",e.CURRENT_FRAMEGROUP="current_framegroup",e.IMAGES="images",e.SELECTED_IMAGES="selected_images",e.PALETTES="palettes",e.PLUGINS="plugins"}(n||(n={}))},5431:function(e,t){"use strict";t.A=e=>e.replace(/[^a-z0-9/\\._-]/gi,"").replace(/[\\/]+/gi,"/").replace(/^\//,"").replace(/\/$/,"")},16521:function(e,t,a){"use strict";var n=a(74353),r=a.n(n),l=a(601),o=a(30498),i=a(27261);t.A=(e,t)=>a=>{const n=e.reduce(((e,t)=>[l.X3.FILTER_MONOCHROME,l.X3.FILTER_NEW,l.X3.FILTER_RGB,l.X3.FILTER_UNTAGGED,l.X3.FILTER_RECENT,l.X3.FILTER_FAVOURITE,l.X3.FILTER_COMMENTS,l.X3.FILTER_USERNAME].includes(t)?[...e,t]:e),[]);if(n.length){if(n.includes(l.X3.FILTER_UNTAGGED)&&0!==a.tags.length)return!1;if(n.includes(l.X3.FILTER_NEW)){if(r()(a.created,o.i$).unix()<=r()().subtract(1,"day").unix())return!1}return!(n.includes(l.X3.FILTER_RECENT)&&!t.map((({hash:e})=>e)).includes(a.hash))&&(!(n.includes(l.X3.FILTER_RGB)&&!(0,i.pl)(a))&&((!n.includes(l.X3.FILTER_MONOCHROME)||!(0,i.pl)(a))&&(!(n.includes(l.X3.FILTER_FAVOURITE)&&!a.tags.includes(l.X3.FILTER_FAVOURITE))&&(!(n.includes(l.X3.FILTER_COMMENTS)&&!a.meta?.comment)&&!(n.includes(l.X3.FILTER_USERNAME)&&!a.meta?.userName)))))}return!0}},26564:function(e,t,a){"use strict";var n;a.d(t,{V:function(){return n}}),function(e){e.CHECKBOX="checkbox",e.SELECT="select",e.TEXT="text",e.NUMBER="number",e.INFO="info",e.IMAGE="image",e.META="meta"}(n||(n={}))},28025:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var n,r=a(48287).Buffer;!function(e){e.UINT8_ARRAY="uint8array",e.TEXT="text",e.DATA_URL="dataURL",e.BINARY_STRING="binaryString"}(n||(n={})),t.A=function(e,t){return new Promise(((a,l)=>{const o=new FileReader;switch(o.onload=({target:e})=>{if(e?.result)return t===n.UINT8_ARRAY?void a(r.from(e.result)):void a(e.result);l(new Error("Filereader has no result"))},o.onerror=e=>{l(e)},t){case n.UINT8_ARRAY:o.readAsArrayBuffer(e);break;case n.TEXT:o.readAsText(e);break;case n.BINARY_STRING:o.readAsBinaryString(e);break;case n.DATA_URL:o.readAsDataURL(e);break;default:l(new Error(`readAs param missing or unknown type "${t}"`))}}))}},29809:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var n=a(90521),r=a(30498);const l=async(e,t,a)=>{const l=(await(0,n.Hh)(e)||[]).map((e=>e.match(/.{1,2}/g)?.join(" ")||"")).reduce(((e,t,a)=>a%40?[...e,t]:[...e,r.g0,t]),[]),o=[r.dm,...l,r.R2,r.Ys].join("\n");return{folder:"images",filename:`${a}.txt`,blob:new Blob(new Array(o),{type:"text/plain"}),title:t}}},30985:function(e,t,a){"use strict";var n=a(601);t.A=e=>t=>{const a=e.filter((e=>![n.X3.FILTER_MONOCHROME,n.X3.FILTER_NEW,n.X3.FILTER_RGB,n.X3.FILTER_UNTAGGED,n.X3.FILTER_RECENT,n.X3.FILTER_FAVOURITE,n.X3.FILTER_COMMENTS,n.X3.FILTER_USERNAME].includes(e)));return!a.length||!!t.tags.find((e=>a.includes(e)))}},37482:function(e,t,a){"use strict";a.d(t,{N:function(){return n}});const n=(e,t)=>t?[...e,t]:e},39200:function(e,t,a){"use strict";a.d(t,{S:function(){return o}});var n=a(88137),r=a(16521),l=a(30985);const o=(e,{filtersActiveTags:t,sortBy:a,recentImports:o})=>[...e].map(n.YZ).sort((0,n.PM)(a)).map(n.lt).filter((0,r.A)(t,o)).filter((0,l.A)(t))},42002:function(e,t,a){"use strict";a.d(t,{R:function(){return o},j:function(){return p}});var n=a(4213);var r=e=>"function"==typeof e.arrayBuffer?e.arrayBuffer():new Promise((t=>{const a=new FileReader;a.onload=e=>{if(!e.target)throw new Error("no file");const a=e.target.result;if("string"==typeof a||null===a)throw new Error("unexpected filereader result");t(a)},a.readAsArrayBuffer(e)})),l=a(73052);var o=e=>async t=>{if(1===t.length){const e=t[0];return(0,n.saveAs)(e.blob,e.filename)}const{default:o}=await a.e(1710).then(a.t.bind(a,71710,23)),i=new o,F=await Promise.all(t.map((({filename:e,blob:t})=>r(t).then((t=>({filename:e,arrayBuffer:t}))))));(0,l.A)(F).forEach((({filename:e,arrayBuffer:t})=>{i.file(e,t)}));const s=await i.generateAsync({type:"blob",compression:"DEFLATE"});if(!e)throw new Error("missing filename");return(0,n.saveAs)(s,`${e}.zip`)},i=a(58746),F=a(99905),s=a(29809),c=a(27261),u=a(45082),m=a(60318),d=a(44949);var p=(e,t,a,n,r)=>l=>async(o,p)=>{const g=(0,c.pl)(l),h=l.lockFrame||!1,f=l.rotation||0,{palette:E,framePalette:A}=(0,m.s)(n,l);if(!E)throw new Error("Palette missing?");const v=async(e,t)=>{if(g)return(0,i.y1)({tiles:o,palette:E,lockFrame:h,imageStartLine:p,rotation:f,scaleFactor:t,handleExportFrame:a},e);const{invertPalette:n,invertFramePalette:r}=(0,d.f)(l),F=(0,u.C)({imagePalette:E.palette||i.CU,framePalette:A?.palette||i.CU,invertPalette:n,invertFramePalette:r});return(0,i.Yn)({tiles:o,rotation:f,scaleFactor:t,handleExportFrame:a,...F,imageStartLine:p},e)},b=[...e].filter((e=>"number"==typeof e)),y=[...t];b.length||b.push(4),y.length||y.push("png");const w=b.map((e=>y.map((t=>new Promise((a=>{const n=(0,F.A)({image:l,palette:E,exportScaleFactor:e,fileNameStyle:r});switch(t){case"txt":if(g)return void a(null);(0,s.Z)(l.hash,l.title,n).then(a);break;case"pgm":if(g)return void a(null);v("image/png",e).then(createImageBitmap).then((e=>{const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const o=r.getContext("2d");o.drawImage(e,0,0);const F=E.palette;if(!o||!F?.length)return void a(null);const s=["P2","#",`# Exported from ${window.location.origin}`,"#",`# hash: ${l.hash}`,`# created: ${l.created}`,`# title: ${l.title}`,`# tags: ${l.tags.join(", ")}`,`# dimension: ${r.width}*${r.height} pixels`,"#",`${r.width} ${r.height}`,"3","#"];for(let e=0;e<r.height;e+=1){const t=[];for(let a=0;a<r.width;a+=1){const n=o.getImageData(a,e,1,1).data,r=["#",n[0].toString(16).padStart(2,"0"),n[1].toString(16).padStart(2,"0"),n[2].toString(16).padStart(2,"0")].join("");let l=E.palette.indexOf(r);-1===l&&(l=i.eJ.indexOf(parseInt(r.slice(1),16))),t.push(3-l)}s.push(t.join(" "))}a({filename:`${n}.${t}`,blob:new Blob([s.join("\n")],{type:"text/plain"}),title:l.title})}));break;default:v(`image/${t}`,e).then((e=>{a({filename:`${n}.${t}`,blob:e,title:l.title})})).catch((()=>a(null)))}}))))));return(await Promise.all(w.flat())).reduce(((e,t)=>t?[...e,t]:e),[])}},44949:function(e,t,a){"use strict";a.d(t,{f:function(){return n}});const n=e=>{const t=e.invertPalette||!1;if(!e.lockFrame)return{invertPalette:t,invertFramePalette:t};const a=e.invertFramePalette;return{invertPalette:t,invertFramePalette:void 0===a?t:a}}},45082:function(e,t,a){"use strict";a.d(t,{C:function(){return l}});var n=a(58746);const r=e=>{const t=e.replace("#","");if(!/^([0-9a-fA-F]{6})$/.test(t))throw new Error("Invalid hex color");return parseInt(t,16)},l=({imagePalette:e,framePalette:t,invertPalette:a=!1,invertFramePalette:l=!1})=>{const o=(e||n.CU).map(r),i=t?.map(r)||o;return{imagePalette:a?[...o].reverse():[...o],framePalette:l?[...i].reverse():[...i]}}},47020:function(e,t,a){"use strict";a.d(t,{A:function(){return g}});var n=a(42813),r=a(27673),l=a(3876),o=a(42419),i=a(27261),F=a(7372);var s=async e=>{const t=e.reduce(((e,t)=>[...e,...(0,i.pl)(t)?(0,F.A)(Object.values(t.hashes)):[t.hash]]),[]),a=await Promise.all(t.map((async e=>({hash:e,data:await o.mU.getItem(e)})))),n={};return a.forEach((({hash:e,data:t})=>{t&&(n[e]=t)})),n};var c=async e=>{const t=await Promise.all(e.map((async e=>({hash:e,data:await o.Uv.getItem(e)})))),a={};return t.forEach((({hash:e,data:t})=>{t&&(a[`frame-${e}`]=t)})),a};var u=(e,t,a)=>{switch(e){case"images":return t.map((({hash:e})=>e));case"selected_images":return a;default:return[]}};var m=(e,t,a="")=>{switch(e){case"frames":return t;case"current_framegroup":return t.filter((({id:e})=>e.startsWith(a)));default:return[]}},d=a(1562);const p=e=>{switch(e){case l.m.ALL:return["frameGroups","frames","imageGroups","images","palettes","plugins"];case l.m.SELECTED_IMAGES:return["images"];case l.m.IMAGES:return["images","imageGroups"];case l.m.PALETTES:return["palettes"];case l.m.FRAMES:case l.m.CURRENT_FRAMEGROUP:return["frames","frameGroups"];case l.m.PLUGINS:return["plugins"];default:return[]}};var g=()=>async(e,{lastUpdateUTC:t,selectedFrameGroup:a}={})=>{const{frames:o,images:i,palettes:F,imageGroups:g,frameGroups:h,plugins:f}=n.h.getState(),{imageSelection:E}=r.A.getState(),A={...p(e).reduce(((t,n)=>{switch(n){case"frameGroups":return{...t,frameGroups:e===l.m.CURRENT_FRAMEGROUP?h.filter((e=>e.id===a)):(0,d.A)(o,h)};case"frames":{const n=e===l.m.FRAMES?l.m.FRAMES:l.m.CURRENT_FRAMEGROUP;return{...t,frames:m(n,o,a)}}case"imageGroups":return{...t,imageGroups:g};case"images":{const a=e===l.m.SELECTED_IMAGES?"selected_images":"images",n=u(a,i,E);return{...t,images:i.filter((({hash:e})=>n.includes(e)))}}case"palettes":return{...t,palettes:F.filter((({isPredefined:e})=>!e))};case"plugins":return{...t,plugins:f};default:return t}}),{}),lastUpdateUTC:t||Math.floor((new Date).getTime()/1e3),version:n.A};let v={};if(A.images?.length&&[l.m.IMAGES,l.m.SELECTED_IMAGES,l.m.ALL].includes(e)&&(v={...v,...await s(A.images)}),A.frames?.length&&[l.m.FRAMES,l.m.CURRENT_FRAMEGROUP,l.m.ALL].includes(e)){const t=e===l.m.CURRENT_FRAMEGROUP?l.m.CURRENT_FRAMEGROUP:l.m.FRAMES;v={...v,...await c(m(t,o,a).map((({hash:e})=>e)))}}const b={state:A,...v};return JSON.stringify(b,null,2)}},48381:function(e,t,a){"use strict";a.d(t,{default:function(){return Bu}});var n=a(96540),r=a(97665),l=a(52412),o=a(18516),i=a(53830);function F({children:e}){return n.createElement(i.A,{direction:"column",gap:1,sx:e=>({a:{color:e.palette.secondary.light,textDecorationColor:"currentColor","&:hover":{color:e.palette.secondary.main}},code:{fontFamily:"monospace"},ul:{listStyleType:"disc",paddingInlineStart:e.spacing(2)},"h1,h2,h3,h4,h5,h6,p":{marginBottom:"0.6em"}})},e)}var s=function({getMarkdown:e}){const[t,r]=(0,n.useState)((()=>()=>null)),[i,s]=(0,n.useState)("");return(0,n.useEffect)((()=>{(async()=>{const{default:t}=await a.e(4840).then(a.bind(a,24840));r((()=>t)),s(await e())})()}),[e]),n.createElement(l.A,null,n.createElement(o.A,null,n.createElement(t,{options:{wrapper:F}},i)))};var c=function(){return n.createElement(s,{getMarkdown:async()=>{const{default:e}=await a.e(3119).then(a.bind(a,81745));return e.split("\n").slice(1).join("\n")}})},u=a(27947),m=a(22535),d=a(29608),p=a(15147),g=a(32483),h=a(5076),f=a(82719),E=a(41128),A=a(47151),v=a(53356),b=a(79672),y=a(34477),w=a(48227),C=a(63518),I=a(55370),S=a(57862),x=a(25418),k=a(85916),P=a(22944);var T=({confirm:e,canConfirm:t,deny:a})=>{(0,n.useEffect)((()=>{const n=n=>{"Escape"===n.key&&a&&a(),"Enter"===n.key&&n.ctrlKey&&e&&t&&e()};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}}),[e,t,a])};const D=document.body;var M=function({contentHeight:e,contentWidth:t,header:a,closeTitle:r,children:l,confirm:o,deny:i,canConfirm:F,headerOnly:s,fullSize:c,open:u,keepMounted:m,closeOnOverlayClick:d,headerActionButtons:p,actionButtons:h}){const f="boolean"!=typeof d||d,E="boolean"!=typeof u||u,A="boolean"!=typeof m||m;T({confirm:o,canConfirm:F||!1,deny:i});const b=(0,v.A)(),M=(0,P.A)(b.breakpoints.down("md")),B=((e,t,a,n)=>{const r={};if(n?(r.padding="8px !important",r.overflowX="hidden",r.overflowY="hidden"):(r.scrollbarGutter="stable",r.overflowY="scroll"),a)return r;switch(typeof t){case"string":r.height=t;break;case"number":r.height=`${t}px`}switch(typeof e){case"string":r.width=e;break;case"number":r.width=`${e}px`;break;default:r.width="440px"}return r})(t,e,M,c);return n.createElement(I.A,{container:D,fullScreen:M||c,maxWidth:"lg",open:E,onClose:i,"aria-label":"string"==typeof a?a:void 0,keepMounted:A,disableEscapeKeyDown:!f,sx:{paddingRight:"10px"}},n.createElement(k.A,{sx:{display:"flex",justifyContent:"space-between",gap:2,maxWidth:B.width}},n.createElement(y.A,{sx:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},a),n.createElement(y.A,{sx:{my:-.5,mr:-2}},p,i?n.createElement(g.A,{title:r||`Close ${"string"==typeof a?a:""}`,color:"inherit",onClick:i},n.createElement(C.A,null)):null)),!s&&n.createElement(x.A,{sx:B},l),n.createElement(S.A,null,h,i?n.createElement(w.A,{onClick:i,color:"primary",variant:"outlined"},"Cancel"):null,o?n.createElement(w.A,{disabled:!1===F,color:"primary",variant:"contained",onClick:o},"Ok"):null))};const B="ROOT",R=()=>({id:B,slug:"",created:"",title:"Home",coverImage:"",images:[],groups:[],tags:[]}),N=R(),L=(0,n.createContext)({root:N,view:N,images:[],covers:[],paths:[],pathsOptions:[]}),G=()=>(0,n.useContext)(L),$=()=>{const{"*":e}=(0,r.g)(),[t,a]=(0,n.useState)(""),l=/(?<slug>.*\/)*(page\/)(?<page>\d*)/g.exec(e||""),o=l?.groups?.page,i=l?.groups?.slug||"",F=o?parseInt(o,10)-1:0;return(0,n.useEffect)((()=>{if("string"==typeof e){a(`/gallery/${i}page/${F+1}`)}}),[i,F,e]),{pageIndex:F,path:i,lastGalleryLink:t}};var O=a(39200),_=a(27673);const j=()=>{const e=(0,r.Zp)(),{paths:t,root:a}=G(),[l,o]=(0,n.useState)({}),{sortBy:i,filtersActiveTags:F,recentImports:s}=(0,_.A)(),{pageSize:c}=(0,u.A)(),{path:m}=$(),d=(0,n.useCallback)((e=>(0,O.S)(e,{filtersActiveTags:F,sortBy:i,recentImports:s})),[F,s,i]),p=(0,n.useCallback)(((e,t)=>{const a=d(t.images).findIndex((({hash:t})=>t===e));return Math.floor(a/c)+1}),[d,c]),g=(0,n.useCallback)((e=>{if(e===B)return"/gallery/page/1";return`/gallery/${t.find((({group:{id:t}})=>e===t))?.absolutePath||""}page/1`}),[t]),h=(0,n.useMemo)((()=>t.find((({absolutePath:e})=>e===m))?.group||a),[m,t,a]),f=(0,n.useCallback)((e=>{const n=t.find((({group:{images:t}})=>t.map((({hash:e})=>e)).includes(e)));return`/gallery/${n?.absolutePath||""}page/${p(e,n?.group||a)}`}),[p,t,a]);return(0,n.useEffect)((()=>{l.imageHash?(e(f(l.imageHash)),o({})):l.groupId&&(e(g(l.groupId)),o({}))}),[g,f,e,l]),{currentGroup:h,getGroupPath:g,getPagedImagePath:f,getImagePageIndexInGroup:p,navigateToGroup:e=>{o({groupId:e})},navigateToImage:e=>{o({imageHash:e})}}},V=()=>{const{path:e}=$(),{root:t,paths:a}=G(),{getImagePageIndexInGroup:r}=j();return{segments:(0,n.useMemo)((()=>{const n=["",...e.split("/").filter(Boolean)],l=n.reduce(((e,t,a)=>[...e,n.slice(1,a+1).join("/").concat("/")]),[]).map((e=>a.find((({absolutePath:t})=>t===e))||{absolutePath:"",group:t}));return l.map(((e,t)=>{const a=l[t+1];let n=1;if(a){const t=a.group.coverImage;n=r(t,e.group)}return{group:e.group,path:`${e.absolutePath}page/${n}`}}))}),[e,r,a,t])}};var U=a(7372);function z({group:e,onClick:t}){const{getGroupPath:a}=j();return n.createElement(A.y,{itemId:e.id,label:n.createElement(h.A,{component:r.N_,to:a(e.id),onClick:t,sx:{display:"block"}},e.title),sx:e=>({"& > .MuiTreeItem-content.Mui-selected":{backgroundColor:(0,b.X4)(e.palette.secondary.main,.8),color:e.palette.secondary.contrastText,"&:hover,&.Mui-focused":{backgroundColor:e.palette.secondary.main}}})},e.groups.map((e=>n.createElement(z,{key:e.id,group:e,onClick:t}))))}var W=function({open:e,onClose:t}){const{pathsOptions:a,root:r}=G(),{currentGroup:l}=j(),o=(0,v.A)(),{segments:i}=V(),[F,s]=(0,n.useState)([]);return(0,n.useEffect)((()=>{s((e=>{const t=i.map((({group:e})=>e.id));return(0,U.A)([...t,...e])}))}),[i]),a.length<2?null:n.createElement(M,{contentHeight:"60vh",contentWidth:"auto",deny:t,open:e,header:"Gallery Navigation",keepMounted:!1},n.createElement(E.G,{expansionTrigger:"iconContainer",expandedItems:F,onExpandedItemsChange:(e,t)=>s(t),selectedItems:l.id,sx:{width:o.breakpoints.values.sm,height:"60vh"}},n.createElement(z,{group:r,onClick:t})))},H=a(71511);var X=(0,H.v)((e=>({editFrame:null,editPalette:null,pickColors:null,editImageGroup:null,editImages:null,editRGBNImages:[],setEditFrame:t=>e({editFrame:t}),setEditImageGroup:t=>e({editImageGroup:t}),setEditPalette:t=>e({editPalette:t,pickColors:null}),setEditRGBNImages:t=>e({editRGBNImages:t}),setPickColors:t=>e({pickColors:t}),setEditImages:t=>e({editImages:t}),cancelEditFrame:()=>e({editFrame:null}),cancelEditImageGroup:()=>e({editImageGroup:null}),cancelEditPalette:()=>e({editPalette:null}),cancelEditRGBNImages:()=>e({editRGBNImages:[]}),cancelPickColors:()=>e({pickColors:null}),cancelEditImages:()=>e({editImages:null})})));var Y=function(){const{pathsOptions:e}=G(),{setEditImageGroup:t}=X(),{segments:a}=V(),[l,o]=(0,n.useState)(!1);return e.length<2?null:n.createElement(i.A,{direction:"row",gap:2,justifyContent:"space-between",alignItems:"center"},n.createElement(m.A,null,a.map((({group:e,path:a},l)=>{return n.createElement(i.A,{key:e.id,direction:"row",gap:.5,alignItems:"center"},l>0?n.createElement(h.A,{component:r.N_,title:e.title,to:`/gallery/${a}`},l?(o=e.title,F=30,o.length<F?o:`${o.slice(0,F)}…`):n.createElement(p.A,{fontSize:"small"})):n.createElement(g.A,{component:r.N_,title:e.title,to:`/gallery/${a}`,sx:{fontSize:16}},n.createElement(p.A,{fontSize:"inherit"})),l>0&&n.createElement(g.A,{onClick:()=>t({groupId:e.id}),title:`Edit group "${e.title}"`,sx:{fontSize:16}},n.createElement(d.A,{fontSize:"inherit"})));var o,F}))),n.createElement(g.A,{title:"Open Gallery Navigation",onClick:()=>o(!0)},n.createElement(f.A,null)),n.createElement(W,{open:l,onClose:()=>o(!1)}))};const Q=e=>{const t=40;return e>1220?1155:e>1025?960:e>830?765:e>635?570:e>440?375:e-t},K=()=>({width:window.innerWidth,height:window.innerHeight,ddpx:window.devicePixelRatio<=2?window.devicePixelRatio:window.devicePixelRatio/2,layoutWidth:Q(window.innerWidth)}),q=()=>{const[e,t]=(0,n.useState)(K());return(0,n.useEffect)((()=>{const e=()=>{t(K())};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[t]),e};var Z=a(23839);var J=function({fixedView:e,children:t}){const{ddpx:a}=q(),{galleryView:r}=(0,u.A)(),l=e||r,o=(0,n.useMemo)((()=>{let e="",t="";switch(l===Z.j.GALLERY_VIEW_SMALL&&1===a?Z.j.GALLERY_VIEW_1X:l){case Z.j.GALLERY_VIEW_SMALL:e=160/a+"px",t=8/a+"px";break;case Z.j.PALETTE_VIEW:e="minmax(270px, 1fr)",t="32px";break;case Z.j.GALLERY_VIEW_1X:e="160px",t="16px";break;case Z.j.GALLERY_VIEW_2X:e="320px",t="32px";break;case Z.j.GALLERY_VIEW_MAX:e="100%",t="32px"}return{gap:t,display:"grid",justifyContent:"center",gridTemplateColumns:`repeat(auto-fill, ${e})`}}),[l,a]);return n.createElement(y.A,{component:"ul",sx:o},t)},ee=a(6196),te=a(58746),ae=a(45082),ne=a(96763);var re=function({palette:e,tiles:t,imageStartLine:a,lockFrame:r,invertPalette:l,framePalette:o,invertFramePalette:i,asThumb:F=!1,rotation:s=te.pL.DEG_0}){const c=!(e instanceof Array),[u,m]=(0,n.useState)(null),[d,p]=(0,n.useState)("");(0,n.useEffect)((()=>{e&&t&&(async()=>{try{c?m(await(0,te.uL)({tiles:t,palette:te.YP,lockFrame:r||!1,rotation:s})):t?.length&&m(await(0,te.qO)({tiles:t,imageStartLine:a,rotation:s,...(0,ae.C)({imagePalette:e,framePalette:o,invertPalette:l,invertFramePalette:i})})),p("")}catch(e){e instanceof Error&&(ne.error(e),p(e.message))}})()}),[t,e,r,l,s,c,a,o,i]);const g=(0,n.useMemo)((()=>{const e=s===te.pL.DEG_90||s===te.pL.DEG_270,a=(c?(0,te.EK)(t):t.length)<=360,n=e&&a;return{display:"block",imageRendering:F?"auto":"pixelated",margin:n?"0 5%":0,width:n?"90%":"100%",maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}),[F,c,s,t]);return n.createElement(y.A,{className:"gameboy-image",sx:{display:"flex",width:"100%",height:"100%"}},!d&&u&&n.createElement(y.A,{component:"img",width:160,src:u,sx:g,alt:""}))},le=a(8861);var oe=function(){return n.createElement(y.A,{sx:{width:"100%",paddingTop:"90%",height:0,display:"block",background:"transparent",position:"relative"}},n.createElement(y.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},n.createElement(le.A,{color:"primary",size:40})))},ie=a(42813),Fe=a(96533),se=a(30498),ce=a(88222),ue=a(76194);let me;const de=(e,t)=>{const n=async()=>{if(!me){const{dropBoxSyncTool:n}=await Promise.all([a.e(8429),a.e(1575)]).then(a.bind(a,70584));me=me||n(e,t)}return me};ue.A.getState().dropboxStorage.use&&n();return{recoverImageData:async e=>(await n()).recoverImageData(e),startAuth:async()=>(await n()).startAuth(),startSyncData:async e=>(await n()).startSyncData(e),startSyncImages:async()=>(await n()).startSyncImages(),updateSettings:async e=>(await n()).updateSettings(e),subscribe:()=>ue.A.subscribe((e=>e.dropboxStorage),(async e=>{(await n()).updateSettings(e)}))}};var pe=a(56727);var ge=(0,H.v)(((e,t)=>({bitmapQueue:[],frameQueue:[],importQueue:[],bitmapQueueAdd:t=>e((({bitmapQueue:e})=>({bitmapQueue:[...e,...t]}))),bitmapQueueCancel:()=>e({bitmapQueue:[]}),frameQueueAdd:t=>e((({frameQueue:e})=>({frameQueue:[...e,...t]}))),frameQueueCancelOne:t=>e((({frameQueue:e})=>({frameQueue:e.filter((e=>e.tempId!==t))}))),importQueueAdd:a=>{const{bitmapQueue:n,importQueue:r}=t(),l=a.map((({fileName:e})=>e));e({bitmapQueue:n.filter((({fileName:e})=>!l.includes(e))),importQueue:[...r,...a]})},importQueueCancel:()=>{e({importQueue:[]})},importQueueCancelOne:t=>e((({importQueue:e})=>({importQueue:e.filter((e=>e.tempId!==t))})))}))),he=a(88231);const fe=()=>{const{dismissDialog:e,setDialog:t}=(0,pe.A)(),{cancelEditFrame:a,cancelEditImages:r,cancelEditPalette:l}=X(),{updateRecentImports:o,updateImageSelection:i}=(0,_.A)(),{importQueueCancel:F}=ge(),{setProgress:s,setPrinterBusy:c}=(0,he.A)(),{addImages:u,deleteImages:m,setImageGroups:d,updateFrameGroups:p,updateImageHash:g,updateImages:h,setFrames:f,setImages:E,setPalettes:A}=(0,ie.h)(),{setSyncLastUpdate:v}=(0,ue.A)();return(0,n.useMemo)((()=>{const n=()=>v("local",Math.floor((new Date).getTime()/1e3)),b=()=>{s("printer",0),c(!1),F()};return{addImages:t=>{u(t),e(0),n(),b(),o(t)},deleteImages:t=>{m(t),i(_.N.REMOVE,t),e(0),n()},dismissDialog:e,globalUpdate:e=>{a(),l(),r(),e.lastUpdateUTC?v("local",e.lastUpdateUTC):n(),e.palettes&&A(e.palettes),e.images&&(E(e.images),o(e.images)),e.frames&&f(e.frames),e.frameGroups&&p(e.frameGroups),e.imageGroups&&d(e.imageGroups)},importQueueCancel:b,setDialog:t,updateImageHash:(e,t)=>{r(),n(),g(e,t)},updateImages:e=>{h(e),n()},updateLastSyncLocalNow:n}}),[u,a,r,l,m,e,F,t,f,E,A,d,c,s,v,p,g,i,h,o])};var Ee=a(42002),Ae=a(47020),ve=a(23299);const be=e=>{const t=(0,ve.A)(e);return(a,n)=>{const r=n.map((t=>{const n=a.find((a=>a[e]===t[e]));return n?{...n,...t}:t}));return t([...r,...a])}},ye=be("hash"),we=be("id"),Ce=be("shortName");var Ie=(e,t,a,n,r)=>{let l=e,o=a,i=t;return r?(n.frames&&n.frames.length&&(l=we(l,n.frames)),n.images&&n.images.length&&(o=ye(o,n.images)),n.palettes&&n.palettes.length&&(i=Ce(i,n.palettes))):(l=n.frames||e,o=n.images||a,i=n.palettes||t),{...n,images:o,frames:l,palettes:i}},Se=a(42419),xe=a(17673);const ke=async(e,t=!1)=>{const{frames:a,palettes:n,images:r}=ie.h.getState(),l=await(0,xe.i)(e);return Object.keys(l).forEach((e=>{if("state"!==e){const t=l[e];e.match(/^[a-f0-9]{40,}$/gi)?Se.mU.setItem(`${e}`,t):e.startsWith("frame-")&&Se.Uv.setItem(`${e.split("frame-").pop()}`,t)}})),Ie(a,n,r,l.state||{},t)},Pe=()=>{const{globalUpdate:e}=fe();return(0,n.useMemo)((()=>{const t=(0,Ae.A)();return{downloadSettings:async(e,a="")=>{const n=await t(e,{selectedFrameGroup:a}),r="frames"===e?"frames":[e,a].filter(Boolean).join("_");(0,Ee.R)(null)([{blob:new Blob(new Array(n)),filename:`${r}.json`}])},jsonImport:async t=>{const a=await ke(t,!0);e(a)},remoteImport:async t=>{const a=await ke(t,!1);e(a)}}}),[e])};var Te=function({hash:e,hashes:t,frameId:a,lockFrame:r,invertPalette:l,invertFramePalette:o,palette:i,framePalette:F,rotation:s,asThumb:c}){const{gbImageProps:u}=(({hash:e,hashes:t,palette:a,invertPalette:r,framePalette:l,invertFramePalette:o,lockFrame:i,frameId:F,rotation:s})=>{const[c,u]=(0,n.useState)(null),m=fe(),{remoteImport:d}=Pe(),{frames:p,palettes:g,images:h}=(0,ie.h)(),f=p.find((({id:e})=>e===F))?.hash,E=(0,n.useCallback)(((e,a,n)=>(0,Fe.T)(h,p,(()=>{de(m,d).recoverImageData(e)}))(e,a,n,t)),[h,p,t,m,d]),A=(0,n.useMemo)((()=>"string"==typeof a?(g.find((({shortName:e})=>e===a))||se.Fv).palette:a),[g,a]);return(0,n.useEffect)((()=>{let t=!1;return e||u(null),(async()=>{if(t)return;const n=await E(e,!1,F),c=f?await(0,ce.mZ)(f):null,m=c?c.upper.length/20:2;t||n&&u({tiles:n,palette:A,invertPalette:r,imageStartLine:m,lockFrame:i,rotation:s,framePalette:i?l:a,invertFramePalette:i?o:r})})(),()=>{t=!0}}),[E,e,F,a,r,i,s,A,f,l,o]),{gbImageProps:c}})({hash:e,hashes:t,frameId:a,lockFrame:r,invertPalette:l,invertFramePalette:o,palette:i,framePalette:F,rotation:s});return u?n.createElement(re,{lockFrame:u.lockFrame,invertPalette:u.invertPalette,invertFramePalette:u.invertFramePalette,tiles:u.tiles,palette:u.palette,framePalette:u.framePalette,imageStartLine:u.imageStartLine,rotation:u.rotation,asThumb:c}):n.createElement(oe,null)},De=a(17862),Me=a(601);const Be=(e,t)=>e.toLowerCase().localeCompare(t.toLowerCase());var Re=function({tags:e,fromGroup:t}){let a,r=[];if(t){const t=e.sort(Be).filter((e=>!Me.rx.includes(e)));a=t.slice(0,3),r=t.slice(3,-1)}else a=e;const l=t?"secondary":"tertiary";return n.createElement(i.A,{component:"ul",direction:"row",gap:.66,flexWrap:"wrap",sx:e=>({"& .MuiChip-root":{fontSize:"0.75rem",height:e.spacing(2.5),padding:0}})},a.sort(Be).map((e=>n.createElement(De.A,{key:e,title:e===Me.X3.FILTER_FAVOURITE?"Favourite":e,label:e===Me.X3.FILTER_FAVOURITE?"❤️":e,size:"small",color:l}))),r.length>0&&n.createElement(De.A,{variant:"outlined",title:`+${r.length} more tags:\n${r.join("\n")}`,label:`+${r.length} more`,size:"small"}))},Ne=a(43990),Le=a(37603),Ge=a(12070),$e=a(16738),Oe=a(82139),_e=a(71053),je=a(26564),Ve=a(74353),Ue=a.n(Ve);const ze=a(33829).A,We=(0,n.createContext)(null);function He({children:e}){const t=j();return n.createElement(We.Provider,{value:t},e)}const Xe=()=>{const e=(0,n.useContext)(We);if(!e)throw new Error("useNavigationToolsContext must be used within an NavigationToolsProvider");return e},Ye="NEW_GROUP",Qe=e=>e.trim().replace(/[^A-Z0-9_-]+/gi,"_").toLowerCase(),Ke=(e,t)=>e.find((({group:{groups:e}})=>e.find((({id:e})=>e===t))))||null;var qe;!function(e){e.CREATE_NEW="CREATE_NEW",e.EDIT_EXISTING="EDIT_EXISTING",e.NOT_EDITING="NOT_EDITING"}(qe||(qe={}));var Ze=()=>{const{imageSelection:e}=(0,_.A)(),{editImageGroup:t,cancelEditImageGroup:a}=X(),{imageGroups:r,addImageGroup:l,updateImageGroup:o,groupImagesAdd:i,ungroupImages:F}=(0,ie.h)(),{navigateToGroup:s,navigateToImage:c}=Xe(),{view:u,paths:m,pathsOptions:d}=G(),{path:p}=$(),g=e.length,h=(e=>e?.groupId?e.groupId===Ye?qe.CREATE_NEW:qe.EDIT_EXISTING:qe.NOT_EDITING)(t),f=(0,n.useMemo)((()=>{switch(h){case qe.CREATE_NEW:{const e=t?.newGroupTitle||"";return{imageGroup:null,parentPathMap:m.find((({group:e})=>e.id===u.id))||null,title:e,slug:Qe(e),slugTouched:!1}}case qe.EDIT_EXISTING:{const e=r.find((({id:e})=>e===t?.groupId))||null;return{imageGroup:e,parentPathMap:t?.groupId?Ke(m,t.groupId):null,title:e?.title||"",slug:e?.slug||"",slugTouched:!0}}case qe.NOT_EDITING:default:return{imageGroup:null,parentPathMap:null,title:"",slug:"",slugTouched:!1}}}),[t,h,r,m,u]),[E,A]=(0,n.useState)(f.title),[v,b]=(0,n.useState)(f.slug),[y,w]=(0,n.useState)(f.slugTouched),[C,I]=(0,n.useState)(f.parentPathMap?.absolutePath||""),S=(0,n.useMemo)((()=>{if(!t?.groupId)return"";if(t?.groupId===Ye)return`${p}${v}/`;const e=Ke(m,t.groupId);return`${e?.absolutePath||""}${v}/`}),[t,m,p,v]),x=(0,n.useMemo)((()=>!!m.find((({absolutePath:e})=>e===S))),[S,m]),k=(0,n.useMemo)((()=>v!==f.imageGroup?.slug),[f,v]),P=(0,n.useMemo)((()=>!!v&&(h===qe.CREATE_NEW?!x:h===qe.EDIT_EXISTING&&(!k||!x))),[h,v,x,k]),T=(0,n.useMemo)((()=>{const e=m.find((({absolutePath:e})=>e===C))?.group.id||"";return(f.parentPathMap?.group.id||"")!==e}),[f,C,m]),D=(0,n.useMemo)((()=>{switch(h){case qe.EDIT_EXISTING:{const e=m.find((({group:e})=>e.id===t?.groupId))?.absolutePath||"";return d.filter((({value:t})=>!t.startsWith(S)&&t!==e))}case qe.CREATE_NEW:return d;case qe.NOT_EDITING:default:return[]}}),[S,t,h,m,d]);return{editId:t?.groupId||null,absoluteSlug:S,possibleParents:D,slug:v,title:E,canConfirm:P,canMove:T,slugIsInUse:x,slugWasChanged:k,parentSlug:C,selectionCount:g,setSlug:e=>{b(e),w(!0)},setTitle:e=>{A(e),(e.length<2||!y)&&(w(!1),b(Qe(e)))},setParentSlug:I,confirm:()=>{if(a(),!P||!t)return;const n=m.find((({absolutePath:e})=>e===C))?.group.id||"";if(t.groupId===Ye){if(!t.newGroupCover)return;const a=ze();l({id:a,slug:v,title:E,created:Ue()(Date.now()).format(se.i$),coverImage:t.newGroupCover,images:e,groups:[]},n),s(a)}else{if(!f.imageGroup)return;o({...f.imageGroup,slug:v,title:E},n),s(t.groupId)}},move:async()=>{if(a(),!T)return;const t=m.find((({absolutePath:e})=>e===C))?.group.id||"";t?i(t,e):F(e),c(e[0])},cancelEditImageGroup:a}};const Je=()=>{const{view:e}=G(),{dismissDialog:t,setDialog:a}=(0,pe.A)(),{setEditImageGroup:r}=X(),{deleteImageGroup:l,setImageGroups:o,images:i}=(0,ie.h)(),{imageSelection:F}=(0,_.A)(),s=(0,n.useMemo)((()=>{if(!F.length)return"";const e=i.filter((({hash:e})=>F.includes(e))).map((({title:e})=>e)).filter((e=>e.length>3)),t=(0,_e.Hg)(e),a=t.filter((e=>e.length>3))[0]?.trim();return a?a.replace(/[_-]/g," ").replace(/^\s*\d+\s+|\s+\d+\s*$/g,"").trim():"New Group"}),[F,i]);return{resetGroups:()=>{a({message:"Reset image groups?",questions:()=>[{key:"info",type:je.V.INFO,label:"This will remove ALL your created groups and all existing images will be moved to the top level."}],confirm:async()=>{t(0),o([])},deny:async()=>{t(0)}})},createGroup:e=>{r({groupId:Ye,newGroupCover:e,newGroupTitle:s})},editGroup:e=>{r({groupId:e})},deleteGroup:n=>{const r=e.groups.find((e=>e.id===n));r&&a({message:"Delete image group?",questions:()=>[{key:"info",type:je.V.INFO,label:`This will delete this group "${r.title||r.slug}" and move all children (images & groups) to the current level.`}],confirm:async()=>{t(0),l(n)},deny:async()=>{t(0)}})}}};var et=function({groupId:e,menuAnchor:t,onClose:a}){const{deleteGroup:r,editGroup:l}=Je();return t?n.createElement(Ne.A,{open:!!t,anchorEl:t,onClose:a,onClick:e=>{e.stopPropagation(),a()}},n.createElement(Le.A,{onClick:()=>l(e),title:"Edit"},n.createElement(Ge.A,null,n.createElement(d.A,null)),n.createElement($e.A,null,"Edit")),n.createElement(Le.A,{onClick:()=>r(e),title:"Delete"},n.createElement(Ge.A,null,n.createElement(Oe.A,null)),n.createElement($e.A,null,"Delete"))):null},tt=a(75665),at=a(62208),nt=a(34818),rt=a(75710);var lt=function({selectionText:e,title:t,titleIcon:a,subheader:r,wrapperProps:F,media:s,content:c,contextMenuComponent:u,contextMenuProps:m}){const d=(0,v.A)(),[p,h]=(0,n.useState)(null),f=(0,n.useMemo)((()=>{const t={"@media (any-hover: hover)":{"&:hover":{backgroundColor:(0,b.au)(d.palette.tertiary.main,d.palette.background.paper,.33)}},transition:"background-color 0.15s ease-in-out"};return e?{...t,backgroundColor:(0,b.au)(d.palette.info.main,d.palette.background.paper,.75)}:t}),[e,d]),E=[t,r].filter(Boolean).join("\n");return n.createElement(i.A,{component:"li",direction:"column",justifyContent:"stretch",sx:{position:"relative","& > *":{flexGrow:1}}},e&&n.createElement(y.A,{sx:{position:"absolute",display:"block",width:"1.8em",height:"1.8em",top:"-0.53em",left:"-0.53em",zIndex:15,fontSize:"0.85rem",lineHeight:"1.8em",textAlign:"center",backgroundColor:d.palette.info.main,color:d.palette.info.contrastText,borderRadius:"50%",pointerEvents:"none"}},e),n.createElement(l.A,{sx:f},n.createElement(tt.A,{...F,component:F.component||"span",tabIndex:F.component?void 0:-1},n.createElement(at.A,{title:a?n.createElement(i.A,{direction:"row",gap:.5,alignItems:"center"},a,t):t,subheader:r,action:n.createElement(g.A,{onClick:e=>{e.preventDefault(),e.stopPropagation(),h(e.target)}},n.createElement(rt.A,null)),slotProps:{title:{title:E,variant:"body1",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},subheader:{title:E,variant:"caption",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}},sx:{gap:1,backgroundColor:(0,b.X4)(d.palette.fgtext.main,.1),p:1,".MuiCardHeader-content":{minWidth:0}}}),n.createElement(nt.A,null,s),c&&n.createElement(o.A,{sx:{p:1,flexGrow:1,justifyContent:"space-between",display:"flex",flexDirection:"column",padding:1,"&:last-child":{padding:1}}},c)),n.createElement(u,{menuAnchor:p,onClose:()=>h(null),...m})))};var ot,it=a(27261),Ft=a(60318),st=a(44949);!function(e){e.ADD="add",e.REMOVE="remove"}(ot||(ot={}));const ct=e=>{const{setEditImages:t}=X(),{pageSize:a}=(0,u.A)(),{filtersActiveTags:r,sortBy:l,recentImports:o,imageSelection:i,updateImageSelection:F,lastSelectedImage:s,setImageSelection:c}=(0,_.A)(),{palettes:m,images:d}=(0,ie.h)(),p=i.indexOf(e),g=(0,n.useMemo)((()=>{const t=d.find((t=>t.hash===e));let a,n=[];if(!t)return;const{palette:r,framePalette:l}=(0,Ft.s)(m,t),{invertPalette:o,invertFramePalette:i}=(0,st.f)(t);if(!r)throw new Error("Palette missing?");return(0,it.pl)(t)?a=r:(a=(r||se.Fv).palette,n=(l||se.Fv).palette),{title:t.title,created:t.created,frame:t.frame,hashes:t.hashes||void 0,tags:t.tags,palette:a,framePalette:n,lockFrame:t.lockFrame,invertPalette:o,invertFramePalette:i,rotation:t.rotation,selectionIndex:p}}),[e,p,m,d]),{images:h}=G();return{galleryImageData:g,updateImageSelection:(t,n,i)=>{if(n){const t=(0,O.S)(h,{filtersActiveTags:r,sortBy:l,recentImports:o}),n=t.findIndex((t=>t.hash===e));let F=t.findIndex((e=>e.hash===s));-1===F&&(F=i*a);const u=Math.min(F,n),m=Math.max(F,n);c(t.slice(u,m+1).map((e=>e.hash)))}else F(t,[e])},editImage:a=>{t({tags:a,batch:[e]})}}};var ut=function({hash:e}){const{group:t,path:a}=(e=>{const{paths:t,view:a}=G(),n=a.groups.find((({coverImage:t})=>t===e))||null,r=t.find((({group:{id:e}})=>e===n?.id))?.absolutePath||null;return{group:n,path:r}})(e),{galleryImageData:l}=ct(e),{galleryView:o}=(0,u.A)(),i=[Z.j.GALLERY_VIEW_SMALL,Z.j.GALLERY_VIEW_1X].includes(o);if(!l||!t)return null;const{hashes:F,palette:s,invertPalette:c,framePalette:m,frame:d,lockFrame:p,rotation:g}=l;return n.createElement(lt,{selectionText:"",title:t.title,subheader:`${t.images.length} items`,wrapperProps:{component:r.N_,to:`/gallery/${a}page/1`,sx:{textDecoration:"none"}},contextMenuComponent:et,contextMenuProps:{groupId:t.id},media:n.createElement(y.A,{sx:{position:"relative",margin:"0 auto","& > .MuiBox-root":{position:"absolute",top:0,img:{transform:"scale(0.5)"}}}},n.createElement(ee.A,{viewBox:"0 0 24 21",color:"secondary",sx:e=>({width:"100%",height:"100%",fill:(0,b.au)(e.palette.secondary.main,e.palette.fgtext.main,.25)})},n.createElement("path",{d:"M 10,2 H 4 C 2.9,2 2.01,2.9 2.01,4 L 2,16 c 0,1.1 0.9,2 2,2 h 16 c 1.1,0 2,-0.9 2,-2 V 6 C 22,4.9 21.1,4 20,4 h -8 z"})),n.createElement(Te,{lockFrame:p,invertPalette:c,framePalette:m,palette:s,frameId:d,hash:e,hashes:F,rotation:g,asThumb:i})),content:t.tags.length>0&&n.createElement(Re,{tags:t.tags,fromGroup:!0})})},mt=a(15279),dt=a(78377),pt=a(61736),gt=a(29308),ht=a(13407),ft=a(71246);const Et=e=>{switch(e){case Z.j.GALLERY_VIEW_SMALL:return"Smallest";case Z.j.GALLERY_VIEW_1X:return"Original Size";case Z.j.GALLERY_VIEW_2X:return"Double Size";case Z.j.GALLERY_VIEW_MAX:return"Maximum Size";default:return""}};var At=function(){const{galleryView:e,setGalleryView:t}=(0,u.A)(),{ddpx:a}=q(),r=a>1?[Z.j.GALLERY_VIEW_SMALL,Z.j.GALLERY_VIEW_1X,Z.j.GALLERY_VIEW_2X,Z.j.GALLERY_VIEW_MAX]:[Z.j.GALLERY_VIEW_1X,Z.j.GALLERY_VIEW_2X,Z.j.GALLERY_VIEW_MAX];return n.createElement(dt.A,{value:e,exclusive:!0,onChange:(e,a)=>{a&&t(a)},sx:{"& .MuiToggleButton-root":{width:40,height:40}}},r.map((e=>n.createElement(mt.A,{key:e,value:e,title:Et(e)},(e=>{switch(e){case Z.j.GALLERY_VIEW_SMALL:return n.createElement(gt.A,null);case Z.j.GALLERY_VIEW_1X:return n.createElement(pt.A,null);case Z.j.GALLERY_VIEW_2X:return n.createElement(ft.A,null);case Z.j.GALLERY_VIEW_MAX:default:return n.createElement(ht.A,null)}})(e)))))},vt=a(72569),bt=a(58760),yt=a(77953),wt=a(29184),Ct=a(87639),It=a(36727),St=a(41756),xt=a(75961),kt=a(76584),Pt=a(70802);const Tt=(0,n.createContext)({runWithImage:async()=>{},runWithImages:async()=>{},validateAndAddPlugin:async()=>!1}),Dt=()=>(0,n.useContext)(Tt);var Mt,Bt,Rt,Nt=function({pluginAnchor:e,hash:t,onClose:a}){const{plugins:r}=(0,ie.h)(),{imageSelection:l}=(0,_.A)(),{runWithImage:o,runWithImages:i}=Dt();return n.createElement(Ne.A,{open:!!e,anchorEl:e,onClose:a},r.map((({url:e,name:r,description:F,loading:s,error:c})=>n.createElement(Le.A,{key:e,disabled:Boolean(s||c),title:`${c||F||""}\n${e}`,onClick:()=>{a(),(e=>{t?o(e,t):i(e,l)})(e)}},c&&n.createElement(Pt.A,{color:"warning"}),s&&n.createElement(le.A,{color:"secondary",size:22}),r||e))))};!function(e){e.DELETE="delete",e.ANIMATE="animate",e.DOWNLOAD="download",e.EDIT="edit",e.RGB="rgb"}(Mt||(Mt={})),function(e){e.LOCK_FRAME="lockFrame",e.FRAME="frame",e.PALETTE="palette",e.TITLE="title",e.TAGS="tags",e.CREATED="created",e.ROTATION="rotation"}(Bt||(Bt={})),function(e){e.INVERT_PALETTE="invertPalette",e.FRAME_PALETTE="framePalette",e.INVERT_FRAME_PALETTE="invertFramePalette"}(Rt||(Rt={}));const Lt=[Bt.LOCK_FRAME,Bt.FRAME,Bt.TITLE,Bt.TAGS,Bt.CREATED,Bt.ROTATION,Bt.PALETTE,Rt.INVERT_PALETTE,Rt.FRAME_PALETTE,Rt.INVERT_FRAME_PALETTE];var Gt=a(99905);var $t=()=>{const{exportScaleFactors:e,exportFileTypes:t,handleExportFrame:a,fileNameStyle:r}=(0,u.A)(),{frames:l,palettes:o,images:i}=(0,ie.h)(),F=(0,Ee.j)(e,t,a,o,r);return{downloadSingleImage:(0,n.useCallback)((async e=>{const t=i.find((({hash:t})=>t===e));if(!t)throw new Error("image not found");const a=l.find((({id:e})=>e===t.frame)),{palette:n}=(0,Ft.s)(o,t);if(!n)throw new Error("imagePalette not found");const s=(0,Gt.A)({image:t,palette:n,fileNameStyle:r}),c=await(0,Fe.T)(i,l)(t.hash),u=a?await(0,ce.mZ)(a?.hash):null,m=u?u.upper.length/20:2;if(!c)throw new Error("no tiles");const d=await F(t)(c,m);return(0,Ee.R)(s)(d)}),[r,l,i,o,F]),downloadImageCollection:(0,n.useCallback)((async e=>{const t=(0,Gt.A)({altTitle:"gameboy-printer-gallery",useCurrentDate:!0,fileNameStyle:r}),a=await Promise.all(e.map((async e=>{const t=i.find((({hash:t})=>t===e));if(!t)throw new Error("image not found");const a=l.find((({id:e})=>e===t.frame)),n=await(0,Fe.T)(i,l)(t.hash),r=a?await(0,ce.mZ)(a?.hash):null,o=r?r.upper.length/20:2;return F(t)(n||[],o)})));(0,Ee.R)(t)(a.flat())}),[r,l,i,F])}};const Ot=e=>(0,U.A)(e.map((({tags:e})=>e)).flat());var _t=e=>{const{imageSelection:t,sortBy:a,filtersActiveTags:r,recentImports:l,setFiltersVisible:o,setSortOptionsVisible:i,setImageSelection:F}=(0,_.A)(),{plugins:s,images:c}=(0,ie.h)(),{pageSize:m}=(0,u.A)(),{setEditImages:d,setEditRGBNImages:p}=X(),{dismissDialog:g,setDialog:h}=(0,pe.A)(),{setVideoSelection:f}=(0,he.A)(),{downloadImageCollection:E}=$t(),{deleteImages:A}=fe(),{view:v,covers:b}=G(),y=e*m,w=(0,O.S)(v.images,{sortBy:a,filtersActiveTags:r,recentImports:l}).splice(y,m||1/0).filter((e=>!b.includes(e.hash))).filter((({hash:e})=>t.includes(e))),C=w.reduce(it.iy,[]),I=(0,n.useMemo)((()=>t.reduce(((e,t)=>{const a=c.find((({hash:e})=>e===t));return a?[a,...e]:e}),[])),[t,c]),S=t.length,x=w.length>0;return{hasPlugins:!!s.length,batchEnabled:!!t.length,monochromeBatchEnabled:w.length>1&&C.length===w.length,activeFilters:r.length||0,selectedImageCount:S,hasSelected:x,batchTask:e=>{if(t.length)switch(e){case Mt.DELETE:h({message:`Delete ${t.length} images?`,confirm:async()=>{A(t)},deny:async()=>g(0)});break;case Mt.ANIMATE:f(t);break;case Mt.DOWNLOAD:E(t);break;case Mt.EDIT:d({tags:Ot(I),batch:I.map((({hash:e})=>e))});break;case Mt.RGB:p(I.reduce(it.iy,[]).map((({hash:e})=>e)))}},checkAll:()=>{F((0,O.S)(v.images,{filtersActiveTags:r,sortBy:a,recentImports:l}).slice(e*m,(e+1)*m||void 0).map((({hash:e})=>e)))},unCheckAll:()=>F([]),filter:()=>o(!0),showSortOptions:()=>i(!0)}};const jt=[Mt.DOWNLOAD,Mt.DELETE,Mt.EDIT,Mt.ANIMATE],Vt=[Mt.RGB],Ut=e=>{switch(e){case Mt.DELETE:return"Delete";case Mt.ANIMATE:return"Animate";case Mt.DOWNLOAD:return"Download";case Mt.EDIT:return"Edit";case Mt.RGB:return"Create RGB Images";default:return""}},zt=e=>{switch(e){case Mt.DELETE:return n.createElement(Oe.A,null);case Mt.ANIMATE:return n.createElement(St.A,null);case Mt.DOWNLOAD:return n.createElement(wt.A,null);case Mt.EDIT:return n.createElement(d.A,null);case Mt.RGB:return n.createElement(xt.A,null);default:return null}};var Wt=function({page:e}){const{hasPlugins:t,batchEnabled:a,monochromeBatchEnabled:r,activeFilters:l,selectedImageCount:o,hasSelected:i,batchTask:F,checkAll:s,unCheckAll:c,filter:u,showSortOptions:m}=_t(e),[d,p]=(0,n.useState)(null);return n.createElement(n.Fragment,null,n.createElement(bt.A,{color:"tertiary",variant:"contained",sx:{"& .MuiButton-root":{width:40,height:40}},disableElevation:!0},n.createElement(w.A,{onClick:m,title:"Manage Sorting"},n.createElement(kt.A,null)),n.createElement(w.A,{onClick:u,title:"Manage Filters"},n.createElement(vt.A,{badgeContent:l,color:"info",anchorOrigin:{vertical:"bottom",horizontal:"right"}},n.createElement(It.A,null))),n.createElement(w.A,{onClick:i?c:s,title:i?"Uncheck All":"Check All"},n.createElement(vt.A,{badgeContent:o,color:"info",anchorOrigin:{vertical:"bottom",horizontal:"right"}},n.createElement(yt.A,null))),jt.map((e=>n.createElement(w.A,{key:e,disabled:!a,onClick:()=>F(e),title:Ut(e)},zt(e)))),Vt.map((e=>n.createElement(w.A,{key:e,disabled:!r,onClick:()=>F(e),title:Ut(e)},zt(e)))),t?n.createElement(w.A,{onClick:e=>{p(e.target)},title:"Use Plugin"},n.createElement(Ct.A,null)):null),n.createElement(Nt,{pluginAnchor:d,onClose:()=>p(null)}))};var Ht=function({isBottom:e,page:t,isSticky:a}){return n.createElement(i.A,{direction:{xs:"column",md:"row"},alignItems:"center",gap:2,justifyContent:"space-between",sx:t=>({zIndex:20,backgroundColor:t.palette.background.default,...a?{position:"sticky",top:"var(--navigation-height)",py:1,mx:-1}:{},...e?{"@media (max-height: 900px)":{display:"none"}}:{}})},n.createElement(At,null),n.createElement(Wt,{page:t}))},Xt=a(90445),Yt=a.n(Xt),Qt=a(24057),Kt=a(9033),qt=a(18672),Zt=a(50412),Jt=a(42106),ea=a(12898),ta=a(93577);var aa=()=>{const{exportScaleFactors:e,exportFileTypes:t,handleExportFrame:a,fileNameStyle:r}=(0,u.A)(),{frames:l,palettes:o,images:i}=(0,ie.h)();return{shareImage:(0,n.useCallback)((async n=>{const F=i.find((({hash:e})=>n===e));if(!F)throw new Error("image not found");const s=l.find((({id:e})=>e===F.frame)),c=[...e].pop()||4,u=[...t].pop()||"png",m=(0,Ee.j)([c],[u],a,o,r),d=await(0,Fe.T)(i,l)(F.hash),p=s?await(0,ce.mZ)(s?.hash):null,g=p?p.upper.length/20:2,h=await m(F)(d||[],g),{blob:f,filename:E,title:A}=h[0];window.navigator.share&&window.navigator.share({files:[new File([f],E,{type:"image/png",lastModified:Date.now()})],title:A}).catch((()=>"¯\\_(ツ)_/¯"))}),[t,e,r,l,a,i,o])}};let na=null;const ra=()=>{if(null===na)try{na=window.navigator.canShare({files:[new File([new Blob(["t","e","s","t"])],"test.txt",{type:"text/plain",lastModified:Date.now()})]})}catch(e){na=!1}return na||!1};var la;!function(e){e.EDIT="edit",e.DOWNLOAD="download",e.DELETE="delete",e.SHARE="share",e.SELECT="select",e.VIEW="view",e.FAVOURITE="favourite",e.PLUGINS="plugins"}(la||(la={}));const oa=e=>{const{imageSelection:t,updateImageSelection:a,filtersActiveTags:r,sortBy:l,recentImports:o}=(0,_.A)(),{setLightboxImage:i}=(0,he.A)(),{plugins:F,updateImageFavouriteTag:s}=(0,ie.h)(),{view:c,covers:u}=G(),{setEditImages:m}=X(),{dismissDialog:d,setDialog:p}=(0,pe.A)(),{updateLastSyncLocalNow:g,deleteImages:h}=fe(),{downloadSingleImage:f}=$t(),{shareImage:E}=aa(),{images:A}=(0,ie.h)(),v=(0,n.useMemo)((()=>A.find((t=>t.hash===e))),[e,A]),b=t.includes(e);return{hasPlugins:!!F.length,isSelected:b,hasHashes:Boolean(v?.hashes),isFavourite:v?.tags.includes(Me.X3.FILTER_FAVOURITE)||!1,hasMeta:!!v?.meta,canShare:ra(),startDownload:()=>f(e),deleteImage:()=>{p({message:v?.title?`Delete image "${v.title}"?`:"Delete this image?",confirm:async()=>{h([e])},deny:async()=>d(0)})},shareImage:()=>E(e),showMetadata:()=>{p({message:v?.title?`Meta-Info for "${v.title}"`:"Meta-Info",questions:()=>[{key:"meta",type:je.V.META,label:"",meta:{hash:e,hashes:v?.hashes||void 0,meta:v?.meta||void 0}}],confirm:async()=>d(0)})},updateImageToSelection:t=>{a(t,[e])},setLightboxImage:()=>{i((0,O.S)(c.images,{filtersActiveTags:r,sortBy:l,recentImports:o}).filter((e=>!u.includes(e.hash))).findIndex((t=>e===t.hash)))},updateFavouriteTag:t=>{s(t,e),g()},editImage:()=>{m({tags:v?.tags||[],batch:[e]})}}};Ue().extend(Yt());var ia=function({hash:e,menuAnchor:t,onClose:a}){const[r,l]=(0,n.useState)(null),{enableImageGroups:o}=(0,u.A)(),{canShare:i,isSelected:F,hasPlugins:s,isFavourite:c,hasMeta:m,hasHashes:p,deleteImage:g,setLightboxImage:h,shareImage:f,startDownload:E,showMetadata:A,updateImageToSelection:v,updateFavouriteTag:b,editImage:y}=oa(e),{createGroup:w}=Je();return t?n.createElement(Ne.A,{open:!!t,anchorEl:t,onClose:a,onClick:e=>{e.stopPropagation()}},n.createElement(Le.A,{onClick:()=>{y(),a()},title:"Edit"},n.createElement(Ge.A,null,n.createElement(d.A,null)),n.createElement($e.A,null,"Edit")),n.createElement(Le.A,{onClick:()=>{E(),a()},title:"Download"},n.createElement(Ge.A,null,n.createElement(wt.A,null)),n.createElement($e.A,null,"Download")),n.createElement(Le.A,{onClick:()=>{g(),a()},title:"Delete"},n.createElement(Ge.A,null,n.createElement(Oe.A,null)),n.createElement($e.A,null,"Delete")),n.createElement(Le.A,{onClick:()=>{h(),a()},title:"View in Lightbox"},n.createElement(Ge.A,null,n.createElement(ea.A,null)),n.createElement($e.A,null,"View in Lightbox")),s?n.createElement(n.Fragment,null,n.createElement(Nt,{pluginAnchor:r,hash:e,onClose:()=>{l(null),a()}}),n.createElement(Le.A,{onClick:e=>{l(e.target)},title:"Use Plugin"},n.createElement(Ge.A,null,n.createElement(Ct.A,null)),n.createElement($e.A,null,"Use Plugin"))):null,i?n.createElement(Le.A,{onClick:()=>{f(),a()},title:"Share"},n.createElement(Ge.A,null,n.createElement(ta.A,null)),n.createElement($e.A,null,"Share")):null,n.createElement(Le.A,{onClick:()=>{b(!c),a()},title:c?"Remove from favourites":"Add to favourites"},n.createElement(Ge.A,null,c?n.createElement(Jt.A,null):n.createElement(Zt.A,null)),n.createElement($e.A,null,c?"Remove from favourites":"Add to favourites")),n.createElement(Le.A,{onClick:()=>{v(F?_.N.REMOVE:_.N.ADD),a()},title:F?"Remove from selection":"Add to selection"},n.createElement(Ge.A,null,F?n.createElement(Qt.A,null):n.createElement(yt.A,null)),n.createElement($e.A,null,F?"Remove from selection":"Add to selection")),(m||p)&&n.createElement(Le.A,{onClick:()=>{A(),a()},title:"Show Metadata"},n.createElement(Ge.A,null,n.createElement(Kt.A,null)),n.createElement($e.A,null,"Show Metadata")),F&&o&&n.createElement(Le.A,{onClick:()=>{w(e),a()},title:"Create Group"},n.createElement(Ge.A,null,n.createElement(qt.A,null)),n.createElement($e.A,null,"Create Group"))):null},Fa=a(35124);const sa=(e,t)=>({flexGrow:0,flexShrink:1,wordBreak:"break-all",whiteSpace:"no-wrap",overflow:"hidden",width:"100%",borderRadius:"3px",...t});var ca=function({text:e}){const{enableDebug:t}=(0,u.A)();return t?n.createElement(Fa.A,{title:e,variant:"caption",fontFamily:"monospace",component:"pre",sx:e=>sa(0,{px:.5,py:0,mt:1,mb:0,backgroundColor:e.palette.warning[e.palette.mode]})},e):null},ua=a(55534);var ma=a(34027);Ue().extend(Yt());var da=function({page:e,hash:t}){const{enableDebug:a,galleryClickAction:r}=(0,u.A)(),{galleryImageData:l,updateImageSelection:o}=ct(t),{setLightboxImage:i,editImage:F}=oa(t),{formatter:s}=(()=>{const{hideDates:e,preferredLocale:t}=(0,u.A)();return{formatter:(0,n.useCallback)((a=>e||!a?null:(0,ua.A)(Ue()(a,se.i$),t)),[e,t])}})(),c=(0,n.useMemo)((()=>[t,...l?.hashes?Object.keys(l.hashes).map((e=>`${e.toUpperCase()}: ${l.hashes?.[e]}`)):[]].filter(Boolean).join("\n")),[l,t]),m=(0,n.useCallback)((t=>{o(-1!==l?.selectionIndex?_.N.REMOVE:_.N.ADD,t,e)}),[l,e,o]),d=(0,n.useCallback)((e=>{if(e.preventDefault(),e.ctrlKey||e.shiftKey)m(e.shiftKey);else switch(r){case ma.n.VIEW:i();break;case ma.n.EDIT:F();break;case ma.n.SELECT:default:m(e.shiftKey)}}),[F,r,i,m]);if(!l)return null;const{created:p,hashes:g,palette:h,invertPalette:f,invertFramePalette:E,framePalette:A,frame:v,lockFrame:b,title:y,tags:w,selectionIndex:C,rotation:I}=l;return n.createElement(lt,{selectionText:-1!==C?(C+1).toString(10):"",title:y,subheader:s(p),wrapperProps:{onClick:d,disableRipple:!0,sx:{display:"block",width:"100%",textAlign:"left"}},contextMenuComponent:ia,contextMenuProps:{hash:t},media:n.createElement(Te,{lockFrame:b,invertPalette:f,palette:h,framePalette:A,invertFramePalette:E,frameId:v,hash:t,hashes:g,rotation:I}),content:(w.length>0||c&&a)&&n.createElement(n.Fragment,null,n.createElement(Re,{tags:w}),n.createElement(ca,{text:c}))})};var pa=function(e){return n.createElement(Fa.A,{component:"h2",variant:"caption"},`${e.imageCount} images`,e.filteredCount?` / ${e.filteredCount} filtered`:null,e.selectedCount?` / ${e.selectedCount} selected`:null)},ga=a(25508),ha=a.n(ga),fa=a(67221),Ea=a(60446);const Aa=(0,Ea.A)("percentage",Ea.U.DESC),va=()=>{const[e,t]=(0,n.useState)([]);return(0,n.useEffect)((()=>{window.setTimeout((async()=>{const e=await(navigator.storage?.estimate())||null,a=(()=>{let e=0;for(const t in localStorage)if(localStorage.hasOwnProperty(t)){const a=localStorage.getItem(t);null!==a&&(e+=t.length+a.length)}return e})(),n=a+(()=>{const e="__test_localStorage_limit__";let t=0,a=15728640,n=0;try{for(;t<=a;){const r=Math.floor((t+a)/2),l="A".repeat(r);try{localStorage.setItem(e,l),n=r,t=r+1}catch{a=r-1}}}finally{localStorage.removeItem(e)}return n})();t([{type:"indexedDB",total:n,used:a,percentage:Math.ceil(a/n*100)},{type:"localStorage",total:e?.quota||0,used:e?.usage||0,percentage:Math.ceil(n?(e?.usage||0)/(e?.quota||1)*100:100)}])}),10)}),[]),{storageEstimate:Aa(e.filter((({percentage:e})=>e>75)))[0]||null}};var ba=function(){const{storageEstimate:e}=va();return e?n.createElement(y.A,{title:`Using ${ha()(e.used)} of ${ha()(e.total)}`,sx:{position:"relative"}},n.createElement(fa.A,{variant:"determinate",value:e.percentage,sx:{width:"100%",height:"34px"},color:"error"}),n.createElement(Fa.A,{variant:"body2",color:"bg",sx:{position:"absolute",p:1,top:0}},`You are using ${e.percentage}% of your browser's ${(e=>{switch(e){case"indexedDB":return"indexed DB";case"localStorage":return"local storage";default:return e}})(e.type)}. Be aware for now saving images will not be possible once you hit the limit.`)):null},ya=a(60527),wa=a(66277),Ca=a(4676),Ia=a(93746),Sa=a(7797),xa=a(74035);var ka=function(e){const{path:t}=$();return n.createElement(w.A,{component:e.disabled?"span":r.N_,disabled:e.disabled,to:`/gallery/${t}page/${e.page+1}`,title:`To page ${e.page+1}`},e.children)},Pa=a(30985),Ta=a(16521);var Da=(e,t,a)=>[...e].filter((0,Ta.A)(t,a)).filter((0,Pa.A)(t)).length;var Ma=function({page:e}){const{view:t}=G(),{pageSize:a}=(0,u.A)(),{filtersActiveTags:r,recentImports:l}=(0,_.A)(),o=(0,n.useMemo)((()=>a?Math.ceil(Da(t.images,r,l)/a)-1:0),[r,a,l,t]);if(0===o)return null;const F=[{icon:n.createElement(wa.A,null),pageIndex:e-1,disabled:e<1},null,{icon:n.createElement(Ca.A,null),pageIndex:e+1,disabled:o<e+1}];return o>5&&(F.unshift({icon:n.createElement(Ia.A,null),pageIndex:e-5,disabled:e<5}),F.push({icon:n.createElement(Sa.A,null),pageIndex:e+5,disabled:o<e+5})),o>1&&(F.unshift({icon:n.createElement(ya.A,null),pageIndex:0,disabled:0===e}),F.push({icon:n.createElement(xa.A,null),pageIndex:o,disabled:e===o})),n.createElement(i.A,{direction:"row",justifyContent:"space-around"},n.createElement(bt.A,{color:"tertiary",variant:"contained",disableElevation:!0,sx:{"& .MuiButton-root":{width:40,height:40}}},F.map((t=>{if(!t)return n.createElement(Fa.A,{key:"current",component:"span",variant:"body1",sx:{px:2,display:"flex",alignItems:"center"}},`${e+1}/${o+1}`);const{icon:a,pageIndex:r,disabled:l}=t;return n.createElement(ka,{key:r,page:r,disabled:l},a)}))))};var Ba=function(){const{imageCount:e,selectedCount:t,filteredCount:a,page:l,images:o,covers:F}=(()=>{const{view:e,covers:t}=G(),{pageSize:a}=(0,u.A)(),{imageSelection:n,filtersActiveTags:l,recentImports:o,sortBy:i}=(0,_.A)(),{images:F}=(0,ie.h)(),s=F.length,c=Da(e.images,l,o),{pageIndex:m,path:d}=$(),p=(0,r.Zp)(),g=a?Math.ceil(s/a):1,h=Math.max(0,g-1),f=Math.max(0,Math.min(m,h));f!==m&&p(`/gallery/${d}page/${f+1}`);const E=f*a,A=a;return{imageCount:s,selectedCount:n.length,filteredCount:c,page:f,images:(0,O.S)(e.images,{filtersActiveTags:l,recentImports:o,sortBy:i}).splice(E,A||1/0),covers:t}})(),{enableImageGroups:s}=(0,u.A)();return n.createElement(i.A,{direction:"column",gap:2},n.createElement(ba,null),n.createElement(pa,{imageCount:e,selectedCount:t,filteredCount:a}),s?n.createElement(Y,null):null,n.createElement(Ht,{page:l,isSticky:!0}),n.createElement(Ma,{page:l}),n.createElement(J,null,o.map((e=>F.includes(e.hash)?n.createElement(ut,{key:e.hash,hash:e.hash}):n.createElement(da,{key:e.hash,hash:e.hash,page:l})))),o.length<3?null:n.createElement(n.Fragment,null,n.createElement(Ma,{page:l}),n.createElement(Ht,{page:l,isBottom:!0})))},Ra=a(14776);var Na=e=>{const{printerUrl:t,printerParams:a}=(0,u.A)(),r=a?`#${encodeURI(a)}`:"",l=t?`${t}remote.html${r}`:void 0,{printerFunctions:o}=(0,he.A)(),i=o.length>0,[F,s]=(0,n.useState)(!1),[c,m]=(0,n.useState)(!1),d=(0,n.useRef)();return(0,n.useEffect)((()=>(F||c||d.current||(d.current=window.setTimeout((()=>{m(!0)}),e)),()=>{window.clearTimeout(d.current)})),[c,F,e]),!F&&i&&(window.clearTimeout(d.current),s(!0)),{failed:c,loaded:F,printerUrl:l,printerConnected:i}};var La=function(){const{printerUrl:e,failed:t,loaded:a,printerConnected:r}=Na(5e3);return(e=>{if(!e)return!1;if(e.startsWith("/"))return!0;const{protocol:t}=new URL(e),{protocol:a}=new URL(window.location.href);return"http:"===a||a===t})(e)&&!t?n.createElement(y.A,{sx:{display:"flex",justifyContent:"center"}},n.createElement("iframe",{style:{position:"absolute",top:"80px",left:"-200vw",width:"480px",height:"90px"},title:"Transfer window",src:e}),!a&&n.createElement(le.A,{color:"secondary"})):(!r||t)&&n.createElement(bt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{onClick:()=>{window.open(e,"remoteprinter","width=480,height=400")}},"Open printer page"))},Ga=a(31965),$a=a.n(Ga),Oa=a(88943),_a=a(49565),ja=a(54026),Va=a(51361),Ua=a(94963),za=a(96120),Wa=a(86700),Ha=a(78828);const Xa=(0,n.createContext)({callRemoteFunction:async()=>{}}),Ya=()=>{const{printerData:e,printerFunctions:t,printerBusy:a}=(0,he.A)(),{callRemoteFunction:r}=(0,n.useContext)(Xa);return{printerData:e,printerFunctions:t,printerBusy:a,printerConnected:t.length>0,callRemoteFunction:r}};var Qa;!function(e){e.TESTFILE="testFile",e.CHECKPRINTER="checkPrinter",e.FETCHIMAGES="fetchImages",e.CLEARPRINTER="clearPrinter",e.TEAR="tear"}(Qa||(Qa={}));const Ka={testFile:"Print test image",checkPrinter:"Check Printer",fetchImages:"",clearPrinter:"Clear Printer",tear:"Tear"};var qa=function(){const{printerData:e,printerFunctions:t,printerConnected:a,callRemoteFunction:r,printerBusy:l}=Ya();return a?n.createElement(i.A,{direction:"column",gap:2},n.createElement(bt.A,{variant:"contained",fullWidth:!0},t.map((a=>n.createElement(w.A,{key:a,disabled:l||[Qa.FETCHIMAGES,Qa.CLEARPRINTER,Qa.TEAR].includes(a)&&!e?.dumps?.length,onClick:()=>r(a)},a===Qa.FETCHIMAGES?((e,t)=>e.includes(Qa.TEAR)||!t?"Fetch images":`Fetch ${t||0} images`)(t,e?.dumps?.length||0):Ka[a])))),e?.message?n.createElement(Oa.A,{severity:"info"},e?.message):null,e?.fs&&e?.dumps?n.createElement(za.A,{component:_a.A},n.createElement(ja.A,{sx:{minWidth:650},size:"small","aria-label":"a dense table"},n.createElement(Wa.A,null,n.createElement(Ha.A,null,n.createElement(Ua.A,{align:"right"},"Printer Filesystem"),n.createElement(Ua.A,{align:"left"}))),n.createElement(Va.A,null,n.createElement(Ha.A,null,n.createElement(Ua.A,{align:"right"},"Total"),n.createElement(Ua.A,{align:"left"},$a()(e?.fs.total))),n.createElement(Ha.A,null,n.createElement(Ua.A,{align:"right"},"Used"),n.createElement(Ua.A,{align:"left"},$a()(e?.fs.used))),n.createElement(Ha.A,null,n.createElement(Ua.A,{align:"right"},"Free"),n.createElement(Ua.A,{align:"left"},`${Math.max(0,(e?.fs.maximages||0)-(e?.dumps.length||0))} images`)),n.createElement(Ha.A,null,n.createElement(Ua.A,{align:"right"},"Images"),n.createElement(Ua.A,{align:"left"},e?.dumps.length))))):null):null},Za=a(28025);var Ja=a(90521);const en=e=>{e.fillStyle="#000",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.filter="grayscale(1)",e.imageSmoothingEnabled=!1};var tn=(e,t=!1)=>new Promise(((a,n)=>{const r=document.createElement("img"),l=document.createElement("canvas");l.width=160;const o=l.getContext("2d");o?(r.onerror=n,r.onload=()=>{let n;const i=r.naturalWidth,F=r.naturalHeight;.875===F/i?(l.height=144,n=r.naturalWidth/128,t||en(o),o.drawImage(r,0,0,i,F,16,16,l.width-32,l.height-32)):(l.height=l.width*F/i,n=i/160,t||en(o),o.drawImage(r,0,0,i,F,0,0,l.width,l.height));const s=o.getImageData(0,0,l.width,l.height);a({imageData:s,scaleFactor:n,width:l.width,height:l.height,fileName:e.name,lastModified:e.lastModified||null})},(0,Za.A)(e,Za.Z.DATA_URL).then((e=>{r.src=e}))):n(new Error("No canvas context"))}));var an=({baseValues:e,orderPatterns:t})=>{const a=[];for(let n=0;n<4;n+=1){const r=[];a.push(r);for(let a=0;a<4;a+=1){const l=[];r.push(l);for(let r=0;r<3;r+=1)l.push(e[r][t[r][4*n+a]])}}return a};const nn=[0,12,3,15,8,4,11,7,2,14,1,13,10,6,9,5],rn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var ln=(e,t)=>{const a=(t-e)/16;return new Array(16).fill(null).map(((t,n)=>Math.floor(e+a*n)))};var on=e=>{const t="number"==typeof e[0]?e[0]:0,a="number"==typeof e[1]?e[1]:85,n="number"==typeof e[2]?e[2]:170,r="number"==typeof e[3]?e[3]:255;return[ln(t,a),ln(a,n),ln(n,r)]},Fn=a(96763);let sn=0;const cn=({imageData:e,contrastBaseValues:t,dither:a,colors:n})=>{const r=new ImageData(e.width,e.height),l=an({baseValues:on(t),orderPatterns:[a?nn:rn,a?nn:rn,a?nn:rn]}),o=e.width,i=e.data;for(let e=0;e<i.length;e+=4){const t=sn%o%4,a=Math.ceil(sn/o)%4,F=i[e];let s;const c=l[t][a];s=F<=c[0]?n[3]:F<=c[1]?n[2]:F<=c[2]?n[1]:n[0],r.data[e]=s.r,r.data[e+1]=s.g,r.data[e+2]=s.b,r.data[e+3]=255,sn+=1}return r},un=[0,256,1,257],mn=e=>{const t=[];for(let a=0;a<8;a+=1){let n=0;for(let t=0;t<8;t+=1){n+=un[e[8*a+t]]<<7-t}t.push((n>>8).toString(16).padStart(2,"0"),(255&n).toString(16).padStart(2,"0"))}return t.join(" ").toUpperCase()},dn=({bitmapQueue:e,dither:t,contrastBaseValues:a})=>{const{importQueueAdd:n}=ge.getState();e.forEach((async({imageData:e,height:r,fileName:l,lastModified:o})=>{const{data:i}=cn({imageData:e,contrastBaseValues:a,dither:t,colors:[{r:0,g:0,b:0},{r:1,g:0,b:0},{r:2,g:0,b:0},{r:3,g:0,b:0}]}),F=Array.from(i).filter(((e,t)=>!(t%4))),s=20*Math.ceil(r/8),c=(e=>t=>{const a=t%20,n=Math.floor(t/20),r=8*a,l=8*n;return new Array(8).fill(null).map(((t,a)=>e.slice(r+160*(l+a)).slice(0,8))).flat(1)})(F),u=new Array(s).fill(null).map(((e,t)=>c(t))).map(mn),{dataHash:m}=await(0,Ja.cg)(u);n([{fileName:l,imageHash:m,tiles:u,lastModified:o,tempId:ze()}])}))};var pn=a(41851);var gn,hn=e=>{const t=e.split("\n").map((e=>e.trim())).filter((e=>e.length&&0!==e.indexOf("//")&&0!==e.indexOf("/*"))).map((e=>e.split(" "))).flat().map((e=>parseInt(e,16))).filter((e=>!isNaN(e)));return(0,pn.gV)(t)};!function(e){e.NEW_LINES="NEW_LINES",e.IMAGE_COMPLETE="IMAGE_COMPLETE",e.PARSE_ERROR="PARSE_ERROR"}(gn||(gn={}));var fn=e=>{if("#"===e.charAt(0)||"/"===e.charAt(0))return null;if("!"===e.charAt(0)||"{"===e.charAt(0)){try{const{command:t,margin_lower:a}=JSON.parse(e.slice(e.indexOf("{")).trim());if("PRNT"===t&&a>0)return{type:gn.IMAGE_COMPLETE}}catch(e){return{type:gn.PARSE_ERROR,payload:"Error while trying to parse JSON data command block"}}return null}const t=e.replace(/[^0-9A-F]/gi,"");return t.length?{type:gn.NEW_LINES,payload:[t]}:null},En=a(96763);var An=(e,t)=>{const a=`${e}\n${se.Ys}`.split("\n").map(fn).reduce(((e,t)=>{switch(t?.type){case gn.NEW_LINES:return e[e.length-1].push(...t.payload),e;case gn.IMAGE_COMPLETE:return[...e,[]];default:return e}}),[[]]).filter((e=>e.length>0));return a.length||En.warn(`File ${t} did not contain images`),a};var vn=a(57402),bn=a.n(vn),yn=a(86344),wn=a.n(yn),Cn=a(10894);var In=(e,t,a)=>{if(!t)return"";const n=e=>a.find((({id:t})=>t===e)),r=(e+1).toString(10).padStart(2,"0"),l=n(`${t}${r}`);if(l?.hash)return l.hash;if("jp"===t){const e=n(`int${r}`);if(e?.hash)return e.hash}const o=n(`${t}01`);if(o?.hash)return o.hash;if("jp"!==t){const e=n(`int${r}`);if(e?.hash)return e.hash}return n("int01")?.hash||""};const Sn={86:"A",87:"B",88:"C",89:"D",90:"E",91:"F",92:"G",93:"H",94:"I",95:"J",96:"K",97:"L",98:"M",99:"N",100:"O",101:"P",102:"Q",103:"R",104:"S",105:"T",106:"U",107:"V",108:"W",109:"X",110:"Y",111:"Z",112:"_",113:"'",114:",",115:".",116:"Á",117:"Â",118:"À",119:"Ä",120:"É",121:"Ê",122:"È",123:"Ë",124:"Í",125:"Ï",126:"Ó",127:"Ö",128:"Ú",129:"Ü",130:"Ñ",131:"-",132:"&",133:"!",134:"?",135:" ",136:"a",137:"b",138:"c",139:"d",140:"e",141:"f",142:"g",143:"h",144:"i",145:"j",146:"k",147:"l",148:"m",149:"n",150:"o",151:"p",152:"q",153:"r",154:"s",155:"t",156:"u",157:"v",158:"w",159:"x",160:"y",161:"z",162:"•",163:"~",164:"📱",165:" ",166:"á",167:"â",168:"à",169:"ä",170:"é",171:"ê",172:"è",173:"ë",174:"í",175:"ï",176:"ó",177:"ö",178:"ú",179:"ü",180:"ñ",181:"ḉ",182:"ß",183:"😄",184:"😟",185:"😅",186:"0",187:"1",188:"2",189:"3",190:"4",191:"5",192:"6",193:"7",194:"8",195:"9",196:"/",197:":",198:"~",199:'"',200:"@"},xn={1:"あ",2:"い",3:"う",4:"え",5:"お",6:"か",7:"き",8:"く",9:"け",10:"こ",11:"さ",12:"し",13:"す",14:"せ",15:"そ",16:"た",17:"ち",18:"つ",19:"て",20:"と",21:"な",22:"に",23:"ぬ",24:"ね",25:"の",26:"は",27:"ひ",28:"ふ",29:"へ",30:"ほ",31:"ま",32:"み",33:"む",34:"め",35:"も",36:"や",37:"ゆ",38:"よ",39:"、",40:"。",41:"ら",42:"り",43:"る",44:"れ",45:"ろ",46:"わ",47:"を",48:"ん",49:"〜",50:"♥",51:"が",52:"ぎ",53:"ぐ",54:"げ",55:"ご",56:"ざ",57:"じ",58:"ず",59:"ぜ",60:"ぞ",61:"だ",62:"ぢ",63:"づ",64:"で",65:"ど",66:"ば",67:"び",68:"ぶ",69:"べ",70:"ぼ",71:"ぱ",72:"ぴ",73:"ぷ",74:"ぺ",75:"ぽ",76:"っ",77:"ゃ",78:"ゅ",79:"ょ",80:"・",81:"ぁ",82:"ぃ",83:"ぅ",84:"ぇ",85:"ぉ",86:"ア",87:"イ",88:"ウ",89:"エ",90:"オ",91:"カ",92:"キ",93:"ク",94:"ケ",95:"コ",96:"サ",97:"シ",98:"ス",99:"セ",100:"ソ",101:"タ",102:"チ",103:"ツ",104:"テ",105:"ト",106:"ナ",107:"ニ",108:"ヌ",109:"ネ",110:"ノ",111:"ハ",112:"ヒ",113:"フ",114:"ヘ",115:"ホ",116:"マ",117:"ミ",118:"ム",119:"メ",120:"モ",121:"ヤ",122:"ユ",123:"ヨ",124:"!",125:"?",126:"ラ",127:"リ",128:"ル",129:"レ",130:"ロ",131:"ワ",132:"ヲ",133:"ン",134:"ヴ",135:" ",136:"ガ",137:"ギ",138:"グ",139:"ゲ",140:"ゴ",141:"ザ",142:"ジ",143:"ズ",144:"ゼ",145:"ゾ",146:"ダ",147:"ヂ",148:"ヅ",149:"デ",150:"ド",151:"バ",152:"ビ",153:"ブ",154:"ベ",155:"ボ",156:"パ",157:"ピ",158:"プ",159:"ペ",160:"ポ",161:"ッ",162:"ャ",163:"ュ",164:"ョ",165:"ー",166:"ァ",167:"ィ",168:"ゥ",169:"ェ",170:"ォ",171:"A",172:"B",173:"C",174:"D",175:"E",176:"F",177:"G",178:"H",179:"I",180:"J",181:"K",182:"L",183:"M",184:"N",185:"O",186:"P",187:"Q",188:"R",189:"S",190:"T",191:"U",192:"V",193:"W",194:"X",195:"Y",196:"Z",197:"_",198:"'",199:",",200:".",201:"a",202:"b",203:"c",204:"d",205:"e",206:"f",207:"g",208:"h",209:"i",210:"j",211:"k",212:"l",213:"m",214:"n",215:"o",216:"p",217:"q",218:"r",219:"s",220:"t",221:"u",222:"v",223:"w",224:"x",225:"y",226:"z",227:"📱",228:"😅",229:"😄",230:"_",231:"0",232:"1",233:"2",234:"3",235:"4",236:"5",237:"6",238:"7",239:"8",240:"9",241:"/",242:":",243:"~",244:'"',245:"@"},kn="00123456789?????";var Pn;!function(e){e.PHOTO="photo",e.STOCK="stock",e.PXLR="pxlr"}(Pn||(Pn={}));const Tn=2,Dn=0,Mn=0,Bn=1,Rn=2,Nn=3,Ln=4,Gn=16,$n=5,On=17,_n=6,jn=18,Vn=7,Un=19,zn=8,Wn=20,Hn=21,Xn=9,Yn=22,Qn=23,Kn=10,qn=24,Zn=11,Jn=25,er=12,tr=26,ar=13,nr=27,rr=28,lr=14,or=29,ir=15,Fr=30,sr=31,cr=0,ur=32,mr=64,dr=96,pr=128,gr=0,hr=0,fr=16,Er=32,Ar=48,vr=64,br=80,yr=96,wr=112,Cr=8,Ir=0,Sr=0,xr=1,kr=2,Pr=3,Tr=4,Dr=5,Mr=6,Br=7,Rr=0,Nr=128,Lr=64,Gr=31,$r=30,Or=29,_r=28,jr=27,Vr=26,Ur=25,zr=24,Wr=23,Hr=22,Xr=21,Yr=20,Qr=19,Kr=18,qr=17,Zr=16,Jr=15,el=14,tl=13,al=12,nl=11,rl=10,ll=9,ol=8,il=7,Fl=6,sl=5,cl=4,ul=3,ml=2,dl=1,pl=0,gl=32,hl=33,fl=34,El=35,Al=36,vl=37,bl=38,yl=39,wl=40,Cl=41,Il=42,Sl=43,xl=44,kl=45,Pl=46,Tl=47,Dl=48,Ml=49,Bl=50,Rl=51,Nl=52,Ll=53,Gl=54,$l=55,Ol=56,_l=57,jl=58,Vl=59,Ul=60,zl=61,Wl=62,Hl=63,Xl=0,Yl=1,Ql=0,Kl=16,ql={thumbnailByteCapture:0,thumbnailByteEdgegains:16,thumbnailByteExposureHigh:32,thumbnailByteExposureLow:48,thumbnailByteEdmovolt:198,thumbnailByteVoutzero:214,thumbnailByteDitherset:230,thumbnailByteContrast:246},Zl={thumbnailByteCapture:200,thumbnailByteEdgegains:201,thumbnailByteExposureHigh:203,thumbnailByteExposureLow:202,thumbnailByteEdmovolt:204,thumbnailByteVoutzero:205,thumbnailByteDitherset:200,thumbnailByteContrast:200},Jl=(e,t)=>{const a=.016*e+4.096*t;return a<10?`${a.toFixed(1)}ms`:`${Math.floor(a)}ms`},eo=e=>{switch(e){case Tn:return"positive";case Dn:return"negative";default:return"unknown"}},to=e=>{switch(e){case pr:return"on";case gr:return"off";default:return"unknown"}},ao=e=>{switch(e){case cr:return"none";case ur:return"horizontal";case mr:return"vertical";case dr:return"2d";default:return"unknown"}},no=e=>{switch(e){case Mn:return"14.0";case Bn:return"15.5";case Rn:return"17.0";case Nn:return"18.5";case Ln:return"20.0";case Gn:return"20.0 (d)";case $n:return"21.5";case On:return"21.5 (d)";case _n:return"23.0";case jn:return"23.0 (d)";case Vn:return"24.5";case Un:return"24.5 (d)";case zn:return"26.0";case Wn:return"26.0 (d)";case Hn:return"27.5";case Xn:return"29.0";case Yn:return"29.0 (d)";case Qn:return"30.5";case Kn:return"32.0";case qn:return"32.0 (d)";case Zn:return"35.0";case Jn:return"35.0 (d)";case er:return"38.0";case tr:return"38.0 (d)";case ar:return"41.0";case nr:return"41.0 (d)";case rr:return"44.0";case lr:return"45.5";case or:return"47.0";case ir:return"51.5";case Fr:return"51.5 (d)";case sr:return"57.5";default:return"unknown"}},ro=e=>{switch(e){case hr:return"50%";case fr:return"75%";case Er:return"100%";case Ar:return"125%";case vr:return"200%";case br:return"300%";case yr:return"400%";case wr:return"500%";default:return"unknown"}},lo=e=>{switch(e){case Cr:return"on";case Ir:return"off";default:return"unknown"}},oo=e=>{switch(e){case Sr:return"0.0V";case xr:return"0.5V";case kr:return"1.0V";case Pr:return"1.5V";case Tr:return"2.0V";case Dr:return"2.5V";case Mr:return"3.0V";case Br:return"3.5V";default:return"unknown"}},io=e=>{switch(e){case Rr:return"none";case Nr:return"positive";case Lr:return"negative";default:return"unknown"}},Fo=e=>{switch(e){case Gr:return"-0.992mV";case $r:return"-0.960mV";case Or:return"-0.928mV";case _r:return"-0.896mV";case jr:return"-0.864mV";case Vr:return"-0.832mV";case Ur:return"-0.800mV";case zr:return"-0.768mV";case Wr:return"-0.736mV";case Hr:return"-0.704mV";case Xr:return"-0.672mV";case Yr:return"-0.640mV";case Qr:return"-0.608mV";case Kr:return"-0.576mV";case qr:return"-0.544mV";case Zr:return"-0.512mV";case Jr:return"-0.480mV";case el:return"-0.448mV";case tl:return"-0.416mV";case al:return"-0.384mV";case nl:return"-0.352mV";case rl:return"-0.320mV";case ll:return"-0.288mV";case ol:return"-0.256mV";case il:return"-0.224mV";case Fl:return"-0.192mV";case sl:return"-0.160mV";case cl:return"-0.128mV";case ul:return"-0.096mV";case ml:return"-0.064mV";case dl:return"-0.032mV";case pl:return"-0.000mV";case gl:return" 0.000mV";case hl:return"0.032mV";case fl:return"0.064mV";case El:return"0.096mV";case Al:return"0.128mV";case vl:return"0.160mV";case bl:return"0.192mV";case yl:return"0.224mV";case wl:return"0.256mV";case Cl:return"0.288mV";case Il:return"0.320mV";case Sl:return"0.352mV";case xl:return"0.384mV";case kl:return"0.416mV";case Pl:return"0.448mV";case Tl:return"0.480mV";case Dl:return"0.512mV";case Ml:return"0.544mV";case Bl:return"0.576mV";case Rl:return"0.608mV";case Nl:return"0.640mV";case Ll:return"0.672mV";case Gl:return"0.704mV";case $l:return"0.736mV";case Ol:return"0.768mV";case _l:return"0.800mV";case jl:return"0.832mV";case Vl:return"0.864mV";case Ul:return"0.896mV";case zl:return"0.928mV";case Wl:return"0.960mV";case Hl:return"0.992mV";default:return"unknown"}},so=e=>{let t,a;switch(1&e){case Xl:t="High";break;case Yl:t="Low";break;default:t="unknown"}switch(2&e){case Ql:a="On";break;case Kl:a="Off";break;default:a="unknown"}return`${t}/${a}`},co=(e,t)=>{let a;switch(t){case Pn.PHOTO:a=Zl;break;case Pn.PXLR:a=ql;break;default:return null}const n=e[a.thumbnailByteExposureHigh],r=e[a.thumbnailByteExposureLow],l=2&e[a.thumbnailByteCapture],o=128&e[a.thumbnailByteEdgegains],i=96&e[a.thumbnailByteEdgegains],F=31&e[a.thumbnailByteEdgegains],s=112&e[a.thumbnailByteEdmovolt],c=8&e[a.thumbnailByteEdmovolt],u=7&e[a.thumbnailByteEdmovolt],m=192&e[a.thumbnailByteVoutzero],d=63&e[a.thumbnailByteVoutzero],p=e[a.thumbnailByteDitherset],g=e[a.thumbnailByteContrast];return t===Pn.PHOTO?{romType:t,exposure:Jl(n,r),captureMode:eo(l),edgeExclusive:to(o),edgeOperation:ao(i),gain:no(F),edgeMode:ro(s),invertOut:lo(c),voltageRef:oo(u),zeroPoint:io(m),vOut:Fo(d)}:{romType:t,exposure:Jl(n,r),captureMode:eo(l),edgeExclusive:to(o),edgeOperation:ao(i),gain:no(F),edgeMode:ro(s),invertOut:lo(c),voltageRef:oo(u),zeroPoint:io(m),vOut:Fo(d),ditherset:so(p),contrast:g+1}},uo=(e,t)=>{const a=t?xn:Sn;return[...e].map((e=>a[e]||" ")).join("").trim()},mo=e=>{switch(28&e){case 4:return"A";case 8:return"B";case 12:return"0";case 16:return"AB";default:return"-"}},po=e=>{if(!e)return"--";return`${kn[e>>4]}${kn[15&e]}`},go=(e,t)=>{const[a,n,r,l]=[...e].map(po),o=((e,t)=>"--"===e&&"--"!==t?`00${t}`:"--"!==e&&"--"===t?`${e}00`:`${e}${t}`)(a,n);return t?`${o}年${r}月${l}日`:`${r}/${l}/${o}`},ho=(e,t)=>`${t?"PC-":"GC-"}${[...e].map(po).map((e=>"--"===e?"00":e)).join("")}`,fo=(e,t,a)=>{const n=e.subarray(t+3840,t+3843+1),r=e.subarray(t+3844,t+3852+1),l=e[t+3853],o=e.subarray(t+3854,t+3857+1),i=e.subarray(t+3861,t+3887+1),F=Boolean(e[t+3891]);return{userId:ho(n,a),birthDate:go(o,a),userName:uo(r,a),gender:(s=l,1&s?"m":2&s?"f":"-"),bloodType:mo(l),comment:uo(i,a),isCopy:F};var s};var Eo=(e,t,a)=>{const n=t/4096-2,r=n>=0?e[4530+n]:64,l=e[t+3924],o=e.slice(t+3584,t+3839+1);let i;if(r<64){const n=(e=>{const t=[200,201,202,203,204,205,206,207,216,217,218,219,220,221,222,223,232,233,234,235,236,237,238,239,248,249,250,251,252,253,254,255];return t.map((t=>e[t])).filter((e=>0===e)).length===t.length?Pn.STOCK:t.map((t=>e[t])).filter((e=>255===e)).length===t.length?Pn.PXLR:Pn.PHOTO})(o);i={romType:n},"stock"!==n&&(i={...i,...co(o,n)}),"stock"===n&&(i={...i,...fo(e,t,a)})}return{cartIndex:n,albumIndex:r,baseAddress:t,frameNumber:l,meta:i}};const Ao="FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF";var vo=(e,t)=>{const a=[];let n="",r=!1;a.push(...[...Array(40)].map((()=>Ao)));for(let l=0;l<3584;l+=1)l%256==0&&a.push(...[...Array(2)].map((()=>Ao))),n+=` ${e[t+l].toString(16).padStart(2,"0")}`,l%16==15&&(a.push(n.trim()),r||"00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00"===n.trim()||(r=!0),n=""),l%256==255&&a.push(...[...Array(2)].map((()=>Ao)));return a.push(...[...Array(40)].map((()=>Ao))),r?a:null},bo=a(37482);const yo=(0,Ea.A)("albumIndex");var wo=({importLastSeen:e,data:t,lastModified:a,frames:n,fileName:r,importDeleted:l,forceMagicCheck:o})=>{const{importQueueAdd:i}=ge.getState();if(o){if([4306,4523,4560,4597].some((e=>"Magic"!==[...t.subarray(e,e+5)].map((e=>String.fromCharCode(e))).join(""))))return null}return async(o,F)=>{const s=new Array(30).fill(null).map(((e,t)=>4096*(t+2))).filter((e=>e<t.length));e&&s.unshift(0);const c=await Promise.all(s.map((async e=>{const a=Eo(t,e,F),{frameNumber:r}=a,l=vo(t,e);if(l){return{tiles:await(0,Cn.A)(l,In(r,o,n)),...a}}return null}))),u=yo(c.filter(Boolean)),m=new(wn())(1,1/0);let d=0;const p=await Promise.all(u.map((async({albumIndex:e,tiles:t,meta:n})=>m.add((async()=>{let o;switch(e){case 64:o="[last seen]";break;case 255:if(!l)return;o="[deleted]";break;default:d+=1,o=d.toString(10).padStart(2,"0")}const{dataHash:i}=await(0,Ja.cg)(t);return{fileName:"function"==typeof r?r({indexText:o,albumIndex:e,displayIndex:d}):`${r} ${o}`,imageHash:i,tiles:t,lastModified:a,meta:n,tempId:ze()}})))));return i(p.reduce(bo.N,[])),!0}};const Co=e=>e.toString(10).padStart(2,"0");var Io=a(1562);var So=e=>{let t,a;if(e.blob){const n=e;if(t=new File([n.blob],n.blobName||"blob"),a=n.contentType||"application/unknown",void 0!==n.ok&&!n.ok)throw new Error("Invalid file received from printer")}else t=e,a=t.type;if(!t.size)throw new Error("empty file");return{file:t,contentType:a}};var xo=e=>{const t=(e=>async t=>{const a=await(0,Za.A)(t,Za.Z.TEXT);let n;try{n=JSON.parse(a)}catch(e){throw new Error("Not a valid .json file")}if(!n?.state)throw new Error("Not a settings .json file");return e(n),!0})(e);return async(e,{fromPrinter:n}={fromPrinter:!1})=>{await Promise.all(e.map((e=>{const{file:r,contentType:l}=So(e);if(l&&l.startsWith("image/"))return(async(e,t=!1)=>{const a=await tn(e);return t?dn({bitmapQueue:[a],dither:!1,contrastBaseValues:[0,85,170,255]}):ge.getState().bitmapQueueAdd([a]),!0})(r,n);if(r.size>268435455)throw new Error("File too large");if("text/plain"===l)return(async e=>{const{importQueueAdd:t}=ge.getState(),a=await(0,Za.A)(e,Za.Z.TEXT);let n;return n=-1!==a.indexOf('{"command"')?await An(a,e.name):await hn(a),await Promise.all(n.map((async(a,r)=>{const{dataHash:l}=await(0,Ja.cg)(a),o=n.length<2?"":` ${(r+1).toString(10).padStart(2,"0")}`;return t([{fileName:`${e.name}${o}`,imageHash:l,tiles:a,lastModified:e.lastModified?e.lastModified+r:void 0,tempId:ze()}]),!0}))),!0})(r);if("application/json"===l)return t(r);if(r.name?.toLowerCase().endsWith(".sav")&&(r.size%4096==0||3584===r.size))return(async(e,t)=>{const{dismissDialog:a,setDialog:n}=pe.A.getState(),{frames:r,frameGroups:l}=ie.h.getState(),{savFrameTypes:o,setSavFrameTypes:i}=u.A.getState(),F=await(0,Za.A)(e,Za.Z.UINT8_ARRAY),{importLastSeen:s,importDeleted:c,forceMagicCheck:m}=u.A.getState(),d=(0,Io.A)(r,l).map((({id:e,name:t})=>({value:e,name:t,selected:o===e})));d.unshift({value:"",name:"None (Black frame)"});const p=wo({importLastSeen:!!t||s,data:F,lastModified:e.lastModified,frames:r,fileName:e.name,importDeleted:!!t||c,forceMagicCheck:!t&&m});if(!p)throw new Error(".sav file seems to be invalid");return t?(await p("",!1),!0):new Promise((t=>{n({message:`Importing '${e.name}'`,questions:()=>[{type:je.V.CHECKBOX,label:"Import is from a Japanese Cart (PocketCamera)",key:"cartIsJP"},d.length>1?{type:je.V.SELECT,label:"Select frame group to use with this import",key:"chosenFrameset",options:d}:void 0].reduce(bo.N,[]),confirm:async e=>{const{chosenFrameset:n,cartIsJP:r}=e;a(0),i(n),await p(n||"",Boolean(r)),t(!0)},deny:async()=>{a(0),t(!0)}})}))})(r,3584===r.size);if((r.name?.toLowerCase().endsWith(".gb")||r.name?.toLowerCase().endsWith(".gbc"))&&r.size%1048576==0)return(async e=>{const{default:t}=await Promise.resolve().then(a.t.bind(a,74802,23)),n=await(0,Za.A)(e,Za.Z.UINT8_ARRAY),{importLastSeen:r,importDeleted:l,forceMagicCheck:o}=u.A.getState(),i=bn()(n,131072).reduce(((e,a,n)=>{const r=t(a);return-1!==e.findIndex((({hash:e})=>e===r))?e:[...e,{bankData:a,bankIndex:n,hash:r}]}),[]),F=await i.reduce((async(t,{bankData:a,bankIndex:n})=>{const i=await t;if(0===n)return[...i,!1];const F=wo({importLastSeen:r,data:a,lastModified:e.lastModified,frames:[],fileName:({albumIndex:t})=>64===t?`${e.name} - bank ${Co(n)} [last seen]`:255===t?`${e.name} - bank ${Co(n)} [deleted]`:`${e.name} - bank ${Co(n)} - image ${Co(t+1)}`,importDeleted:l,forceMagicCheck:o});return F?[...i,await F("",!1)]:[...i,!1]}),Promise.resolve([]));if(!F.filter(Boolean).length)throw new Error("File does not contain any recognizable images");return F})(r);if("application/pico-printer-binary-log"===l)return(async e=>{const{importQueueAdd:t}=ge.getState(),a=await(0,Za.A)(e,Za.Z.UINT8_ARRAY),n=await(0,pn.Eh)(a);return await Promise.all(n.map((async(a,r)=>{const{dataHash:l}=await(0,Ja.cg)(a),o=n.length<2?"":` (${r+1})`;return t([{fileName:`${e.name}${o}`,imageHash:l,tiles:a,lastModified:e.lastModified?e.lastModified+r:void 0,tempId:ze()}]),!0}))),!0})(r);if(l.startsWith("application/"))return(async e=>{const{importQueueAdd:t}=ge.getState(),a=await(0,Za.A)(e,Za.Z.UINT8_ARRAY);if(71!==(n=a)[0]||66!==n[1]||45!==n[2]||66!==n[3]||73!==n[4]||78!==n[5]||48!==n[6]||49!==n[7])throw new Error('Not a valid .bin file - is it missing the "GB-BIN01" header?');var n;const r=[];let l=[];for(let e=8;e<a.length;e+=1){const t=a[e];l.push(t.toString(16).padStart(2,"0").toUpperCase()),16===l.length&&(r.push(l.join(" ")),l=[])}if(l.length){for(;l.length<16;)l.push("FF");r.push(l.join(" "))}const{dataHash:o}=await(0,Ja.cg)(r);return t([{fileName:e.name,imageHash:o,tiles:r,lastModified:e.lastModified,tempId:ze()}]),!0})(r);throw new Error("Not a dump")})))}};var ko=()=>{const{setError:e}=he.A.getState(),{jsonImport:t}=Pe(),a=(0,n.useMemo)((()=>xo(t)),[t]);return{handleFileImport:async(t,n)=>{try{await a(t,n)}catch(t){e(t)}}}};const Po=()=>{const{printerUrl:e}=(0,u.A)(),{printerFunctions:t}=(0,he.A)(),{downloadSettings:a}=Pe(),n=e?`${e}remote.html`:void 0,r=t.length>0,{handleFileImport:l}=ko();return{printerUrl:n,printerConnected:r,importPlainText:e=>{const t=new File([...e],"Text input.txt",{type:"text/plain"});l([t])},importFiles:l,exportJson:e=>a(e)}};var To=a(3876);var Do=function(){const[e,t]=(0,n.useState)(""),{importPlainText:r,importFiles:l,printerUrl:o,exportJson:F}=Po();return(0,n.useEffect)((()=>{a.e(7963).then(a.bind(a,24553)).then((({default:e})=>{t(e.join("\n"))}))}),[]),n.createElement(i.A,{direction:"column",gap:6},o&&n.createElement(qa,null),o&&n.createElement(La,null),n.createElement(w.A,{component:"label",variant:"contained"},"Select file(s) to import",n.createElement("input",{type:"file",tabIndex:-1,hidden:!0,multiple:!0,onChange:e=>{const{target:t}=e,{files:a}=t;a&&a.length&&l([...a]),t.value=""}})),n.createElement(i.A,{flexDirection:"column",gap:1,justifyContent:"flex-end",justifyItems:"end"},n.createElement(Ra.A,{id:"import-plaintext",label:"Enter data received through your serial monitor",multiline:!0,rows:20,value:e,onChange:({target:e})=>{t(e.value)}}),n.createElement(i.A,{direction:"row",justifyContent:"flex-end"},n.createElement(w.A,{variant:"contained",onClick:()=>{r(e)}},"Import"))),n.createElement(bt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{onClick:()=>F(To.m.IMAGES)},"Export images"),n.createElement(w.A,{onClick:()=>F(To.m.SELECTED_IMAGES)},"Export selected images"),n.createElement(w.A,{onClick:()=>F(To.m.PALETTES)},"Export palettes")))},Mo=a(64951),Bo=a(23903),Ro=a(73748),No=a(835),Lo=a(97938),Go=a(31694);const $o=e=>["#",Math.ceil(Math.random()*e).toString(16).padStart(2,"0"),Math.ceil(Math.random()*e).toString(16).padStart(2,"0"),Math.ceil(Math.random()*e).toString(16).padStart(2,"0")].join(""),Oo=()=>({name:"",shortName:Me.mI,palette:[$o(255),$o(170),$o(102),$o(34)],origin:"",isPredefined:!1});var _o=()=>{const{palettes:e}=(0,ie.h)(),{setEditPalette:t}=X(),a=(0,n.useCallback)(((a,n)=>{const r=a===Me.mI?Oo():e.find((e=>a===e.shortName))||Oo();t({...r,name:n?`Copy of ${r.name}`:r.name,shortName:n?Me.mI:a})}),[e,t]);return{editPalette:e=>a(e,!1),clonePalette:e=>a(e,!0)}};var jo=a(94895);var Vo=function({isPredefined:e,clonePalette:t,editPalette:a,deletePalette:r,setActive:l,menuAnchor:o,onClose:i}){return o?n.createElement(Ne.A,{open:!!o,anchorEl:o,onClose:i,onClick:e=>{e.stopPropagation(),i()}},n.createElement(Le.A,{onClick:l,title:"Set Active"},n.createElement(Ge.A,null,n.createElement(Go.A,null)),n.createElement($e.A,null,"Set Active")),n.createElement(Le.A,{onClick:t,title:"Clone"},n.createElement(Ge.A,null,n.createElement(jo.A,null)),n.createElement($e.A,null,"Clone")),!e&&n.createElement(n.Fragment,null,n.createElement(Le.A,{onClick:a,title:"Edit"},n.createElement(Ge.A,null,n.createElement(d.A,null)),n.createElement($e.A,null,"Edit")),n.createElement(Le.A,{onClick:r,title:"Delete"},n.createElement(Ge.A,null,n.createElement(Oe.A,null)),n.createElement($e.A,null,"Delete")))):null};const Uo=e=>{const t=e.replace("#","");if(!/^([0-9a-fA-F]{6})$/.test(t))throw new Error("Invalid hex color");return`${parseInt(t.slice(0,2),16)}, ${parseInt(t.slice(2,4),16)}, ${parseInt(t.slice(4,6),16)}`};var zo;!function(e){e.HARD="HARD",e.SMOOTH="SMOOTH",e.CONIC="CONIC"}(zo||(zo={}));const Wo=(e,t)=>{const a=Uo(e[0]||"#000000"),n=Uo(e[1]||"#000000"),r=Uo(e[2]||"#000000"),l=Uo(e[3]||"#000000");switch(t){case zo.SMOOTH:return{backgroundImage:`linear-gradient(to right,\n          rgba(${a}, 0.25) 0%,\n          rgba(${n}, 0.25) 33.3%,\n          rgba(${r}, 0.25) 66.6%,\n          rgba(${l}, 0.25) 100%\n      )`};case zo.HARD:return{backgroundImage:`linear-gradient(to right,\n          rgb(${a}) 0% 25%,\n          rgb(${n}) 25% 50%,\n          rgb(${r}) 50% 75%,\n          rgb(${l}) 75% 100%\n        )`};case zo.CONIC:return{background:`conic-gradient(\n          rgb(${a}) 0% 25%,\n          rgb(${n}) 25% 50%,\n          rgb(${r}) 50% 75%,\n          rgb(${l}) 75% 100%\n        )`};default:return{}}};var Ho=function({shortName:e,name:t,isPredefined:a,palette:r,usage:l}){const{isActive:o,setActive:i,deletePalette:F,editPalette:s,clonePalette:c}=((e,t)=>{const{activePalette:a,setActivePalette:n}=(0,u.A)(),{dismissDialog:r,setDialog:l}=(0,pe.A)(),{updateLastSyncLocalNow:o}=fe(),{deletePalette:i}=(0,ie.h)(),{editPalette:F,clonePalette:s}=_o(),c=a===e;return{isActive:c,setActive:()=>n(e),deletePalette:()=>{l({message:`Delete palette "${t||"no name"}"?`,confirm:async()=>{c&&n("dsh"),o(),i(e),r(0)},deny:async()=>r(0)})},editPalette:()=>F(e),clonePalette:()=>s(e)}})(e,t),m=(0,v.A)(),d=(0,n.useMemo)((()=>({...Wo(r,zo.SMOOTH),display:"block",width:"100%",textAlign:"left",".MuiTypography-body1":{fontWeight:o?"bold":"normal"}})),[r,o]),p=(0,n.useMemo)((()=>({...Wo(r,zo.HARD),display:"block",width:"100%",height:m.spacing(8)})),[r,m]);return 4!==r?.length?n.createElement("li",{className:"palette palette--broken"}):n.createElement(lt,{selectionText:"",title:t,subheader:`(${e}) ${l?`Used ${l} times`:"Not used"}`,titleIcon:o?n.createElement(Go.A,null):void 0,wrapperProps:{sx:d,onClick:s,disableRipple:!0},contextMenuComponent:Vo,contextMenuProps:{isPredefined:a,setActive:i,clonePalette:c,deletePalette:F,editPalette:s},media:n.createElement(y.A,{sx:p}),content:null})},Xo=a(91785),Yo=a(73371),Qo=a.n(Yo);const Ko=(e,t)=>{const a=.299*e[0]+.587*e[1]+.114*e[2],n=.299*t[0]+.587*t[1]+.114*t[2];return a>n?-1:a<n?1:0};var qo=()=>{const[e,t]=(0,n.useState)(!1),{setError:a}=(0,he.A)(),{setPickColors:r}=X();return{onInputChange:async({target:e})=>{if(e.files?.[0]){t(!0);const{imageData:n,fileName:l}=await tn(e.files[0],!0),o=bn()(n.data,4).map((([e,t,a])=>[e,t,a]));Xo.clusterize(o,{k:6},((e,n)=>{if(e)a(e);else{const e=Qo()(o,4),t=[...e?e.palette():[],...n?n.map((({centroid:[e,t,a]})=>[Math.round(e),Math.round(t),Math.round(a)])):[]].filter(((e,t,a)=>a.findIndex((t=>t.join(",")===e.join(",")))===t)).sort(Ko);r({colors:t,fileName:l})}t(!1)}))}e.value=""},busy:e}},Zo=a(17402);var Jo=()=>{const{sortPalettes:e,setSortPalettes:t}=(0,u.A)(),{images:a}=(0,ie.h)(),r=[{label:"Default (ascending)",value:Zo.V.DEFAULT_ASC},{label:"Default (descending)",value:Zo.V.DEFAULT_DESC},{label:"Usage (ascending)",value:Zo.V.USAGE_ASC},{label:"Usage (descending)",value:Zo.V.USAGE_DESC},{label:"Name (ascending)",value:Zo.V.NAME_ASC},{label:"Name (descending)",value:Zo.V.NAME_DESC}],l=(0,n.useMemo)((()=>a.reduce(((e,t)=>(0,it.pl)(t)?e:{...e,[t.palette]:(e[t.palette]||0)+1}),{})),[a]),o=(0,n.useCallback)(((t,a)=>{const[n,r]=e.split("_"),o="asc"===r?1:-1;switch(n){case"usage":{const e=l[t.shortName]||0,n=l[a.shortName]||0;return e<n?-1*o:e>n?o:0}case"name":return t.name.localeCompare(a.name)*o;default:return o}}),[l,e]);return{sortPalettes:e,setSortPalettes:t,paletteSortOptions:r,paletteUsages:l,sortFn:o}};const ei=[{id:"own",headline:"Own palettes",filter:({isPredefined:e})=>!e},{id:"predefined",headline:"Predefined palettes",filter:({isPredefined:e})=>e},{id:"all",headline:"All palettes",filter:Boolean}];var ti=function(){const{palettes:e}=(0,ie.h)(),{onInputChange:t,busy:a}=qo(),{editPalette:r}=_o(),{exportJson:l}=Po(),[o,F]=(0,n.useState)(0),[s,c]=(0,n.useState)(null),u=(0,v.A)(),m=(0,P.A)(u.breakpoints.up("sm")),d=(0,n.useMemo)((()=>ei[o]),[o]),{sortFn:p,sortPalettes:g,setSortPalettes:h,paletteSortOptions:f,paletteUsages:E}=Jo(),A=(0,n.useMemo)((()=>[...e].filter(d.filter).sort(p)),[d,e,p]);return n.createElement(i.A,{direction:"column",gap:4},n.createElement(Bo.A,{value:o},ei.map((({id:e,headline:t},a)=>n.createElement(Mo.A,{label:t,key:e,onClick:()=>F(a),value:a})))),n.createElement(i.A,{direction:"row",justifyContent:"end"},n.createElement(bt.A,{color:"tertiary",variant:"contained",size:"small",orientation:m?"horizontal":"vertical",fullWidth:!m,disableElevation:!0},"own"===d.id&&n.createElement(n.Fragment,null,n.createElement(w.A,{disabled:a,title:"New palette",onClick:()=>r(Me.mI),startIcon:n.createElement(Ro.A,null)},"New palette"),n.createElement(w.A,{component:"label",disabled:a,startIcon:n.createElement(No.A,null),title:"New palette from image"},"New palette from image",n.createElement("input",{disabled:a,type:"file",hidden:!0,onChange:t}))),n.createElement(w.A,{title:"Sort Palettes",onClick:e=>c(e.target),endIcon:n.createElement(Lo.A,null)},"Sort Palettes"))),n.createElement(Ne.A,{open:!!s,anchorEl:s,onClose:()=>c(null),onClick:e=>{e.stopPropagation(),c(null)}},f.map((({label:e,value:t})=>n.createElement(Le.A,{key:t,selected:g===t,onClick:()=>h(t)},e)))),n.createElement(J,{fixedView:Z.j.PALETTE_VIEW},A.map((e=>n.createElement(Ho,{key:e.shortName,name:e.name,isPredefined:e.isPredefined||!1,shortName:e.shortName,palette:e.palette,usage:E[e.shortName]||0})))),n.createElement(bt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{onClick:()=>l(To.m.PALETTES)},"Export palettes")))},ai=a(98714);const ni=(e,t)=>e.reduce(((e,a)=>{const n=/^(?<group>[a-z]+)(?<id>[0-9]+)/g.exec(a.id)?.groups?.group;return t===n?[...e,a]:e}),[]);var ri=()=>{const{enableDebug:e,savFrameTypes:t,activePalette:a}=(0,u.A)(),{frames:r,palettes:l,frameGroups:o,addFrames:i,updateFrameGroups:F}=(0,ie.h)(),{updateLastSyncLocalNow:s}=fe(),{downloadSettings:c}=Pe(),m=l.find((({shortName:e})=>e===a))||l[0],d=(0,Io.A)(r,o),[p,g]=(0,n.useState)([]),[h,f]=(0,n.useState)(((e,t)=>{const a=e.find((({id:e})=>e===t));return a?a.id:e[0]?.id||""})(d,t));(0,n.useEffect)((()=>{g(h?ni(r,h):[])}),[r,h]);const E=d.find((({id:e})=>e===h))||d[0];return{selectedFrameGroup:h,groupFrames:p,setSelectedFrameGroup:f,frameGroups:d,exportJson:e=>c(e,h),palette:m?.palette,setActiveFrameGroupName:e=>{F([{...E,name:e}]),s()},activeFrameGroup:E,convertFormat:async()=>{const e=await Promise.all(r.map((async e=>{const t=await(0,ce.mZ)(e.hash);if(!t)return e;const a=t.upper.length/20,n=(0,ai.L2)(t),{dataHash:r}=await(0,ce.Bf)(n,a);if(e.hash===r)return e;const l=await(0,ce.R_)(n,a);return{...e,hash:l}})));i(e)},enableDebug:e}},li=a(56362);var oi=({frameId:e,name:t})=>{const[a,r]=(0,n.useState)([]),[l,o]=(0,n.useState)(2),{setEditFrame:i}=X(),{dismissDialog:F,setDialog:s}=(0,pe.A)(),{frames:c,deleteFrame:u,images:m}=(0,ie.h)(),{updateLastSyncLocalNow:d}=fe(),p=c.find((({id:t})=>t===e))?.hash||"",g=m.filter((({frame:t})=>t===e)).length;return(0,n.useEffect)((()=>{o(2),r([]);(async()=>{if(!p)return;const a=await(0,ce.mZ)(p),n=await(({frameId:e,frameHash:t,name:a})=>{const n=`\n  frameId: ${e}\n\n  ${a}\n\n${t}`;return(0,Cn.A)((0,li.A)(n),t)})({frameId:e,frameHash:p,name:t});o(a?a.upper.length/20:2),r(n)})()}),[e,p,t]),{frameHash:p,tiles:a,imageStartLine:l,usage:g,setTiles:r,deleteFrame:()=>{s({message:`Delete frame "${t}" (${e})?`,confirm:async()=>{F(0),d(),u(e)},deny:async()=>F(0)})},editFrame:()=>i(e)}};var ii=function({deleteFrame:e,editFrame:t,menuAnchor:a,onClose:r}){return a?n.createElement(Ne.A,{open:!!a,anchorEl:a,onClose:r,onClick:e=>{e.stopPropagation(),r()}},n.createElement(Le.A,{onClick:t,title:"Edit"},n.createElement(Ge.A,null,n.createElement(d.A,null)),n.createElement($e.A,null,"Edit")),n.createElement(Le.A,{onClick:e,title:"Delete"},n.createElement(Ge.A,null,n.createElement(Oe.A,null)),n.createElement($e.A,null,"Delete"))):null};var Fi=function({frameId:e,name:t,palette:a}){const{enableDebug:r}=(0,u.A)(),{tiles:l,deleteFrame:o,editFrame:i,frameHash:F,imageStartLine:s,usage:c}=oi({frameId:e,name:t});if(!l)return null;const m=c?`Used ${c} times`:"Not used";return n.createElement(lt,{selectionText:"",title:t,subheader:`(${e}) ${m}`,wrapperProps:{onClick:i,disableRipple:!0,sx:{display:"block",width:"100%",textAlign:"left"}},contextMenuComponent:ii,contextMenuProps:{deleteFrame:o,editFrame:i},media:l.length?n.createElement(re,{lockFrame:!1,invertPalette:!1,palette:a,imageStartLine:s,tiles:l}):n.createElement(oe,null),content:r&&n.createElement(ca,{text:F})})};var si,ci=function(){const{frameGroups:e,selectedFrameGroup:t,setSelectedFrameGroup:a,palette:r,groupFrames:l,exportJson:o,setActiveFrameGroupName:F,activeFrameGroup:s,convertFormat:c,enableDebug:u}=ri();return n.createElement(i.A,{direction:"column",gap:4},n.createElement(Ra.A,{label:"Edit Framegroup",size:"small",select:!0,value:t,onChange:e=>{a(e.target.value)}},e.map((({id:e,name:t})=>n.createElement(Le.A,{key:e,value:e},t)))),s&&n.createElement(Ra.A,{label:"Rename Framegroup",size:"small",type:"text",onChange:e=>F(e.target.value),value:s.name||""}),n.createElement(i.A,{direction:"column",gap:2},n.createElement(At,null),n.createElement(J,null,l?.map((e=>n.createElement(Fi,{frameId:e.id,key:`frame-${e.id}`,name:e.name,palette:r}))))),n.createElement(bt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{onClick:()=>o(To.m.FRAMES)},"Export frames"),n.createElement(w.A,{onClick:()=>o(To.m.CURRENT_FRAMEGROUP)},`Export current framegroup (${t})`),u?n.createElement(w.A,{onClick:c},"Convert frames to new format"):null))};!function(e){e.PERSISTED="persisted",e.NOT_PERSISTED="not-persisted",e.FAILED="failed",e.NO_API="no_api"}(si||(si={}));const ui=!(!navigator.storage||!navigator.storage.persist);var mi=()=>{const[e,t]=(0,n.useState)(si.NOT_PERSISTED);(0,n.useEffect)((()=>{(async e=>{e(ui?await navigator.storage.persisted()?si.PERSISTED:si.NOT_PERSISTED:si.NO_API)})(t)}),[]);return{persistAPIAvailable:ui,persisted:e,requestPersist:async()=>{(async e=>{e(ui?await navigator.storage.persist()?si.PERSISTED:si.FAILED:si.NO_API)})(t)}}},di=a(96763);const pi=async(e,t,a)=>{const n=await(0,Fe.T)(e,t)(a,!1);if(!n)return null;const{dataHash:r}=await(0,Ja.cg)(n);return r!==a?(0,Ja.UN)(n):null};var gi=()=>{const{frames:e,images:t}=(0,ie.h)(),{updateImageHash:r}=fe(),[l,o]=(0,n.useState)(!0);return window.enableHashCleanup=()=>o(!1),{cleanupBusy:l,hashCleanup:async()=>{o(!0);let n=0,l=0;const{default:i}=await Promise.resolve().then(a.t.bind(a,74802,23));await Promise.all(t.map((async a=>{const{hash:o}=a;if((0,it.pl)(a)){const{hashes:l}=a,F=Object.keys(l),s=await Promise.all(F.map((async a=>{const n=l[a];let r=null;return n&&(r=await pi(t,e,n)),{[a]:r||n}}))),c=s.reduce(((e,t)=>({...e,...t})),{}),u=i(c);u!==o&&(n+=1,r(o,{...a,hash:u,hashes:c}))}else{const n=await pi(t,e,o);n&&(l+=1,r(o,{...a,hash:n}))}}))),o(!1),di.info({iCounterRGBN:n,iCounterMono:l})}}};var hi=function(){const{hashCleanup:e,cleanupBusy:t}=gi(),{downloadSettings:a}=Pe(),{resetGroups:r}=Je(),l=e=>a(e),{persisted:o,requestPersist:i}=mi();return n.createElement(bt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{disabled:o!==si.NOT_PERSISTED,onClick:i},(e=>{switch(e){case si.PERSISTED:return"Storage is persistent";case si.NOT_PERSISTED:return"Request storage persistence";case si.NO_API:return"Persistance API not available";case si.FAILED:default:return"Failed to persist storage"}})(o)),n.createElement(w.A,{onClick:r},"Reset image groups"),n.createElement(w.A,{onClick:()=>l(To.m.ALL)},"Export Everything"),n.createElement(w.A,{onClick:()=>l(To.m.PLUGINS)},"Export Plugins"),n.createElement(w.A,{disabled:t,onClick:e},"Hash Cleanup"))},fi=a(23920);const Ei=(0,fi._)(),Ai=["Web-App version: 1.46.1","Web-App branch: master",`Printer version: ${Ei?.version}`,`Max Images: ${Ei?.maximages}`,`Localforage driver: ${Ei?.localforage}`,`Environment type: ${Ei?.env}`,`Compiled Filesystem: ${Ei?.fstype}`,`Compiled Bootmode: ${Ei?.bootmode}`,"Compiled for OLED: "+(Ei?.oled?"yes":"no")],vi=[{path:"/settings/generic",headline:"Generic Settings"},{path:"/settings/git",headline:"Git Settings"},{path:"/settings/plugins",headline:"Plugin Settings"}];vi.push({path:"/settings/dropbox",headline:"Dropbox Settings"}),"esp8266"!==(0,fi._)()?.env&&"webpack-dev"!==(0,fi._)()?.env||vi.push({path:"/settings/wifi",headline:"WiFi Settings"});var bi=function(){const e=(0,r.FE)(),t=e[2]?.pathname;return vi.find((({path:e})=>e===t))?n.createElement(i.A,{direction:"column",gap:4,justifyContent:"space-between",sx:{flexGrow:1}},n.createElement(i.A,{direction:"column",gap:6},n.createElement(Bo.A,{value:t},vi.map((({headline:e,path:t})=>n.createElement(Mo.A,{label:e,key:t,component:r.k2,to:t,value:t})))),n.createElement(y.A,null,n.createElement(r.sv,null)),n.createElement(hi,null)),n.createElement(i.A,{component:"ul",direction:"column"},Ai.map((e=>n.createElement(Fa.A,{key:e,component:"li",variant:"caption",color:"textDisabled",align:"right"},e))))):n.createElement(r.C5,{to:vi[0].path,replace:!0})},yi=a(37007),wi=a.n(yi);class Ci extends(wi()){device;manufacturerName;productName;serialNumber;interfaceNumber;endpointIn;endpointOut;textDecoder;constructor(e){super(),this.device=e,this.manufacturerName=e.manufacturerName||"",this.productName=e.productName||"",this.serialNumber=e.serialNumber||"",this.interfaceNumber=2,this.endpointIn=5,this.endpointOut=4,this.textDecoder=new TextDecoder}connect(){const e=()=>{this.device.transferIn(this.endpointIn,64).then((t=>{this.emit("data",this.textDecoder.decode(t.data)),e()})).catch((e=>{this.emit("error",e)}))};return this.device.open().then((()=>this.device?.selectConfiguration?.(1))).then((()=>{const e=this.device.configuration?.interfaces;e&&e.forEach((e=>{e.alternates.forEach((t=>{255===t.interfaceClass&&(this.interfaceNumber=e.interfaceNumber,t.endpoints.forEach((e=>{"out"===e.direction&&(this.endpointOut=e.endpointNumber),"in"===e.direction&&(this.endpointIn=e.endpointNumber)})))}))}))})).then((()=>this.device.claimInterface(this.interfaceNumber))).then((()=>this.device.selectAlternateInterface(this.interfaceNumber,0))).then((()=>this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:1,index:this.interfaceNumber}))).then((()=>{e()}))}disconnect(){return this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:0,index:this.interfaceNumber}).then((()=>this.device.close()))}send(e){return this.device.transferOut(this.endpointOut,e)}}var Ii=Ci,Si=a(96763);class xi extends(wi()){enabled;activePorts;constructor(){super(),this.enabled=!!navigator.usb&&!!navigator.usb.getDevices,this.activePorts=[],this.watchPorts()}getPorts(){return this.enabled?navigator.usb.getDevices().then((e=>e.filter((({opened:e})=>!e)).map((e=>new Ii(e))))):Promise.resolve([])}getActivePorts(){return this.activePorts}watchPorts(){window.setInterval((()=>{this.getPorts().then((e=>{e.forEach((e=>{e.addListener("error",(t=>{Si.warn(t),this.activePorts=this.activePorts.filter((t=>t!==e)),this.emit("activePortsChange",[...this.activePorts])})),e.addListener("data",(e=>{this.emit("data",e)})),e.connect().then((()=>{this.activePorts.push(e),this.emit("activePortsChange",[...this.activePorts])}))}))}))}),1e3)}requestPort(){if(!this.enabled)return;navigator.usb.requestDevice({filters:[{vendorId:9025,productId:32822},{vendorId:9025,productId:32823},{vendorId:9025,productId:32845},{vendorId:9025,productId:32846},{vendorId:9025,productId:32847},{vendorId:9025,productId:32848},{vendorId:9025,productId:32850},{vendorId:9025,productId:32851},{vendorId:9025,productId:32852},{vendorId:9025,productId:32853},{vendorId:9025,productId:32854},{vendorId:9025,productId:32855},{vendorId:9114}]}).then((e=>{if(e.opened)throw new Error("device already opened");return new Ii(e)})).catch((()=>null)).then((e=>{e&&e.connect().then((()=>{this.activePorts.push(e),this.emit("activePortsChange",[...this.activePorts])}))}))}}var ki=new xi;var Pi=()=>{const{handleFileImport:e}=ko();return(0,n.useCallback)((t=>{const a=new File([...t],"Text input.txt",{type:"text/plain"});e([a])}),[e])};var Ti=e=>{const t=ki.enabled,a=Pi(),[r,l]=(0,n.useState)([]),[o,i]=(0,n.useState)(!1),F=(0,n.useRef)(""),s=(0,n.useRef)();(0,n.useEffect)((()=>{if(!ki.enabled)return()=>{};const t=e=>{window.clearTimeout(s.current),s.current=window.setTimeout((()=>{i(!1),a(F.current),F.current=""}),1e3),i(!0),F.current=`${F.current}${e}`};return l(ki.getActivePorts()),ki.addListener("activePortsChange",l),e||ki.addListener("data",t),()=>{ki.removeListener("activePortsChange",l),ki.removeListener("data",t)}}),[a,e]);return{activePorts:r,webUSBEnabled:t,openWebUSBSerial:()=>{ki.enabled&&ki.requestPort()},isReceiving:o}};class Di extends(wi()){device;baudRate;usbProductId;usbVendorId;reader;constructor({device:e,baudRate:t}){super(),this.device=e,this.baudRate=t;const{usbProductId:a,usbVendorId:n}=e.getInfo();this.usbProductId=a,this.usbVendorId=n,this.reader=null}connect(){const e=()=>{this.reader?.read().then((({value:t})=>{this.emit("data",t),e()})).catch((e=>{this.emit("error",e)}))};return this.device.open({baudRate:this.baudRate}).then((()=>{const t=new window.TextDecoderStream;this.device.readable.pipeTo(t.writable),this.reader=t.readable.getReader(),e()}))}}var Mi=Di,Bi=a(96763);class Ri extends(wi()){enabled;activePorts;baudRate;constructor(){super(),this.enabled=!!navigator.serial&&!!window.TextDecoderStream,this.activePorts=[],this.baudRate=115200,this.watchPorts()}getPorts(){return this.enabled?navigator.serial.getPorts().then((e=>e.filter((({readable:e})=>!e)).map((e=>new Mi({device:e,baudRate:this.baudRate}))))):Promise.resolve([])}getActivePorts(){return this.activePorts}watchPorts(){window.setInterval((()=>{this.getPorts().then((e=>{e.forEach((e=>{e.addListener("error",(t=>{Bi.warn(t),this.activePorts=this.activePorts.filter((t=>t!==e)),this.emit("activePortsChange",[...this.activePorts])})),e.addListener("data",(e=>{this.emit("data",e)})),e.connect().then((()=>{this.activePorts.push(e),this.emit("activePortsChange",[...this.activePorts])})).catch((()=>{}))}))}))}),1e3)}requestPort(){this.enabled&&navigator.serial.requestPort().then((e=>{if(e.readable)throw new Error("device already opened");return new Mi({device:e,baudRate:this.baudRate})})).catch((()=>null)).then((e=>{e&&e.connect().then((()=>{this.activePorts.push(e),this.emit("activePortsChange",[...this.activePorts])}))}))}}var Ni=new Ri;var Li=e=>{const t=Ni.enabled,a=Pi(),[r,l]=(0,n.useState)([]),[o,i]=(0,n.useState)(!1),F=(0,n.useRef)(""),s=(0,n.useRef)();(0,n.useEffect)((()=>{if(!Ni.enabled)return()=>{};const t=e=>{window.clearTimeout(s.current),s.current=window.setTimeout((()=>{i(!1),a(F.current),F.current=""}),1e3),i(!0),F.current=`${F.current}${e}`};return l(Ni.getActivePorts()),Ni.addListener("activePortsChange",l),e||Ni.addListener("data",t),()=>{Ni.removeListener("activePortsChange",l),Ni.removeListener("data",t)}}),[a,e]);return{activePorts:r,webSerialEnabled:t,openWebSerial:()=>{Ni.enabled&&Ni.requestPort()},isReceiving:o}};var Gi=()=>{const{useSerials:e}=(0,u.A)(),{showSerials:t,setShowSerials:a}=(0,he.A)();return{lightBoxOpen:t&&e,hideSerials:()=>a(!1)}};var $i=function({inline:e,passive:t}){const{activePorts:a,isReceiving:r,webUSBEnabled:l,openWebUSBSerial:o}=Ti(t||!1),{activePorts:F,isReceiving:s,webSerialEnabled:c,openWebSerial:u}=Li(t||!1),{lightBoxOpen:m,hideSerials:d}=Gi(),p=n.createElement(i.A,{direction:{xs:"column",md:e?"row":"column"},gap:4,sx:{"& > *":{flex:1}}},n.createElement(i.A,{direction:"column",gap:1},n.createElement(w.A,{title:"Open WebUSB device",onClick:o,disabled:!l,loading:r,loadingPosition:"start",variant:"contained",color:"secondary"},"Open WebUSB device",r?" (receiving)":null),n.createElement(Fa.A,{variant:"body2"},`Connected devices (${a.length}):`),n.createElement("ul",null,a.map((({productName:e},t)=>n.createElement("li",{key:t},e))))),n.createElement(i.A,{direction:"column",gap:1},n.createElement(w.A,{title:"Open Web Serial device",onClick:u,disabled:!c,loading:s,loadingPosition:"start",variant:"contained",color:"secondary"},"Open Web Serial device",s?" (receiving)":null),n.createElement(Fa.A,{variant:"body2"},`${F.length} devices connected`)));return e?p:m||r||s?n.createElement(M,{header:"WebUSB / Serial devices",confirm:d,canConfirm:!r&&!s},p):null},Oi=a(87788),_i=a(76320);var ji=function(){const{useSerials:e,setUseSerials:t}=(0,u.A)();return n.createElement(Oi.A,{label:"Enable WebUSB / Serial ports",control:n.createElement(_i.A,{checked:e,onChange:({target:e})=>{t(e.checked)}})})};var Vi=function(){const{useSerials:e}=(0,u.A)();return n.createElement(i.A,{direction:"column",gap:4},n.createElement(ji,null),e?n.createElement(n.Fragment,null,n.createElement($i,{inline:!0,passive:!0}),n.createElement(s,{getMarkdown:async()=>{const{default:e}=await a.e(3119).then(a.bind(a,70525));return e}}),n.createElement(i.A,{direction:{xs:"column",md:"row"},gap:4,sx:{"& > *":{flex:1}}},n.createElement(Oa.A,{severity:Ni.enabled?"success":"warning",variant:"filled"},Ni.enabled?"Your current browser/device does support Web Serial":"Your current browser/device does not support Web Serial"),n.createElement(Oa.A,{severity:ki.enabled?"success":"warning",variant:"filled"},ki.enabled?"Your current browser/device does support WebUSB":"Your current browser/device does not support WebUSB"))):null)},Ui=a(94852);const zi=["https://herrzatacke.github.io","https://localhost:5000","https://127.0.01:5000","http://localhost:5000","http://127.0.01:5000"];var Wi=function(){const{url:e,source:t,isTrusted:a,pending:l,pluginExists:o,addPlugin:F}=(()=>{const e=(0,r.g)().pluginUrl||"",[t,a]=(0,n.useState)(!1),l=(0,Ui.vx)(e),{plugins:o}=(0,ie.h)(),{setError:i}=(0,he.A)(),{validateAndAddPlugin:F}=Dt(),s=(0,r.Zp)(),c=zi.some((e=>{const t=(0,Ui.vx)(e);return t.protocol===l.protocol&&t.host===l.host})),u=o.some((t=>t.url===e)),m=(0,n.useCallback)((async()=>{a(!0),s("/settings/plugins",{replace:!0}),await F({url:e})||i(new Error("Could not install plugin."))}),[s,i,e,F]);return{url:e,pending:t,pluginExists:u,source:`${l.protocol}//${l.host}`,isTrusted:c,addPlugin:m}})();return e?l?null:n.createElement(i.A,{direction:"column",gap:4},a?null:n.createElement(Oa.A,{severity:"error",variant:"filled"},`The source "${t}" of this plugin is not trusted!!`),o?n.createElement(n.Fragment,null,n.createElement(Oa.A,{severity:"warning",variant:"filled"},`The plugin "${e}" is already installed`),n.createElement(h.A,{component:r.N_,to:"/settings/plugins"},"Go to plugins")):n.createElement(n.Fragment,null,n.createElement(Oa.A,{severity:a?"success":"warning",variant:"filled"},`This will add ${e} to your plugins.`),n.createElement(y.A,null,n.createElement(w.A,{color:a?"success":"warning",variant:"contained",sx:{fontSize:20,px:8,py:2,mx:"auto",display:"block"},disabled:o,onClick:F},"Add")))):n.createElement(r.C5,{to:"/settings/plugins",replace:!0})},Hi=a(66423),Xi=a(88868),Yi=a(46446),Qi=a(5744),Ki=a(62143),qi=a(15548),Zi=a(30433),Ji=a(13129),eF=a(30073),tF=a(7527),aF=a(95884),nF=a(42215),rF=a(17095),lF=a(96224),oF=a(44212);var iF=()=>{const{gitStorage:e,dropboxStorage:t}=(0,ue.A)(),a=t.autoDropboxSync||!1,n=!!(t.use||e.use&&e.owner&&e.repo&&e.branch&&e.throttle&&e.token),{syncBusy:r,setSyncSelect:l,setShowSerials:o}=(0,he.A)(),{useSerials:i}=(0,u.A)(),{syncLastUpdate:F}=(0,ue.A)();return{disableSerials:!ki.enabled&&!Ni.enabled,syncBusy:r,useSync:n,useSerials:i,syncLastUpdate:F,autoDropboxSync:a,selectSync:()=>l(!0),setShowSerials:()=>o(!0)}},FF=a(98254),sF=a(1642);const cF={htmlInput:{autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1},inputLabel:{shrink:!0},fullWidth:!0,size:"small"},uF=e=>({styleOverrides:{root:{fontSize:"13px",textTransform:"none",minHeight:"40px"}},variants:[...["primary","secondary","tertiary"].map((t=>({props:{color:t},style:{"&.MuiButton-outlined":{color:e.palette[t].light,borderColor:e.palette[t].light}}})))]}),mF=e=>({styleOverrides:{grouped:{variants:[...["primary","secondary","tertiary"].map((t=>({props:{color:t},style:{"&.Mui-selected":{background:e.palette[t].main,color:e.palette[t].contrastText,"&:hover":{backgroundColor:(0,b.X4)(e.palette[t].main,.7)}},"&:hover":{backgroundColor:(0,b.X4)(e.palette[t].main,.4)}}})))]}},defaultProps:{color:"tertiary"}}),dF=e=>({root:{background:"dark"===e.palette.mode?"#000000":"#ffffff",color:"dark"===e.palette.mode?"#ffffff":"#000000",".MuiInputBase-inputMultiline":{fontSize:"13px",lineHeight:"16px",fontFamily:"monospace"},".MuiOutlinedInput-notchedOutline legend span":{display:"none"}}}),pF=e=>({root:{fontSize:16,textTransform:"none",minHeight:60,"&.Mui-selected":{backgroundColor:(0,b.X4)(e.palette.primary.main,.2),color:"inherit"},"&:hover":{backgroundColor:(0,b.X4)(e.palette.secondary.main,.35)}}}),gF=e=>({styleOverrides:{root:{}},variants:[...["primary","secondary"].map((t=>({props:{color:t},style:{"--AppBar-background":e.palette[t].dark,"--AppBar-color":e.palette[t].contrastText,"& .MuiButton-root.active":{backgroundColor:e.palette["primary"===t?"secondary":"primary"].main},"& .MuiButton-root:hover":{backgroundColor:e.palette[t].light,color:e.palette[t].contrastText},"& .MuiIconButton-root:hover":{backgroundColor:e.palette[t].light,color:e.palette[t].contrastText}}})))]}),hF=e=>({root:{[e.breakpoints.up("xs")]:{minHeight:"var(--navigation-height)"},justifyContent:"end","& .MuiButton-root":{height:"var(--navigation-height)",padding:"0 20px",fontSize:e.typography.body1.fontSize},"& .MuiButtonGroup-horizontal":{paddingRight:"8px"},"& .MuiSvgIcon-root":{fontSize:"1.8rem"}}}),fF=e=>({root:{backgroundColor:e.palette.primary[e.palette.mode],color:e.palette.primary.contrastText,"&& + .MuiDialogContent-root":{padding:e.spacing(2)}}}),EF=e=>({root:{"&~.MuiTabPanel-root":{padding:0,marginTop:e.spacing(2)},"& .MuiTabScrollButton-root.Mui-disabled":{opacity:.25}}}),AF=e=>({root:{"&.Mui-selected":{backgroundColor:(0,b.X4)(e.palette.secondary.main,.8),color:e.palette.secondary.contrastText,"&:hover,&.Mui-focusVisible":{backgroundColor:e.palette.secondary.main}}}}),vF=e=>({MuiButton:uF(e),MuiToggleButtonGroup:mF(e),MuiAppBar:gF(e),MuiOutlinedInput:{styleOverrides:dF(e)},MuiPaper:{styleOverrides:{root:{backgroundImage:"none"}}},MuiTab:{styleOverrides:pF(e)},MuiTabs:{styleOverrides:EF(e),defaultProps:{scrollButtons:"auto",indicatorColor:"secondary",variant:"scrollable"}},MuiInputLabel:{styleOverrides:{root:{transform:"translate(14px, 25px) scale(1)","&.MuiInputLabel-shrink":{transform:"translate(2px, -12px) scale(1)"}}}},MuiFormControl:{styleOverrides:{root:{paddingTop:16,".MuiStack-root &:first-of-type":{marginTop:12}}}},MuiCardContent:{styleOverrides:{root:{padding:"24px 16px"}}},MuiToolbar:{styleOverrides:hF(e)},MuiLink:{styleOverrides:{root:{color:"inherit"}}},MuiDialogTitle:{styleOverrides:fF(e)},MuiSwitch:{defaultProps:{color:"tertiary"}},MuiTextField:{defaultProps:{color:"tertiary",slotProps:cF}},MuiSelect:{styleOverrides:{select:{display:"flex",".MuiListItemIcon-root":{minWidth:32,flexDirection:"column",justifyContent:"center"}}},defaultProps:{displayEmpty:!0}},MuiList:{styleOverrides:{root:{".MuiListSubheader-root":{display:"flex",".MuiListItemIcon-root":{minWidth:32,flexDirection:"column",justifyContent:"center"}}}}},MuiMenuItem:{styleOverrides:AF(e)},MuiCardActionArea:{styleOverrides:{root:{height:"100%",".MuiCardActionArea-focusHighlight":{background:"transparent"}}}}}),bF=({mode:e,colorPrimary:t,colorSecondary:a,colorTertiary:n,colorSuccess:r,colorWarn:l,colorError:o,colorPageBackground:i,colorText:F})=>{const s=(0,sF.A)({shape:{borderRadius:0},breakpoints:{values:{xs:0,sm:570,md:768,lg:1024,xl:1264}},typography:{fontFamily:'"Trebuchet MS", Helvetica, sans-serif',body1:{fontSize:16},body2:{fontSize:13},h1:{fontSize:30,fontWeight:"bold"},h2:{fontSize:24,fontWeight:"bold"},h3:{fontSize:20,fontWeight:"bold"},h4:{fontSize:18,fontWeight:"bold"}},palette:{mode:e,primary:{main:t},secondary:{main:a},success:{main:r},warning:{main:l},error:{main:o},background:{default:i,paper:(0,b.a)(i,"light"===e?.6:.02)}}}),c=(0,sF.A)(s,{palette:{tertiary:s.palette.augmentColor({color:{main:n},name:"tertiary"}),fgtext:s.palette.augmentColor({color:{main:F},name:"fgtext"}),bg:s.palette.augmentColor({color:{main:i},name:"bg"}),text:{primary:F,secondary:F}}}),u=(0,b.au)(c.palette.primary.main,F,.7);return(0,sF.A)(c,{typography:{fontFamily:'"Trebuchet MS", Helvetica, sans-serif',body1:{color:F},body2:{color:F},h1:{color:u},h2:{color:u},h3:{color:u},h4:{color:u}},components:vF(c)})},yF={colorInfo:"#3f769e",colorSuccess:"#3f9e7c",colorWarn:"#8b7b2c",colorError:"#cb0003",colorPrimary:"#503281",colorSecondary:"#455c63",colorTertiary:"#4a6959"},wF=bF({mode:"dark",colorPageBackground:"#2a292b",colorText:"#b2b2b2",...yF}),CF=bF({mode:"light",colorPageBackground:"#d6d3dc",colorText:"#333333",...yF}),IF=document.body;var SF=function(){const[e,t]=(0,n.useState)(!1),{lastGalleryLink:a}=$(),{pathname:l}=(0,r.zy)(),{themeName:o,setThemeName:i}=(0,u.A)(),{disableSerials:F,syncBusy:s,useSync:c,useSerials:m,syncLastUpdate:d,autoDropboxSync:p,selectSync:h,setShowSerials:f}=iF(),{showTrashCount:E,trashCount:A}=(0,he.A)(),v=(0,n.useMemo)((()=>A.frames+A.images),[A]),y=(0,n.useMemo)((()=>p&&d.local!==d.dropbox),[p,d]),I=(0,n.useMemo)((()=>d.local>d.dropbox?"There are local changes not synched to dropbox yet":"There are remote changes not synched yet"),[d]),S=(0,n.useMemo)((()=>[{label:"Home",route:"/home"},{label:"Gallery",route:a&&l!==a?a:"/gallery/page/1"},{label:"Import",route:"/import"},{label:"Palettes",route:"/palettes"},{label:"Frames",route:"/frames"},{label:"Settings",route:"/settings"}].reduce(bo.N,[])),[a,l]),x=(0,n.useMemo)((()=>[{title:"Trash",icon:n.createElement(Oe.A,null),badgeContent:v>0?v.toString(10):null,disabled:!1,onClick:()=>E(!0)},c?{title:I,icon:n.createElement(rF.A,null),badgeContent:y?"!":null,disabled:s,onClick:h}:null,{title:o===FF.V.BRIGHT?"Switch to dark mode":"Switch to bright mode",icon:o===FF.V.BRIGHT?n.createElement(Ji.A,null):n.createElement(Ki.A,null),badgeContent:null,disabled:!1,onClick:()=>i(o===FF.V.BRIGHT?FF.V.DARK:FF.V.BRIGHT)},m?{title:F?"USB devices are disabled":"WebUSB Serial devices",icon:n.createElement(oF.A,null),badgeContent:null,disabled:F,onClick:f}:null].reduce(bo.N,[])),[F,h,f,i,E,s,y,I,o,v,m,c]);return n.createElement(n.Fragment,null,n.createElement(Yi.A,{theme:CF},n.createElement(Qi.A,{color:"primary",enableColorOnDark:!0,position:"sticky"},n.createElement(Hi.A,{maxWidth:"xl",disableGutters:!0},n.createElement(lF.A,{disableGutters:!0},n.createElement(bt.A,{variant:"text",component:"nav",role:"navigation","aria-label":"Main Navigation",sx:{display:{xs:"none",md:"inline-flex"},width:"100%"}},S.map((({route:e,label:a})=>n.createElement(w.A,{key:e,to:e,component:r.k2,color:"inherit",onClick:()=>t(!1)},a)))),n.createElement(bt.A,{variant:"text",role:"navigation","aria-label":"Utility Navigation"},x.map((({title:e,icon:t,onClick:a,badgeContent:r})=>n.createElement(g.A,{key:e,color:"inherit",title:e,onClick:a},n.createElement(vt.A,{badgeContent:r,color:"error",anchorOrigin:{vertical:"bottom",horizontal:"right"}},t)))),n.createElement(g.A,{color:"inherit",title:"Open Main Navigation",onClick:()=>t(!0),sx:{display:{md:"none"}}},n.createElement(nF.A,null))))))),n.createElement(Zi.Ay,{container:IF,variant:"temporary",open:e,onClose:()=>t(!1),ModalProps:{keepMounted:!0},sx:e=>({display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{width:{xs:"100%",sm:e.breakpoints.values.sm}}})},n.createElement(lF.A,{disableGutters:!0},n.createElement(bt.A,{variant:"text",sx:{display:{md:"none"}}},n.createElement(g.A,{color:"inherit",title:"Close Main Navigation",onClick:()=>t(!1)},n.createElement(C.A,null)))),n.createElement(qi.A,null),n.createElement(eF.A,null,S.map((({route:e,label:a})=>n.createElement(tF.Ay,{key:e,disablePadding:!0},n.createElement(aF.A,{to:e,component:r.k2,onClick:()=>t(!1),sx:e=>({"&.active":{background:e.palette.secondary.light,color:e.palette.secondary.contrastText},"&:hover":{background:(0,b.X4)(e.palette.primary.main,.3)}})},n.createElement($e.A,{primary:a}))))))))},xF=a(43522),kF=a.n(xF),PF=a(72051),TF=a(88225),DF=a(1812);Ue().extend(kF());var MF=function(){const{git:{messages:e,repoUrl:t,repo:a,branch:r},dropbox:{messages:l,path:o},confirm:F}=(()=>{const{progressLog:e,resetProgressLog:t}=(0,he.A)(),{gitStorage:a,dropboxStorage:n}=(0,ue.A)();return{git:{messages:e.git||[],repoUrl:`https://github.com/${a.owner}/${a.repo}/tree/${a.branch}`,repo:a.repo,branch:a.branch},dropbox:{messages:e.dropbox||[],path:n.path||""},confirm:t}})(),[s,c]=(0,n.useState)(!0),u=e.length>0,m=l.length>0,{timestamp:d}=e[e.length-1]||{},{timestamp:p,message:g}=e[0]||{},{timestamp:h}=l[l.length-1]||{},{timestamp:f,message:E}=l[0]||{},A="."===g||"."===E,v=u?d:h,b=u?p:f,C=(0,n.useMemo)((()=>[...e,...l].filter((({message:e})=>"."!==e))),[l,e]),I=(0,n.useMemo)((()=>C.filter(((e,t)=>!s||t<15))),[s,C]);return e.length||l.length?n.createElement(M,{header:`${A?"✔️ Update done":"⏳ Updating..."} ${u?` - "${a}/${r}"`:""}`,confirm:A?F:void 0},n.createElement(i.A,{direction:"column",gap:2},n.createElement(y.A,{component:"ul",sx:{overflowX:"hidden",overflowY:"auto",maxHeight:"30vh","& > .MuiTypography-root":{whiteSpace:"nowrap"}}},I.map((({message:e,timestamp:t},a)=>n.createElement(Fa.A,{key:a,variant:"caption",component:"li",title:Ue().unix(t).format("HH:mm:ss")},e)))),C.length>15&&n.createElement(w.A,{variant:"outlined",color:"secondary",onClick:()=>c(!s),endIcon:s?n.createElement(DF.A,null):n.createElement(TF.A,null)},s?`Show all ${C.length} messages`:"Reduce messages"),n.createElement(i.A,{direction:"column",gap:0},n.createElement(Fa.A,{variant:"caption"},`Started at: ${Ue().unix(v).format("HH:mm:ss")}`),n.createElement(Fa.A,{variant:"caption"},`${A?"Finished after":"Running for"}: ${Ue().duration(b-v,"seconds").format("HH:mm:ss")}`)),u&&n.createElement(w.A,{variant:"outlined",component:"a",color:"secondary",startIcon:n.createElement(PF.A,null),title:t,href:t,target:"_blank",rel:"noreferrer"},"Open GitHub Repository"),m&&n.createElement(w.A,{variant:"outlined",component:"a",color:"secondary",title:`Open Dropbox folder:\nhttps://www.dropbox.com/home/Apps/GameBoyPrinter/${o}`,href:`https://www.dropbox.com/home/Apps/GameBoyPrinter/${o}`,target:"_blank",rel:"noreferrer"},"Open Dropbox folder"))):null};var BF=function(){const{message:e,progress:t}=(()=>{const{progress:e}=(0,he.A)();return e.gif?{progress:e.gif,message:"Creating GIF animation..."}:e.plugin?{progress:e.plugin,message:"Executing plugin..."}:e.printer?{progress:e.printer,message:"Fetching images from printer..."}:{progress:0,message:""}})();return t>0&&n.createElement(M,{header:e},n.createElement(fa.A,{variant:"determinate",value:100*t,color:"secondary"}))};var RF=()=>{const{dialogs:e}=(0,pe.A)(),t=e[0],{questions:a}=t,[r,l]=(0,n.useState)((e=>e?e({}).reduce(((e,t)=>{const{key:a}=t;let n;switch(t.type){case je.V.SELECT:{const e={...t};n=e.options?.find((({selected:e})=>e))?.value||"";break}case je.V.CHECKBOX:n=!1;break;case je.V.TEXT:n=t.initialValue||"";break;case je.V.NUMBER:n=0;break;case je.V.INFO:default:return e}return{...e,[a]:n}}),{}):{})(a));return{message:t.message,confirm:()=>t.confirm(r),deny:t.deny,questions:a?a(r):[],values:r,setSelected:e=>{l({...r,...e})}}};var NF=function({hash:e,hashes:t,meta:a}){const r={...a,hash:e},l=Object.keys(r).reduce(((e,t)=>{let a;a="number"!=typeof r[t]&&"string"!=typeof r[t]?JSON.stringify(r[t]):r[t];return[...e,{key:t,value:a}]}),[]);if(t){const e=Object.keys(t).reduce(((e,a)=>[...e,{key:`hash ${a}`,value:t[a]}]),[]);l.push(...e)}return n.createElement(za.A,null,n.createElement(ja.A,{padding:"none",sx:{fontFamily:"monospace"}},n.createElement(Va.A,null,l.map((({key:e,value:t})=>n.createElement(Ha.A,{key:e},n.createElement(Ua.A,{component:"th",scope:"row"},e),n.createElement(Ua.A,{align:"right"},t)))))))};var LF=function(){const{message:e,questions:t,values:a,setSelected:r,confirm:l,deny:o}=RF();return n.createElement(M,{confirm:l,deny:o,header:e,headerOnly:!t.length},n.createElement(i.A,{direction:"column",gap:2},t.map((e=>{switch(e.type){case je.V.SELECT:{const{label:t,key:l,options:o,disabled:i=!1}=e;return n.createElement(Ra.A,{key:l,select:!0,disabled:i,size:"small",value:a[l]||"",label:t,onChange:e=>r({[l]:e.target.value})},o.map((({value:e,name:t})=>n.createElement(Le.A,{value:e,key:e},t))))}case je.V.TEXT:{const{label:t,key:l,disabled:o=!1}=e;return n.createElement(Ra.A,{key:l,disabled:o,size:"small",value:a[l]||"",label:t,onChange:e=>r({[l]:e.target.value})})}case je.V.NUMBER:{const{label:t,key:l,min:o,max:i,disabled:F=!1}=e;return n.createElement(Ra.A,{key:l,disabled:F,size:"small",value:a[l]||"",type:"number",label:t,slotProps:{htmlInput:{min:o,max:i}},onChange:e=>r({[l]:e.target.value})})}case je.V.CHECKBOX:{const{label:t,key:l,disabled:o=!1}=e;return n.createElement(Oi.A,{key:l,disabled:o,label:t,control:n.createElement(_i.A,{checked:a[l],onChange:({target:e})=>{r({[l]:e.checked})}})})}case je.V.INFO:{const{label:t,key:a,severity:r}=e;return r?n.createElement(Oa.A,{severity:r,key:a,variant:"filled"},t):n.createElement(Fa.A,{key:a},t)}case je.V.IMAGE:{const{label:t,key:a,src:r}=e;return n.createElement(y.A,{component:"img",key:a,src:r,alt:t,title:t,sx:{imageRendering:"pixelated"}})}case je.V.META:{const{key:t,meta:a}=e;return n.createElement(NF,{key:t,hash:a.hash,meta:a?.meta,hashes:a?.hashes})}default:return null}}))))},GF=a(92454),$F=a(65836),OF=a(82586),_F=a(6481),jF=a(85268),VF=a(22730);var UF=function({frame:e,updateFrame:t,noFrameOption:a,updateFrameLock:r,lockFrame:l,selectLabel:o}){const{frames:F,frameGroups:s}=(0,ie.h)(),c=(0,n.useMemo)((()=>s.map((e=>{const t=ni(F,e.id);return 0===t.length?[]:[{id:e.id,name:e.name,isGroup:!0},...t.map((({id:e,name:t})=>({id:e,name:t,isGroup:!1})))]})).flat()),[s,F]);return n.createElement(i.A,{direction:"column",gap:2},n.createElement(Ra.A,{label:o||"Frame",select:!0,size:"small",value:e,onChange:e=>{t(e.target.value)}},n.createElement(Le.A,{value:""},a||"As imported / No frame"),c.map((({id:e,name:t,isGroup:a})=>a?n.createElement(VF.A,{key:e},n.createElement(Ge.A,null,n.createElement(jF.A,null)),n.createElement($e.A,null,`${t} (${e})`)):n.createElement(Le.A,{key:e,value:e},t)))),"function"==typeof r?n.createElement(Oi.A,{label:"Use separate color settings for frame",control:n.createElement(_i.A,{checked:l,onChange:({target:e})=>{r(e.checked)}})}):null)},zF=a(10777);const WF=[{id:te.Nx.NORMAL,label:"Normal (ignore neutral layer)"},{id:te.Nx.NORMAL_S,label:"Normal ⇵ (only neutral layer)"},{id:te.Nx.LIGHTEN,label:"Lighten"},{id:te.Nx.SCREEN,label:"Screen"},{id:te.Nx.DODGE,label:"Dodge"},{id:te.Nx.ADDITION,label:"Addition"},{id:te.Nx.DARKEN,label:"Darken"},{id:te.Nx.MULTIPLY,label:"Multiply"},{id:te.Nx.BURN,label:"Burn"},{id:te.Nx.OVERLAY,label:"Overlay"},{id:te.Nx.SOFTLIGHT,label:"Soft light"},{id:te.Nx.HARDLIGHT,label:"Hard light"},{id:te.Nx.DIFFERENCE,label:"Difference"},{id:te.Nx.EXCLUSION,label:"Exclusion"}];var HF=a(23668),XF=a(13271);var YF=function({color:e,onChange:t,values:a}){const r=(0,n.useMemo)((()=>{switch(e){case"r":return"#ff0000";case"g":return"#00dd00";case"b":return"#0000ff";default:return"#888888"}}),[e]);return n.createElement(i.A,{direction:"row",gap:2,alignItems:"center",sx:{pr:2}},n.createElement(g.A,{title:"Reset",onClick:()=>{t([0,85,170,255])}},n.createElement(HF.A,null)),n.createElement(XF.Ay,{min:0,max:255,value:a,sx:{color:r},defaultValue:[0,85,170,255],onChange:(e,a)=>{t(a)},disableSwap:!0}))};var QF=function(e){const[t,a]=(0,n.useState)(e.values),r=(0,zF.A)((t=>{e.onChange(t,!0)}),150,{leading:!0,trailing:!0}),l=(e,n)=>{const l={...t,[e]:n};a(l),r.callback(l)},o=["r","g","b","n"].reduce(((t,a)=>e.useChannels[a]?[...t,a]:t),[]);return n.createElement(i.A,{direction:"column",gap:3},o.map((e=>n.createElement(i.A,{key:`slider-${e}`,direction:"column",gap:0},"n"===e?n.createElement(Ra.A,{value:t.blend,label:"Neutral Layer Blendmode",select:!0,size:"small",onChange:e=>{l("blend",e.target.value)}},WF.map((({id:e,label:t})=>n.createElement(Le.A,{key:e,value:e},t)))):null,n.createElement(YF,{color:e,values:t[e],onChange:t=>{l(e,t)}})))))};var KF=function({palette:e,fontSize:t}){return n.createElement(y.A,{sx:{display:"inline-block",fontSize:t||"2rem",width:"1em",height:"1em",lineHeight:"1em",verticalAlign:"middle",borderRadius:"50%",...Wo(e,zo.CONIC),"&:hover":{animation:"spin 800ms infinite linear"}}})};var qF=function({value:e,allowEmpty:t,invertPalette:a,noFancy:r,onChange:l,updateInvertPalette:o}){const[F,s]=(0,n.useState)(e),{palettes:c}=(0,ie.h)(),u=(0,v.A)(),{sortFn:m}=Jo(),d=[...c].sort(m);return t&&d.unshift({shortName:"",name:"As selected per image",palette:[],isPredefined:!1,origin:""}),n.createElement(i.A,{direction:"column",gap:2},n.createElement(Ra.A,{value:e,label:"Palette",size:"small",select:!0,onChange:e=>{l(e.target.value,!0),s(e.target.value)}},d.map((({shortName:e,name:t,palette:a})=>n.createElement(Le.A,{key:e,value:e},n.createElement(Ge.A,null,n.createElement(KF,{palette:a,fontSize:"1.5rem"})),n.createElement($e.A,null,t))))),o?n.createElement(Oi.A,{label:"Invert Palette",control:n.createElement(_i.A,{checked:a,onChange:({target:e})=>{o(e.checked)}})}):null,r?null:n.createElement(y.A,{component:"ul",sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, 2.5rem)",justifyContent:"center",gap:.25,button:{padding:0,cursor:"pointer",width:"2.5rem",height:"2.5rem",border:"none",borderRadius:"50%"}}},d.map((({shortName:e,name:t,palette:a})=>n.createElement(y.A,{component:"li",key:e},n.createElement("button",{type:"button",title:t,style:{background:e===F?u.palette.tertiary.main:"transparent"},onMouseEnter:()=>{l(e,!1)},onMouseLeave:()=>{l(F,!1)},onClick:()=>{l(e,!0),s(e)}},n.createElement(KF,{palette:a})))))))},ZF=a(82077),JF=a(42149),es=a(88824),ts=a(78670),as=a(16014);var ns=function({children:e}){const t=(0,v.A)(),a=(0,n.useMemo)((()=>{if(!t.components?.MuiTextField)return t;const e={...t.components.MuiTextField};return e.defaultProps?.slotProps?.htmlInput&&delete e.defaultProps.slotProps.htmlInput,{...t,components:{...t.components,MuiTextField:e}}}),[t]);return n.createElement(Yi.A,{theme:a},e)};const rs=e=>(0,U.A)(e.map((({tags:e})=>e)).flat()).filter((e=>e!==Me.X3.FILTER_FAVOURITE)).sort(((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase()))),ls=()=>{const{images:e}=(0,ie.h)(),[t,a]=(0,n.useState)(rs(e));return(0,n.useEffect)((()=>{a(rs(e))}),[e]),{availableTags:t}};var os;!function(e){e.ADD="add",e.REMOVE="remove"}(os||(os={}));var is=(e,{mode:t,tag:a})=>{switch(t){case"add":return{add:[...e.add,a],remove:[...e.remove.filter((e=>e!==a))]};case"remove":return{remove:[...e.remove,a],add:[...e.add.filter((e=>e!==a))]};default:return e}};var Fs=function({updateTags:e,selectedTags:t}){const{availableTags:a}=ls(),r=a.filter((e=>!t.includes(e))),[l,o]=(0,n.useState)("");return n.createElement(ns,null,n.createElement(as.A,{options:r,fullWidth:!0,size:"small",inputValue:l,renderInput:e=>n.createElement(Ra.A,{...e,label:"Tags"}),clearOnBlur:!0,clearOnEscape:!0,freeSolo:!0,onInputChange:(e,t,a)=>{switch(a){case"input":o(t||"");break;case"reset":case"clear":case"blur":o("")}},onChange:(t,a,n)=>{const r=a||"";switch(n){case"createOption":case"selectOption":e(os.ADD,r.trim())}}}))};var ss=function({tags:e,updateTags:t,resetTags:a}){const r=(0,U.A)([...e.initial,...e.add]);return n.createElement(i.A,{direction:"column",gap:2},n.createElement(Fs,{updateTags:t,selectedTags:r}),r.length>0&&n.createElement(i.A,{direction:"row",gap:1,flexWrap:"wrap",alignItems:"center",sx:{".MuiChip-root":{my:"1px"}}},r.map((a=>{const r=e.add.includes(a),l=e.remove.includes(a);let o;return o=r?"success":l?"error":"default",n.createElement(De.A,{key:a,label:n.createElement(i.A,{direction:"row",gap:1,alignItems:"center"},a===Me.X3.FILTER_FAVOURITE?"❤️":a,n.createElement(i.A,{direction:"row",gap:0,sx:{mr:-1,".MuiButtonBase-root":{opacity:.4,borderRadius:"50%","&:hover":{opacity:1},"&:focus-visible":{opacity:1,background:"color-mix(in srgb, currentColor 20%, transparent)"}}}},n.createElement(JF.A,{onClick:()=>t(os.ADD,a)},n.createElement(ZF.A,null)),n.createElement(JF.A,{onClick:()=>t(os.REMOVE,a)},n.createElement(es.A,null)))),color:o,variant:"filled"})})),e.add.length+e.remove.length>0&&n.createElement(g.A,{onClick:a,title:"Reset tags",size:"small"},n.createElement(ts.A,null))))},cs=a(22982),us=a(75737),ms=a(44843),ds=a(91799),ps=a(80688);const gs=[te.pL.DEG_0,te.pL.DEG_90,te.pL.DEG_180,te.pL.DEG_270];var hs,fs=function({created:e,hash:t,hashes:r,updateCreated:l,meta:o,rotation:F,updateRotation:s}){const{preferredLocale:c}=(0,u.A)(),[m,d]=(0,n.useState)(void 0);return(0,n.useEffect)((()=>{(async()=>{const e=c.toLowerCase();try{await a(76776)(`./${e}.js`),d(e)}catch{try{const t=e.split("-")[0];await a(76776)(`./${t}.js`),d(t)}catch{d(void 0)}}})()}),[c]),n.createElement(i.A,{direction:"column",gap:4},n.createElement(ns,null,n.createElement(us.$,{dateAdapter:cs.R,adapterLocale:m},n.createElement(ms.K,{label:"Date / Time",closeOnSelect:!1,views:["year","month","day","hours","minutes","seconds"],value:Ue()(e),onAccept:e=>{e&&l(e.format(se.i$))}}))),n.createElement(ds.A,null,n.createElement(ps.A,{shrink:!0},"Edit Rotation"),n.createElement(dt.A,{exclusive:!0,fullWidth:!0,value:F||te.pL.DEG_0,onChange:(e,t)=>{s(t)}},gs.map((e=>n.createElement(mt.A,{key:e,value:e},90*e+"°"))))),n.createElement(NF,{meta:o,hash:t,hashes:r}))};!function(e){e.PALETTE="pal",e.FRAME="frame",e.TAGS="tags",e.MISC="misc"}(hs||(hs={}));const Es=(e,t)=>{switch(e){case hs.FRAME:return"Frame";case hs.MISC:return"Misc";case hs.PALETTE:return t?"Colors":"Palette";case hs.TAGS:return"Tags";default:return""}};var As=function(e){const t=(0,n.useMemo)((()=>{const t=[];return e.mixedTypes||t.push(hs.PALETTE),e.regularImage&&t.push(hs.FRAME),t.push(hs.TAGS,hs.MISC),t}),[e.mixedTypes,e.regularImage]),[a,r]=(0,n.useState)(null);return(0,n.useEffect)((()=>{r(t[0])}),[t]),n.createElement(i.A,{direction:"column",spacing:1},n.createElement($F.Ay,{value:a||t[0]},n.createElement(OF.A,{variant:"fullWidth",indicatorColor:"secondary",allowScrollButtonsMobile:!1},t.map((t=>n.createElement(Mo.A,{label:Es(t,!!e.paletteRGBN),key:t,value:t,onClick:()=>r(t)})))),n.createElement(_F.A,{value:hs.PALETTE},e.paletteRGBN?n.createElement(QF,{values:e.paletteRGBN,onChange:e.updatePalette,useChannels:{r:!!e.hashes?.r,g:!!e.hashes?.g,b:!!e.hashes?.b,n:!!e.hashes?.n}}):n.createElement(qF,{value:e.paletteShort||"",invertPalette:e.invertPalette,onChange:e.updatePalette,updateInvertPalette:e.updateInvertPalette})),n.createElement(_F.A,{value:hs.FRAME},n.createElement(UF,{updateFrame:e.updateFrame,updateFrameLock:e.updateFrameLock,frame:e.frame||"",lockFrame:e.lockFrame}),e.lockFrame&&!e.paletteRGBN?n.createElement(qF,{value:e.framePaletteShort||"",invertPalette:e.invertFramePalette,onChange:e.updateFramePalette,updateInvertPalette:e.updateInvertFramePalette}):null),n.createElement(_F.A,{value:hs.TAGS},n.createElement(ss,{updateTags:e.updateTags,resetTags:e.resetTags,tags:e.tags})),n.createElement(_F.A,{value:hs.MISC},n.createElement(fs,{created:e.created,hash:e.hash,hashes:e.hashes,updateCreated:e.updateCreated,meta:e.meta,rotation:e.rotation,updateRotation:e.updateRotation}))))},vs=a(88137);var bs=({initial:e,add:t,remove:a})=>(0,U.A)([...e,...t]).filter((e=>!a.includes(e)));var ys=()=>{const{editImages:e,cancelEditImages:t}=X(),{sortBy:a}=(0,_.A)(),{images:r}=(0,ie.h)(),{updateImages:l}=fe();return{batchUpdateImages:(0,n.useCallback)((({shouldUpdate:n,updates:o,tagChanges:i})=>{const F=(0,vs.PM)(a),s=e?.batch||[];if(n&&s?.length){const e=s.reduce(((e,t)=>{const a=r.find((({hash:e})=>e===t));return a?[...e,a]:e}),[]).map(vs.YZ).sort(F).map(vs.lt).map(((e,t)=>Lt.reduce(((e,a)=>{if(!n[a])return e;switch(a){case Bt.TITLE:return{...e,title:o.title.replace(/%(n+)/gi,((e,a)=>(t+1).toString(10).padStart(a.length,"0")))};case Bt.TAGS:{const t=bs({...i,initial:e.tags});return{...e,tags:t}}case Bt.ROTATION:case Bt.LOCK_FRAME:case Bt.FRAME:case Bt.CREATED:return{...e,[a]:o[a]}}if((0,it.pl)(e)){const t=e;return a===Bt.PALETTE?{...t,palette:o.palette}:t}{const t=e;switch(a){case Bt.PALETTE:case Rt.FRAME_PALETTE:case Rt.INVERT_FRAME_PALETTE:case Rt.INVERT_PALETTE:return{...t,[a]:o[a]};default:return t}}}),e)));l(e)}t()}),[t,e?.batch,r,a,l])}};var ws=a(96763);var Cs=function(){const{toEdit:e,form:t,isRegularImage:a,willUpdateBatch:r,tagChanges:l,usedPalette:o,usedFramePalette:F,updateForm:s,updatePalette:c,updateFramePalette:u,updateTags:m,resetTags:d,save:p,cancel:g}=(()=>{const{editImages:e,cancelEditImages:t}=X(),{palettes:a,frames:r,images:l}=(0,ie.h)(),{batchUpdateImages:o}=ys(),i=e=>a.find((t=>e===t.shortName))||se.Fv,F=(0,Fe.p)(l,r),{windowDimensions:s}=(0,he.A)(),c=(0,n.useMemo)((()=>{if(!e)return;const t=e.batch||[],a=e.tags||[];if(!t[0])return;const n=l.find((({hash:e})=>e===t[0]));if(!n)return;const r=s.width<=600?s.height:Math.min(900,s.height),o=t.reduce(((e,t)=>{const a=l.find((({hash:e})=>e===t));if(!a)return e;const n=(0,it.pl)(a);return{mono:e.mono||!n,rgb:e.rgb||n}}),{mono:!1,rgb:!1}),i=o.mono&&o.rgb,F=(0,it.pl)(n)?n.palette:void 0,c=(0,it.pl)(n)?void 0:n.palette,u=(0,it.pl)(n)?void 0:n.framePalette;return{created:n.created,hash:n.hash,height:r,imageCount:t?.length||0,invertPalette:n.invertPalette||!1,invertFramePalette:n.invertFramePalette||!1,lockFrame:n.lockFrame||!1,mixedTypes:i,tags:a,title:n.title,frame:n.frame,hashes:(0,it.pl)(n)?n.hashes:void 0,meta:n.meta,paletteRGBN:F,paletteShort:c,framePaletteShort:u,rotation:n.rotation}}),[e,l,s]),[u,m]=(0,n.useState)(c?.title||""),[d,p]=(0,n.useState)(c?.created||""),[g,h]=(0,n.useState)(c?.frame||""),[f,E]=(0,n.useState)(c?.lockFrame),[A,v]=(0,n.useState)(c?.rotation),[b,y]=(0,n.useState)(c?.invertPalette),[w,C]=(0,n.useState)(c?.invertFramePalette),[I,S]=(0,n.useState)(c?.paletteShort||""),[x,k]=(0,n.useState)(c?.framePaletteShort||""),[P,T]=(0,n.useState)(c?.paletteRGBN),[D,M]=(0,n.useState)(!1),B={title:u,created:d,frame:g,lockFrame:f,rotation:A,invertPalette:b,paletteShort:I,framePaletteShort:x,invertFramePalette:w,paletteRGBN:P},R=P||i(I).palette,N=i(x).palette,L=c?.hash;(0,n.useEffect)((()=>{(async()=>{if(!L)return;const e=await F(L);M(360===e)})()}),[F,L]);const[G,$]=(0,n.useState)({initial:c?.tags||[],add:[],remove:[]}),[O,_]=(0,n.useState)({created:!1,title:!1,frame:!1,lockFrame:!1,tags:!1,rotation:!1,palette:!1,invertPalette:!1,framePalette:!1,invertFramePalette:!1});return{toEdit:c,form:B,isRegularImage:D,shouldUpdate:O,willUpdateBatch:(j=O,[j.created?"Update date":"",j.title?"Update title":"",j.palette?"Update image palette colors":"",j.invertPalette?"Update invert image palette setting":"",j.frame?"Update frame":"",j.lockFrame?"Update separate frame settings":"",j.framePalette?"Update frame palette colors":"",j.invertFramePalette?"Update invert frame palette setting":"",j.tags?"Update tags":"",j.rotation?"Update rotation":""].filter(Boolean)),tagChanges:G,usedPalette:R,usedFramePalette:N,updateForm:e=>t=>{switch(_({...O,[e]:!0}),e){case"title":m(t);break;case"created":p(t);break;case"invertPalette":y(t);break;case"invertFramePalette":C(t);break;case"framePalette":k(t);break;case"frame":h(t);break;case"lockFrame":E(t);break;case"rotation":v(t)}},updatePalette:(e,t)=>{e&&(t&&_({...O,palette:!0}),"string"==typeof e?S(e):T(e))},updateFramePalette:(e,t)=>{t&&_({...O,framePalette:!0}),k(e)},updateTags:(e,t)=>{_({...O,tags:!0}),$({...G,...is(G,{mode:e,tag:t})})},resetTags:()=>{_({...O,tags:!1}),$((({initial:e})=>({initial:e,add:[],remove:[]})))},save:()=>{o({shouldUpdate:O,updates:{title:u,created:d,frame:g,lockFrame:f,rotation:A,palette:P||I,invertPalette:b||!1,framePalette:x,invertFramePalette:w||!1},tagChanges:G})},cancel:()=>t()};var j})(),h=(0,v.A)(),[f,E]=(0,n.useState)(null),[A,b]=(0,n.useState)({top:h.spacing(-2)});if((0,n.useEffect)((()=>{if(!f)return()=>{};let e;const t=e=>{const t=f.getBoundingClientRect(),a=144/t.height,n=e.scrollTop/t.height,r=Math.min(1,Math.max(a,1-n)),l=Math.min(t.height-144,e.scrollTop);b({position:"sticky",zIndex:2,transition:"top ease-in-out 150ms",transform:"translateY(-16px)",top:`-${Math.round(l)}px`,"& .gameboy-image":{transformOrigin:"center bottom",transition:"transform ease-in-out 150ms",transform:`scale(${r.toPrecision(4)})`}})};t(f);const a=a=>{clearTimeout(e),e=setTimeout((()=>{t(a.target)}),50)},n=(e=>{let t=e.parentElement;for(;t;){const e=getComputedStyle(t),a=e.overflowY,n=e.overflowX,r=("auto"===a||"scroll"===a)&&t.scrollHeight>t.clientHeight,l=("auto"===n||"scroll"===n)&&t.scrollWidth>t.clientWidth;if(r||l)return t;t=t.parentElement}return document.scrollingElement||document.documentElement})(f);return n.addEventListener("scroll",a),()=>{clearTimeout(e),n.removeEventListener("scroll",a)}}),[f]),!e)return ws.warn('Editform should be open, but "toEdit" is undefined',e),null;const{title:w,created:C,frame:I,lockFrame:S,rotation:x,invertPalette:k,invertFramePalette:P,framePaletteShort:T,paletteShort:D,paletteRGBN:B}=t;return n.createElement(M,{contentHeight:e.height,header:`Editing ${e.imageCount} image(s)`,open:!0,confirm:p,deny:g},n.createElement(i.A,{direction:"column",gap:4},n.createElement(y.A,{ref:E,sx:A},n.createElement(y.A,{sx:{mx:h.spacing(-2),position:"relative",backgroundColor:h.palette.background.default}},n.createElement(Te,{lockFrame:S,invertPalette:k,palette:o,invertFramePalette:P,framePalette:F,frameId:I,hash:e.hash,hashes:e.hashes,rotation:x}),e.imageCount>1?n.createElement(Oa.A,{severity:"info",sx:{position:"absolute",width:"75%",top:"11%",left:"50%",transform:"translate(-50%, -50%)"}},n.createElement(GF.A,null,`You are editing ${e.imageCount} images`),r.length?n.createElement(y.A,{component:"ul"},r.map((e=>n.createElement(Fa.A,{key:e,component:"li",variant:"caption"},e)))):null):null)),n.createElement(Ra.A,{helperText:e.imageCount>1?"Use %n (or %nn, %nnn, ...) to add an index to the image titles":void 0,type:"text",label:"Edit title",value:w,onChange:({target:{value:e}})=>{s("title")(e)}}),n.createElement(As,{created:C,updateCreated:s("created"),regularImage:a,mixedTypes:e.mixedTypes,lockFrame:S,hash:e.hash,hashes:e.hashes,paletteShort:D,framePaletteShort:T,paletteRGBN:B,invertPalette:k,invertFramePalette:P,frame:I,tags:l,meta:e.meta,rotation:x,updatePalette:c,updateInvertPalette:s("invertPalette"),updateFramePalette:u,updateInvertFramePalette:s("invertFramePalette"),updateFrame:s("frame"),updateFrameLock:s("lockFrame"),updateRotation:s("rotation"),updateTags:m,resetTags:d})))};var Is=function(){const{editId:e,absoluteSlug:t,possibleParents:a,slug:r,title:l,canConfirm:o,canMove:F,slugIsInUse:s,slugWasChanged:c,parentSlug:u,selectionCount:m,setSlug:d,setTitle:p,setParentSlug:g,confirm:h,move:f,cancelEditImageGroup:E}=Ze();return n.createElement(M,{confirm:h,canConfirm:o,header:e!==Ye?"Editing group "+(l?`"${l}"`:""):`Create new group with ${m} images`,deny:E,contentWidth:"auto",actionButtons:a.length>1&&e===Ye&&n.createElement(w.A,{disabled:!F,onClick:f,variant:"contained",color:"secondary"},`Move ${m} selected images`)},n.createElement(i.A,{direction:"column",gap:4},e&&n.createElement(n.Fragment,null,n.createElement(Ra.A,{label:"Title",size:"small",type:"text",value:l,onChange:e=>p(e.target.value)}),n.createElement(Ra.A,{label:"Pathsegment (identifier)",size:"small",type:"text",value:r,onChange:e=>d(e.target.value),helperText:s?`Path${c?" is already in use":""}: "${t}"`:`Path: "${t}"`,error:!o}),a.length>1&&n.createElement(Ra.A,{label:"Parent group",size:"small",select:!0,onChange:e=>g(e.target.value),value:u},a.map((({value:e,name:t})=>n.createElement(Le.A,{key:e,value:e},t)))),n.createElement(ca,{text:JSON.stringify({slug:r,parentSlug:u,canConfirm:o,slugIsInUse:s},null,2)}))))};var Ss=e=>{const t=e?.id||"",{cancelEditFrame:a}=X(),{frames:r}=(0,ie.h)(),{frameGroups:l,addFrames:o}=(0,ie.h)(),{updateLastSyncLocalNow:i}=fe(),F=(0,Io.A)(r,l),s=/^(?<groupName>[a-z]+)(?<id>[0-9]+)/g.exec(t),c=s?.groups?.groupName||"",u=s?.groups?.id||"0",[m,d]=(0,n.useState)(c),[p,g]=(0,n.useState)(parseInt(u,10)),[h,f]=(0,n.useState)(e?.name||""),E=`${m}${p.toString(10).padStart(2,"0")}`,A=E===t||!r.find((e=>E===e.id)),v=Boolean(m.match(/^[a-z]{2,}$/g)),b=p>0;return{groups:F,updateId:t,fullId:E,frameIndex:p,frameGroup:m,frameName:h,idValid:A,formValid:A&&v&&b,groupIdValid:v,frameIndexValid:b,setFrameIndex:g,setFrameGroup:d,setFrameName:f,saveFrame:()=>{a(),i(),o([{hash:e?.hash||"",id:E,name:h}])},cancelEdit:a}};var xs=function({frameIndex:e,frameName:t,idValid:a,groupIdValid:r,frameIndexValid:l,frameGroup:o,groups:F,fullId:s,frameGroupName:c,extraFields:u,setFrameGroupName:m,setFrameIndex:d,setFrameGroup:p,setFrameName:g}){const h=Boolean(F.find((({id:e})=>o===e)));return n.createElement(i.A,{direction:"column",gap:4},u,n.createElement(Ra.A,{label:"Frame group",select:!0,size:"small",type:"text",value:o,onChange:e=>{p(e.target.value)},slotProps:{inputLabel:{shrink:!0},select:{renderValue:e=>h?F.find((({id:t})=>t===e))?.name||"Unknown":""===e?"Select frame group":"New frame group"}}},n.createElement(Le.A,{value:""},h?"Select frame group":"New frame group"),F.map((({id:e,name:t})=>n.createElement(Le.A,{value:e,key:e},t)))),n.createElement(Ra.A,{label:h?"Frame group id":"New frame group id",size:"small",type:"text",value:o,onChange:e=>{p(e.target.value)},helperText:r?void 0:"Must have at least two characters, only lowercase"}),m?n.createElement(Ra.A,{label:"New frame group name",size:"small",type:"text",onChange:e=>{m(e.target.value)},value:h?"":c,disabled:h}):null,n.createElement(Ra.A,{label:"Frame Index",size:"small",type:"number",slotProps:{htmlInput:{min:1,max:99}},value:e,onChange:e=>{d(parseInt(e.target.value,10))},helperText:l?null:"Integer, must be greater than 0"}),n.createElement(Ra.A,{label:"Frame name",size:"small",type:"text",value:t,onChange:e=>{g(e.target.value)}}),!a&&n.createElement(Oa.A,{severity:"warning",variant:"filled"},`Specified frame index/identifier "${s}" is already in use, please try another one.`))};var ks=()=>{const{editFrame:e}=X(),{frames:t}=(0,ie.h)(),a=t.find((({id:t})=>t===e)),{cancelEdit:r,saveFrame:l,updateId:o,fullId:i,formValid:F,groups:s,frameGroup:c,frameIndex:u,setFrameIndex:m,frameName:d,setFrameGroup:p,setFrameName:g,idValid:h,groupIdValid:f,frameIndexValid:E}=Ss(a),A=o!==i?` -> "${i}"`:"";return n.createElement(M,{confirm:l,canConfirm:F,header:a?`Editing frame "${o}"${A}`:`Error editing '${e}'`,deny:r},a?n.createElement(xs,{groups:s,fullId:i,frameIndex:u,frameGroup:c,frameName:d,idValid:h,groupIdValid:f,frameIndexValid:E,setFrameIndex:m,setFrameGroup:p,setFrameName:g}):n.createElement(Oa.A,{severity:"error",variant:"filled"},`A frame with the ID '${e}' does not exist!`))},Ps=a(47195);const Ts=e=>/^#[0-9a-fA-F]{6}$/.test(e);var Ds=function({value:e,onChange:t,label:a}){const[r,l]=(0,n.useState)(e),[o]=(0,n.useState)(`id-${Math.random().toString(16).split(".")[1]}`);(0,n.useEffect)((()=>{l(e)}),[e]);const F=(0,n.useRef)(t);return(0,n.useEffect)((()=>{F.current=t}),[t]),(0,n.useEffect)((()=>{const e=setTimeout((()=>{Ts(r)&&F.current(r)}),125);return()=>{clearTimeout(e)}}),[r]),n.createElement(ds.A,{variant:"outlined",fullWidth:!0,size:"small",color:"tertiary",sx:{"--palette-color":Ts(r)?r:"#000000",".MuiOutlinedInput-notchedOutline":{inset:0},"[type=color]":{height:"100%",width:"100%",opacity:"0",cursor:"pointer"}}},n.createElement(ps.A,{shrink:!0,htmlFor:o},a),n.createElement(i.A,{direction:"row",gap:1,sx:{"& > *":{flexBasis:"auto",flexShrink:0,flexGrow:1},"& > *:first-of-type":{flexBasis:"40px",flexShrink:0,flexGrow:0,backgroundColor:"var(--palette-color)"}}},n.createElement(_a.A,{variant:"outlined"},n.createElement("input",{type:"color",value:r,onChange:e=>l(e.target.value),tabIndex:-1})),n.createElement(Ps.A,{id:o,type:"text",value:r,onChange:e=>l(e.target.value),onBlur:e=>l(e.target.value.toLowerCase())})))};const Ms=(0,ve.A)("hash");var Bs=()=>{const{images:e}=(0,ie.h)(),{imageSelection:t,sortBy:a,filtersActiveTags:r,recentImports:l}=(0,_.A)(),o=(0,n.useMemo)((()=>({sortBy:a,filtersActiveTags:r,recentImports:l})),[r,l,a]);return(0,n.useMemo)((()=>{const a=t.map((t=>e.find((({hash:e})=>e===t)))).reduce(it.iy,[]),n=a.length>1?[]:(0,O.S)(e,o).reduce(it.iy,[]),r=a.length+n.length>1?[]:[...e].map(vs.YZ).sort((0,vs.PM)(o.sortBy)).map(vs.lt).reduce(it.iy,[]),l=Ms([a.shift(),n.shift(),r.shift(),r.pop(),n.pop(),a.pop()].reduce(it.iy,[]));return[l.shift(),l.pop()].reduce(it.iy,[])}),[o,t,e])};var Rs=function(){const{canConfirm:e,canEditShortName:t,newName:a,newShortName:r,palette:l,previewImages:o,shortName:F,setNewName:s,setNewShortName:c,setPalette:u,save:m,cancelEditPalette:d}=(()=>{const{editPalette:e,cancelEditPalette:t}=X(),{palettes:a,addPalettes:r}=(0,ie.h)(),{updateLastSyncLocalNow:l}=fe(),o=e?.shortName||"",i=e?.palette||[],F=e?.name||"",s=(0,n.useCallback)((e=>!!e.match(/^[a-z]+[a-z0-9]*$/gi)&&-1===a.findIndex((t=>t.shortName===e))),[a]),c=o===Me.mI,[u,m]=(0,n.useState)(F),[d,p]=(0,n.useState)(i),[g,h]=(0,n.useState)(c?"":o),f=(0,n.useMemo)((()=>(!c||s(g))&&u.length>0),[u,c,g,s]),E=Bs(),A=(0,n.useCallback)((()=>{r([{shortName:c?g:o,name:u,palette:d,origin:"Made with the webapp",isPredefined:!1}]),l(),t()}),[r,c,t,u,g,d,o,l]);return(0,n.useEffect)((()=>{const e=e=>{"Enter"===e.key&&e.ctrlKey&&f&&A()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)})),{canConfirm:f,canEditShortName:c,newName:u,newShortName:g,palette:d,previewImages:E,shortName:o,setNewName:m,setNewShortName:h,setPalette:p,save:A,cancelEditPalette:t}})(),p=(0,n.useCallback)((e=>{s(e.target.value)}),[s]),g=(0,n.useCallback)((e=>{c(e.target.value)}),[c]),h=(0,n.useCallback)((e=>{c(e.target.value.toLowerCase())}),[c]),f=(0,n.useCallback)(((e,t)=>{const a=[...l];a[e]=t,u(a)}),[l,u]);return F?n.createElement(M,{confirm:m,canConfirm:e,deny:d,header:"Editing palette "+(a?`"${a}"`:""),closeOnOverlayClick:!1},n.createElement(i.A,{direction:"column",gap:4},n.createElement(Ra.A,{label:"Edit Title",size:"small",type:"text",placeholder:"Add a title",value:a,onChange:p}),n.createElement(Ra.A,{label:"ID/Short name",size:"small",type:"text",value:r,disabled:!t,onChange:g,onBlur:h,required:!0}),n.createElement(i.A,{direction:"row",gap:2,component:"ul",justifyContent:"space-around"},o.map((e=>n.createElement(y.A,{key:e.hash,component:"li"},n.createElement(Te,{hash:e.hash,invertPalette:!1,invertFramePalette:!1,lockFrame:!1,palette:l,framePalette:l}))))),l.map(((e,t)=>n.createElement(Ds,{key:`color-${t}`,label:`Color ${t+1}`,value:e,onChange:e=>f(t,e)}))))):null},Ns=a(20700),Ls=a(74802),Gs=a.n(Ls);var $s,Os=()=>{const{setImageSelection:e}=(0,_.A)(),{addImages:t}=fe();return{saveRGBNImage:(0,n.useCallback)((async n=>{const{default:r}=await Promise.resolve().then(a.t.bind(a,74802,23)),l=Ue()(),o=n.map(((e,t)=>({palette:se.YP,hashes:e,hash:r(e),created:l.add(t,"milliseconds").format(se.i$),title:"",tags:[]})));t(o),e(o.map((e=>e.hash)))}),[t,e])}};!function(e){e.BY_COLOR="BY_COLOR",e.BY_IMAGE="BY_IMAGE",e.MANUAL="MANUAL"}($s||($s={}));var _s=a(736),js=a(58381);const Vs=e=>{switch(e){case"r":return"#ff0000";case"g":return"#00aa00";case"b":return"#0000ff";default:return"#444444"}};var Us=function({isR:e,isG:t,isB:a,isN:r,toggleChannel:l}){const o=(0,n.useMemo)((()=>[{value:e,updateKey:"r"},{value:t,updateKey:"g"},{value:a,updateKey:"b"},{value:r,updateKey:"n"}]),[a,t,r,e]);return n.createElement(dt.A,{onChange:(e,t)=>l(t),fullWidth:!0,sx:{".MuiToggleButton-root":{padding:"1px",border:"none"}}},o.map((({value:e,updateKey:t})=>n.createElement(mt.A,{value:t,key:t,sx:{"& svg":{color:Vs(t)}}},e?n.createElement(_s.A,null):n.createElement(js.A,null)))))};var zs=function(){const{canConfirm:e,order:t,grouping:a,lengthWarning:r,rgbnHashes:F,sortedImages:s,createGroup:c,updateOrder:u,toggleSingleChannel:m,setGrouping:d,setCreateGroup:p,save:g,cancelEditRGBNImages:h}=(()=>{const{navigateToGroup:e}=Xe(),{view:t}=G(),{saveRGBNImage:a}=Os(),{sortBy:r}=(0,_.A)(),{editRGBNImages:l,cancelEditRGBNImages:o,cancelEditImageGroup:i}=X(),{addImageGroup:F,images:s}=(0,ie.h)(),[c,u]=(0,n.useState)(l.length>5),m=r.split("_")[1],d=(0,n.useMemo)((()=>{const e=(0,O.S)(s,{filtersActiveTags:[],sortBy:r,recentImports:[]});return"desc"===m&&e.reverse(),e.reduce(it.iy,[]).reduce(((e,t)=>l.includes(t.hash)?[...e,t]:e),[])}),[l,m,s,r]),[p,g]=(0,n.useState)(["r","g","b","s","n"]),[h,f]=(0,n.useState)(d.length<=4?$s.MANUAL:$s.BY_COLOR),[E,A]=(0,n.useState)({r:d[0]?.hash||void 0,g:d[Math.floor(d.length/3)]?.hash||void 0,b:d[2*Math.floor(d.length/3)]?.hash||void 0}),v=p.findIndex((e=>"s"===e)),b=Math.ceil(l.length/v),y=v*b!==l.length,w=(0,n.useMemo)((()=>{switch(h){case $s.MANUAL:return Object.keys(E).length?[E]:[];case $s.BY_COLOR:case $s.BY_IMAGE:default:{const e=p.slice(0,v),t=Array(b).fill("").map(((t,a)=>e.reduce(((e,t,n)=>{const r=h===$s.BY_COLOR?a+b*n:n+v*a,l=d[r]?.hash;return l?{...e,[t]:l}:e}),{})));return"desc"===m&&t.reverse(),t}}}),[b,m,h,E,p,d,v]),C=h===$s.MANUAL;return{order:p,grouping:h,canConfirm:C?w.length>0:p.length>1,lengthWarning:!C&&y,rgbnHashes:w,sortedImages:d,createGroup:c,updateOrder:(e,t)=>{if(t<0||t>p.length)return;const a=p.filter((t=>t!==e));a.splice(t,0,e).filter(Boolean),g(a)},toggleSingleChannel:(e,t)=>{const a={...E};a[e]===t?delete a[e]:a[e]=t,A(a)},setGrouping:f,save:async()=>{if(o(),await a(w),c){const a=`RGB ${Ue()().format(se.fg)}`,n=Qe(a),r=w.map((e=>Gs()(e)));i();const l=ze();F({id:l,slug:n,title:a,created:Ue()(Date.now()).format(se.i$),coverImage:r[0],images:r,groups:[]},t.id),e(l)}},setCreateGroup:u,cancelEditRGBNImages:o}})(),f=(0,v.A)(),E=(0,P.A)(f.breakpoints.up("sm"));return n.createElement(M,{confirm:g,deny:h,closeOnOverlayClick:!1,canConfirm:e&&!r,header:"Create RGBN images",contentWidth:"576px"},n.createElement(i.A,{direction:"column",gap:4},n.createElement(Ra.A,{label:"Grouping of your selection",select:!0,size:"small",value:a,onChange:e=>d(e.target.value)},n.createElement(Le.A,{value:$s.BY_COLOR},"Selection is grouped by colors (RRR GGG BBB)"),n.createElement(Le.A,{value:$s.BY_IMAGE},"Selection is grouped by image (RGB RGB RGB)"),n.createElement(Le.A,{value:$s.MANUAL},"Manual channel selection for a single image")),a===$s.MANUAL?n.createElement(i.A,{direction:"column",gap:1},n.createElement(Fa.A,{variant:"body2"},"Manually select the channels to create a single RGBN image"),n.createElement(i.A,{direction:"row",gap:2,component:"ul",justifyContent:"center",alignItems:"center",flexWrap:"wrap",sx:{"& .MuiCardContent-root":{padding:1}}},s.map((({hash:e})=>{const t=F[0]?.r===e,a=F[0]?.g===e,r=F[0]?.b===e,i=F[0]?.n===e,s=function(e,t,a,n){const r=e?255:0,l=t?255:0,o=a?255:0,i=(e,t,a,n)=>{const r=(e,t)=>Math.floor(e*t).toString(16).padStart(2,"0");return`#${r(e,n)}${r(t,n)}${r(a,n)}`};return e||t||a?[i(r,l,o,1),i(r,l,o,.66),i(r,l,o,.33),"#000000"]:n?["#ffffff","#aaaaaa","#555555","#000000"]:["#b2b2b2","#949494","#737373","#606060"]}(t,a,r,i);return n.createElement(l.A,{key:e,className:"edit-rgbn__single-image-list-entry",variant:"outlined"},n.createElement(o.A,{sx:{".gameboy-image":{width:"80px",margin:"0 auto",imageRendering:"auto"}}},n.createElement(Te,{lockFrame:!1,invertPalette:!1,invertFramePalette:!1,palette:s,framePalette:s,hash:e})),n.createElement(Ns.A,null,n.createElement(Us,{isR:t,isG:a,isB:r,isN:i,toggleChannel:t=>m(t,e)})))})))):n.createElement(i.A,{direction:"column",gap:1},n.createElement(Fa.A,{variant:"body2"},"Select the order of channels to be applied (in the order of images taken). Channels to the right of the separator will not be used."),n.createElement(i.A,{direction:{xs:"column",sm:"row"},gap:{xs:1,sm:2},component:"ul",justifyContent:"center",alignItems:"center"},t.map(((e,t)=>"s"===e?n.createElement(qi.A,{key:e,orientation:E?"vertical":"horizontal",variant:"middle",flexItem:!0}):n.createElement(bt.A,{key:e,component:"li",size:"small",sx:{backgroundColor:Vs(e)}},n.createElement(w.A,{onClick:()=>u(e,t-1),sx:{svg:{color:"#ffffff"}}},E?n.createElement(wa.A,null):n.createElement(TF.A,null)),n.createElement(w.A,{onClick:()=>u(e,t+1),sx:{svg:{color:"#ffffff"}}},E?n.createElement(Ca.A,null):n.createElement(DF.A,null)))))),r?n.createElement(Oa.A,{variant:"filled",severity:"error"},"Your distribution of channels and number of selected images does not add up!"):null),n.createElement(i.A,{direction:"column",gap:1},n.createElement(Fa.A,{variant:"body2"},"Image preview"),n.createElement(i.A,{direction:"row",component:"ul",sx:{overflowX:"auto","& > *":{flex:"160px 0 0",margin:"0 auto"}},gap:1},F.map(((e,t)=>n.createElement(y.A,{key:t,component:"li"},n.createElement(Te,{lockFrame:!1,invertPalette:!1,invertFramePalette:!1,palette:se.YP,framePalette:[],hash:"newRGBN",hashes:e})))))),n.createElement(Oi.A,{label:"Create group from created images at current location",control:n.createElement(_i.A,{checked:c,onChange:({target:e})=>{p(e.checked)}})})))};var Ws=[{id:te.H.FRAMEMODE_KEEP,name:"Keep frame"},{id:te.H.FRAMEMODE_CROP,name:"Crop frame"},{id:te.H.FRAMEMODE_SQUARE_BLACK,name:"Make image squared (add black)"},{id:te.H.FRAMEMODE_SQUARE_WHITE,name:"Make image squared (add white)"}],Hs=a(34399),Xs=a(4213);const Ys=e=>({scaleFactor:e.scaleFactor||4,frameRate:e.frameRate||12,yoyo:e.yoyo||!1,reverse:e.reverse||!1,frame:e.frame||"",lockFrame:e.lockFrame||!1,invertPalette:e.invertPalette||!1,palette:e.palette||"",exportFrameMode:e.exportFrameMode||te.H.FRAMEMODE_KEEP}),Qs=async()=>{const{setProgress:e,setError:t,videoSelection:a}=he.A.getState(),{frames:n,palettes:r,images:l}=ie.h.getState(),{videoParams:o,fileNameStyle:i}=u.A.getState();e("gif",.01);const{scaleFactor:F,frameRate:s,yoyo:c,reverse:m,frame:d,lockFrame:p,invertPalette:g,palette:h,exportFrameMode:f}=Ys(o);if(!a.length)return;const E=a.map((e=>l.find((({hash:t})=>t===e)))).reduce(bo.N,[]),A=E.reduce(((e,t)=>{if(!t)return e;const a=(0,it.pl)(t)?{...t,frame:d||t.frame}:{...t,palette:h||t.palette};return[...e,a]}),[]),v=(0,Fe.T)(E,n),b=await Promise.all(A.map((async e=>{const t=await v(e.hash),a=p||e.lockFrame||!1,l=e.rotation||0,{palette:o,framePalette:i}=(0,Ft.s)(r,{...e,lockFrame:a}),s=n.find((({id:t})=>t===e.frame)),c=s?await(0,ce.mZ)(s.hash):null,u=c?c.upper.length/20:2;if(!t||!o)throw new Error("missing tiles or palette");let m;if((0,it.pl)(e))m=await(0,te.y1)({tiles:t,palette:o,lockFrame:a,imageStartLine:u,rotation:l,scaleFactor:F,handleExportFrame:f},"image/png");else{const n=o?.palette||te.CU,r=i?.palette||te.CU,{invertPalette:s,invertFramePalette:c}=(0,st.f)(e),d=(0,ae.C)({imagePalette:n,invertPalette:g||s,framePalette:a?r:n,invertFramePalette:g||c});m=await(0,te.Yn)({tiles:t,imageStartLine:u,rotation:l,scaleFactor:F,handleExportFrame:f,...d},"image/png")}const d=await createImageBitmap(m),h=document.createElement("canvas");h.width=d.width,h.height=d.height;return h.getContext("2d").drawImage(d,0,0),h})));if(1!==(0,U.A)(b.map((e=>`${e.width}*${e.height}`))).length)return e("gif",0),void t(new Error("All images need to have same dimensions"));const y=[],w=new(wn())(1,1/0),C=new Hs.e(y,b[0].width,b[0].height,{loop:65535});if(c){const e=[...b].reverse();e.shift(),e.pop(),b.push(...e)}m&&b.reverse();const I=((e,t,a,n)=>(r,l)=>t.add((()=>new Promise(((t,o)=>{const i=r.getContext("2d");if(!i)throw new Error("missing context");const{data:F}=i.getImageData(0,0,r.width,r.height),{palette:s,pixels:c}=bn()(F,4).reduce(((e,[t,a,n])=>{const r=(t<<16)+(a<<8)+n;let l=e.palette.findIndex((e=>e===r));return-1===l&&(l=e.palette.length,e.palette.push(r)),e.pixels.push(l),e}),{pixels:[],palette:[]});for(;s.length<256;)s.push(0);try{he.A.getState().setProgress("gif",(l+1)/n),window.requestAnimationFrame((()=>{e.addFrame(0,0,r.width,r.height,c,{delay:Math.round(100/a),palette:s}),t(null)}))}catch(e){o(e)}})))))(C,w,s,b.length);await Promise.all(b.map(I));const S=(0,Gt.A)({useCurrentDate:!0,exportScaleFactor:F,frameRate:s,altTitle:"animated",frameName:d,paletteShort:h,fileNameStyle:i}),x=C.end();let k;try{k=new File([new Uint8Array(y.slice(0,x)).buffer],`${S}.gif`,{type:"image/gif"})}catch(e){k=new Blob([new Uint8Array(y.slice(0,x)).buffer])}(0,Xs.saveAs)(k,`${S}.gif`),e("gif",0)};var Ks=function(){const{update:e,cancel:t,imageCount:a,animate:r,videoParams:l}=(()=>{const{videoParams:e,setVideoParams:t}=(0,u.A)(),{videoSelection:a,setVideoSelection:n}=(0,he.A)(),r=Ys(e);return{imageCount:a.length||0,videoParams:r,update:t,cancel:()=>{n([])},animate:()=>{Qs(),n([])}}})();return a?n.createElement(M,{confirm:r,deny:t,header:`Create an animated GIF with ${a} frames`},n.createElement(i.A,{direction:"column",gap:4},n.createElement(Ra.A,{label:"Framerate",size:"small",type:"number",slotProps:{htmlInput:{min:1,max:120}},value:l.frameRate,onChange:t=>{e({frameRate:parseInt(t.target.value,10)})}}),n.createElement(Ra.A,{label:"Scale GIF",size:"small",type:"number",slotProps:{htmlInput:{min:1,max:12}},value:l.scaleFactor,onChange:t=>{e({scaleFactor:parseInt(t.target.value,10)})}}),n.createElement(Oi.A,{label:"Enable Yoyo-Effect (loop back to the beginning)",control:n.createElement(_i.A,{checked:l.yoyo,onChange:t=>{e({yoyo:t.target.checked})}})}),n.createElement(Oi.A,{label:"Reverse animation direction",control:n.createElement(_i.A,{checked:l.reverse,onChange:t=>{e({reverse:t.target.checked})}})}),n.createElement(qF,{noFancy:!0,allowEmpty:!0,value:l.palette||"",invertPalette:l.invertPalette,onChange:t=>{e({palette:t})},updateInvertPalette:t=>{e({invertPalette:t})}}),n.createElement(Ra.A,{label:"How to handle frames when exporting images",size:"small",select:!0,value:l.exportFrameMode,onChange:t=>{e({exportFrameMode:t.target.value})}},Ws.map((({id:e,name:t})=>n.createElement(Le.A,{value:e,key:e},t)))),"crop"===l.exportFrameMode?null:n.createElement(UF,{frame:l.frame||"",lockFrame:l.lockFrame,noFrameOption:"As selected per image",updateFrame:t=>{e({frame:t})},updateFrameLock:t=>{e({lockFrame:t})}}))):null},qs=a(28849),Zs=a(67241),Js=a(51916),ec=a.n(Js);const tc=()=>{const e=(0,_.A)(),{view:t,covers:a}=G(),{isFullscreen:r,setLightboxImage:l,setLightboxImagePrev:o,setLightboxImageNext:i,setIsFullscreen:F,lightboxImage:s}=(0,he.A)(),{preferredLocale:c}=(0,u.A)(),{palettes:m}=(0,ie.h)(),d=(0,O.S)(t.images,e),p=(0,n.useMemo)((()=>d.filter((({hash:e})=>!a.includes(e)))),[a,d]),g=null!==s?((e,t)=>{let a,n=[];if(!e?.hash)return null;const{palette:r,framePalette:l}=(0,Ft.s)(t,e);if(!r)throw new Error("Palette missing?");const{invertPalette:o,invertFramePalette:i}=(0,st.f)(e);return(0,it.pl)(e)?a=r:(a=(r||se.Fv).palette,n=(l||se.Fv).palette),{title:e?.title||"",created:e?.created||"",frame:e.frame,hash:e.hash,hashes:e.hashes||void 0,tags:e.tags,palette:a,framePalette:n,lockFrame:e.lockFrame,invertPalette:o,invertFramePalette:i,rotation:e.rotation}})(p[s],m):null;return(0,n.useEffect)((()=>{const e=()=>{F(!!ec().element)},t=e=>{switch(e.key){case"Esc":case"Escape":close(),e.preventDefault();break;case"Right":case"ArrowRight":case"d":i(p.length),e.preventDefault();break;case"Left":case"ArrowLeft":case"a":o(),e.preventDefault();break;case"Home":l(0),e.preventDefault();break;case"End":l(p.length-1),e.preventDefault()}};return document.addEventListener("keydown",t),ec().isEnabled&&ec().on("change",e),()=>{document.removeEventListener("keydown",t),ec().off("change",e)}})),{image:g,isFullscreen:r,currentIndex:s||0,size:p.length,canPrev:null!==s&&s>0,canNext:null!==s&&s<p.length-1,preferredLocale:c,close:()=>l(null),prev:()=>o(),next:()=>i(p.length),fullscreen:()=>{ec().isEnabled&&(ec().element?ec().exit():ec().request(document.body))}}};var ac=function(){const{image:e,isFullscreen:t,currentIndex:a,size:r,preferredLocale:l,canPrev:o,canNext:F,prev:s,next:c,fullscreen:u,close:m}=tc();return n.createElement(M,{header:e?.title,deny:m,contentWidth:"100%",contentHeight:"100%",fullSize:!0,headerActionButtons:n.createElement(g.A,{color:"inherit",onClick:u,title:t?"Leave fullscreen":"Enter fullscreen"},t?n.createElement(Zs.A,null):n.createElement(qs.A,null))},n.createElement(i.A,{direction:"column",gap:2,sx:{width:"100%",height:"100%"}},n.createElement(i.A,{direction:"row",gap:1,alignItems:"center",justifyContent:"center",sx:{height:"100%",overflow:"hidden",position:"relative","& > .MuiBox-root":{flexGrow:1}}},n.createElement(g.A,{size:"large",onClick:s,disabled:!o},n.createElement(wa.A,null)),e&&n.createElement(y.A,{sx:{width:"100%",height:"100%",flexBasis:"100%",flexGrow:1}},n.createElement(Te,{lockFrame:e.lockFrame,invertPalette:e.invertPalette,invertFramePalette:e.invertFramePalette,palette:e.palette,framePalette:e.framePalette,frameId:e.frame,hash:e.hash,hashes:e.hashes,rotation:e.rotation})),n.createElement(g.A,{size:"large",onClick:c,disabled:!F},n.createElement(Ca.A,null))),n.createElement(i.A,{direction:"row",gap:{xs:4,md:12},alignItems:"center",justifyContent:"center"},n.createElement(Fa.A,{variant:"body2"},`Image ${a+1}/${r}`),n.createElement(Fa.A,{variant:"body2"},(0,ua.A)(Ue()(e?.created,se.i$),l)))))},nc=a(45614);var rc,lc=function(){const e=(0,v.A)();return n.createElement(i.A,{justifyContent:"center",alignItems:"center",sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:30,background:(0,b.X4)(e.palette.background.paper,.6),backdropFilter:"blur(6px)"}},n.createElement(_a.A,{elevation:12,sx:{px:{xs:6,md:10},py:{xs:4,md:9}}},n.createElement(i.A,{direction:"column",gap:4,alignItems:"center",color:e.palette.tertiary.main},n.createElement(nc.A,{sx:{fontSize:64}}),n.createElement(Fa.A,{variant:"h5",fontWeight:"bold"},"Drop your files here"),n.createElement(Fa.A,{variant:"body2",sx:{maxWidth:"70vw"},textAlign:"center"},"Printer hex-dumps, .sav savestates, JSON exports or even plain bitmaps."))))};!function(e){e.ADD="add",e.REMOVE="remove"}(rc||(rc={}));var oc=function({tagActive:e,toggleTag:t,title:a}){return n.createElement(De.A,{label:a,title:`${e?"Remove":"Select"} "${a}"-tag`,size:"small",onClick:()=>t(e?rc.REMOVE:rc.ADD),color:e?"tertiary":"default"})};var ic=function(){const{visible:e,availableTags:t,activeTags:a,updateActiveTags:r,clearTags:l,applyClearTags:o,confirm:F,cancel:s}=(()=>{const{filtersActiveTags:e,filtersVisible:t,setFiltersVisible:a,setFiltersActiveTags:r}=(0,_.A)(),[l,o]=(0,n.useState)(e),{availableTags:i}=ls();return(0,n.useEffect)((()=>{o(e)}),[e]),{visible:t,availableTags:i,activeTags:l,updateActiveTags:(e,t)=>{o("add"===t?(0,U.A)([...l,e]):l.filter((t=>t!==e)))},clearTags:()=>o([]),applyClearTags:()=>r([]),confirm:()=>r(l),cancel:()=>a(!1)}})();return e?n.createElement(M,{confirm:F,deny:s,header:"Select Filters",contentWidth:"auto",actionButtons:n.createElement(n.Fragment,null,n.createElement(w.A,{disabled:!a.length,title:"Clear Filters",color:"secondary",variant:"outlined",onClick:l},"Clear"),n.createElement(w.A,{disabled:!a.length,title:"Clear Filters and apply",color:"secondary",variant:"contained",onClick:o},"Clear and apply"))},n.createElement(i.A,{direction:"column",gap:4},n.createElement(i.A,{direction:"column",gap:1},n.createElement(Fa.A,{component:"span",variant:"body2"},"If set, all must be met"),n.createElement(i.A,{direction:"row",gap:1,flexWrap:"wrap",alignItems:"center",sx:{".MuiChip-root":{my:"1px"}}},n.createElement(oc,{title:"Untagged",tagActive:a.includes(Me.X3.FILTER_UNTAGGED),toggleTag:e=>r(Me.X3.FILTER_UNTAGGED,e)}),n.createElement(oc,{title:"❤️ Favourite",tagActive:a.includes(Me.X3.FILTER_FAVOURITE),toggleTag:e=>r(Me.X3.FILTER_FAVOURITE,e)}),n.createElement(oc,{title:"New",tagActive:a.includes(Me.X3.FILTER_NEW),toggleTag:e=>r(Me.X3.FILTER_NEW,e)}),n.createElement(oc,{title:"Monochrome",tagActive:a.includes(Me.X3.FILTER_MONOCHROME),toggleTag:e=>r(Me.X3.FILTER_MONOCHROME,e)}),n.createElement(oc,{title:"RGB",tagActive:a.includes(Me.X3.FILTER_RGB),toggleTag:e=>r(Me.X3.FILTER_RGB,e)}),n.createElement(oc,{title:"Recent Imports",tagActive:a.includes(Me.X3.FILTER_RECENT),toggleTag:e=>r(Me.X3.FILTER_RECENT,e)}),n.createElement(oc,{title:"Image has comments",tagActive:a.includes(Me.X3.FILTER_COMMENTS),toggleTag:e=>r(Me.X3.FILTER_COMMENTS,e)}),n.createElement(oc,{title:"Image has username",tagActive:a.includes(Me.X3.FILTER_USERNAME),toggleTag:e=>r(Me.X3.FILTER_USERNAME,e)}))),n.createElement(i.A,{direction:"column",gap:1},n.createElement(Fa.A,{component:"span",variant:"body2"},"If set, one must be met"),n.createElement(i.A,{direction:"row",gap:1,flexWrap:"wrap",alignItems:"center",sx:{".MuiChip-root":{my:"1px"}}},t.map((e=>n.createElement(oc,{key:e,title:e,tagActive:a.includes(e),toggleTag:t=>r(e,t)}))))))):null};const Fc=[{title:"Title",key:"title"},{title:"Date",key:"created"},{title:"Palette",key:"palette"}];var sc=function(){const{visible:e,sortBy:t,sortOrder:a,setSortBy:r,hideSortForm:l}=(()=>{const{setSortBy:e,setSortOptionsVisible:t,sortOptionsVisible:a,sortBy:n}=(0,_.A)(),[r="",l=""]=n.split("_");return{visible:a,sortBy:r,sortOrder:l,setSortBy:e,hideSortForm:()=>t(!1)}})(),[o,F]=(0,n.useState)(t),[s,c]=(0,n.useState)(a);if((0,n.useEffect)((()=>{F(t),c(a)}),[F,c,e,t,a]),!e)return null;const u=Fc.find((({key:e})=>e===o))||Fc[0],m=s===Ea.U.ASC?"Ascending":"Descending";return n.createElement(M,{header:`Sort by: ${u.title}/${m}`,confirm:()=>r(`${o}_${s}`),deny:l},n.createElement(i.A,{direction:"column",gap:4},n.createElement(Ra.A,{label:"Sort by",size:"small",select:!0,value:o,onChange:e=>F(e.target.value)},Fc.map((({key:e,title:t})=>n.createElement(Le.A,{key:e,value:e},t)))),n.createElement(Ra.A,{label:"Sort direction",size:"small",select:!0,value:s,onChange:e=>c(e.target.value)},n.createElement(Le.A,{value:Ea.U.ASC},"Ascending"),n.createElement(Le.A,{value:Ea.U.DESC},"Descending"))))},cc=a(40547);let uc;const mc=e=>{const t=async()=>{if(!uc){const{init:t,gitSyncTool:n}=await Promise.all([a.e(8429),a.e(1575)]).then(a.bind(a,55927));t(),uc=uc||n(e)}return uc};return(()=>{const{gitStorage:{use:e,owner:t,repo:a,branch:n,token:r}}=ue.A.getState();return!!(e&&t&&a&&n&&r)})()&&t(),{startSyncData:async e=>(await t()).startSyncData(e),updateSettings:async e=>(await t()).updateSettings(e)}},dc=(e,t)=>e&&t?"error":"secondary";var pc=function(){const{repoUrl:e,dropboxActive:t,gitActive:a,syncLastUpdate:r,autoDropboxSync:l,startSync:o,cancelSync:F}=(()=>{const e=fe(),{remoteImport:t}=Pe(),{setSyncSelect:a}=(0,he.A)(),{gitStorage:n,dropboxStorage:r,syncLastUpdate:l}=(0,ue.A)();return{repoUrl:`https://github.com/${n.owner}/${n.repo}/tree/${n.branch}`,dropboxActive:!(!r.use||!r.accessToken),gitActive:!!(n.use&&n.owner&&n.repo&&n.branch&&n.throttle&&n.token),autoDropboxSync:r.autoDropboxSync||!1,syncLastUpdate:l,startSync:(a,n)=>{if("dropbox"===a)de(e,t).startSyncData(n);else if("dropboximages"===a)de(e,t).startSyncImages();else{if("diff"===n)throw new Error("diff is invalid direction for github sync");mc(t).startSyncData(n)}},cancelSync:()=>a(!1)}})(),s=l&&r.local!==r.dropbox;return n.createElement(M,{deny:F,header:"Synchronize"},n.createElement(i.A,{direction:"column",gap:4,sx:{"& .MuiButton-endIcon svg":{fontSize:32}}},a&&n.createElement(i.A,{direction:"column",gap:2},n.createElement(w.A,{variant:"contained",color:"secondary",startIcon:n.createElement(PF.A,null),endIcon:n.createElement(nc.A,null),title:`Synchronize to GitHub\n${e}`,onClick:()=>{o("git","up")}},"Synchronize to GitHub"),n.createElement(w.A,{variant:"contained",color:"secondary",startIcon:n.createElement(PF.A,null),endIcon:n.createElement(cc.A,null),title:`Synchronize from GitHub\n${e}`,onClick:()=>{o("git","down")}},"Synchronize from GitHub")),t&&n.createElement(i.A,{direction:"column",gap:2},n.createElement(i.A,{direction:"column",gap:1},n.createElement(w.A,{variant:"contained",color:dc(s,r.local<r.dropbox),endIcon:n.createElement(nc.A,null),title:"Synchronize to Dropbox",onClick:()=>{o("dropbox","up")}},"Synchronize to Dropbox"),s&&r.local<r.dropbox&&n.createElement(Fa.A,{variant:"caption"},"There are pending remote changes. If you synchronize to dropbox now, these will be lost.")),n.createElement(i.A,{direction:"column",gap:1},n.createElement(w.A,{variant:"contained",color:dc(s,r.local>r.dropbox),endIcon:n.createElement(cc.A,null),title:"Synchronize from Dropbox",onClick:()=>{o("dropbox","down")}},"Synchronize from Dropbox"),s&&r.local>r.dropbox&&n.createElement(Fa.A,{variant:"caption"},"There are local changes not synched to dropbox yet. If you synchronize from dropbox now, these will be lost.")),n.createElement(w.A,{variant:"contained",color:"secondary",endIcon:n.createElement(nc.A,null),title:"Synchronize images to Dropbox",onClick:()=>{o("dropboximages","up")}},"Synchronize images to Dropbox"))))},gc=a(31604);var hc=e=>{return Math.floor(e)===e&&(t=e,Boolean(t&&!(t&t-1)));var t};var fc=function({imageData:e,scaleFactor:t,width:a,height:r,fileName:l,palette:o,dither:F,contrastBaseValues:s}){const c=(0,n.useRef)(null),u=(0,n.useRef)(null);return(0,n.useEffect)((()=>{c.current&&u.current&&s?.length&&(({targetCanvas:e,originalCanvas:t,imageData:a,palette:n,dither:r,contrastBaseValues:l})=>{const o=n.map((e=>({r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}))),i=e.getContext("2d"),F=t.getContext("2d");i&&F?(i.putImageData(cn({imageData:a,contrastBaseValues:l,dither:r,colors:o}),0,0),F.putImageData(a,0,0)):Fn.error("canvas context is missing")})({targetCanvas:c.current,originalCanvas:u.current,imageData:e,palette:o,dither:F,contrastBaseValues:s})})),n.createElement(i.A,{direction:"column",gap:1},n.createElement(i.A,{title:`${l} - ${t}x`,direction:"row",gap:1,justifyContent:"space-between",alignItems:"center"},n.createElement("canvas",{width:a,height:r,ref:u}),n.createElement(gc.A,{fontSize:"large"}),n.createElement("canvas",{width:a,height:r,ref:c})),hc(t)?null:n.createElement(Oa.A,{severity:"warning",variant:"filled"},`The scale factor of your image is ${t.toPrecision(3)}. To get a clean result without artifacts, try to import only images with it's dimensions being scaled by powers of two. (1, 2, 4, 8 ...)`))},Ec=a(51084);var Ac=function(){const{bitmapQueue:e,bitmapQueueCancel:t}=ge(),{bitmapQueueDither:a,bitmapQueueSetting:r,setBitmapQueueDither:l,setBitmapQueueSetting:o}=(0,u.A)(),F=(0,n.useMemo)((()=>(Ec.C.find((({value:e})=>e===r))||Ec.C[0]).baseValues),[r]);return n.createElement(M,{header:"Prepare Bitmaps for import",confirm:()=>{dn({bitmapQueue:e,dither:a,contrastBaseValues:F})},deny:t},n.createElement(i.A,{direction:"column",gap:4},e.map(((e,t)=>n.createElement(fc,{key:t,imageData:e.imageData,scaleFactor:e.scaleFactor,width:e.width,height:e.height,fileName:e.fileName,dither:a,contrastBaseValues:F,palette:["#ffffff","#aaaaaa","#555555","#000000"]}))),n.createElement(Oi.A,{label:"Enable Dither",control:n.createElement(_i.A,{checked:a,onChange:({target:e})=>{l(e.checked)}})}),n.createElement(Ra.A,{value:r,label:"Contrast preset",select:!0,size:"small",onChange:e=>{o(e.target.value)}},Ec.C.map((({value:e,name:t})=>n.createElement(Le.A,{key:e,value:e},t))))))},vc=a(40936);var bc=function({importItem:e,paletteShort:t}){const{tiles:a,fileName:r,lastModified:l,imageHash:o,tempId:F}=e,{palettes:s,images:c}=(0,ie.h)(),m=s.find((({shortName:e})=>e===t)),d=c.find((({hash:e})=>e===o)),{importQueue:p}=ge(),h=p.filter((e=>e.imageHash===o)).length,{preferredLocale:f}=(0,u.A)(),{frameQueueAdd:E,importQueueCancelOne:A}=ge(),v=(0,n.useMemo)((()=>h>1?{color:"error",title:"This image exists multiple times within this queue",badgeContent:"D"}:d?{color:"warning",title:"This image has already been imported"+(d.title?` as "${d.title}"`:""),badgeContent:"I"}:{}),[h,d]);return n.createElement(i.A,{direction:"row",gap:2,alignItems:"center",justifyContent:"space-between",component:"li",sx:{"--zoom-image-top":0,"--zoom-image-left":0,"--zoom-image-width":"60px","--zoom-image-z-index":"initial","& > *":{flexGrow:1}}},n.createElement(i.A,{direction:"row",gap:2,alignItems:"center",justifyContent:"left"},n.createElement(y.A,{sx:{height:a.length/2.5/2.66+"px",flex:"60px 0 0",position:"relative","& > *":{top:"var(--zoom-image-top)",left:"var(--zoom-image-left)",width:"var(--zoom-image-width)",zIndex:"var(--zoom-image-z-index)",transition:"width 150ms ease-in-out, left 150ms ease-in-out, top 150ms ease-in-out",position:"absolute",outline:"none","@media (any-hover: none)":{"&:focus":{"--zoom-image-top":-12,"--zoom-image-left":-12,"--zoom-image-width":"160px","--zoom-image-z-index":2}}},"@media (any-hover: hover)":{"& > *":{pointerEvents:"none"},"&:hover":{"--zoom-image-top":-12,"--zoom-image-left":-12,"--zoom-image-width":"160px","--zoom-image-z-index":2}}}},n.createElement(y.A,{tabIndex:window.matchMedia("(any-hover: none)").matches?0:void 0},n.createElement(re,{tiles:a,invertPalette:!1,lockFrame:!1,palette:m?.palette,imageStartLine:2,asThumb:!0}))),n.createElement(y.A,null,n.createElement(Fa.A,{variant:"caption",component:"p"},r),l&&l>0&&n.createElement(Fa.A,{variant:"caption",component:"p"},(0,ua.A)(Ue()(l),f)))),n.createElement(i.A,{direction:"row",gap:2,alignItems:"center",justifyContent:"right"},n.createElement(y.A,null,n.createElement(bt.A,null,n.createElement(g.A,{title:"Import image as frame",disabled:a.length/20<14,onClick:()=>E([e])},n.createElement(vc.A,null)),n.createElement(vt.A,{...v,anchorOrigin:{vertical:"bottom",horizontal:"right"},overlap:"circular"},n.createElement(g.A,{title:"Remove image from queue",onClick:()=>A(F)},n.createElement(Oe.A,null)))))))},yc=a(32317),wc=a(38438);const Cc=(0,Ea.A)("fileName");var Ic=()=>{const{importPad:e,setActivePalette:t,activePalette:a}=(0,u.A)(),{cancelEditImageGroup:r}=X(),{addImageGroup:l}=(0,ie.h)(),{setImageSelection:o}=(0,_.A)(),{addImages:i,importQueueCancel:F}=fe(),s=new(wn())(1,1/0),{view:c}=G(),{navigateToGroup:m}=Xe(),{importQueue:d}=ge(),[p,g]=(0,n.useState)(""),[h,f]=(0,n.useState)(d.length>3),[E,A]=(0,n.useState)({initial:[],add:[],remove:[]});return{importQueue:d,importPad:e,palette:a,frame:p,tagChanges:E,createGroup:h,updateTagChanges:A,resetTagChanges:()=>{A((({initial:e})=>({initial:e,add:[],remove:[]})))},setFrame:g,setCreateGroup:f,runImport:async()=>{const t=await Promise.all(Cc(d).map(((t,n)=>{const{tiles:r,fileName:l,meta:o,lastModified:i}=t;return s.add((()=>(0,yc.A)({lines:e?(0,wc.A)(r):r,filename:l,palette:a,frame:p,tags:E.add,created:Ue()((i||Date.now())+n).format(se.i$),meta:o})))}))),n=t.map((({hash:e})=>e));if(i(t),h){const e=`Import ${Ue()().format(se.fg)}`,a=Qe(e);r();const o=ze();l({id:o,slug:a,title:e,created:Ue()(Date.now()).format(se.i$),coverImage:t[0].hash,images:n,groups:[]},c.id),m(o)}o(n)},cancelImport:F,setActivePalette:t}};var Sc=function(){const{frame:e,palette:t,importQueue:a,tagChanges:r,createGroup:l,setFrame:o,setActivePalette:F,setCreateGroup:s,updateTagChanges:c,resetTagChanges:u,runImport:m,cancelImport:d}=Ic();return n.createElement(M,{header:`Image Import (${a.length} images)`,confirm:m,deny:d},n.createElement(i.A,{direction:"column",gap:4},n.createElement(i.A,{direction:"column",component:"ul",gap:1},a.map((e=>n.createElement(bc,{key:e.tempId,paletteShort:t,importItem:e})))),n.createElement(qF,{noFancy:!0,value:t,onChange:F}),n.createElement(UF,{selectLabel:"Modify Frame",frame:e,lockFrame:!1,noFrameOption:"No frame / import as is",updateFrame:o}),n.createElement(ss,{tags:r,resetTags:u,updateTags:(e,t)=>{c({...r,...is(r,{mode:e,tag:t})})}}),n.createElement(Oi.A,{label:"Create group from images at current location",control:n.createElement(_i.A,{checked:l,onChange:({target:e})=>{s(e.checked)}})})))};const xc=["FFFF8080BFBFA0A0A0A0A0A0A0A0A0A0","FFFF0000FFFF00000000010103030707","FFFF0000FFFF7F7FFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFFFFFFFFFFFFFFFFFFFF","FFFF0000FFFFFEFEFFFFFFFFFFFFFFFF","FFFF0000FFFF000000008080C0C0E0E0","FFFF0101FDFD05050505050505050505","A0A0A0A0A0A0A0A0A0A0A1A1A3A3A7A7","070703030101000000008080C0C0E0E0","FFFFFFFFFFFFFFFF7F7F3F3F1F1F0F0F","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFEFEFCFCF8F8F0F0","E0E0C0C0808000000000010103030707","050505050505050505058585C5C5E5E5","AFAFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","F0F0F8F8FCFCFEFEFFFFFFFFFFFFFFFF","070703030101000001018383C7C7EFEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","E0E0C0C0808000008080C1C1E3E3F7F7","0F0F1F1F3F3F7F7FFFFFFFFFFFFFFFFF","F5F5FDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFF0F0F0F0F0F0F0F0","FFFFFFFFFFFFFFFF3F3F3F3F3F3F3F3F","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0","30303030303030303030303030303030","42214000000040206020602060206020","85C3800101000140C140C140C140C140","FCF0D0E0E0C080C181C1C181C181FEFC","1F0F0307070382038003800380030003","C4828000000004020602060206020602","0F070F070F060E060C060C060C060C06","A1C08000000008040804080400000000","FF7F5F3F3F1F0F1F1F0F1F0F1F0F1F0F","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0","30303030303030303030303030303030","60206020602060206020602060206020","C140C140C140C140C140C140C140C140","E8F0E0C081C080C1C181C18180C180C0","00030003800380038003810381030103","0602060206020602060000008000C482","0C060C060C060C060C060C060E060F06","00000F070C040C040C040C0408040000","1F0FFFFF1F0F1F0F1F0F1F0F0F1F3F1F","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","F0F0F0F0FFFFFFFFFFFFFFFFFFFFFFFF","30303030FFFFFFFFFFFFFFFFFFFFFFFF","60206020FFFFFFFFFFFFFFFFFFFFFFFF","C140C140FFFFFFFFFFFFFFFFFFFFFFFF","C0C0D1E0FFFFFFFFFFFFFFFFFFFFFFFF","01030083FFFFFFFFFFFFFFFFFFFFFFFF","FEFE040200008000A0C0FFFFFFFFFFFF","0F070F07070F0F1F5F3FFFFFFFFFFFFF","8000A0C0FFFFFFFFFFFFFFFFFFFFFFFF","1F3FFF7FFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFBFBF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FDFDFDFDFDFDFDFDFDFDFDFDFDFDFDFD","BFBFBFBFBFBFBFBFBFBFBFBFBFBFAFAF","FFFFFFFFFFFFFFFFFEFEFCFCF8F8F0F0","EFEFC7C7838301010000010103030707","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","F7F7E3E3C1C1808000008080C0C0E0E0","FFFFFFFFFFFFFFFF7F7F3F3F1F1F0F0F","FDFDFDFDFDFDFDFDFDFDFDFDFDFDF5F5","A7A7A3A3A1A1A0A0A0A0A0A0A0A0A0A0","E0E0C0C0808000000000010103030707","0F0F1F1F3F3F7F7FFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","F0F0F8F8FCFCFEFEFFFFFFFFFFFFFFFF","070703030101000000008080C0C0E0E0","E5E5C5C5858505050505050505050505","A0A0A0A0A0A0A0A0A0A0BFBF8080FFFF","07070303010100000000FFFF0000FFFF","FFFFFFFFFFFFFFFF7F7FFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF","FFFFFFFFFFFFFFFFFEFEFFFF0000FFFF","E0E0C0C0808000000000FFFF0000FFFF","05050505050505050505FDFD0101FFFF"];var kc=function({tiles:e,startLine:t,setStartLine:a}){const{activePalette:r}=(0,u.A)(),{palettes:l}=(0,ie.h)(),o=l.find((({shortName:e})=>e===r))?.palette,F=(0,n.useMemo)((()=>{const a=[];a.push(...e.slice(0,20*t));for(let n=0;n<14;n+=1){const r=20*(n+t),l=r+18,o=16*n;a.push(...e.slice(r,r+2),...xc.slice(o,o+16),...e.slice(l,l+2))}return a.push(...e.slice(20*(t+14))),a}),[e,t]);return n.createElement(i.A,{direction:"row",gap:3,justifyContent:"center"},n.createElement(re,{tiles:F,palette:o,imageStartLine:t}),n.createElement(i.A,{direction:"column",justifyContent:"center"},n.createElement(bt.A,{orientation:"vertical",variant:"contained",size:"large",color:"tertiary",fullWidth:!0},n.createElement(w.A,{onClick:()=>a(t-1),disabled:t<=0,endIcon:n.createElement(TF.A,null)},"Move image up"),n.createElement(w.A,{onClick:()=>a(t+1),disabled:t>=e.length/20-14,endIcon:n.createElement(DF.A,null)},"Move image down"))))};var Pc=function(){const{dismissDialog:e}=(0,pe.A)(),{frameQueue:t,frameQueueCancelOne:a,importQueueCancelOne:r}=ge(),{updateLastSyncLocalNow:l}=fe(),{addFrames:o,updateFrameGroups:i}=(0,ie.h)(),F=t[0],[s,c]=(0,n.useState)(""),[u,m]=(0,n.useState)(Math.floor((F.tiles.length-280)/40)),{fullId:d,formValid:p,groups:g,frameGroup:h,frameIndex:f,setFrameIndex:E,frameName:A,setFrameGroup:v,setFrameName:b,idValid:y,groupIdValid:w,frameIndexValid:C}=Ss({id:"",hash:"",name:F.fileName});return n.createElement(M,{header:`Import new Frame as "${d}"`,canConfirm:p,confirm:async()=>{const t=await(0,ce.R_)(F.tiles,u);e(0),F.tempId&&(r(F.tempId),a(F.tempId)),o([{id:d,name:A,hash:t}]),s?.trim()&&i([{id:h,name:s}]),l()},deny:()=>a(F.tempId)},n.createElement(xs,{frameIndex:f,setFrameGroup:v,frameName:A,frameGroup:h,setFrameName:b,groupIdValid:w,idValid:y,frameIndexValid:C,setFrameIndex:E,groups:g,fullId:d,frameGroupName:s,setFrameGroupName:c,extraFields:n.createElement(kc,{tiles:F.tiles,startLine:u,setStartLine:m})}))};const Tc=(e,t)=>!!t.find((({hashes:t})=>!!t&&Object.values(t).includes(e))),Dc=(e,t)=>!!t.find((t=>t.hash===e)),Mc=async({images:e,frames:t})=>{await(0,Se.ZU)();(await Se.mU.keys()).forEach((e=>t=>{Tc(t,e)||Dc(t,e)||(0,Ja.yH)(t)})(e));(await Se.Uv.keys()).forEach((e=>t=>{((e,t)=>!!t.find((t=>t.hash===e)))(t,e)||(0,Ja.t9)(t)})(t))},Bc=async e=>{await(0,Se.ZU)();return(await Se.mU.keys()).filter((e=>!e.startsWith("dummy"))).filter((e=>t=>!Tc(t,e)&&!Dc(t,e))(e))},Rc=async e=>{await(0,Se.ZU)();return(await Se.Uv.keys()).filter((e=>!e.startsWith("dummy"))).filter((e=>t=>!e.find((e=>e.hash===t)))(e))};var Nc=a(66750);const Lc=async(e,t)=>{await(0,Se.ZU)();return(await Promise.all(e.map((async e=>{try{const a=await t.getItem(e);if(!a)return null;return{hash:e,lines:(await(0,Nc.U)(a)).split("\n"),binary:a}}catch(e){return null}})))).reduce(bo.N,[])};var Gc=()=>{const{trashCount:e,showTrashCount:t}=(0,he.A)(),{frames:a,images:r}=(0,ie.h)(),{updateTrashCount:l}=(0,he.A)(),o=(0,n.useCallback)((async()=>{const e=await Rc(a),t=await Lc(e,Se.Uv),n={},r={state:{frames:t.map(((e,t)=>{try{return n[`frame-${e.hash}`]=e.binary,{hash:e.hash,name:`Backup export ${e.hash}`,id:`bak${t.toString(10).padStart(2,"0")}`}}catch(e){return null}})).reduce(bo.N,[]),frameGroups:[{id:"bak",name:"Re-imported trash frames"}],lastUpdateUTC:Math.floor((new Date).getTime()/1e3),version:ie.A}};(0,Xs.saveAs)(new Blob([...JSON.stringify({...r,...n},null,2)]),"backup_frames.json")}),[a]),i=(0,n.useCallback)((async()=>{const e=(await Rc(a)).length,t=(await Bc(r)).length;l(e,t)}),[a,r,l]),F=(0,n.useCallback)((async()=>{await Mc({images:r,frames:a}),t(!1),window.requestAnimationFrame((()=>{i()}))}),[i,a,r,t]);return{showTrashCount:t,purgeTrash:F,downloadImages:async()=>{const e=await Bc(r),t=await Lc(e,Se.mU),a={},n={state:{images:t.map((e=>{try{return a[e.hash]=e.binary,{hash:e.hash,created:Ue()().format(se.i$),title:`Backup export ${e.hash}`,lines:e.lines.length,tags:["backup"],palette:"bw",framePalette:"bw",invertPalette:!1,invertFramePalette:!1,frame:""}}catch(e){return null}})).reduce(it.iy,[]),lastUpdateUTC:Math.floor((new Date).getTime()/1e3),version:ie.A}};(0,Xs.saveAs)(new Blob([...JSON.stringify({...n,...a},null,2)]),"backup_images.json")},downloadFrames:o,checkUpdateTrashCount:i,trashCount:e}};var $c=function(){const{showTrashCount:e,purgeTrash:t,downloadImages:a,downloadFrames:r,trashCount:l}=Gc(),o=l.frames+l.images;return n.createElement(M,{deny:()=>{e(!1)},header:`Trash (${o} items)`,contentWidth:"auto",actionButtons:n.createElement(n.Fragment,null,n.createElement(w.A,{variant:"contained",color:"secondary",title:"Download deleted frames",disabled:0===l.frames,onClick:r},"Download frames"),n.createElement(w.A,{variant:"contained",color:"secondary",title:"Download deleted images",disabled:0===l.images,onClick:a},"Download images"),n.createElement(w.A,{variant:"contained",color:"error",title:"Purge all",disabled:0===o,onClick:t},`Purge all (${o})`))},n.createElement(i.A,{direction:"column",gap:2},n.createElement(Fa.A,{variant:"body2"},`Deleted frames: ${l.frames}`),n.createElement(Fa.A,{variant:"body2"},`Deleted images: ${l.images}`)))},Oc=a(86860);var _c=function(){const{pickColors:e,setEditPalette:t,cancelEditPalette:a,cancelPickColors:r}=X(),[l,o]=(0,n.useState)([0,3,6,9]),F=Bs(),s=(0,n.useMemo)((()=>e?Array(4).fill(null).map(((t,a)=>{const n=l[a],r=e.colors[n];return r?(([e,t,a])=>["#",Math.min(255,Math.max(0,e)).toString(16).padStart(2,"0"),Math.min(255,Math.max(0,t)).toString(16).padStart(2,"0"),Math.min(255,Math.max(0,a)).toString(16).padStart(2,"0")].join(""))(r):"#000000"})):[]),[e,l]);return e?n.createElement(M,{confirm:()=>{t({name:`From file ${e.fileName}`,shortName:Me.mI,palette:s,origin:"generated from file",isPredefined:!1})},canConfirm:4===l.length,deny:()=>{r(),a()},header:`Pick colors from "${e.fileName}"`,contentWidth:"auto"},n.createElement(i.A,{direction:"column",gap:4},n.createElement(i.A,{direction:"row",gap:2,component:"ul",justifyContent:"space-around"},F.map((e=>n.createElement(y.A,{key:e.hash,component:"li"},n.createElement(Te,{hash:e.hash,invertPalette:!1,invertFramePalette:!1,lockFrame:!1,palette:s,framePalette:s}))))),n.createElement(dt.A,{value:l,onChange:(e,t)=>o([...t].sort()),sx:{display:"flex",justifyContent:"space-around",gap:0}},e.colors.map(((e,t)=>n.createElement(mt.A,{key:t,value:t,sx:{"--palette-color":`rgb(${e.join(",")})`,color:"var(--palette-color)",borderRadius:0,width:48,height:48,padding:0,border:"none","&&.Mui-selected":{border:"none",background:"none",color:"var(--palette-color)"},"& > svg":{width:"inherit",height:"inherit"}}},l.includes(t)?n.createElement(Go.A,null):n.createElement(Oc.A,null))))),n.createElement(i.A,{direction:"row",gap:0,sx:{"& > .MuiBox-root":{height:"32px",flexGrow:1}}},s.map(((e,t)=>n.createElement(y.A,{key:t,title:e,sx:{backgroundColor:e}})))))):null};var jc=function(){const{enableImageGroups:e}=(0,u.A)(),{dialogs:t}=(0,pe.A)(),a=!!t.length,{editFrame:r,editImageGroup:l,editImages:o,editPalette:i,editRGBNImages:F,pickColors:s}=X(),c=!!o?.batch?.length,m=!!r,d=!!l&&e,p=!!i,g=F.length>0,h=!!s,{filtersVisible:f,sortOptionsVisible:E}=(0,_.A)(),{bitmapQueue:A,importQueue:v,frameQueue:b}=ge(),y=!!A.length,w=!!v.length,C=!!b.length,{lightboxImage:I,dragover:S,trashCount:{show:x},progress:k,progressLog:P,syncSelect:T,videoSelection:D}=(0,he.A)(),M=!!P.git.length||!!P.dropbox.length,B=!!k.gif||!!k.printer||!!k.plugin;switch(!0){case a:return n.createElement(LF,null);case C:return n.createElement(Pc,null);case y:return n.createElement(Ac,null);case w:return n.createElement(Sc,null);case c:return n.createElement(Cs,null);case d:return n.createElement(Is,null);case m:return n.createElement(ks,null);case p:return n.createElement(Rs,null);case g:return n.createElement(zs,null);case!!D?.length:return n.createElement(Ks,null);case h:return n.createElement(_c,null);case null!==I:return n.createElement(ac,null);case f:return n.createElement(ic,null);case E:return n.createElement(sc,null);case T:return n.createElement(pc,null);case x:return n.createElement($c,null);case S:return n.createElement(lc,null);case M:return n.createElement(MF,null);case B:return n.createElement(BF,null);default:return n.createElement($i,null)}},Vc=a(88629);var Uc=function({dismiss:e,errorMessage:t}){const[a,r]=(0,n.useState)(!1);return n.createElement(Oa.A,{severity:"error",variant:"filled",sx:{minWidth:300},action:n.createElement(n.Fragment,null,t.error.stack&&!a&&n.createElement(g.A,{size:"small",title:"Show error stack","aria-label":"close",color:"inherit",onClick:()=>r(!0)},n.createElement(Vc.A,{fontSize:"small"})),n.createElement(g.A,{size:"small","aria-label":"close",color:"inherit",onClick:(t,a)=>{"clickaway"!==a&&e()}},n.createElement(C.A,{fontSize:"small"})))},n.createElement(GF.A,{sx:{color:"inherit"}},t.error.message),a&&n.createElement(Fa.A,{variant:"caption",fontFamily:"monospace",component:"pre",sx:e=>sa(0,{backgroundColor:"#FFFFFF22",maxHeight:"200px",overflow:"auto",p:1})},t.error.stack))};var zc=function(){const{errors:e,dismissError:t}=(0,he.A)();return n.createElement(i.A,{direction:"column",gap:4,sx:e=>({position:"fixed",top:e.spacing(10),right:e.spacing(2),zIndex:10})},e.map(((e,a)=>n.createElement(Uc,{key:e.id,dismiss:()=>t(a),errorMessage:e}))))};const Wc=(e,t)=>e.filter((e=>!t.includes(e))),Hc=(e,t)=>t.reduce(((t,a)=>{const n=a.slug.replace(/[^A-Z0-9_-]+/gi,"_");let r=0,l=`${e}${n}/`;const o=e=>-1!==t.findIndex((({absolutePath:t})=>t===e));for(;o(l);)r+=1,l=`${e}${n}_${r}/`;return[...t,{absolutePath:l,group:a},...Hc(l,a.groups)]}),[]),Xc=(e,t)=>t.groups.length+t.images.length?[...e,t]:e,Yc=(e,t)=>(a,n)=>{const r=!!e.find((e=>n.hash===e)),l=t.find((({coverImage:e})=>n.hash===e)),o=!!l,i={...n};return l?.tags.length&&(i.tags=(0,U.A)([...i.tags,...l.tags])),r||o?[...a,i]:a},Qc=()=>{const{enableImageGroups:e}=(0,u.A)(),{setError:t}=(0,he.A)(),{imageGroups:a,images:r,setImageGroups:l}=(0,ie.h)(),o=(0,n.useMemo)((()=>e?a:[]),[e,a]),{path:i}=$(),F=(0,n.useMemo)((()=>(e=>{let t=[],a=[];return{groups:e.map((e=>{const n=(0,U.A)(Wc(e?.images,t)),r=(0,U.A)(Wc(e?.groups,a));return t=(0,U.A)([...t,...e.images]),a=(0,U.A)([...a,...e.groups]),{...e,images:n,groups:r}})),usedImageHashes:t,usedGroupIDs:a}})(o)),[o]),s=(0,n.useMemo)((()=>{const e=a=>n=>{const l=(e,t)=>{const a=F.groups.find((({id:e})=>e===t));return a?[...e,a]:e};let o;if(a>20)t(new Error(`Reached maximum inflate depth at group "${n.title||n.slug}" (${n.id})`)),o=[];else try{o=n.groups.reduce(l,[]).map(e(a+1)).reduce(Xc,[])}catch(e){o=[]}const i=r.reduce(Yc(n.images,o),[]),s=i.find((({hash:e})=>e===n.coverImage))||i[0],c=s?.hash||n.coverImage,u=(0,U.A)(i.map((e=>e.tags)).flat(1));return{id:n.id,slug:n.slug,created:n.created,title:n.title,coverImage:c,groups:o,images:i,tags:u}},a=F.groups.map(e(0)).reduce(Xc,[]).filter((({id:e})=>!F.usedGroupIDs.includes(e))),n=r.reduce(((e,{hash:t})=>F.usedImageHashes.includes(t)?e:[...e,t]),[]);return{...R(),groups:a,images:r.reduce(Yc(n,a),[])}}),[F,r,t]),c=(0,n.useMemo)((()=>Hc("",s.groups)),[s]);(0,n.useEffect)((()=>{if(e&&a.length>c.length){const e=c.map((({group:e})=>e.id)),t=a.filter((({id:t})=>e.includes(t)));l(t)}}),[e,c,l,a]);const m=(0,n.useMemo)((()=>c.reduce(((e,{group:t,absolutePath:a})=>{const n=a.split("/").length-1;return[...e,{value:a,name:`${Array(n).fill(" ").join("")}${t.title} (/${a.replace(/\/$/,"")})`}]}),[{value:"",name:"/"}])),[c]);return(0,n.useMemo)((()=>{const e=c.find((({absolutePath:e})=>e===i))?.group||s,t=e.groups.map((({coverImage:e})=>e)),a=e.images.filter((e=>!t.includes(e.hash)));return{view:e,covers:t,paths:c,images:a,pathsOptions:m,root:s}}),[i,c,m,s])};var Kc=function({children:e}){const t=Qc();return n.createElement(L.Provider,{value:t},e)};const qc=e=>t=>{const{frames:a,palettes:n}=ie.h.getState(),{handleExportFrame:r}=u.A.getState(),l=e.find((e=>e.hash===t));if(!l)throw new Error("image not found");const{palette:o,framePalette:i}=(0,Ft.s)(n,l);if(!o)throw new Error("selectedPalette not found");const F=()=>(0,Fe.T)(e,a)(l.hash),s=(0,it.pl)(l);return{getMeta:async()=>({...l,isRGBN:s}),getPalette:async()=>o,getTiles:F,getCanvas:async(e={})=>{const{scaleFactor:t=1,palette:n=o,framePalette:c=i,lockFrame:u,invertPalette:m,invertFramePalette:d,handleExportFrame:p=r}=e,g=await F();let h;const f=a.find((({id:e})=>e===l.frame)),E=f?await(0,ce.mZ)(f.hash):null,A=E?E.upper.length/20:2;if(s)h=await(0,te.y1)({tiles:g,palette:n,lockFrame:void 0!==u?u:l.lockFrame,imageStartLine:A,rotation:l.rotation,scaleFactor:t,handleExportFrame:p},"image/png");else{const e=n?.palette||te.CU,a=c?.palette||te.CU,{invertPalette:r,invertFramePalette:o}=(0,st.f)(l),i=(0,ae.C)({imagePalette:e,framePalette:a,invertPalette:void 0!==m?m:r,invertFramePalette:void 0!==d?d:o});h=await(0,te.Yn)({tiles:g,imageStartLine:A,rotation:l.rotation,scaleFactor:t,handleExportFrame:p,...i},"image/png")}const v=await createImageBitmap(h),b=document.createElement("canvas");b.width=v.width,b.height=v.height;return b.getContext("2d").drawImage(v,0,0),b}}};var Zc;!function(e){e.CONFIRM_ASK="CONFIRM_ASK",e.CONFIRM_ANSWERED="CONFIRM_ANSWERED",e.ADD_IMAGES="ADD_IMAGES",e.IMPORT_FILES="IMPORT_FILES"}(Zc||(Zc={}));var Jc=a(96763);const eu=({addImages:e,setDialog:t,dismissDialog:a},n)=>({importFiles:xo(n),setDialog:t,alert:(e,n)=>t({message:`Plugin: ${e}`,questions:()=>[{label:n,key:"info",type:je.V.INFO}],confirm:async()=>a(0)}),dismissDialog:()=>a(0),addImages:e}),tu=(e,t)=>{const{setDialog:a,dismissDialog:n,importFiles:r,addImages:l,alert:o}=eu(e,t);return{dispatch:e=>{switch(Jc.warn(`You are using a legacy method: "dispatch(${e.type})". Please refer to "env.functions" from your plugin to switch to up-to-date methods`),e.type){case Zc.CONFIRM_ASK:a(e.payload);break;case Zc.CONFIRM_ANSWERED:n();break;case Zc.IMPORT_FILES:r(e.payload.files);break;case Zc.ADD_IMAGES:l(e.payload);break;default:o("Plugin error:",`Unhandled Compatibility Action (type:"${e.type}")`)}}}},au=({setProgress:e,addUpdatePluginProperties:t,collectImageData:a,stores:n,importFn:r},l)=>{const{url:o,config:i={}}=l,F=t=>{e("plugin",t%1)};return new Promise((e=>{window.gbpwRegisterPlugin=l=>{if(window.gbpwRegisterPlugin=()=>{},l)try{const s=new l({saveAs:Xs.saveAs,progress:F,store:tu(n,r),functions:eu(n,r),collectImageData:a},i),{name:c,description:u="",configParams:m={},config:d={}}=s;t({url:o,name:c,description:u,configParams:m,config:d,loading:!1,error:!1}),e(s)}catch(a){t({url:o,loading:!1,error:a?.message}),e(null)}else e(null)};const l=document.createElement("script");document.head.appendChild(l),l.addEventListener("error",(()=>{window.gbpwRegisterPlugin=()=>{},t({url:o,loading:!1,error:"Loading error"}),e(null)})),l.src=o}))};var nu=function({children:e}){const{plugins:t,images:a,addUpdatePluginProperties:r}=(0,ie.h)(),l=fe(),{setProgress:o}=(0,he.A)(),{jsonImport:i}=Pe(),F=(0,n.useMemo)((()=>({collectImageData:qc(a),addUpdatePluginProperties:r,setProgress:o,stores:l,importFn:i})),[a,r,o,l,i]),s=(0,n.useMemo)((()=>async e=>{const a=t.find((t=>t.url===e))||{url:""};return au(F,a)}),[F,t]),c=(0,n.useCallback)((async e=>!!await au(F,e)),[F]),u=(0,n.useMemo)((()=>({runWithImage:async(e,t)=>{const n=qc(a)(t);(await s(e))?.withImage(n)},runWithImages:async(e,t)=>{const n=t.map(qc(a));(await s(e))?.withSelection(n)},validateAndAddPlugin:c})),[s,a,c]);return n.createElement(Tt.Provider,{value:u},e)};let ru,lu;var ou=function({children:e}){const{setProgress:t,setPrinterFunctions:r,setPrinterBusy:l,setPrinterData:o}=he.A.getState(),{dismissDialog:i,setDialog:F}=pe.A.getState(),{handleFileImport:s}=ko();(0,n.useEffect)((()=>{const e=e=>{const{printerUrl:a}=u.A.getState();let n;try{n=new URL(a).origin}catch(e){n=new URL(window.location.href).origin}if(e.origin!==n)return;const{fromRemotePrinter:{lines:c,progress:m,blob:d,blobsdone:p,commands:g,printerData:h}={}}=e.data,f=e.source;if(g&&(ru&&JSON.stringify(g)===JSON.stringify(he.A.getState().printerFunctions)||(r(g),l(!1),o(null)),lu=f,window.clearTimeout(ru),ru=window.setTimeout((()=>{ru=null,lu=null,l(!0),o(null),r([])}),1500)),c){const e=new File([c.join("\n")],"Text input.txt",{type:"text/plain"});s([e])}if(void 0!==m&&t("printer",m),d){const e=new File([d],"blob.unknown");s([e])}if(p){if("string"==typeof p[0])return void window.setTimeout((()=>{alert("You should update the web-app to a version > 1.16.0 on your printer for an optimized import experience :-)")}),200);const e=p.reduce(((e,t)=>{if(!t.blob||!t.ok)return e;const a=p.length>1?(e.length+1).toString(10).padStart(2,"0"):"";return[...e,new File([t.blob],`Printer ${a}`.trim(),{type:t.contentType})]}),[]);e.length?s(e,{fromPrinter:!0}):F({message:"No valid files received from WiFi-Printer",confirm:async()=>{i(0),l(!1),o(null)}})}h&&(o(h),l(!1))};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}),[i,s,F,l,o,r,t]);const c=(0,n.useMemo)((()=>({callRemoteFunction:async e=>{const{printerData:t}=he.A.getState();let n;if(l(!0),e===Qa.FETCHIMAGES&&t&&(n={dumps:t?.dumps}),await Promise.resolve().then(a.t.bind(a,74802,23)),await a.e(1668).then(a.t.bind(a,51668,23)),!lu)throw new Error("remote printer window object is missing");lu.postMessage({toRemotePrinter:{command:e,params:n}},"*")}})),[l]);return n.createElement(Xa.Provider,{value:c},e)};var iu=function(){const e=(0,r.FE)(),t=q(),{themeName:a}=(0,u.A)();(0,n.useEffect)((()=>{const e=document.querySelector("html")?.classList;e&&[FF.V.BRIGHT,FF.V.DARK].forEach((t=>{t===a?e.add(a):e.remove(t)}))}),[a]);const l=(0,n.useMemo)((()=>a===FF.V.DARK?wF:CF),[a]),o=(0,P.A)(l.breakpoints.down("md"));if(!e[1])return n.createElement(r.C5,{to:"/gallery/page/1",replace:!0});const F=e[1]?.handle?.headline,s={"--ddpx":t.ddpx};return n.createElement(nu,null,n.createElement(Kc,null,n.createElement(He,null,n.createElement(ou,null,n.createElement(Yi.A,{theme:l},n.createElement(Xi.Ay,null),n.createElement(SF,null),n.createElement(Hi.A,{maxWidth:"xl",sx:{...s,p:o?2:3,minHeight:"calc(100dvh - var(--navigation-height))",display:"flex",flexDirection:"column"}},n.createElement(i.A,{direction:"column",gap:2,sx:{flexGrow:1}},F&&n.createElement(Fa.A,{component:"h1",variant:"h1"},F),n.createElement(r.sv,null))),n.createElement(jc,null),n.createElement(zc,null))))))},Fu=a(96763);var su=function(){const e=(0,r.r5)();return Fu.error(e),n.createElement(i.A,{direction:"column",gap:4},n.createElement(Fa.A,{variant:"h4",component:"h1"},e?.statusText||e.message),n.createElement(ca,{text:e.stack||""}))};const cu={};var uu=()=>["jpeg","jpg","png","webp","bmp","gif"].filter((e=>(e=>{if(void 0!==cu[e])return cu[e];const t=document.createElement("canvas");t.width=2,t.height=2;const a=t.toDataURL(`image/${e}`);return cu[e]=0===a.indexOf(`data:image/${e};base64`),cu[e]})(e))),mu=a(37769),du=a(38004);var pu=function(){const{enableDebug:e,enableImageGroups:t,exportFileTypes:l,exportScaleFactors:o,fileNameStyle:F,forceMagicCheck:s,galleryClickAction:c,handleExportFrame:m,hideDates:d,importDeleted:p,importLastSeen:g,importPad:f,pageSize:E,preferredLocale:A,printerParams:v,printerUrl:b,savFrameTypes:y,setExportFileTypes:w,setExportScaleFactors:C,setEnableDebug:I,setEnableImageGroups:S,setFileNameStyle:x,setForceMagicCheck:k,setGalleryClickAction:P,setHandleExportFrame:T,setHideDates:D,setImportDeleted:M,setImportLastSeen:B,setImportPad:R,setPageSize:N,setPreferredLocale:L,setSavFrameTypes:G,setPrinterParams:$,setPrinterUrl:O}=(0,u.A)(),{frames:_,frameGroups:j}=(0,ie.h)(),V=(0,Io.A)(_,j),[U,z]=(0,n.useState)(E.toString(10)),[W,H]=(0,n.useState)(b),[X,Y]=(0,n.useState)(v),[Q,K]=(0,n.useState)([]),[q]=(0,n.useState)(Ue()()),{sortPalettes:Z,setSortPalettes:J,paletteSortOptions:ee}=Jo();return(0,n.useEffect)((()=>{(async()=>{const{default:e}=await a.e(2416).then(a.t.bind(a,52416,23)),t=e.all.filter((({tag:e})=>{try{return(0,ua.A)(Ue()(),e),!0}catch(e){return!1}}));K(t)})()}),[]),n.createElement(i.A,{direction:"column",gap:6},n.createElement(Ra.A,{id:"settings-pagesize",label:"Gallery page size",type:"text",helperText:"Set to 0 to disable pagination - might cause performance issues on large sets of images",value:U,onChange:e=>z(e.target.value),onBlur:()=>{const e=Math.abs(parseInt(U,10)||0);N(e),z(e.toString(10))}}),n.createElement(Ra.A,{value:c,label:"Click behaviour for gallery images",select:!0,helperText:"Ctrl+Click and Shift+Click will always select/range-select",onChange:e=>{P(e.target.value)}},ma.s.map((({value:e,label:t})=>n.createElement(Le.A,{key:e,value:e},t)))),n.createElement(ds.A,null,n.createElement(ps.A,{shrink:!0},"Image export dimensions"),n.createElement(dt.A,{fullWidth:!0,value:o,onChange:(e,t)=>{C(t)}},[1,2,3,4,5,6,8,10].map((e=>n.createElement(mt.A,{key:e,value:e,title:`${160*e}×${144*e}`},`${e}×`))))),n.createElement(ds.A,null,n.createElement(ps.A,{shrink:!0},"Image export filetypes"),n.createElement(dt.A,{fullWidth:!0,value:l,onChange:(e,t)=>{w(t)}},[...uu(),"txt","pgm"].map((e=>n.createElement(mt.A,{key:e,value:e,title:e},e))))),n.createElement(Ra.A,{id:"settings-handle-export-frames",value:m,label:"How to handle frames when exporting images",select:!0,onChange:e=>{T(e.target.value)}},Ws.map((({id:e,name:t})=>n.createElement(Le.A,{key:e,value:e},t)))),n.createElement(Ra.A,{id:"settings-filename-style",value:F,label:"Filename style",select:!0,onChange:e=>{x(e.target.value)}},du.y.map((({id:e,name:t})=>n.createElement(Le.A,{key:e,value:e},t)))),n.createElement(Ra.A,{id:"settings-sav-frames",value:y,disabled:!V.length,label:"Frames to be applied when importing Cartridge dumps",select:!0,slotProps:{inputLabel:{shrink:!0},select:{renderValue:e=>""===e?"None":V.find((({id:t})=>t===e))?.name||"Unknown"}},onChange:e=>{G(e.target.value)},placeholder:"None"},n.createElement(Le.A,{value:"",selected:!y},"None"),V.map((({id:e,name:t})=>n.createElement(Le.A,{key:e,value:e},t)))),n.createElement(Oi.A,{label:"Import ‘last seen’ image when importing Cartridge dumps",control:n.createElement(_i.A,{checked:g,onChange:({target:e})=>{B(e.checked)}})}),n.createElement(Oi.A,{label:"Import deleted images when importing Cartridge dumps",control:n.createElement(_i.A,{checked:p,onChange:({target:e})=>{M(e.checked)}})}),n.createElement(Oi.A,{label:"Force valid .sav file when importing",control:n.createElement(_i.A,{checked:s,onChange:({target:e})=>{k(e.checked)}})}),n.createElement(Oi.A,{label:"Pad images up to 144px height on import",control:n.createElement(_i.A,{checked:f,onChange:({target:e})=>{R(e.checked)}})}),n.createElement(Oi.A,{label:"Hide dates in gallery",control:n.createElement(_i.A,{checked:d,onChange:({target:e})=>{D(e.checked)}})}),n.createElement(Ra.A,{id:"settings-filename-style",value:Z,label:"Sort Palettes",select:!0,onChange:e=>{J(e.target.value)}},ee.map((({value:e,label:t})=>n.createElement(Le.A,{key:e,value:e},t)))),n.createElement(Ra.A,{id:"settings-filename-style",value:Q.length?A:"",label:"Preferred locale",helperText:`Example date format: ${(0,ua.A)(q,A)}`,select:!0,onChange:e=>{L(e.target.value)}},Q.map((({name:e,local:t,location:a,tag:r})=>n.createElement(Le.A,{key:r,value:r},`${t||e}${a?` - ${a}`:""} (${r})`)))),n.createElement(ji,null),"esp8266"===(0,fi._)()?.env?null:n.createElement(Ra.A,{id:"settings-printer-url",label:"Printer URL",type:"text",helperText:n.createElement(n.Fragment,null,"If you own a physical wifi-printer, you can add it's URL here and check the ",n.createElement(h.A,{component:r.N_,to:"/import"},"Import-tab")),value:W,onChange:e=>H(e.target.value),onBlur:()=>{const e=(0,mu.A)(W,"http");H(e),O(e)},onKeyUp:e=>{switch(e.key){case"Enter":{const e=(0,mu.A)(W,"http");H(e),O(e);break}case"Escape":H(b)}}}),"esp8266"===(0,fi._)()?.env||b?n.createElement(Ra.A,{id:"settings-printer-settings",label:"Additional printer settings",type:"text",value:X,onChange:e=>Y(e.target.value),onBlur:()=>{$(X)},onKeyUp:e=>{switch(e.key){case"Enter":$(X);break;case"Escape":Y(v)}}}):null,n.createElement(Oi.A,{label:"Show debug info",control:n.createElement(_i.A,{checked:e,onChange:({target:e})=>{I(e.checked)}})}),n.createElement(Oi.A,{label:"Enable Image Groups",control:n.createElement(_i.A,{checked:t,onChange:({target:e})=>{S(e.checked)}})}))},gu=a(70791),hu=a(31600);const fu=()=>{const[e,t]=(0,n.useState)(!1),a=(0,n.useMemo)((()=>n.createElement(g.A,{title:e?"Hide Password":"Show Password","aria-label":e?"hide the password":"display the password",color:"primary",onClick:()=>{t(!e)}},e?n.createElement(gu.A,null):n.createElement(hu.A,null))),[e]);return{type:(0,n.useMemo)((()=>e?"text":"password"),[e]),button:a,setShowPassword:t}};var Eu,Au=function(){const{gitStorage:e,setGitStorage:t}=(0,ue.A)(),[a,r]=(0,n.useState)(e.use||!1),[l,o]=(0,n.useState)(e.owner||""),[F,s]=(0,n.useState)(e.repo||""),[c,u]=(0,n.useState)(e.branch||""),[m,d]=(0,n.useState)(e.throttle?.toString(10)||"10"),[p,g]=(0,n.useState)(e.token||""),{type:f,button:E}=fu(),A=(0,n.useCallback)((a=>{t({...e,...a})}),[e,t]);return n.createElement(i.A,{direction:"column",gap:6},n.createElement(Oi.A,{label:"Use github as storage",control:n.createElement(_i.A,{checked:a,onChange:({target:e})=>{r(e.checked),A({use:e.checked})}})}),a?n.createElement(n.Fragment,null,n.createElement(Ra.A,{id:"settings-git-owner",label:"Owner",type:"text",value:l,onChange:e=>{o(e.target.value)},onBlur:()=>{A({owner:l})}}),n.createElement(Ra.A,{id:"settings-git-repo",label:"Repository name",type:"text",value:F,onChange:e=>{s(e.target.value)},onBlur:()=>{A({repo:F})}}),n.createElement(Ra.A,{id:"settings-git-branch",label:"Branch",type:"text",value:c,onChange:e=>{u(e.target.value)},onBlur:()=>{A({branch:c})}}),n.createElement(Ra.A,{id:"settings-git-throttle",label:"Throttle (in ms)",type:"text",value:m,onChange:e=>{d(e.target.value)},onBlur:()=>{const e=Math.min(10,Math.max(5e3,parseInt(m,10)));d(e.toString(10)),A({throttle:e})}}),n.createElement(Ra.A,{id:"settings-git-token",label:"Token",helperText:n.createElement(n.Fragment,null,"Go to GitHub to create a ",n.createElement(h.A,{href:"https://github.com/settings/personal-access-tokens/new",target:"_blank",rel:"noreferrer"},"new fine-grained personal access token"),", select the repository you want to use for synching and allow read/write for ",n.createElement(Fa.A,{component:"code",variant:"caption",sx:{fontFamily:"monospace",padding:"0 2px"}},'"Repository Permissions > Contents"')),type:f,value:p,slotProps:{input:{endAdornment:E},...cF},onChange:e=>{g(e.target.value)},onBlur:()=>{A({token:p})}})):null)};!function(e){e.NUMBER="number",e.STRING="string",e.MULTILINE="multiline"}(Eu||(Eu={}));const vu=(e,t)=>{switch(e){case Eu.NUMBER:{const e=parseFloat(t);return isNaN(e)?0:e}case Eu.STRING:case Eu.MULTILINE:return t||"";default:return t}},bu=e=>{switch(typeof e){case"string":return e;case"number":return e.toString(10)||"0";default:return""}};var yu=function({id:e,label:t,type:a,value:r,onChange:l}){const[o,i]=(0,n.useState)(bu(r));return n.createElement(Ra.A,{id:e,label:t,type:"text",multiline:a===Eu.MULTILINE,value:o,onChange:e=>{i(e.target.value)},onBlur:()=>{i(bu(vu(a,o))),l(vu(a,o))}})};var wu=function(e){const{deletePlugin:t,updatePluginConfig:a}=(0,ie.h)(),{url:r,name:F,description:s,configParams:c={},config:u={},error:m,loading:d,pluginIndex:p}=e;return n.createElement(l.A,{raised:!0,component:"li"},n.createElement(at.A,{title:n.createElement(i.A,{direction:"row",gap:2},n.createElement(Fa.A,{variant:"h3",component:"h3"},F),d&&n.createElement(le.A,{color:"secondary",size:22})),subheader:n.createElement(n.Fragment,null,n.createElement(Fa.A,{variant:"body2",component:"div"},s),n.createElement(Fa.A,{variant:"caption",component:"div"},r)),action:n.createElement(g.A,{title:`Delete Plugin "${F}"`,onClick:()=>t(r)},n.createElement(Oe.A,null))}),n.createElement(o.A,null,n.createElement(i.A,{direction:"column",gap:4},m&&n.createElement(Oa.A,{severity:"warning",icon:n.createElement(Pt.A,{fontSize:"inherit",color:"warning"})},m),Object.keys(c).map((e=>n.createElement(yu,{key:`${e}-${p}`,id:`${e}-${p}`,label:c[e].label,type:c[e].type,value:u[e],onChange:t=>{a(r,e,t)}}))))))};var Cu=function(){const{plugins:e}=(0,ie.h)(),{setError:t}=(0,he.A)(),{validateAndAddPlugin:a}=Dt(),[r,l]=(0,n.useState)(""),[o,F]=(0,n.useState)(!1);return n.createElement(i.A,{direction:"column",gap:6},n.createElement(Ra.A,{id:"plugin-settings-add-plugin",label:"Add Plugin",helperText:n.createElement(h.A,{rel:"noreferrer noopener nofollow",href:"https://herrzatacke.github.io/gb-printer-web-plugins/",target:"_blank"},"🔗 A selection plugins can be found here"),type:"text",disabled:o,value:r,slotProps:{input:{endAdornment:n.createElement(g.A,{disabled:!r||o,onClick:async()=>{F(!0),await a({url:r})?l(""):t(new Error("Could not install plugin.")),F(!1)}},n.createElement(Ro.A,null))},...cF},onChange:e=>{l(e.target.value)}}),n.createElement(i.A,{direction:"column",gap:1},n.createElement(Fa.A,{component:"h3",variant:"h3"},"Installed Plugins"),n.createElement(i.A,{direction:"column",gap:2,component:"ul"},e.map(((e,t)=>n.createElement(wu,{key:e.url,pluginIndex:t,...e}))))))},Iu=a(5431);var Su=function(){const{use:e,loggedIn:t,logout:a,startAuth:r,setDropboxStorage:l,path:o,autoDropboxSync:F}=(()=>{const e=fe(),{remoteImport:t}=Pe(),{dropboxStorage:a,dropboxLogout:n,setDropboxStorage:r}=(0,ue.A)();return{use:!!a.use,loggedIn:!!a.refreshToken,path:a.path||"",autoDropboxSync:a?.autoDropboxSync||!1,logout:n,setDropboxStorage:r,startAuth:()=>de(e,t).startAuth()}})(),[s,c]=(0,n.useState)(o);return n.createElement(i.A,{direction:"column",gap:6},n.createElement(Oi.A,{label:"Use Dropbox as storage",control:n.createElement(_i.A,{checked:e,onChange:({target:e})=>{l({use:e.checked})}})}),e?n.createElement(n.Fragment,null,n.createElement(Ra.A,{id:"dropbox-settings-path",label:"Subfolder",helperText:n.createElement(h.A,{title:`Open Dropbox folder:\nhttps://www.dropbox.com/home/Apps/GameBoyPrinter/${s}`,href:`https://www.dropbox.com/home/Apps/GameBoyPrinter/${s}`,target:"_blank",rel:"noreferrer"},"open folder"),type:"text",value:s,onChange:e=>{c(e.target.value)},onBlur:()=>{c((0,Iu.A)(s)),l({path:(0,Iu.A)(s)})}}),n.createElement(Oi.A,{label:n.createElement(n.Fragment,null,"Enable enhanced dropbox sync",n.createElement(Fa.A,{variant:"caption",component:"p",color:"error"},"This is an experimental feature.")),control:n.createElement(_i.A,{checked:F,onChange:({target:e})=>{l({autoDropboxSync:e.checked}),window.setTimeout((()=>{window.location.reload()}),300)}})}),n.createElement(bt.A,{variant:"contained",fullWidth:!0},n.createElement(w.A,{disabled:t,onClick:r},"Authenticate"),n.createElement(w.A,{disabled:!t,onClick:a},"Logout"))):null)};var xu=function(e){const{type:t,button:a}=fu();return n.createElement(l.A,{raised:!0,component:"li"},n.createElement(o.A,null,n.createElement(i.A,{direction:"column",gap:4},n.createElement(Ra.A,{id:`${e.id}-settings-ap-ssid`,label:"Network SSID",type:"text",value:e.ssid,slotProps:{...cF,input:{endAdornment:n.createElement(g.A,{title:"Delete Network",color:"primary",onClick:()=>{e.update({delete:!e.delete})}},n.createElement(Oe.A,null))}},disabled:!e.isNew||e.disabled,onChange:t=>{const a=t.target.value;e.update({ssid:a})}}),n.createElement(Ra.A,{id:`${e.id}-settings-ap-psk`,label:"Network Password",type:t,slotProps:{...cF,input:{endAdornment:a}},value:e.psk,disabled:e.disabled,onChange:t=>{const a=t.target.value;e.update({psk:a})}}),e.delete&&n.createElement(Oa.A,{severity:"error",icon:n.createElement(Oe.A,{fontSize:"inherit"})},"Network will be deleted"))))};const ku=(e,t)=>{t("loading");const a=new AbortController,n=a.signal;return(async()=>{try{const a=await fetch("/wificonfig/get",{signal:n}),r=await a.json();r.mdns=r.mdns||"",r.ap=r.ap||{ssid:"",psk:""},r.networks=r.networks||[],t(""),e(r)}catch(a){n.aborted||(t("error"),e(void 0))}})(),()=>{a.abort("Navigated while getting wifi settings")}};var Pu=function(){const[e,t]=(0,n.useState)(),[a,r]=(0,n.useState)("loading"),{type:F,button:s}=fu();if((0,n.useEffect)((()=>ku(t,r)),[t,r]),"loading"===a||!e)return n.createElement(y.A,{sx:{display:"flex",justifyContent:"center"}},n.createElement(le.A,{color:"secondary"}));const c=""!==a&&"updated"!==a;return n.createElement(i.A,{direction:"column",gap:6},n.createElement(i.A,{direction:"column",gap:1},n.createElement(Fa.A,{component:"h3",variant:"h3"},"Host Settings"),n.createElement(l.A,{raised:!0},n.createElement(o.A,null,n.createElement(i.A,{direction:"column",gap:4},n.createElement(Ra.A,{id:"settings-mdns",label:"mDNS Name (Bonjour/Avahi)",type:"text",disabled:c,value:e.mdns||"",onChange:a=>{const n=a.target.value;r("updated"),t({...e,mdns:n.trim()})}}),n.createElement(Ra.A,{id:"settings-ap-ssid",label:"Accesspoint SSID",type:"text",disabled:c,value:e.ap.ssid||"",onChange:a=>{const n=a.target.value;r("updated"),t({...e,ap:{...e.ap,ssid:n.trim()}})}}),n.createElement(Ra.A,{id:"settings-ap-psk",label:"Accesspoint Password",type:F,slotProps:{...cF,input:{endAdornment:s}},disabled:c,value:e.ap.psk||"",onChange:a=>{const n=a.target.value;r("updated"),t({...e,ap:{...e.ap,psk:n.trim()}})}}))))),n.createElement(i.A,{direction:"column",gap:1},n.createElement(Fa.A,{component:"h3",variant:"h3"},"Networks"),n.createElement(i.A,{direction:"column",gap:2,component:"ul"},e.networks.map(((a,l)=>{const{ssid:o,psk:i="",delete:F=!1,isNew:s=!1}=a;return n.createElement(xu,{key:`apconf-${l}`,id:`apconf-${l}`,ssid:o,psk:i,disabled:c,isNew:s,delete:F,update:n=>{const{networks:o}=e;o[l]={...a,...n},r("updated"),t({...e,networks:o})}})})),n.createElement(i.A,{component:"li",direction:"row",justifyContent:"flex-end"},n.createElement(w.A,{disabled:c,title:"Add Network",color:"primary",variant:"contained",startIcon:n.createElement(Ro.A,null),onClick:()=>{t({...e,networks:[...e?.networks||[],{ssid:"",psk:"",delete:!1,isNew:!0}]})}},"Add Network")))),n.createElement(bt.A,{fullWidth:!0,variant:"contained"},n.createElement(w.A,{disabled:"updated"!==a,onClick:()=>(async(e,t,a)=>{const n={...a,networks:a.networks.filter((e=>!0===e.delete||e.psk)).filter((e=>e.ssid)).filter((e=>!(e.delete&&e.isNew))).map((({ssid:e,psk:t,delete:a})=>({delete:a,ssid:e,psk:t})))};t("loading");try{const e=await fetch("/wificonfig/set",{method:"post",body:JSON.stringify(n)}),t=await e.json();if(t.error)throw new Error(t.error)}catch(a){alert(a),t("error"),e(void 0)}ku(e,t)})(t,r,e)},"Save WiFi-Settings")))};let Tu,Du=!1;var Mu=()=>{const{setDragover:e,setError:t}=(0,he.A)(),{jsonImport:a}=Pe(),r=(0,n.useMemo)((()=>xo(a)),[a]),l=(0,n.useCallback)((()=>{const a=t=>{t.preventDefault(),Du||e(!0),window.clearTimeout(Tu),Du=!0,Tu=window.setTimeout((()=>{Du=!1,e(!1)}),250)},n=async e=>{let a;e.preventDefault();const n=e.dataTransfer.items;if(n)a=[...n].reduce(((e,t)=>{if("file"===t.kind){const a=t.getAsFile();return a?[...e,a]:e}return e}),[]);else{a=[...e.dataTransfer.files]}try{await r(a)}catch(e){t(e)}},l=document.querySelector("body");if(!l)throw new Error("dafuq?");return l.addEventListener("dragover",a),l.addEventListener("drop",n),()=>{l.removeEventListener("dragover",a),l.removeEventListener("drop",n)}}),[r,e,t]);(0,n.useEffect)(l,[l])};var Bu=function(){Mu();const e=fe(),{remoteImport:t}=Pe();(0,n.useEffect)((()=>{const{subscribe:a}=de(e,t);return mc(t),a()}),[t,e]);const{checkUpdateTrashCount:a}=Gc();(0,n.useEffect)((()=>{a()}),[a]);const l=(0,r.Ge)([{path:"/",element:n.createElement(iu,null),errorElement:n.createElement(su,null),children:[{path:"/home",handle:{headline:"Game Boy Camera Gallery"},element:n.createElement(c,null)},{path:"/gallery/*",element:n.createElement(Ba,null),handle:{headline:"Gallery"}},{path:"/import",element:n.createElement(Do,null),handle:{headline:"Import"}},{path:"/palettes",element:n.createElement(ti,null),handle:{headline:"Palettes"}},{path:"/frames",element:n.createElement(ci,null),handle:{headline:"Frames"}},{path:"/settings",element:n.createElement(bi,null),handle:{headline:"Settings"},children:[{path:"generic",element:n.createElement(pu,null),handle:{headline:"Generic Settings"}},{path:"git",element:n.createElement(Au,null),handle:{headline:"Git Settings"}},{path:"plugins",element:n.createElement(Cu,null),handle:{headline:"Plugin Settings"}},{path:"dropbox",element:n.createElement(Su,null),handle:{headline:"Dropbox Settings"}},"esp8266"===(0,fi._)()?.env||"webpack-dev"===(0,fi._)()?.env?{path:"wifi",element:n.createElement(Pu,null),handle:{headline:"WiFi Settings"}}:null].reduce(bo.N,[])},{path:"/webusb",element:n.createElement(Vi,null)},{path:"/add-plugin/:pluginUrl?",element:n.createElement(Wi,null),handle:{headline:"Add Plugin"}}]}]);return n.createElement(r.pg,{router:l})}},56727:function(e,t,a){"use strict";const n=(0,a(71511).v)((e=>({dialogs:[],dismissDialog:t=>e((({dialogs:e})=>({dialogs:e.filter(((e,a)=>t!==a))}))),setDialog:t=>e((({dialogs:e})=>({dialogs:[t,...e]})))})));t.A=n},60318:function(e,t,a){"use strict";a.d(t,{s:function(){return l}});var n=a(27261),r=a(30498);const l=(e,t)=>{if((0,n.pl)(t)){const{palette:e}=t;return{palette:e}}const a=t,l=e.find((({shortName:e})=>e===a.palette))||r.Fv,o=e.find((({shortName:e})=>e===a.framePalette))||r.Fv;return{palette:l,framePalette:a.lockFrame?o:l}}},73052:function(e,t){"use strict";t.A=e=>{const t=[];return e.map((e=>{const{filename:a}=e,n=a.split("."),r=n.pop();if(!r)throw new Error("unknown file type");const l=n.join(".");let o=a,i=0;for(;t.includes(o);)i+=1,o=`${l}_(${i}).${r}`;return t.includes(o)||t.push(o),{...e,filename:o}}))}},76194:function(e,t,a){"use strict";var n=a(71511),r=a(87134),l=a(34704);const o=(0,n.v)((0,r.eh)((0,r.Zr)((e=>({dropboxStorage:{},gitStorage:{},syncLastUpdate:{dropbox:0,local:0},dropboxLogout:()=>e((({dropboxStorage:e})=>({dropboxStorage:{use:e.use}}))),setDropboxStorage:t=>e((({dropboxStorage:e})=>({dropboxStorage:{...e,...t}}))),setGitStorage:t=>e((({gitStorage:e})=>({gitStorage:{...e,...t}}))),setSyncLastUpdate:(t,a)=>e((({syncLastUpdate:e})=>({syncLastUpdate:{...e,[t]:a}})))})),{name:`${l.z}-storages`,storage:(0,r.KU)((()=>localStorage))})));t.A=o},76776:function(e,t,a){var n={"./af.js":[65662,5662],"./am.js":[82355,2355],"./ar-dz.js":[48361,8361],"./ar-iq.js":[13309,3309],"./ar-kw.js":[79865,9865],"./ar-ly.js":[85592,5592],"./ar-ma.js":[81289,1289],"./ar-sa.js":[40539,539],"./ar-tn.js":[76786,4405],"./ar.js":[2338,2338],"./az.js":[51130,1130],"./be.js":[51532,1532],"./bg.js":[39990,9990],"./bi.js":[95944,5944],"./bm.js":[71092,1092],"./bn-bd.js":[64608,4608],"./bn.js":[92509,2509],"./bo.js":[59294,9294],"./br.js":[72745,2745],"./bs.js":[25530,5530],"./ca.js":[25993,5993],"./cs.js":[9751,9751],"./cv.js":[4780,4780],"./cy.js":[95681,5681],"./da.js":[42706,2706],"./de-at.js":[32878,2878],"./de-ch.js":[13672,3672],"./de.js":[50494,494],"./dv.js":[82187,2187],"./el.js":[54072,4072],"./en-au.js":[59881,9881],"./en-ca.js":[21995,1995],"./en-gb.js":[72026,2026],"./en-ie.js":[17329,7329],"./en-il.js":[97690,7690],"./en-in.js":[60912,912],"./en-nz.js":[35571,5571],"./en-sg.js":[12673,2673],"./en-tt.js":[2619,2619],"./en.js":[65826,5826],"./eo.js":[33713,3713],"./es-do.js":[61219,1219],"./es-mx.js":[64719,4719],"./es-pr.js":[3532,3532],"./es-us.js":[32498,2498],"./es.js":[47317,7317],"./et.js":[4288,4288],"./eu.js":[94007,4007],"./fa.js":[90292,292],"./fi.js":[89964,9964],"./fo.js":[17674,7674],"./fr-ca.js":[86290,6290],"./fr-ch.js":[73433,3433],"./fr.js":[813,813],"./fy.js":[59836,9836],"./ga.js":[54061,4061],"./gd.js":[68418,8418],"./gl.js":[33562,3562],"./gom-latn.js":[78660,8660],"./gu.js":[57409,7409],"./he.js":[92010,2010],"./hi.js":[52830,2830],"./hr.js":[15811,5811],"./ht.js":[8809,1190],"./hu.js":[38298,8298],"./hy-am.js":[94309,4309],"./id.js":[87420,7420],"./is.js":[15513,5513],"./it-ch.js":[19286,9286],"./it.js":[33900,3900],"./ja.js":[50952,952],"./jv.js":[77741,7741],"./ka.js":[46481,6481],"./kk.js":[11335,1335],"./km.js":[36101,6101],"./kn.js":[6364,6364],"./ko.js":[88003,8003],"./ku.js":[16605,6605],"./ky.js":[34457,4457],"./lb.js":[88615,8615],"./lo.js":[73860,3860],"./lt.js":[34485,4485],"./lv.js":[76467,6467],"./me.js":[80623,623],"./mi.js":[32739,2739],"./mk.js":[75877,5877],"./ml.js":[75376,5376],"./mn.js":[12698,2698],"./mr.js":[46462,6462],"./ms-my.js":[26400,6400],"./ms.js":[79677,9677],"./mt.js":[99464,9464],"./my.js":[46803,6803],"./nb.js":[7205,7205],"./ne.js":[40880,880],"./nl-be.js":[60465,465],"./nl.js":[69423,9423],"./nn.js":[23473,3473],"./oc-lnc.js":[70225,225],"./pa-in.js":[39252,9252],"./pl.js":[63225,3225],"./pt-br.js":[92218,2218],"./pt.js":[72369,2369],"./rn.js":[34509,4509],"./ro.js":[24334,4334],"./ru.js":[62796,2796],"./rw.js":[35414,5414],"./sd.js":[63222,3222],"./se.js":[55285,5285],"./si.js":[65665,5665],"./sk.js":[46847,6847],"./sl.js":[39998,9998],"./sq.js":[95977,5977],"./sr-cyrl.js":[27439,7439],"./sr.js":[45616,5616],"./ss.js":[52487,2487],"./sv-fi.js":[9160,9160],"./sv.js":[21340,1340],"./sw.js":[2979,2979],"./ta.js":[77250,7250],"./te.js":[87406,7406],"./tet.js":[18928,8928],"./tg.js":[15012,5012],"./th.js":[47081,7081],"./tk.js":[62544,2544],"./tl-ph.js":[78142,8142],"./tlh.js":[60321,321],"./tr.js":[4895,4895],"./tzl.js":[3187,3187],"./tzm-latn.js":[58804,8804],"./tzm.js":[95084,5084],"./ug-cn.js":[79911,9911],"./uk.js":[34173,4173],"./ur.js":[51750,1750],"./uz-latn.js":[80950,950],"./uz.js":[54734,4734],"./vi.js":[40860,860],"./x-pseudo.js":[5760,5760],"./yo.js":[87933,7933],"./zh-cn.js":[16033,6033],"./zh-hk.js":[87741,122],"./zh-tw.js":[31349,1349],"./zh.js":[56007,6007]};function r(e){if(!a.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],r=t[0];return a.e(t[1]).then((function(){return a.t(r,23)}))}r.keys=function(){return Object.keys(n)},r.id=76776,e.exports=r},88137:function(e,t,a){"use strict";a.d(t,{PM:function(){return l},YZ:function(){return n},lt:function(){return r}});const n=(e,t)=>({...e,sortIndex:t}),r=e=>({...e,sortIndex:void 0}),l=e=>(t,a)=>{if(!e)return 0;const[n,r]=e.split("_"),l=t[n],o=a[n],i="desc"===r?-1:1;return l&&o?l>o?i:l<o?-i:t.sortIndex<a.sortIndex?i:-i:0}},88231:function(e,t,a){"use strict";var n=a(71511),r=a(51916),l=a.n(r),o=a(74353),i=a.n(o),F=a(33829);const s=(0,n.v)(((e,t)=>({dragover:!1,errors:[],isFullscreen:!1,lightboxImage:null,printerBusy:!1,printerData:null,printerFunctions:[],progress:{gif:0,printer:0,plugin:0},progressLog:{git:[],dropbox:[]},showSerials:!1,syncBusy:!1,syncSelect:!1,trashCount:{frames:0,images:0,show:!1},windowDimensions:{width:window.innerWidth,height:window.innerHeight},videoSelection:[],dismissError:a=>e({errors:t().errors.filter(((e,t)=>t!==a))}),resetProgressLog:()=>e({progressLog:{git:[],dropbox:[]}}),setDragover:t=>e({dragover:t}),setError:a=>e({errors:[...t().errors,{error:a,timestamp:i()().unix(),id:(0,F.A)()}]}),setIsFullscreen:t=>e({isFullscreen:t}),setPrinterBusy:t=>e({printerBusy:t}),setPrinterData:t=>e({printerData:t}),setPrinterFunctions:t=>e({printerFunctions:t}),setProgress:(a,n)=>e({progress:{...t().progress,[a]:n}}),setShowSerials:t=>e({showSerials:t}),setSyncBusy:t=>e({syncBusy:t}),setSyncSelect:t=>e({syncSelect:t}),setWindowDimensions:()=>e({windowDimensions:{width:window.innerWidth,height:window.innerHeight}}),showTrashCount:a=>e({trashCount:{...t().trashCount,show:a}}),updateTrashCount:(a,n)=>e({trashCount:{...t().trashCount,frames:a,images:n}}),setVideoSelection:t=>e({videoSelection:t}),setProgressLog:(a,n)=>{const{progressLog:r}=t();e({progressLog:{...r,[a]:[n,...r[a]]}})},setLightboxImage:t=>{null===t&&l().exit(),e({lightboxImage:t})},setLightboxImageNext:a=>{const n=t().lightboxImage;null!==n&&e({lightboxImage:Math.min(n+1,a-1)})},setLightboxImagePrev:()=>{const a=t().lightboxImage;null!==a&&e({lightboxImage:Math.max(a-1,0)})}})));window.se=s.getState().setError,t.A=s},96533:function(e,t,a){"use strict";a.d(t,{T:function(){return l},p:function(){return o}});var n=a(90521),r=a(27261);const l=(e,t,a)=>{const l=async(o,i,F,s)=>{const c=e.find((e=>o===e.hash)),u=("string"==typeof F?F:c?.frame)||void 0,m=t.find((({id:e})=>e===u))?.hash;if(!(s||c&&(0,r.pl)(c))){return await(0,n.Hh)(o,m,i,a)||[]}const d=s||c.hashes;return{r:d.r?await l(d.r,i,u):[],g:d.g?await l(d.g,i,u):[],b:d.b?await l(d.b,i,u):[],n:d.n?await l(d.n,i,u):[]}};return l},o=(e,t)=>{const a=l(e,t);return async e=>{const t=await a(e,!0,"");return t&&(t?.length||t.r?.length||t.g?.length||t.b?.length||t.n?.length)||0}}},98714:function(e,t,a){"use strict";a.d(t,{L2:function(){return F},_K:function(){return i}});var n=a(90521),r=a(88222),l=a(37482),o=a(27261);const i=async e=>{const t=e.split("\n").filter((e=>e.match(/^[0-9a-f ]+$/gi)));return(0,n.UN)(t)},F=e=>{const t=Array(32).fill("f").join(""),a=Array(16).fill(t);return[...e.upper,...Array(14).fill("").map(((t,n)=>[...e.left[n],...a,...e.right[n]])).flat(),...e.lower]};t.Ay=async({images:e,frames:t,settings:a})=>{const s=a.state.images||[],c=a.state.frames||[],u=(await Promise.all(e.map((async e=>{const t=await(0,n.Hh)(e.hash,void 0,!0);if(t?.length)return;const a=await e.getFileContent(),r=await i(a);return e.hash!==r?{oldHash:e.hash,newHash:r}:void 0})))).reduce(l.N,[]),m=(await Promise.all(t.map((async e=>{if(await(0,r.mZ)(e.hash))return;const t=await e.getFileContent(),a=await(async e=>{const t=JSON.parse(e),a=t.upper.length/20,n=F(t);return(0,r.R_)(n,a)})(t);return e.hash!==a?{oldHash:e.hash,newHash:a}:void 0})))).reduce(l.N,[]),d=s.map((e=>{if((0,o.pl)(e)){const t=e,a=u.find((({oldHash:e})=>e===t.hashes.r)),n=u.find((({oldHash:e})=>e===t.hashes.g)),r=u.find((({oldHash:e})=>e===t.hashes.b)),l=u.find((({oldHash:e})=>e===t.hashes.n));return{...t,hashes:{r:a?.newHash||t.hashes.r,g:n?.newHash||t.hashes.g,b:r?.newHash||t.hashes.b,n:l?.newHash||t.hashes.n}}}const t=u.find((({oldHash:t})=>t===e.hash));return{...e,hash:t?.newHash||e.hash}})),p=c.map((e=>{const t=m.find((({oldHash:t})=>t===e.hash));return t?{...e,hash:t.newHash}:e}));return{...a,state:{...a.state,images:d,frames:p}}}},99905:function(e,t,a){"use strict";var n=a(74353),r=a.n(n),l=a(73460),o=a(90445),i=a.n(o),F=a(30498),s=a(38004);r().extend(i());const c=(e,t="-")=>e.reduce(((e,a)=>a?`${e}${e?t:""}${a}`:e),"");t.A=e=>{const t=e.image||null,a=e.palette||null,n=e.exportScaleFactor||null,o=e.useCurrentDate||null,i=e.frameRate?.toString(10)||"",u=e.altTitle||"",m=e.frameName||"",d=e.paletteShort||"",{fileNameStyle:p}=e,g=o||!t?r()():r()(t.created,F.i$),h=g.isValid()?g.format(F.fE):"",f=d||(a?a.shortName||(({r:e,g:t,b:a,n:n})=>{const r=e=>e.toString(16).padStart(2,"0");return c([e?.map(r).join("")||"",t?.map(r).join("")||"",a?.map(r).join("")||"",n?.map(r).join("")||""],".")})(a):""),E=t&&t.title?t.title:u,A=n?`${n}x`:"",v=i?`${i}fps`:"";let b;switch(p){case s.B.TITLE_ONLY:b=[E];break;case s.B.DATE_TITLE:b=[h,E];break;case s.B.FULL:default:b=[h,E,A,v,m,f]}const y=c(b);return(0,l.A)(y,{replacement:""})}}}]);