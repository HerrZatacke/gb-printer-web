(self.webpackChunkgb_printer_web=self.webpackChunkgb_printer_web||[]).push([[991],{"./src/javascript/app/store/middlewares/dropboxStorage/middleware.js":function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return F}}),o("./node_modules/core-js/modules/es.object.to-string.js"),o("./node_modules/core-js/modules/es.promise.js"),o("./node_modules/core-js/modules/web.timers.js"),o("./node_modules/core-js/modules/es.date.to-string.js"),o("./node_modules/core-js/modules/es.array.concat.js"),o("./node_modules/core-js/modules/es.array.iterator.js"),o("./node_modules/core-js/modules/es.string.iterator.js"),o("./node_modules/core-js/modules/web.dom-collections.iterator.js"),o("./node_modules/core-js/modules/es.array.map.js"),o("./node_modules/core-js/modules/es.array.flat.js"),o("./node_modules/core-js/modules/es.array.filter.js"),o("./node_modules/core-js/modules/es.array.find.js"),o("./node_modules/core-js/modules/es.function.name.js"),o("./node_modules/core-js/modules/es.object.define-property.js"),o("./node_modules/core-js/modules/es.object.keys.js"),o("./node_modules/core-js/modules/es.symbol.js"),o("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),o("./node_modules/core-js/modules/es.array.for-each.js"),o("./node_modules/core-js/modules/web.dom-collections.for-each.js"),o("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),o("./node_modules/core-js/modules/es.object.define-properties.js");var r=o("./node_modules/promise-queue/lib/index.js"),n=o.n(r),s=o("./src/javascript/tools/getUploadImages/index.js"),a=o("./src/javascript/tools/saveLocalStorageItems/index.js"),i=(o("./node_modules/core-js/modules/es.function.bind.js"),o("./node_modules/core-js/modules/es.regexp.exec.js"),o("./node_modules/core-js/modules/es.string.split.js"),o("./node_modules/core-js/modules/es.array.join.js"),o("./node_modules/core-js/modules/es.string.replace.js"),o("./node_modules/core-js/modules/es.string.starts-with.js"),o("./node_modules/core-js/modules/es.object.assign.js"),o("./node_modules/core-js/modules/es.string.match.js"),o("./node_modules/core-js/modules/es.object.set-prototype-of.js"),o("./node_modules/core-js/modules/es.object.get-prototype-of.js"),o("./node_modules/core-js/modules/es.reflect.construct.js"),o("./node_modules/core-js/modules/es.object.create.js"),o("./node_modules/core-js/modules/es.array.is-array.js"),o("./node_modules/core-js/modules/es.symbol.description.js"),o("./node_modules/core-js/modules/es.symbol.iterator.js"),o("./node_modules/core-js/modules/es.array.from.js"),o("./node_modules/core-js/modules/es.array.slice.js"),o("./node_modules/dropbox/dist/Dropbox-sdk.min.js")),c=o("./node_modules/events/events.js"),u=o("./src/javascript/tools/readFileAs/index.js"),l=o("./src/javascript/tools/cleanPath/index.js");function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=o){var r,n,s=[],a=!0,i=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(s.push(r.value),!t||s.length!==t);a=!0);}catch(e){i=!0,n=e}finally{try{a||null==o.return||o.return()}finally{if(i)throw n}}return s}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return h(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function j(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?g(e):t}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=encodeURIComponent("".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname)),w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(a,e);var t,o,r,n,s=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(r);if(n){var o=v(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return b(this,e)});function a(e,t){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(o=s.call(this)).queueCallback=t,o.throttle=30;var r=e.accessToken,n=e.expiresAt,c=e.refreshToken,u=e.path;return o.setRootPath(u),o.dbx=new i.Dropbox({clientId:"err6neqzlljod7b",accessToken:r,accessTokenExpiresAt:new Date(n),refreshToken:c}),window.dbx=o.dbx,o.requestError=o.requestError.bind(g(o)),o}return t=a,(o=[{key:"addToQueue",value:function(){return this.dbx.auth.getAccessToken()?this.queueCallback.apply(this,arguments):Promise.reject()}},{key:"setRootPath",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.rootPath=(0,l.Z)(e).split("/")}},{key:"toPath",value:function(e){var t=[].concat(m(this.rootPath),m(e.split("/"))).filter(Boolean);return"/".concat(t.join("/"))}},{key:"inSettingsPath",value:function(e){var t=this.toPath("settings");return(0,l.Z)(e.replace(t,""))}},{key:"checkLoginStatus",value:function(){var e=this;return this.dbx.auth.checkAndRefreshAccessToken().catch(this.requestError).then((function(){var t=e.dbx.auth.getAccessToken(),o=e.dbx.auth.getAccessTokenExpiresAt().getTime(),r=o-(new Date).getTime();return e.emit("loginDataUpdate",{accessToken:t,expiresAt:o}),t&&r>1e3})).catch((function(){return!1}))}},{key:"startAuth",value:function(){var e=this;this.dbx.auth.getAuthenticationUrl(_,void 0,"code","offline",void 0,void 0,!0).then((function(t){window.sessionStorage.setItem("dropboxCodeVerifier",e.dbx.auth.getCodeVerifier()),window.location.replace(t)}))}},{key:"codeAuth",value:function(e){var t=this;this.dbx.auth.setCodeVerifier(window.sessionStorage.getItem("dropboxCodeVerifier")),window.sessionStorage.removeItem("dropboxCodeVerifier"),this.dbx.auth.getAccessTokenFromCode(_,e).then((function(e){var o=e.result,r=o.refresh_token,n=o.access_token,s=o.expires_in,a=(new Date).getTime()+1e3*s;t.dbx.auth.setAccessToken(e.result.access_token),t.dbx.auth.setAccessTokenExpiresAt(new Date(a)),t.emit("loginDataUpdate",{refreshToken:r,accessToken:n,expiresAt:a})}))}},{key:"requestError",value:function(e){throw e.error.error_summary.startsWith("expired_access_token")&&(this.dbx.auth.setAccessTokenExpiresAt(new Date(0)),this.dbx.auth.setAccessToken(null)),new Error(e)}},{key:"getRemoteContents",value:function(){var e=this,t=["images","frames"];return this.checkLoginStatus().then((function(o){if(!o)throw new Error("not logged in");return e.addToQueue("dbx.filesDownload /settings.json",e.throttle,(function(){return e.dbx.filesDownload({path:e.toPath("/settings/settings.json")}).catch(e.requestError)})).catch((function(){return{result:{fileBlob:new Blob(m("{}"),{type:"text/plain"})}}})).then((function(o){var r=o.result.fileBlob;return(0,u.Z)(r,"text").then((function(e){return JSON.parse(e)})).then((function(o){return Promise.all(t.map((function(t){return e.addToQueue("dbx.filesListFolder /".concat(t),e.throttle,(function(){return e.dbx.filesListFolder({path:e.toPath("/settings/".concat(t)),limit:250,recursive:!0}).catch(e.requestError)})).catch((function(){return{result:{entries:[],has_more:!1}}})).then((function(t){var o=t.result,r=o.entries,n=o.has_more,s=o.cursor;return(n?e.getMoreContents(s,r):Promise.resolve(r)).then((function(e){return e.filter((function(e){return"file"===e[".tag"]}))}))}))}))).then((function(t){var r=f(t,2),n=r[0],s=r[1];return{images:e.augmentFileList("images",n),frames:e.augmentFileList("frames",s),settings:o}}))}))}))}))}},{key:"getImageContents",value:function(){var e=this;return this.addToQueue("dbx.filesListFolder /images",this.throttle,(function(){return e.dbx.filesListFolder({path:e.toPath("/images"),limit:250,recursive:!0}).catch(e.requestError)})).catch((function(){return{result:{entries:[],has_more:!1}}})).then((function(t){var o=t.result,r=o.entries,n=o.has_more,s=o.cursor;return(n?e.getMoreContents(s,r):Promise.resolve(r)).then((function(e){return e.filter((function(e){return"file"===e[".tag"]}))}))}))}},{key:"getMoreContents",value:function(e,t){var o=this;return this.addToQueue("dbx.filesListFolderContinue ".concat(e),this.throttle,(function(){return o.dbx.filesListFolderContinue({cursor:e}).catch(o.requestError)})).then((function(e){var r=e.result,n=r.entries,s=r.has_more,a=r.cursor,i=t.concat(n);return s?o.getMoreContents(a,i):i}))}},{key:"augmentFileList",value:function(e,t){var o=this;return t.map((function(r,n){var s=r.path_lower,a=r.name,i=o.inSettingsPath(s),c={path:i,name:a,getFileContent:function(){return o.getFileContent(i,n,t.length)}};switch(e){case"images":return Object.assign(c,{hash:a.substr(0,40)});case"frames":return Object.assign(c,{id:a.match(/^[a-z]+[0-9]+/gi)[0]});default:return c}}))}},{key:"getFileContent",value:function(e,t,o){var r=this;return this.addToQueue("dbx.filesDownload (".concat(t+1,"/").concat(o,") ").concat(e),this.throttle,(function(){return r.dbx.filesDownload({path:r.toPath("/settings/".concat(e))}).catch(r.requestError)})).then((function(e){var t=e.result.fileBlob;return(0,u.Z)(t,"text")}))}},{key:"upload",value:function(e,t){var o=this,r=e.upload,n=void 0===r?[]:r,s=e.del,a=void 0===s?[]:s;return Promise.all([n.length?Promise.all(n.map((function(e,r){return o.addToQueue("dbx.filesUpload (".concat(r+1,"/").concat(n.length,") ").concat(e.destination),o.throttle,(function(){return o.dbx.filesUpload({path:o.toPath("/".concat(t,"/").concat(e.destination)),contents:e.blob,mode:"overwrite"}).catch(o.requestError)})).then((function(e){return e.result}))}))):[],a.length?this.addToQueue("dbx.filesDeleteBatch ".concat(a.length," files"),this.throttle,(function(){return o.dbx.filesDeleteBatch({entries:a.map((function(e){var t=e.path;return{path:o.toPath("/settings/".concat(t))}}))}).catch(o.requestError)})).then((function(e){var t=e.result.async_job_id;return function e(){return o.addToQueue("dbx.filesDeleteBatchCheck ".concat(t),2e3,(function(){return o.dbx.filesDeleteBatchCheck({async_job_id:t}).catch(o.requestError)})).then((function(t){var o=t.result,r=o[".tag"],n=o.entries;return"in_progress"===r?e():n.map((function(e){return e.metadata}))}))}()})):[]]).then((function(e){var t=f(e,2),o=t[0],r=t[1];console.log({uploaded:o,deleted:r})}))}}])&&j(t.prototype,o),a}(c.EventEmitter),x=o("./node_modules/crypto-browserify/index.js"),O=4194304;function S(e,t,o){this.overallHasher=e,this.blockHasher=t,this.blockPos=o}S.prototype.update=function(e,t){if(null===this.overallHasher)throw new Error("can't use this object anymore; you already called digest()");var o=e;if(!Buffer.isBuffer(o)){if(void 0!==t&&"utf8"!==t&&"ascii"!==t&&"latin1"!==t)throw new Error("Invalid 'inputEncoding': ".concat(JSON.stringify(t)));o=Buffer.from(e,t)}for(var r=0;r<o.length;){this.blockPos===O&&(this.overallHasher.update(this.blockHasher.digest()),this.blockHasher=x.createHash("sha256"),this.blockPos=0);var n=O-this.blockPos,s=Math.min(o.length,r+n),a=s-r;this.blockHasher.update(o.slice(r,s)),this.blockPos+=a,r=s}},S.prototype.digest=function(e){if(null===this.overallHasher)throw new Error("can't use this object anymore; you already called digest()");this.blockPos>0&&(this.overallHasher.update(this.blockHasher.digest()),this.blockHasher=null);var t=this.overallHasher.digest(e);return this.overallHasher=null,t},o("./node_modules/core-js/modules/web.url.js"),o("./node_modules/core-js/modules/es.string.search.js");var A,P=o("./src/javascript/tools/download/index.js"),k=o("./src/javascript/tools/getImagePalette/index.js"),T=o("./src/javascript/tools/loadImageTiles/index.js"),E=o("./src/javascript/tools/replaceDuplicateFilenames/index.js"),R=o("./src/javascript/tools/getFilteredImages/index.js");function C(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function D(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?C(Object(o),!0).forEach((function(t){I(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):C(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function I(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var B=function(){},F=function(e){var t=new(n())({concurrency:1});B=function(o){return function(r,n,s){return t.add((function(){return new Promise((function(t,a){window.setTimeout((function(){e.dispatch({type:"DROPBOX_LOG_ACTION",payload:{timestamp:(new Date).getTime()/1e3,message:"".concat(o," runs ").concat(r)}}),s().then(t).catch(a)}),n)}))}))}},(A=new w(e.getState().dropboxStorage,B("Dropbox"))).on("loginDataUpdate",(function(t){e.dispatch({type:"SET_DROPBOX_STORAGE",payload:D(D({},e.getState().dropboxStorage),t)})}));var o=function(){var e=new URLSearchParams(window.location.search).get("code");return e?(window.history.replaceState({},document.title,"./"),window.location.replace("#/settings/dropbox"),{dropboxCode:e}):{}}().dropboxCode;return o&&A.codeAuth(o),function(t){if("SET_DROPBOX_STORAGE"===t.type&&A.setRootPath(e.getState().dropboxStorage.path||"/"),"STORAGE_SYNC_START"===t.type){if("dropbox"===t.payload.storageType)A.getRemoteContents().then((function(o){switch(t.payload.direction){case"up":return(0,s.Z)(e,o,B("GBPrinter")).then((function(e){return A.upload(e,"settings")}));case"down":return(0,a.Z)(o).then((function(t){return e.dispatch({type:"DROPBOX_SETTINGS_IMPORT",payload:o.settings}),t}));default:return Promise.reject(new Error("dropbox sync: wrong sync case"))}})).then((function(t){e.dispatch({type:"STORAGE_SYNC_DONE",payload:{syncResult:t,storageType:"dropbox"}})})).catch((function(t){console.error(t),e.dispatch({type:"ERROR",payload:t.message})}));else if("dropboximages"===t.payload.storageType){var o=e.getState(),r=(0,R.Z)(o),n=(0,P.j)(o),i=(0,T.Z)(o);Promise.all(r.map((function(e,t){return B("Generate images and hashes")("".concat(t,"/").concat(r.length),0,(function(){var t=(0,k.Z)(o,e);return i(e).then(n(t,e)).then((function(e){return Promise.all(e.map((function(e){var t=new S(x.createHash("sha256"),x.createHash("sha256"),0);return e.blob.arrayBuffer().then((function(o){return t.update(o),D(D({},e),{},{dropboxContentHash:t.digest("hex")})}))})))}))}))}))).then((function(e){return e.flat()})).then(E.Z).then((function(e){return A.getImageContents().then((function(o){switch(t.payload.direction){case"up":var r=e.filter((function(e){var t=e.dropboxContentHash,r=e.uFilename;return!o.find((function(e){var o=e.content_hash,n=e.name;return o===t&&n===r}))})).map((function(e){return D(D({},e),{},{destination:e.uFilename})}));return A.upload({upload:r,del:[]},"images");default:return Promise.reject(new Error("dropbox sync: wrong sync case"))}}))})).then((function(t){e.dispatch({type:"STORAGE_SYNC_DONE",payload:{syncResult:t,storageType:"dropbox"}})})).catch((function(t){console.error(t),e.dispatch({type:"ERROR",payload:t.message})}))}}else"DROPBOX_START_AUTH"===t.type&&A.startAuth()}}},"./src/javascript/tools/cleanPath/index.js":function(e,t,o){"use strict";o("./node_modules/core-js/modules/es.regexp.exec.js"),o("./node_modules/core-js/modules/es.string.replace.js"),t.Z=function(e){return e.replace(/[^a-z0-9/\\._-]/gi,"").replace(/[\\/]+/gi,"/").replace(/^\//,"").replace(/\/$/,"")}},"./src/javascript/tools/getUploadImages/index.js":function(e,t,o){"use strict";o.d(t,{Z:function(){return y}}),o("./node_modules/core-js/modules/es.array.map.js"),o("./node_modules/core-js/modules/es.array.filter.js"),o("./node_modules/core-js/modules/es.array.find.js"),o("./node_modules/core-js/modules/es.function.name.js"),o("./node_modules/core-js/modules/es.regexp.exec.js"),o("./node_modules/core-js/modules/es.string.match.js"),o("./node_modules/core-js/modules/es.array.iterator.js"),o("./node_modules/core-js/modules/es.object.to-string.js"),o("./node_modules/core-js/modules/es.promise.js"),o("./node_modules/core-js/modules/es.string.iterator.js"),o("./node_modules/core-js/modules/web.dom-collections.iterator.js"),o("./node_modules/core-js/modules/es.array.concat.js"),o("./node_modules/core-js/modules/es.object.define-property.js"),o("./node_modules/core-js/modules/es.object.keys.js"),o("./node_modules/core-js/modules/es.symbol.js"),o("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),o("./node_modules/core-js/modules/es.array.for-each.js"),o("./node_modules/core-js/modules/web.dom-collections.for-each.js"),o("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),o("./node_modules/core-js/modules/es.object.define-properties.js"),o("./node_modules/core-js/modules/es.array.is-array.js"),o("./node_modules/core-js/modules/es.symbol.description.js"),o("./node_modules/core-js/modules/es.symbol.iterator.js"),o("./node_modules/core-js/modules/es.array.from.js"),o("./node_modules/core-js/modules/es.array.slice.js");var r=o("./src/javascript/tools/download/getPrepareFiles.js"),n=o("./src/javascript/tools/loadImageTiles/index.js"),s=o("./src/javascript/tools/getImagePalette/index.js"),a=o("./src/javascript/tools/applyFrame/frameData.js");function i(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?c(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}o("./node_modules/core-js/modules/es.array.index-of.js");var u=(o("./node_modules/core-js/modules/es.string.split.js"),o("./node_modules/core-js/modules/es.array.join.js"),o("./src/javascript/tools/getGetSettings/index.js"));function l(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?d(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function f(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?m(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function p(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?p(Object(o),!0).forEach((function(t){j(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function j(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var y=function(e,t,o){var c=e.getState(),d=(0,r.Z)(h(h({},c),{},{exportScaleFactors:[1],exportFileTypes:["txt"],handleExportFrame:"keep"})),m=function(e){var t=(0,u.Z)(e);return function(e){var o=[],r=[],n={};e.forEach((function(e){var t=e.hash,s=e.files,a=e.inRepo;r.push.apply(r,l(a.map((function(e){var t=e.path,o=t.split("/")[0];return n[o]=n[o]?n[o]+1:1,{destination:t}})))),o.push.apply(o,l(s.map((function(e){var o=e.blob,r=e.folder,s=function(e){switch(e){case"image/png":return"png";case"image/jpg":case"image/jpeg":return"jpg";case"image/webp":return"webp";case"text/plain":return"txt";case"text/markdown":return"md";case"application/json":case"text/json":return"json";default:return console.warn('unknown file extension for type "'.concat(e,'"')),"none"}}(o.type),a=r||s;return n[a]=n[a]?n[a]+1:1,{destination:"".concat(a,"/").concat(t,".").concat(s),blob:o}}))))}));var s=["## Files in this repo:"].concat(l(Object.keys(n).map((function(e){return" * ".concat(e,": [").concat(n[e],"](/").concat(e,")")})))).join("\n");return t("remote").then((function(e){return o.push({destination:"README.md",blob:new Blob(l(s),{type:"text/plain"})},{destination:"settings.json",blob:new Blob(l(e),{type:"application/json"})}),{toUpload:o.filter(Boolean),toKeep:r.filter(Boolean)}}))}}(e),p=[],j=c.images.filter((function(e){return!e.hashes})).map((function(e){return h(h({},e),{},{inRepo:[t.images.find((function(t){return t.name.substr(0,40)===e.hash}))].filter(Boolean)})})),y=j.length,b=c.frames.map((function(e){return h(h({},e),{},{inRepo:[t.frames.find((function(t){return t.name.match(/^[a-z]+[0-9]+/gi)[0]===e.id}))].filter(Boolean)})})),g=b.length;return Promise.all([].concat(f(j.map((function(e,t){return e.inRepo.length?h(h({},e),{},{inRepo:e.inRepo,files:[]}):o("loadImageTiles (".concat(t+1,"/").concat(y,") ").concat(e.title),3,(function(){return(0,n.Z)(c)(e,!0).then((function(t){return t.length?d((0,s.Z)(c,e),e)(t).then((function(t){return h(h({},e),{},{files:t})})):(p.push(e.hash),Promise.resolve(null))}))}))}))),f(b.map((function(e,t){return e.inRepo.length?h(h({},e),{},{inRepo:e.inRepo,files:[]}):o("loadFrameData (".concat(t+1,"/").concat(g,") ").concat(e.id),3,(function(){return(0,a.v)(e.id).then((function(t){return h(h({},e),{},{hash:e.id,files:[{folder:"frames",filename:"",blob:new Blob(new Array(JSON.stringify(t||"{}",null,2)),{type:"application/json"}),title:e.name}]})}))}))}))))).then((function(e){return m(e.filter(Boolean))})).then((function(e){var o=e.toUpload,r=e.toKeep;return function(e,t,o,r){var n=e.images,s=e.frames;return{upload:t.filter((function(e){var t=e.destination;return!n.find((function(e){return e.path===t}))&&!s.find((function(e){return e.path===t}))})),del:[].concat(i(i(n).filter((function(e){var n=e.path;return!o.find((function(e){var t=e.destination;return n===t}))&&!t.find((function(e){var t=e.destination;return n===t}))&&!r.find((function(e){return n.indexOf(e)>=-1}))}))),i(i(s).filter((function(e){var r=e.path;return!o.find((function(e){var t=e.destination;return r===t}))&&!t.find((function(e){var t=e.destination;return r===t}))}))))}}(t,o,r,p)}))}},"./src/javascript/tools/saveLocalStorageItems/index.js":function(e,t,o){"use strict";o("./node_modules/core-js/modules/es.array.iterator.js"),o("./node_modules/core-js/modules/es.object.to-string.js"),o("./node_modules/core-js/modules/es.promise.js"),o("./node_modules/core-js/modules/es.string.iterator.js"),o("./node_modules/core-js/modules/web.dom-collections.iterator.js"),o("./node_modules/core-js/modules/es.array.concat.js"),o("./node_modules/core-js/modules/es.array.map.js"),o("./node_modules/core-js/modules/es.array.filter.js"),o("./node_modules/core-js/modules/es.regexp.exec.js"),o("./node_modules/core-js/modules/es.string.split.js"),o("./node_modules/core-js/modules/es.string.match.js"),o("./node_modules/core-js/modules/es.array.join.js"),o("./node_modules/core-js/modules/es.array.fill.js"),o("./node_modules/core-js/modules/es.array.flat.js"),o("./node_modules/core-js/modules/es.array.is-array.js"),o("./node_modules/core-js/modules/es.symbol.js"),o("./node_modules/core-js/modules/es.symbol.description.js"),o("./node_modules/core-js/modules/es.symbol.iterator.js"),o("./node_modules/core-js/modules/es.array.from.js"),o("./node_modules/core-js/modules/es.array.slice.js"),o("./node_modules/core-js/modules/es.function.name.js");var r=o("./src/javascript/tools/storage/index.js"),n=o("./src/javascript/tools/applyFrame/frameData.js");function s(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?a(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}t.Z=function(e){var t=e.images,o=e.frames,a=t.length,i=o.length;return Promise.all([].concat(s(t.map((function(e,t){return(0,r.zD)(e.hash,null,!0).then((function(o){return o.length?e.hash:e.getFileContent(e.sha,t,a).then((function(e){var t=e.split("\n").filter((function(e){return e.match(/^[0-9a-f ]+$/gi)}));return(0,r.a1)(t)}))}))}))),s(o.map((function(e,t){return(0,n.v)(e.id).then((function(o){return o?e.id:e.getFileContent(e.sha,t,i).then((function(t){var o=JSON.parse(t,null,2),r=Array(32).fill("f").join(""),a=Array(16).fill(r),i=[].concat(s(o.upper),s(Array(14).fill().map((function(e,t){return[].concat(s(o.left[t]),s(a),s(o.right[t]))})).flat()),s(o.lower));return(0,n.e)(e.id,i)}))}))})))))}},"?d546":function(){},"?8131":function(){},"?3fc0":function(){},"?cad2":function(){},"?593c":function(){},"?cd53":function(){},"?4068":function(){},"?e7e4":function(){},"?a2b8":function(){},"?14d3":function(){},"?7bec":function(){},"?802b":function(){},"?1e44":function(){},"?0aec":function(){},"?fbf1":function(){}}]);
//# sourceMappingURL=dmw.js.map